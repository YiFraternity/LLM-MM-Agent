{
  "tasks": [],
  "problem_str": "问题背景：\nASIC芯片上的载波恢复DSP算法设计与实现\n\n光数字信号处理（DSP）芯片是光传输领域里的“心脏”，这种芯片往往是基于专用集成电路（ASIC）实现的。例如，采用7nm芯片工艺制造的光传输芯片容量可以达到800Gbps，相当于单光纤可实现48Tbps的容量，保障了网络流量的爆发型增长。ASIC芯片的DSP算法设计通常包含两个主要步骤，第一步是根据信道损伤的物理模型设计补偿算法，此时只需要考虑浮点计算；第二步是根据芯片资源和功耗约束，将算法改造成ASIC芯片可实现的定点形式，此时需要将算法细化为芯片上最基本的乘、加等运算，并考虑定点量化噪声的影响。怎样权衡性能和资源，实现具体场景下的最优设计，是DSP芯片算法工程领域持久不变的课题。本题以oDSP中一种关键的载波恢复算法为例，探讨算法与芯片的最优工程设计。\n\n首先介绍关于基本通信系统和ASIC芯片上算法设计的基本知识。\n\n一、通信系统模型\n\n本题考虑一个简化的数字通信系统性能评估模型，如图1所示。发送端编码后的二进制序列映射调制为星座点上的符号并向外发送，每秒发送的符号个数称为波特率fBaud。信号在信道中受到色散和相位噪声的影响，并人为加入加性高斯白噪声，噪声量用信号和噪声功率的比值表示。接收端先补偿色散，再由载波恢复(Carrier Recovery, CR)算法补偿相位噪声，最后信号进行判决后逆映射为二进制比特序列。受信道中损伤和噪声影响，星座图会发生扩散，从而导致信号判错，使接收到的二进制序列与发端不一致，从而带来误码。错误二进制比特占总二进制比特的比率称为误码率（BER）。只要BER小于某个门限，那么纠错编码后的BER就能够小于1e-15次方量级，达到工程意义上的“无误码”传输。本题中不考虑纠错编码，BER均指直接判决后的BER。\n\n算法评估中常用RSNR（Required SNR）代价来评估算法性能。 SNR(Signal-to-Noise Ratio)指的是信号功率和噪声功率的比例。例如图1中，若只有加性高斯白噪声存在时，对于给定的调制格式，SNR和BER存在关系也就确定了。将BER达到门限时信道中施加的SNR定义为Required SNR (RSNR)，它可理解为系统能够容忍的噪声量。当存在相位噪声、色散等干扰后，相同纠前门限点对应的SNR值会提高，说明系统能够容忍的噪声量减少了，将RSNR的增加部分称为RSNR代价。RSNR代价是衡量系统和算法性能的常用指标。例如CR算法性能越好，那么RSNR代价也应该越低。图1 模型计算RSNR的噪声是“人为”加入的，目的是用于评估系统性能。现实光传输系统中，噪声可能有来自于电器件、光器件、光放大器等各种系统组件。\n\n下面对模型中的术语做进一步解释。\n\n\n\n图1 简化数字通信系统性能评估模型\n\n【调制、星座图与误码率BER】\n\n二进制序列通常需要将K个比特作为一个“符号”进行传输，每个符号有个不同状态。光传输利用光波的复振幅承载信号，因此可用复平面上不同的点来对应不同的符号状态，这种将符号状态画在复平面上的图称为“星座图”，图上的点称为“星座点”。如图2(a)所示的QPSK（Quadrature Phase Shift Keying）调制，经过信道叠加噪声和接收机处理后，接收端的星座图不再是理想的四个点，而是会出现扩散。当接收机收到1个符号时，就将发送的符号判定为离该符号最近的星座点。显然，如果噪声过大，接收到的符号可能被判错从而产生误码，如图2(b)中的蓝点。误码率（Bit Error Ratio, BER）定义为错误的比特数占总传输比特数的比例，例如传输了50个符号共100个比特，其中有1个符号被误判为相邻的符号，错误了 1 个 bit，则误码率为 0.01。BER 是衡量通信系统性能的最根本指标。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=\\textwidth]{image.png}\n    \\caption{(a) 星座图与噪声导致误码的示意图 (b) 信号和噪声的相关定义示意图}\n    \\label{fig:noise_and_signal}\n\\end{figure}\n\n图 \\ref{fig:noise_and_signal}(b) 中理想星座点用 $\\mathbf{S}_k$ 表示，接收到的符号用 $\\mathbf{r}_k$ 表示，则噪声为\n\n\\begin{equation}\nn_k = r_k - S_k\n\\tag{1}\n\\end{equation}\n\n噪声通常服从均值为 0 的正态分布。噪声的方差等于噪声的平均功率，定义为\n\n\\begin{equation}\nP_{\\text{n}} = \\frac{1}{N} \\sum_{k=1}^{N} |n_k|^2\n\\tag{2}\n\\end{equation}\n\n其中 $N$ 为总共传输的符号数。信号平均功率定义为发送符号绝对值平方的均值：\n\n\\begin{equation}\nP_{\\text{s}} = \\frac{1}{N} \\sum_{k=1}^{N} |S_k|^2\n\\tag{3}\n\\end{equation}\n\n定义信号和噪声功率的比值为信噪比（Signal-to-Noise Ratio，SNR），\n\n\\begin{equation}\n\\text{SNR} = \\frac{P_{\\text{s}}}{P_{\\text{n}}}\n\\tag{4}\n\\end{equation}\n\n工程上通常用 dB 作为 SNR 的单位，定义为\n\n\\begin{equation}\n\\text{SNR}(\\text{dB}) = 10 \\log_{10} \\left( \\frac{P_{\\text{s}}}{P_{\\text{n}}} \\right)\n\\tag{5}\n\\end{equation}\n\n\\textbf{【相位噪声与 CR 算法】}\n\n相噪会对信号叠加一个时变的相位，\n\n\\begin{equation}\nS_1(t) = S_0(t) \\exp \\{ j \\theta(t) \\}\n\\tag{6}\n\\end{equation}\n\n其中 $S_0(t)$ 是叠加相噪前的波形，$S_1(t)$ 是叠加相噪后的波形，$\\theta(t)$ 是相噪。通信系统常用等间隔采样后的离散方式表示，每个采样点对应了某个时刻采样到的波形。对于相位噪声，$k+1$ 时刻和 $k$ 时刻的相位差表示为：\n\n\\begin{equation}\nd\\theta = \\theta_{k+1} - \\theta_k = \\left( \\sqrt{\\frac{2\\pi \\cdot LW}{f_b}} \\right) \\cdot X_k\n\\tag{7}\n\\end{equation}\n\n其中 $LW$ 是一个激光器线宽指标，单位为 kHz。$f_b$ 是波特率，而 $X_k$ 是均值为 0，方差为1的随机变量。一个典型的相噪随时间变化的规律如图4所示，相位变化也有可能演化到负值。\n\n\n\n图4 典型相位噪声演化曲线\n\n如图5所示，典型的CR算法是间隔性地插入已知的导频符号（Pilot），通过比较接收信号和已知符号的相位差，来估算出当前的相位噪声，再将此相位差反乘到接收端受影响的符号上，就实现了相位噪声的补偿。Pilot占总符号的比例称为Pilot开销，例如每N个符号中包含M个Pilot，则开销为M/N。在设计CR算法时可以有各种考虑：例如应该尽可能减小Pilot以降低系统开销，因为Pilot本身为已知量并不传递信息；间插Pilot之间净荷的相位可以通过各种插值方法来近似；加性白噪会影响相位估计精度，可以用2个连续的Pilot符号求平均以抑制白噪影响，也可以在间插的Pilot之间求平均。当然，以上仅是举例，实际CR算法不限于此。\n\n\n\n图5 Pilot的载波恢复算法\n\n【色散与色散补偿算法】\n   \n光纤中色散的效应，可认为是对信号直接做傅里叶变换后的频域数据施加 1 个随频点平方关系变化的相位，如式 (8) 所示。\n\n\\begin{equation}\nH(f) = \\exp \\left[ j * \\left( \\frac{\\lambda^2 \\pi D z}{c} f^2 \\right) \\right]\n\\tag{8}\n\\end{equation}\n\n其中 $\\lambda$ 是波长，取 $1550\\,\\text{nm}$，$D_z$ 是色散值，$c$ 是光速，$f$ 则是频点。本题中，信道中施加色散和算法中补偿色散如图 \\ref{fig:dispersion} 所示，假设色散值已知，则先 FFT 将接收到的数据转换到频域，再乘上式中的频域响应，随后再 IFFT 转换回时域即可。信道中色散的频域响应和算法中补偿色散的频域响应呈共轭关系。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=0.8\\textwidth]{dispersion_diagram.png}\n    \\caption{色散和色散补偿方法}\n    \\label{fig:dispersion}\n\\end{figure}\n\n\\section{ASIC 芯片上的算法实现}\n\n与我们通常在计算机上开展的基于软件的数学计算不同，在 ASIC 上的计算是基于硬件电路展开的。例如要计算某个公式，通用计算机上是转换为一条条逻辑指令，按时间顺序在相同的 CPU 中运行，最终输出结果。而在 ASIC 上开展的计算，则是把计算过程拆分为具体的加法、乘法等基本操作，每一个基本操作都对应了不同的专用逻辑电路，在芯片上各自占据了一定的面积。设计 ASIC 芯片上的 DSP 算法，需要考虑并行实现，定点量化，时序约束，和资源/功耗约束等约束，下面简要叙述。\n\n\\subsection{并行实现}\n\n芯片上的计算都是在系统时钟下，以一拍一拍的节奏运行的。芯片计算的吞吐量必须要大于信号传输速度，才能确保信息不丢失。如果采用串行的处理方式，芯片时钟频率极高，而芯片的功耗与时钟主频率近似呈平方关系，显然不能通过一味提升主频的方式增加处理流量，必须采用并行处理的方法，以资源换取处理流量的提升。例如图 \\ref{fig:square_operation} 中所示的求平方操作，串行情况下 1 个时钟周期处理 1 个符号，100G 的波特率至少需要 100GHz 的时钟主频，远远超出了现实能达到的水平。若付出 $N$ 倍的资源，每次同时计算 $N$ 个符号，则时钟主频仅为 $1/N$，功耗大大降低。当前 oDSP 时钟主频在 $500\\,\\text{MHz} \\sim 1\\,\\text{GHz}$ 量级，对应符号的并行度约为 $100 \\sim 200$ 量级。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=0.5\\textwidth]{square_operation_diagram.png}\n    \\caption{求平方操作}\n    \\label{fig:square_operation}\n\\end{figure}\n\n\n\n图7 ASIC芯片并行运算示意图\n\n计算机中常用双精度浮点数来定义参变量，而ASIC通常用定点数来表示参变量的大小。双精度浮点数在大多数计算情况下几乎没有精度损失，而ASIC定点数因为位数往往较小，舍入误差增大，带来量化噪声。表示定点数的二进制位数称为定点位宽。定点数常分为有符号和无符号位2种，如下图所示，例如S(8,4)表示有符号的8-bit定点数，其中小数位占4位；u(7,4)代表无符号的7-bit定点数，其中小数位占4位。单个定点数仅能代表实数，复数则用2个定点分别代表实部和虚部。在ASIC中任何计算都应量化为定点数的计算，量化噪声的影响也是算法设计的关键之一。例如CR相噪算法中，收端受影响的符号往往用6~9bit定点数表示，而计算相噪部分的位宽则根据实际情况而变化。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=0.8\\textwidth]{image2.png}\n    \\caption{定点表示法}\n    \\label{fig:fixed_point}\n\\end{figure}\n\n\\section{基本操作、时序约束和资源/功耗约束}\n\n【基本操作、时序约束和资源/功耗约束】\n\nASIC 上的算法设计，需要将计算拆解为基本的操作。本题中考虑加法、乘法，查表和数据缓存四类操作，其表示如图 \\ref{fig:asic_operations} 所示。加法和乘法均是对两个数开展，复数运算拆分实部和虚部各自计算。减法可认为是先做一次乘以 $-1$ 的乘法，再做一次加法。ASIC 上由于是二进制定点数表示，乘以或除以 $2$ 的幂次方相当于对小数点进行移位，不会带来额外的资源代价。查表用于加法和乘法无法直接实现的操作。例如求 $\\sin$ 函数，可以将输入-输出映射关系分别量化为离散输入-输出对应关系，通过查表的方式求得输出。例如求 $d = \\sin\\left(\\frac{a+b}{2} * c\\right)$，首先一级加法计算 $a+b$，再通过移位得到 $\\frac{a+b}{2}$，随后一级乘法得到 $\\frac{a+b}{2} * c$，最后通过 $\\sin$ 查表的方式得到 $d$。每种运算都对应了芯片上的资源。显然，参与运算的数据位宽越大，占用的资源也会更多。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=0.8\\textwidth]{asic_operations.png}\n    \\caption{ASIC 芯片基本运算操作}\n    \\label{fig:asic_operations}\n\\end{figure}\n\n另一方面，芯片是在时钟主频下一拍一拍运行，一拍运行中只能完成有限个连续的基本运算，但通过加缓存的方式，可以实现流水的结构。例如图 \\ref{fig:buffer_pipeline} 中，若运算 1 结果出来的时候，一拍内剩余的时间无法完成运算 2，则需要在运算 1 的出口加入 1 级 buff 缓存以存储运算 1 的输出数据。每拍运算时，运算 2 读取 buff 中存储的运算 1 的上一拍输出开展计算，而运算 1 则和当前输入数据开展运算，并将结果在存入 buff 中，这样一来，每拍运行可以同时开展运算 1 和运算 2，但会造成输出的结果会比运算 1 和运算 2 在同一拍完成的情况延迟 1 拍。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=0.8\\textwidth]{buffer_pipeline.png}\n    \\caption{缓存实现流水结构}\n    \\label{fig:buffer_pipeline}\n\\end{figure}\n\n不同的运算路径有着不同的时钟延迟，当算法存在不同的计算路径时，需要保证每个路径的延时对准。例如在 CR 算法中，计算出的相位噪声差需要反乘回数据，但相噪计算通常无法在 1 拍内完成，从而导致相位和数据有延时，需要用 buffer 将延时对准。本题中，假设 1 个时钟周期最多完成 1 级乘法，4 级加法，以及 1 级查表操作。\n\n加法、乘法、查表和缓存均需要占用资源，在算法设计也应有所考虑。加法和乘法均是两两操作，加法资源近似与最大位宽呈正比，乘法资源近似与位宽乘积成正比，延时资源和位宽以及延时深度近似呈正比。对于一个M-N的查表，资源与(2^M)*N呈正比。M代表输入位宽，N代表输出位宽，例如：已知信号求相位的查表操作，信号位宽s(10,1)，相位位宽s(9,1)，此时的M=20，N=9。在查表时候的输入为信号的【实部 虚部】组合，需要遍历的地址有2^20，每个地址对应的相位值的位宽为s(9,1)。\n\n\\begin{table}\n\\centering\n\\caption{表1}\n\\begin{tabular}{|c|c|c|c|c|}\n\\hline\n基本操作 & 8+8bit & 8*8bit & 8bit-8bit查表 & 8bit, \\\\\n & 加法器 & 乘法器 & & 每2048符号延时 \\\\\n\\hline\n资源 & 1U & 8U & 128U & 1U \\\\\n\\hline\n\\end{tabular}\n\\end{table}\n\n三、ASIC芯片算法设计的典型步骤\n  \n  综合上述内容，芯片上算法设计的通常包含以下具体步骤：\n\n1) 根据物理模型和系数特性设计算法原型：例如CR算法中，采用Pilot估计相位差，并利用插值等方法计算出净荷的相噪，最终将估计的相位差乘回数据以补偿相噪。\n2）在考虑并行度和时序约束的基础上，将算法细化为可实现的基本操作，并大致考虑算法的实现复杂度对算法实现的影响。此时可假设为浮点数，不需要考虑定点量化噪声。例如CR算法中，可能需要考虑净荷相噪的插值如何由基本操作实现，计算噪声路径的延时如何与补偿噪声路径的延时相匹配等。\n3） 进一步考虑定点量化噪声的影响，尽量以更低的资源实现，此时位宽优化是一个关键步骤。\n\n问题要求：\n问题1：考虑波特率为150Gbaud的标准16QAM信号，令线宽为100kHz，色散值为2万ps/nm，算法的并行度固定为128，不考虑定点量化。请以基本的加法、乘法、查表和缓存为基础，并以RSNR代价<0.3dB为目标，设计一套CR算法，使得Pilot开销最小？\n\n问题2：考虑线宽从10kHz~10MHz，色散Dz从0~10,000 ps/nm变化场景，以RSNR代价<0.3dB为目标，定量挖掘色散、线宽与Pilot开销的关系。\n\n问题3：在问题2的场景上，进一步将芯片实现的资源纳入考察，此时需考虑定点量化对性能和资源的影响，且导频开销可任意变化（但必须确保净荷的流量为>145Gbaud），如何设计资源最低的CR算法？\n\n问题4：现实中性能和资源的权衡与具体场景有关。例如长距干线传输对性能要求往往比短距离要求更高，长距传输可付出更多的资源以降低RSNR代价。并选出问题3中你队认为有代表性的1种场景，给出统筹性的“性能-资源”综合考虑下的算法设计思路，构造性能和资源的综合代价函数，尝试给出一套自动优化位宽和实现性设计的方案，并给出定量结果，用以指导算法开发。\n\n注：本题中均不考虑色散补偿和误码率计算的复杂度和资源，只需考虑CR算法（计算相噪+补偿相噪）相关的资源即可。\nAddendum: \n注：本题中均不考虑色散补偿和误码率计算的复杂度和资源，只需考虑CR算法（计算相噪+补偿相噪）相关的资源即可。",
  "problem": {
    "background": "ASIC芯片上的载波恢复DSP算法设计与实现\n\n光数字信号处理（DSP）芯片是光传输领域里的“心脏”，这种芯片往往是基于专用集成电路（ASIC）实现的。例如，采用7nm芯片工艺制造的光传输芯片容量可以达到800Gbps，相当于单光纤可实现48Tbps的容量，保障了网络流量的爆发型增长。ASIC芯片的DSP算法设计通常包含两个主要步骤，第一步是根据信道损伤的物理模型设计补偿算法，此时只需要考虑浮点计算；第二步是根据芯片资源和功耗约束，将算法改造成ASIC芯片可实现的定点形式，此时需要将算法细化为芯片上最基本的乘、加等运算，并考虑定点量化噪声的影响。怎样权衡性能和资源，实现具体场景下的最优设计，是DSP芯片算法工程领域持久不变的课题。本题以oDSP中一种关键的载波恢复算法为例，探讨算法与芯片的最优工程设计。\n\n首先介绍关于基本通信系统和ASIC芯片上算法设计的基本知识。\n\n一、通信系统模型\n\n本题考虑一个简化的数字通信系统性能评估模型，如图1所示。发送端编码后的二进制序列映射调制为星座点上的符号并向外发送，每秒发送的符号个数称为波特率fBaud。信号在信道中受到色散和相位噪声的影响，并人为加入加性高斯白噪声，噪声量用信号和噪声功率的比值表示。接收端先补偿色散，再由载波恢复(Carrier Recovery, CR)算法补偿相位噪声，最后信号进行判决后逆映射为二进制比特序列。受信道中损伤和噪声影响，星座图会发生扩散，从而导致信号判错，使接收到的二进制序列与发端不一致，从而带来误码。错误二进制比特占总二进制比特的比率称为误码率（BER）。只要BER小于某个门限，那么纠错编码后的BER就能够小于1e-15次方量级，达到工程意义上的“无误码”传输。本题中不考虑纠错编码，BER均指直接判决后的BER。\n\n算法评估中常用RSNR（Required SNR）代价来评估算法性能。 SNR(Signal-to-Noise Ratio)指的是信号功率和噪声功率的比例。例如图1中，若只有加性高斯白噪声存在时，对于给定的调制格式，SNR和BER存在关系也就确定了。将BER达到门限时信道中施加的SNR定义为Required SNR (RSNR)，它可理解为系统能够容忍的噪声量。当存在相位噪声、色散等干扰后，相同纠前门限点对应的SNR值会提高，说明系统能够容忍的噪声量减少了，将RSNR的增加部分称为RSNR代价。RSNR代价是衡量系统和算法性能的常用指标。例如CR算法性能越好，那么RSNR代价也应该越低。图1 模型计算RSNR的噪声是“人为”加入的，目的是用于评估系统性能。现实光传输系统中，噪声可能有来自于电器件、光器件、光放大器等各种系统组件。\n\n下面对模型中的术语做进一步解释。\n\n\n\n图1 简化数字通信系统性能评估模型\n\n【调制、星座图与误码率BER】\n\n二进制序列通常需要将K个比特作为一个“符号”进行传输，每个符号有个不同状态。光传输利用光波的复振幅承载信号，因此可用复平面上不同的点来对应不同的符号状态，这种将符号状态画在复平面上的图称为“星座图”，图上的点称为“星座点”。如图2(a)所示的QPSK（Quadrature Phase Shift Keying）调制，经过信道叠加噪声和接收机处理后，接收端的星座图不再是理想的四个点，而是会出现扩散。当接收机收到1个符号时，就将发送的符号判定为离该符号最近的星座点。显然，如果噪声过大，接收到的符号可能被判错从而产生误码，如图2(b)中的蓝点。误码率（Bit Error Ratio, BER）定义为错误的比特数占总传输比特数的比例，例如传输了50个符号共100个比特，其中有1个符号被误判为相邻的符号，错误了 1 个 bit，则误码率为 0.01。BER 是衡量通信系统性能的最根本指标。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=\\textwidth]{image.png}\n    \\caption{(a) 星座图与噪声导致误码的示意图 (b) 信号和噪声的相关定义示意图}\n    \\label{fig:noise_and_signal}\n\\end{figure}\n\n图 \\ref{fig:noise_and_signal}(b) 中理想星座点用 $\\mathbf{S}_k$ 表示，接收到的符号用 $\\mathbf{r}_k$ 表示，则噪声为\n\n\\begin{equation}\nn_k = r_k - S_k\n\\tag{1}\n\\end{equation}\n\n噪声通常服从均值为 0 的正态分布。噪声的方差等于噪声的平均功率，定义为\n\n\\begin{equation}\nP_{\\text{n}} = \\frac{1}{N} \\sum_{k=1}^{N} |n_k|^2\n\\tag{2}\n\\end{equation}\n\n其中 $N$ 为总共传输的符号数。信号平均功率定义为发送符号绝对值平方的均值：\n\n\\begin{equation}\nP_{\\text{s}} = \\frac{1}{N} \\sum_{k=1}^{N} |S_k|^2\n\\tag{3}\n\\end{equation}\n\n定义信号和噪声功率的比值为信噪比（Signal-to-Noise Ratio，SNR），\n\n\\begin{equation}\n\\text{SNR} = \\frac{P_{\\text{s}}}{P_{\\text{n}}}\n\\tag{4}\n\\end{equation}\n\n工程上通常用 dB 作为 SNR 的单位，定义为\n\n\\begin{equation}\n\\text{SNR}(\\text{dB}) = 10 \\log_{10} \\left( \\frac{P_{\\text{s}}}{P_{\\text{n}}} \\right)\n\\tag{5}\n\\end{equation}\n\n\\textbf{【相位噪声与 CR 算法】}\n\n相噪会对信号叠加一个时变的相位，\n\n\\begin{equation}\nS_1(t) = S_0(t) \\exp \\{ j \\theta(t) \\}\n\\tag{6}\n\\end{equation}\n\n其中 $S_0(t)$ 是叠加相噪前的波形，$S_1(t)$ 是叠加相噪后的波形，$\\theta(t)$ 是相噪。通信系统常用等间隔采样后的离散方式表示，每个采样点对应了某个时刻采样到的波形。对于相位噪声，$k+1$ 时刻和 $k$ 时刻的相位差表示为：\n\n\\begin{equation}\nd\\theta = \\theta_{k+1} - \\theta_k = \\left( \\sqrt{\\frac{2\\pi \\cdot LW}{f_b}} \\right) \\cdot X_k\n\\tag{7}\n\\end{equation}\n\n其中 $LW$ 是一个激光器线宽指标，单位为 kHz。$f_b$ 是波特率，而 $X_k$ 是均值为 0，方差为1的随机变量。一个典型的相噪随时间变化的规律如图4所示，相位变化也有可能演化到负值。\n\n\n\n图4 典型相位噪声演化曲线\n\n如图5所示，典型的CR算法是间隔性地插入已知的导频符号（Pilot），通过比较接收信号和已知符号的相位差，来估算出当前的相位噪声，再将此相位差反乘到接收端受影响的符号上，就实现了相位噪声的补偿。Pilot占总符号的比例称为Pilot开销，例如每N个符号中包含M个Pilot，则开销为M/N。在设计CR算法时可以有各种考虑：例如应该尽可能减小Pilot以降低系统开销，因为Pilot本身为已知量并不传递信息；间插Pilot之间净荷的相位可以通过各种插值方法来近似；加性白噪会影响相位估计精度，可以用2个连续的Pilot符号求平均以抑制白噪影响，也可以在间插的Pilot之间求平均。当然，以上仅是举例，实际CR算法不限于此。\n\n\n\n图5 Pilot的载波恢复算法\n\n【色散与色散补偿算法】\n   \n光纤中色散的效应，可认为是对信号直接做傅里叶变换后的频域数据施加 1 个随频点平方关系变化的相位，如式 (8) 所示。\n\n\\begin{equation}\nH(f) = \\exp \\left[ j * \\left( \\frac{\\lambda^2 \\pi D z}{c} f^2 \\right) \\right]\n\\tag{8}\n\\end{equation}\n\n其中 $\\lambda$ 是波长，取 $1550\\,\\text{nm}$，$D_z$ 是色散值，$c$ 是光速，$f$ 则是频点。本题中，信道中施加色散和算法中补偿色散如图 \\ref{fig:dispersion} 所示，假设色散值已知，则先 FFT 将接收到的数据转换到频域，再乘上式中的频域响应，随后再 IFFT 转换回时域即可。信道中色散的频域响应和算法中补偿色散的频域响应呈共轭关系。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=0.8\\textwidth]{dispersion_diagram.png}\n    \\caption{色散和色散补偿方法}\n    \\label{fig:dispersion}\n\\end{figure}\n\n\\section{ASIC 芯片上的算法实现}\n\n与我们通常在计算机上开展的基于软件的数学计算不同，在 ASIC 上的计算是基于硬件电路展开的。例如要计算某个公式，通用计算机上是转换为一条条逻辑指令，按时间顺序在相同的 CPU 中运行，最终输出结果。而在 ASIC 上开展的计算，则是把计算过程拆分为具体的加法、乘法等基本操作，每一个基本操作都对应了不同的专用逻辑电路，在芯片上各自占据了一定的面积。设计 ASIC 芯片上的 DSP 算法，需要考虑并行实现，定点量化，时序约束，和资源/功耗约束等约束，下面简要叙述。\n\n\\subsection{并行实现}\n\n芯片上的计算都是在系统时钟下，以一拍一拍的节奏运行的。芯片计算的吞吐量必须要大于信号传输速度，才能确保信息不丢失。如果采用串行的处理方式，芯片时钟频率极高，而芯片的功耗与时钟主频率近似呈平方关系，显然不能通过一味提升主频的方式增加处理流量，必须采用并行处理的方法，以资源换取处理流量的提升。例如图 \\ref{fig:square_operation} 中所示的求平方操作，串行情况下 1 个时钟周期处理 1 个符号，100G 的波特率至少需要 100GHz 的时钟主频，远远超出了现实能达到的水平。若付出 $N$ 倍的资源，每次同时计算 $N$ 个符号，则时钟主频仅为 $1/N$，功耗大大降低。当前 oDSP 时钟主频在 $500\\,\\text{MHz} \\sim 1\\,\\text{GHz}$ 量级，对应符号的并行度约为 $100 \\sim 200$ 量级。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=0.5\\textwidth]{square_operation_diagram.png}\n    \\caption{求平方操作}\n    \\label{fig:square_operation}\n\\end{figure}\n\n\n\n图7 ASIC芯片并行运算示意图\n\n计算机中常用双精度浮点数来定义参变量，而ASIC通常用定点数来表示参变量的大小。双精度浮点数在大多数计算情况下几乎没有精度损失，而ASIC定点数因为位数往往较小，舍入误差增大，带来量化噪声。表示定点数的二进制位数称为定点位宽。定点数常分为有符号和无符号位2种，如下图所示，例如S(8,4)表示有符号的8-bit定点数，其中小数位占4位；u(7,4)代表无符号的7-bit定点数，其中小数位占4位。单个定点数仅能代表实数，复数则用2个定点分别代表实部和虚部。在ASIC中任何计算都应量化为定点数的计算，量化噪声的影响也是算法设计的关键之一。例如CR相噪算法中，收端受影响的符号往往用6~9bit定点数表示，而计算相噪部分的位宽则根据实际情况而变化。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=0.8\\textwidth]{image2.png}\n    \\caption{定点表示法}\n    \\label{fig:fixed_point}\n\\end{figure}\n\n\\section{基本操作、时序约束和资源/功耗约束}\n\n【基本操作、时序约束和资源/功耗约束】\n\nASIC 上的算法设计，需要将计算拆解为基本的操作。本题中考虑加法、乘法，查表和数据缓存四类操作，其表示如图 \\ref{fig:asic_operations} 所示。加法和乘法均是对两个数开展，复数运算拆分实部和虚部各自计算。减法可认为是先做一次乘以 $-1$ 的乘法，再做一次加法。ASIC 上由于是二进制定点数表示，乘以或除以 $2$ 的幂次方相当于对小数点进行移位，不会带来额外的资源代价。查表用于加法和乘法无法直接实现的操作。例如求 $\\sin$ 函数，可以将输入-输出映射关系分别量化为离散输入-输出对应关系，通过查表的方式求得输出。例如求 $d = \\sin\\left(\\frac{a+b}{2} * c\\right)$，首先一级加法计算 $a+b$，再通过移位得到 $\\frac{a+b}{2}$，随后一级乘法得到 $\\frac{a+b}{2} * c$，最后通过 $\\sin$ 查表的方式得到 $d$。每种运算都对应了芯片上的资源。显然，参与运算的数据位宽越大，占用的资源也会更多。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=0.8\\textwidth]{asic_operations.png}\n    \\caption{ASIC 芯片基本运算操作}\n    \\label{fig:asic_operations}\n\\end{figure}\n\n另一方面，芯片是在时钟主频下一拍一拍运行，一拍运行中只能完成有限个连续的基本运算，但通过加缓存的方式，可以实现流水的结构。例如图 \\ref{fig:buffer_pipeline} 中，若运算 1 结果出来的时候，一拍内剩余的时间无法完成运算 2，则需要在运算 1 的出口加入 1 级 buff 缓存以存储运算 1 的输出数据。每拍运算时，运算 2 读取 buff 中存储的运算 1 的上一拍输出开展计算，而运算 1 则和当前输入数据开展运算，并将结果在存入 buff 中，这样一来，每拍运行可以同时开展运算 1 和运算 2，但会造成输出的结果会比运算 1 和运算 2 在同一拍完成的情况延迟 1 拍。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=0.8\\textwidth]{buffer_pipeline.png}\n    \\caption{缓存实现流水结构}\n    \\label{fig:buffer_pipeline}\n\\end{figure}\n\n不同的运算路径有着不同的时钟延迟，当算法存在不同的计算路径时，需要保证每个路径的延时对准。例如在 CR 算法中，计算出的相位噪声差需要反乘回数据，但相噪计算通常无法在 1 拍内完成，从而导致相位和数据有延时，需要用 buffer 将延时对准。本题中，假设 1 个时钟周期最多完成 1 级乘法，4 级加法，以及 1 级查表操作。\n\n加法、乘法、查表和缓存均需要占用资源，在算法设计也应有所考虑。加法和乘法均是两两操作，加法资源近似与最大位宽呈正比，乘法资源近似与位宽乘积成正比，延时资源和位宽以及延时深度近似呈正比。对于一个M-N的查表，资源与(2^M)*N呈正比。M代表输入位宽，N代表输出位宽，例如：已知信号求相位的查表操作，信号位宽s(10,1)，相位位宽s(9,1)，此时的M=20，N=9。在查表时候的输入为信号的【实部 虚部】组合，需要遍历的地址有2^20，每个地址对应的相位值的位宽为s(9,1)。\n\n\\begin{table}\n\\centering\n\\caption{表1}\n\\begin{tabular}{|c|c|c|c|c|}\n\\hline\n基本操作 & 8+8bit & 8*8bit & 8bit-8bit查表 & 8bit, \\\\\n & 加法器 & 乘法器 & & 每2048符号延时 \\\\\n\\hline\n资源 & 1U & 8U & 128U & 1U \\\\\n\\hline\n\\end{tabular}\n\\end{table}\n\n三、ASIC芯片算法设计的典型步骤\n  \n  综合上述内容，芯片上算法设计的通常包含以下具体步骤：\n\n1) 根据物理模型和系数特性设计算法原型：例如CR算法中，采用Pilot估计相位差，并利用插值等方法计算出净荷的相噪，最终将估计的相位差乘回数据以补偿相噪。\n2）在考虑并行度和时序约束的基础上，将算法细化为可实现的基本操作，并大致考虑算法的实现复杂度对算法实现的影响。此时可假设为浮点数，不需要考虑定点量化噪声。例如CR算法中，可能需要考虑净荷相噪的插值如何由基本操作实现，计算噪声路径的延时如何与补偿噪声路径的延时相匹配等。\n3） 进一步考虑定点量化噪声的影响，尽量以更低的资源实现，此时位宽优化是一个关键步骤。",
    "problem_requirement": "问题1：考虑波特率为150Gbaud的标准16QAM信号，令线宽为100kHz，色散值为2万ps/nm，算法的并行度固定为128，不考虑定点量化。请以基本的加法、乘法、查表和缓存为基础，并以RSNR代价<0.3dB为目标，设计一套CR算法，使得Pilot开销最小？\n\n问题2：考虑线宽从10kHz~10MHz，色散Dz从0~10,000 ps/nm变化场景，以RSNR代价<0.3dB为目标，定量挖掘色散、线宽与Pilot开销的关系。\n\n问题3：在问题2的场景上，进一步将芯片实现的资源纳入考察，此时需考虑定点量化对性能和资源的影响，且导频开销可任意变化（但必须确保净荷的流量为>145Gbaud），如何设计资源最低的CR算法？\n\n问题4：现实中性能和资源的权衡与具体场景有关。例如长距干线传输对性能要求往往比短距离要求更高，长距传输可付出更多的资源以降低RSNR代价。并选出问题3中你队认为有代表性的1种场景，给出统筹性的“性能-资源”综合考虑下的算法设计思路，构造性能和资源的综合代价函数，尝试给出一套自动优化位宽和实现性设计的方案，并给出定量结果，用以指导算法开发。\n\n注：本题中均不考虑色散补偿和误码率计算的复杂度和资源，只需考虑CR算法（计算相噪+补偿相噪）相关的资源即可。",
    "dataset_path": [],
    "dataset_description": {},
    "variable_description": [],
    "addendum": "注：本题中均不考虑色散补偿和误码率计算的复杂度和资源，只需考虑CR算法（计算相噪+补偿相噪）相关的资源即可。",
    "data_summary": "",
    "data_description": {},
    "problem_str": "问题背景：\nASIC芯片上的载波恢复DSP算法设计与实现\n\n光数字信号处理（DSP）芯片是光传输领域里的“心脏”，这种芯片往往是基于专用集成电路（ASIC）实现的。例如，采用7nm芯片工艺制造的光传输芯片容量可以达到800Gbps，相当于单光纤可实现48Tbps的容量，保障了网络流量的爆发型增长。ASIC芯片的DSP算法设计通常包含两个主要步骤，第一步是根据信道损伤的物理模型设计补偿算法，此时只需要考虑浮点计算；第二步是根据芯片资源和功耗约束，将算法改造成ASIC芯片可实现的定点形式，此时需要将算法细化为芯片上最基本的乘、加等运算，并考虑定点量化噪声的影响。怎样权衡性能和资源，实现具体场景下的最优设计，是DSP芯片算法工程领域持久不变的课题。本题以oDSP中一种关键的载波恢复算法为例，探讨算法与芯片的最优工程设计。\n\n首先介绍关于基本通信系统和ASIC芯片上算法设计的基本知识。\n\n一、通信系统模型\n\n本题考虑一个简化的数字通信系统性能评估模型，如图1所示。发送端编码后的二进制序列映射调制为星座点上的符号并向外发送，每秒发送的符号个数称为波特率fBaud。信号在信道中受到色散和相位噪声的影响，并人为加入加性高斯白噪声，噪声量用信号和噪声功率的比值表示。接收端先补偿色散，再由载波恢复(Carrier Recovery, CR)算法补偿相位噪声，最后信号进行判决后逆映射为二进制比特序列。受信道中损伤和噪声影响，星座图会发生扩散，从而导致信号判错，使接收到的二进制序列与发端不一致，从而带来误码。错误二进制比特占总二进制比特的比率称为误码率（BER）。只要BER小于某个门限，那么纠错编码后的BER就能够小于1e-15次方量级，达到工程意义上的“无误码”传输。本题中不考虑纠错编码，BER均指直接判决后的BER。\n\n算法评估中常用RSNR（Required SNR）代价来评估算法性能。 SNR(Signal-to-Noise Ratio)指的是信号功率和噪声功率的比例。例如图1中，若只有加性高斯白噪声存在时，对于给定的调制格式，SNR和BER存在关系也就确定了。将BER达到门限时信道中施加的SNR定义为Required SNR (RSNR)，它可理解为系统能够容忍的噪声量。当存在相位噪声、色散等干扰后，相同纠前门限点对应的SNR值会提高，说明系统能够容忍的噪声量减少了，将RSNR的增加部分称为RSNR代价。RSNR代价是衡量系统和算法性能的常用指标。例如CR算法性能越好，那么RSNR代价也应该越低。图1 模型计算RSNR的噪声是“人为”加入的，目的是用于评估系统性能。现实光传输系统中，噪声可能有来自于电器件、光器件、光放大器等各种系统组件。\n\n下面对模型中的术语做进一步解释。\n\n\n\n图1 简化数字通信系统性能评估模型\n\n【调制、星座图与误码率BER】\n\n二进制序列通常需要将K个比特作为一个“符号”进行传输，每个符号有个不同状态。光传输利用光波的复振幅承载信号，因此可用复平面上不同的点来对应不同的符号状态，这种将符号状态画在复平面上的图称为“星座图”，图上的点称为“星座点”。如图2(a)所示的QPSK（Quadrature Phase Shift Keying）调制，经过信道叠加噪声和接收机处理后，接收端的星座图不再是理想的四个点，而是会出现扩散。当接收机收到1个符号时，就将发送的符号判定为离该符号最近的星座点。显然，如果噪声过大，接收到的符号可能被判错从而产生误码，如图2(b)中的蓝点。误码率（Bit Error Ratio, BER）定义为错误的比特数占总传输比特数的比例，例如传输了50个符号共100个比特，其中有1个符号被误判为相邻的符号，错误了 1 个 bit，则误码率为 0.01。BER 是衡量通信系统性能的最根本指标。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=\\textwidth]{image.png}\n    \\caption{(a) 星座图与噪声导致误码的示意图 (b) 信号和噪声的相关定义示意图}\n    \\label{fig:noise_and_signal}\n\\end{figure}\n\n图 \\ref{fig:noise_and_signal}(b) 中理想星座点用 $\\mathbf{S}_k$ 表示，接收到的符号用 $\\mathbf{r}_k$ 表示，则噪声为\n\n\\begin{equation}\nn_k = r_k - S_k\n\\tag{1}\n\\end{equation}\n\n噪声通常服从均值为 0 的正态分布。噪声的方差等于噪声的平均功率，定义为\n\n\\begin{equation}\nP_{\\text{n}} = \\frac{1}{N} \\sum_{k=1}^{N} |n_k|^2\n\\tag{2}\n\\end{equation}\n\n其中 $N$ 为总共传输的符号数。信号平均功率定义为发送符号绝对值平方的均值：\n\n\\begin{equation}\nP_{\\text{s}} = \\frac{1}{N} \\sum_{k=1}^{N} |S_k|^2\n\\tag{3}\n\\end{equation}\n\n定义信号和噪声功率的比值为信噪比（Signal-to-Noise Ratio，SNR），\n\n\\begin{equation}\n\\text{SNR} = \\frac{P_{\\text{s}}}{P_{\\text{n}}}\n\\tag{4}\n\\end{equation}\n\n工程上通常用 dB 作为 SNR 的单位，定义为\n\n\\begin{equation}\n\\text{SNR}(\\text{dB}) = 10 \\log_{10} \\left( \\frac{P_{\\text{s}}}{P_{\\text{n}}} \\right)\n\\tag{5}\n\\end{equation}\n\n\\textbf{【相位噪声与 CR 算法】}\n\n相噪会对信号叠加一个时变的相位，\n\n\\begin{equation}\nS_1(t) = S_0(t) \\exp \\{ j \\theta(t) \\}\n\\tag{6}\n\\end{equation}\n\n其中 $S_0(t)$ 是叠加相噪前的波形，$S_1(t)$ 是叠加相噪后的波形，$\\theta(t)$ 是相噪。通信系统常用等间隔采样后的离散方式表示，每个采样点对应了某个时刻采样到的波形。对于相位噪声，$k+1$ 时刻和 $k$ 时刻的相位差表示为：\n\n\\begin{equation}\nd\\theta = \\theta_{k+1} - \\theta_k = \\left( \\sqrt{\\frac{2\\pi \\cdot LW}{f_b}} \\right) \\cdot X_k\n\\tag{7}\n\\end{equation}\n\n其中 $LW$ 是一个激光器线宽指标，单位为 kHz。$f_b$ 是波特率，而 $X_k$ 是均值为 0，方差为1的随机变量。一个典型的相噪随时间变化的规律如图4所示，相位变化也有可能演化到负值。\n\n\n\n图4 典型相位噪声演化曲线\n\n如图5所示，典型的CR算法是间隔性地插入已知的导频符号（Pilot），通过比较接收信号和已知符号的相位差，来估算出当前的相位噪声，再将此相位差反乘到接收端受影响的符号上，就实现了相位噪声的补偿。Pilot占总符号的比例称为Pilot开销，例如每N个符号中包含M个Pilot，则开销为M/N。在设计CR算法时可以有各种考虑：例如应该尽可能减小Pilot以降低系统开销，因为Pilot本身为已知量并不传递信息；间插Pilot之间净荷的相位可以通过各种插值方法来近似；加性白噪会影响相位估计精度，可以用2个连续的Pilot符号求平均以抑制白噪影响，也可以在间插的Pilot之间求平均。当然，以上仅是举例，实际CR算法不限于此。\n\n\n\n图5 Pilot的载波恢复算法\n\n【色散与色散补偿算法】\n   \n光纤中色散的效应，可认为是对信号直接做傅里叶变换后的频域数据施加 1 个随频点平方关系变化的相位，如式 (8) 所示。\n\n\\begin{equation}\nH(f) = \\exp \\left[ j * \\left( \\frac{\\lambda^2 \\pi D z}{c} f^2 \\right) \\right]\n\\tag{8}\n\\end{equation}\n\n其中 $\\lambda$ 是波长，取 $1550\\,\\text{nm}$，$D_z$ 是色散值，$c$ 是光速，$f$ 则是频点。本题中，信道中施加色散和算法中补偿色散如图 \\ref{fig:dispersion} 所示，假设色散值已知，则先 FFT 将接收到的数据转换到频域，再乘上式中的频域响应，随后再 IFFT 转换回时域即可。信道中色散的频域响应和算法中补偿色散的频域响应呈共轭关系。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=0.8\\textwidth]{dispersion_diagram.png}\n    \\caption{色散和色散补偿方法}\n    \\label{fig:dispersion}\n\\end{figure}\n\n\\section{ASIC 芯片上的算法实现}\n\n与我们通常在计算机上开展的基于软件的数学计算不同，在 ASIC 上的计算是基于硬件电路展开的。例如要计算某个公式，通用计算机上是转换为一条条逻辑指令，按时间顺序在相同的 CPU 中运行，最终输出结果。而在 ASIC 上开展的计算，则是把计算过程拆分为具体的加法、乘法等基本操作，每一个基本操作都对应了不同的专用逻辑电路，在芯片上各自占据了一定的面积。设计 ASIC 芯片上的 DSP 算法，需要考虑并行实现，定点量化，时序约束，和资源/功耗约束等约束，下面简要叙述。\n\n\\subsection{并行实现}\n\n芯片上的计算都是在系统时钟下，以一拍一拍的节奏运行的。芯片计算的吞吐量必须要大于信号传输速度，才能确保信息不丢失。如果采用串行的处理方式，芯片时钟频率极高，而芯片的功耗与时钟主频率近似呈平方关系，显然不能通过一味提升主频的方式增加处理流量，必须采用并行处理的方法，以资源换取处理流量的提升。例如图 \\ref{fig:square_operation} 中所示的求平方操作，串行情况下 1 个时钟周期处理 1 个符号，100G 的波特率至少需要 100GHz 的时钟主频，远远超出了现实能达到的水平。若付出 $N$ 倍的资源，每次同时计算 $N$ 个符号，则时钟主频仅为 $1/N$，功耗大大降低。当前 oDSP 时钟主频在 $500\\,\\text{MHz} \\sim 1\\,\\text{GHz}$ 量级，对应符号的并行度约为 $100 \\sim 200$ 量级。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=0.5\\textwidth]{square_operation_diagram.png}\n    \\caption{求平方操作}\n    \\label{fig:square_operation}\n\\end{figure}\n\n\n\n图7 ASIC芯片并行运算示意图\n\n计算机中常用双精度浮点数来定义参变量，而ASIC通常用定点数来表示参变量的大小。双精度浮点数在大多数计算情况下几乎没有精度损失，而ASIC定点数因为位数往往较小，舍入误差增大，带来量化噪声。表示定点数的二进制位数称为定点位宽。定点数常分为有符号和无符号位2种，如下图所示，例如S(8,4)表示有符号的8-bit定点数，其中小数位占4位；u(7,4)代表无符号的7-bit定点数，其中小数位占4位。单个定点数仅能代表实数，复数则用2个定点分别代表实部和虚部。在ASIC中任何计算都应量化为定点数的计算，量化噪声的影响也是算法设计的关键之一。例如CR相噪算法中，收端受影响的符号往往用6~9bit定点数表示，而计算相噪部分的位宽则根据实际情况而变化。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=0.8\\textwidth]{image2.png}\n    \\caption{定点表示法}\n    \\label{fig:fixed_point}\n\\end{figure}\n\n\\section{基本操作、时序约束和资源/功耗约束}\n\n【基本操作、时序约束和资源/功耗约束】\n\nASIC 上的算法设计，需要将计算拆解为基本的操作。本题中考虑加法、乘法，查表和数据缓存四类操作，其表示如图 \\ref{fig:asic_operations} 所示。加法和乘法均是对两个数开展，复数运算拆分实部和虚部各自计算。减法可认为是先做一次乘以 $-1$ 的乘法，再做一次加法。ASIC 上由于是二进制定点数表示，乘以或除以 $2$ 的幂次方相当于对小数点进行移位，不会带来额外的资源代价。查表用于加法和乘法无法直接实现的操作。例如求 $\\sin$ 函数，可以将输入-输出映射关系分别量化为离散输入-输出对应关系，通过查表的方式求得输出。例如求 $d = \\sin\\left(\\frac{a+b}{2} * c\\right)$，首先一级加法计算 $a+b$，再通过移位得到 $\\frac{a+b}{2}$，随后一级乘法得到 $\\frac{a+b}{2} * c$，最后通过 $\\sin$ 查表的方式得到 $d$。每种运算都对应了芯片上的资源。显然，参与运算的数据位宽越大，占用的资源也会更多。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=0.8\\textwidth]{asic_operations.png}\n    \\caption{ASIC 芯片基本运算操作}\n    \\label{fig:asic_operations}\n\\end{figure}\n\n另一方面，芯片是在时钟主频下一拍一拍运行，一拍运行中只能完成有限个连续的基本运算，但通过加缓存的方式，可以实现流水的结构。例如图 \\ref{fig:buffer_pipeline} 中，若运算 1 结果出来的时候，一拍内剩余的时间无法完成运算 2，则需要在运算 1 的出口加入 1 级 buff 缓存以存储运算 1 的输出数据。每拍运算时，运算 2 读取 buff 中存储的运算 1 的上一拍输出开展计算，而运算 1 则和当前输入数据开展运算，并将结果在存入 buff 中，这样一来，每拍运行可以同时开展运算 1 和运算 2，但会造成输出的结果会比运算 1 和运算 2 在同一拍完成的情况延迟 1 拍。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=0.8\\textwidth]{buffer_pipeline.png}\n    \\caption{缓存实现流水结构}\n    \\label{fig:buffer_pipeline}\n\\end{figure}\n\n不同的运算路径有着不同的时钟延迟，当算法存在不同的计算路径时，需要保证每个路径的延时对准。例如在 CR 算法中，计算出的相位噪声差需要反乘回数据，但相噪计算通常无法在 1 拍内完成，从而导致相位和数据有延时，需要用 buffer 将延时对准。本题中，假设 1 个时钟周期最多完成 1 级乘法，4 级加法，以及 1 级查表操作。\n\n加法、乘法、查表和缓存均需要占用资源，在算法设计也应有所考虑。加法和乘法均是两两操作，加法资源近似与最大位宽呈正比，乘法资源近似与位宽乘积成正比，延时资源和位宽以及延时深度近似呈正比。对于一个M-N的查表，资源与(2^M)*N呈正比。M代表输入位宽，N代表输出位宽，例如：已知信号求相位的查表操作，信号位宽s(10,1)，相位位宽s(9,1)，此时的M=20，N=9。在查表时候的输入为信号的【实部 虚部】组合，需要遍历的地址有2^20，每个地址对应的相位值的位宽为s(9,1)。\n\n\\begin{table}\n\\centering\n\\caption{表1}\n\\begin{tabular}{|c|c|c|c|c|}\n\\hline\n基本操作 & 8+8bit & 8*8bit & 8bit-8bit查表 & 8bit, \\\\\n & 加法器 & 乘法器 & & 每2048符号延时 \\\\\n\\hline\n资源 & 1U & 8U & 128U & 1U \\\\\n\\hline\n\\end{tabular}\n\\end{table}\n\n三、ASIC芯片算法设计的典型步骤\n  \n  综合上述内容，芯片上算法设计的通常包含以下具体步骤：\n\n1) 根据物理模型和系数特性设计算法原型：例如CR算法中，采用Pilot估计相位差，并利用插值等方法计算出净荷的相噪，最终将估计的相位差乘回数据以补偿相噪。\n2）在考虑并行度和时序约束的基础上，将算法细化为可实现的基本操作，并大致考虑算法的实现复杂度对算法实现的影响。此时可假设为浮点数，不需要考虑定点量化噪声。例如CR算法中，可能需要考虑净荷相噪的插值如何由基本操作实现，计算噪声路径的延时如何与补偿噪声路径的延时相匹配等。\n3） 进一步考虑定点量化噪声的影响，尽量以更低的资源实现，此时位宽优化是一个关键步骤。\n\n问题要求：\n问题1：考虑波特率为150Gbaud的标准16QAM信号，令线宽为100kHz，色散值为2万ps/nm，算法的并行度固定为128，不考虑定点量化。请以基本的加法、乘法、查表和缓存为基础，并以RSNR代价<0.3dB为目标，设计一套CR算法，使得Pilot开销最小？\n\n问题2：考虑线宽从10kHz~10MHz，色散Dz从0~10,000 ps/nm变化场景，以RSNR代价<0.3dB为目标，定量挖掘色散、线宽与Pilot开销的关系。\n\n问题3：在问题2的场景上，进一步将芯片实现的资源纳入考察，此时需考虑定点量化对性能和资源的影响，且导频开销可任意变化（但必须确保净荷的流量为>145Gbaud），如何设计资源最低的CR算法？\n\n问题4：现实中性能和资源的权衡与具体场景有关。例如长距干线传输对性能要求往往比短距离要求更高，长距传输可付出更多的资源以降低RSNR代价。并选出问题3中你队认为有代表性的1种场景，给出统筹性的“性能-资源”综合考虑下的算法设计思路，构造性能和资源的综合代价函数，尝试给出一套自动优化位宽和实现性设计的方案，并给出定量结果，用以指导算法开发。\n\n注：本题中均不考虑色散补偿和误码率计算的复杂度和资源，只需考虑CR算法（计算相噪+补偿相噪）相关的资源即可。\nAddendum: \n注：本题中均不考虑色散补偿和误码率计算的复杂度和资源，只需考虑CR算法（计算相噪+补偿相噪）相关的资源即可。"
  },
  "problem_background": "ASIC芯片上的载波恢复DSP算法设计与实现\n\n光数字信号处理（DSP）芯片是光传输领域里的“心脏”，这种芯片往往是基于专用集成电路（ASIC）实现的。例如，采用7nm芯片工艺制造的光传输芯片容量可以达到800Gbps，相当于单光纤可实现48Tbps的容量，保障了网络流量的爆发型增长。ASIC芯片的DSP算法设计通常包含两个主要步骤，第一步是根据信道损伤的物理模型设计补偿算法，此时只需要考虑浮点计算；第二步是根据芯片资源和功耗约束，将算法改造成ASIC芯片可实现的定点形式，此时需要将算法细化为芯片上最基本的乘、加等运算，并考虑定点量化噪声的影响。怎样权衡性能和资源，实现具体场景下的最优设计，是DSP芯片算法工程领域持久不变的课题。本题以oDSP中一种关键的载波恢复算法为例，探讨算法与芯片的最优工程设计。\n\n首先介绍关于基本通信系统和ASIC芯片上算法设计的基本知识。\n\n一、通信系统模型\n\n本题考虑一个简化的数字通信系统性能评估模型，如图1所示。发送端编码后的二进制序列映射调制为星座点上的符号并向外发送，每秒发送的符号个数称为波特率fBaud。信号在信道中受到色散和相位噪声的影响，并人为加入加性高斯白噪声，噪声量用信号和噪声功率的比值表示。接收端先补偿色散，再由载波恢复(Carrier Recovery, CR)算法补偿相位噪声，最后信号进行判决后逆映射为二进制比特序列。受信道中损伤和噪声影响，星座图会发生扩散，从而导致信号判错，使接收到的二进制序列与发端不一致，从而带来误码。错误二进制比特占总二进制比特的比率称为误码率（BER）。只要BER小于某个门限，那么纠错编码后的BER就能够小于1e-15次方量级，达到工程意义上的“无误码”传输。本题中不考虑纠错编码，BER均指直接判决后的BER。\n\n算法评估中常用RSNR（Required SNR）代价来评估算法性能。 SNR(Signal-to-Noise Ratio)指的是信号功率和噪声功率的比例。例如图1中，若只有加性高斯白噪声存在时，对于给定的调制格式，SNR和BER存在关系也就确定了。将BER达到门限时信道中施加的SNR定义为Required SNR (RSNR)，它可理解为系统能够容忍的噪声量。当存在相位噪声、色散等干扰后，相同纠前门限点对应的SNR值会提高，说明系统能够容忍的噪声量减少了，将RSNR的增加部分称为RSNR代价。RSNR代价是衡量系统和算法性能的常用指标。例如CR算法性能越好，那么RSNR代价也应该越低。图1 模型计算RSNR的噪声是“人为”加入的，目的是用于评估系统性能。现实光传输系统中，噪声可能有来自于电器件、光器件、光放大器等各种系统组件。\n\n下面对模型中的术语做进一步解释。\n\n\n\n图1 简化数字通信系统性能评估模型\n\n【调制、星座图与误码率BER】\n\n二进制序列通常需要将K个比特作为一个“符号”进行传输，每个符号有个不同状态。光传输利用光波的复振幅承载信号，因此可用复平面上不同的点来对应不同的符号状态，这种将符号状态画在复平面上的图称为“星座图”，图上的点称为“星座点”。如图2(a)所示的QPSK（Quadrature Phase Shift Keying）调制，经过信道叠加噪声和接收机处理后，接收端的星座图不再是理想的四个点，而是会出现扩散。当接收机收到1个符号时，就将发送的符号判定为离该符号最近的星座点。显然，如果噪声过大，接收到的符号可能被判错从而产生误码，如图2(b)中的蓝点。误码率（Bit Error Ratio, BER）定义为错误的比特数占总传输比特数的比例，例如传输了50个符号共100个比特，其中有1个符号被误判为相邻的符号，错误了 1 个 bit，则误码率为 0.01。BER 是衡量通信系统性能的最根本指标。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=\\textwidth]{image.png}\n    \\caption{(a) 星座图与噪声导致误码的示意图 (b) 信号和噪声的相关定义示意图}\n    \\label{fig:noise_and_signal}\n\\end{figure}\n\n图 \\ref{fig:noise_and_signal}(b) 中理想星座点用 $\\mathbf{S}_k$ 表示，接收到的符号用 $\\mathbf{r}_k$ 表示，则噪声为\n\n\\begin{equation}\nn_k = r_k - S_k\n\\tag{1}\n\\end{equation}\n\n噪声通常服从均值为 0 的正态分布。噪声的方差等于噪声的平均功率，定义为\n\n\\begin{equation}\nP_{\\text{n}} = \\frac{1}{N} \\sum_{k=1}^{N} |n_k|^2\n\\tag{2}\n\\end{equation}\n\n其中 $N$ 为总共传输的符号数。信号平均功率定义为发送符号绝对值平方的均值：\n\n\\begin{equation}\nP_{\\text{s}} = \\frac{1}{N} \\sum_{k=1}^{N} |S_k|^2\n\\tag{3}\n\\end{equation}\n\n定义信号和噪声功率的比值为信噪比（Signal-to-Noise Ratio，SNR），\n\n\\begin{equation}\n\\text{SNR} = \\frac{P_{\\text{s}}}{P_{\\text{n}}}\n\\tag{4}\n\\end{equation}\n\n工程上通常用 dB 作为 SNR 的单位，定义为\n\n\\begin{equation}\n\\text{SNR}(\\text{dB}) = 10 \\log_{10} \\left( \\frac{P_{\\text{s}}}{P_{\\text{n}}} \\right)\n\\tag{5}\n\\end{equation}\n\n\\textbf{【相位噪声与 CR 算法】}\n\n相噪会对信号叠加一个时变的相位，\n\n\\begin{equation}\nS_1(t) = S_0(t) \\exp \\{ j \\theta(t) \\}\n\\tag{6}\n\\end{equation}\n\n其中 $S_0(t)$ 是叠加相噪前的波形，$S_1(t)$ 是叠加相噪后的波形，$\\theta(t)$ 是相噪。通信系统常用等间隔采样后的离散方式表示，每个采样点对应了某个时刻采样到的波形。对于相位噪声，$k+1$ 时刻和 $k$ 时刻的相位差表示为：\n\n\\begin{equation}\nd\\theta = \\theta_{k+1} - \\theta_k = \\left( \\sqrt{\\frac{2\\pi \\cdot LW}{f_b}} \\right) \\cdot X_k\n\\tag{7}\n\\end{equation}\n\n其中 $LW$ 是一个激光器线宽指标，单位为 kHz。$f_b$ 是波特率，而 $X_k$ 是均值为 0，方差为1的随机变量。一个典型的相噪随时间变化的规律如图4所示，相位变化也有可能演化到负值。\n\n\n\n图4 典型相位噪声演化曲线\n\n如图5所示，典型的CR算法是间隔性地插入已知的导频符号（Pilot），通过比较接收信号和已知符号的相位差，来估算出当前的相位噪声，再将此相位差反乘到接收端受影响的符号上，就实现了相位噪声的补偿。Pilot占总符号的比例称为Pilot开销，例如每N个符号中包含M个Pilot，则开销为M/N。在设计CR算法时可以有各种考虑：例如应该尽可能减小Pilot以降低系统开销，因为Pilot本身为已知量并不传递信息；间插Pilot之间净荷的相位可以通过各种插值方法来近似；加性白噪会影响相位估计精度，可以用2个连续的Pilot符号求平均以抑制白噪影响，也可以在间插的Pilot之间求平均。当然，以上仅是举例，实际CR算法不限于此。\n\n\n\n图5 Pilot的载波恢复算法\n\n【色散与色散补偿算法】\n   \n光纤中色散的效应，可认为是对信号直接做傅里叶变换后的频域数据施加 1 个随频点平方关系变化的相位，如式 (8) 所示。\n\n\\begin{equation}\nH(f) = \\exp \\left[ j * \\left( \\frac{\\lambda^2 \\pi D z}{c} f^2 \\right) \\right]\n\\tag{8}\n\\end{equation}\n\n其中 $\\lambda$ 是波长，取 $1550\\,\\text{nm}$，$D_z$ 是色散值，$c$ 是光速，$f$ 则是频点。本题中，信道中施加色散和算法中补偿色散如图 \\ref{fig:dispersion} 所示，假设色散值已知，则先 FFT 将接收到的数据转换到频域，再乘上式中的频域响应，随后再 IFFT 转换回时域即可。信道中色散的频域响应和算法中补偿色散的频域响应呈共轭关系。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=0.8\\textwidth]{dispersion_diagram.png}\n    \\caption{色散和色散补偿方法}\n    \\label{fig:dispersion}\n\\end{figure}\n\n\\section{ASIC 芯片上的算法实现}\n\n与我们通常在计算机上开展的基于软件的数学计算不同，在 ASIC 上的计算是基于硬件电路展开的。例如要计算某个公式，通用计算机上是转换为一条条逻辑指令，按时间顺序在相同的 CPU 中运行，最终输出结果。而在 ASIC 上开展的计算，则是把计算过程拆分为具体的加法、乘法等基本操作，每一个基本操作都对应了不同的专用逻辑电路，在芯片上各自占据了一定的面积。设计 ASIC 芯片上的 DSP 算法，需要考虑并行实现，定点量化，时序约束，和资源/功耗约束等约束，下面简要叙述。\n\n\\subsection{并行实现}\n\n芯片上的计算都是在系统时钟下，以一拍一拍的节奏运行的。芯片计算的吞吐量必须要大于信号传输速度，才能确保信息不丢失。如果采用串行的处理方式，芯片时钟频率极高，而芯片的功耗与时钟主频率近似呈平方关系，显然不能通过一味提升主频的方式增加处理流量，必须采用并行处理的方法，以资源换取处理流量的提升。例如图 \\ref{fig:square_operation} 中所示的求平方操作，串行情况下 1 个时钟周期处理 1 个符号，100G 的波特率至少需要 100GHz 的时钟主频，远远超出了现实能达到的水平。若付出 $N$ 倍的资源，每次同时计算 $N$ 个符号，则时钟主频仅为 $1/N$，功耗大大降低。当前 oDSP 时钟主频在 $500\\,\\text{MHz} \\sim 1\\,\\text{GHz}$ 量级，对应符号的并行度约为 $100 \\sim 200$ 量级。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=0.5\\textwidth]{square_operation_diagram.png}\n    \\caption{求平方操作}\n    \\label{fig:square_operation}\n\\end{figure}\n\n\n\n图7 ASIC芯片并行运算示意图\n\n计算机中常用双精度浮点数来定义参变量，而ASIC通常用定点数来表示参变量的大小。双精度浮点数在大多数计算情况下几乎没有精度损失，而ASIC定点数因为位数往往较小，舍入误差增大，带来量化噪声。表示定点数的二进制位数称为定点位宽。定点数常分为有符号和无符号位2种，如下图所示，例如S(8,4)表示有符号的8-bit定点数，其中小数位占4位；u(7,4)代表无符号的7-bit定点数，其中小数位占4位。单个定点数仅能代表实数，复数则用2个定点分别代表实部和虚部。在ASIC中任何计算都应量化为定点数的计算，量化噪声的影响也是算法设计的关键之一。例如CR相噪算法中，收端受影响的符号往往用6~9bit定点数表示，而计算相噪部分的位宽则根据实际情况而变化。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=0.8\\textwidth]{image2.png}\n    \\caption{定点表示法}\n    \\label{fig:fixed_point}\n\\end{figure}\n\n\\section{基本操作、时序约束和资源/功耗约束}\n\n【基本操作、时序约束和资源/功耗约束】\n\nASIC 上的算法设计，需要将计算拆解为基本的操作。本题中考虑加法、乘法，查表和数据缓存四类操作，其表示如图 \\ref{fig:asic_operations} 所示。加法和乘法均是对两个数开展，复数运算拆分实部和虚部各自计算。减法可认为是先做一次乘以 $-1$ 的乘法，再做一次加法。ASIC 上由于是二进制定点数表示，乘以或除以 $2$ 的幂次方相当于对小数点进行移位，不会带来额外的资源代价。查表用于加法和乘法无法直接实现的操作。例如求 $\\sin$ 函数，可以将输入-输出映射关系分别量化为离散输入-输出对应关系，通过查表的方式求得输出。例如求 $d = \\sin\\left(\\frac{a+b}{2} * c\\right)$，首先一级加法计算 $a+b$，再通过移位得到 $\\frac{a+b}{2}$，随后一级乘法得到 $\\frac{a+b}{2} * c$，最后通过 $\\sin$ 查表的方式得到 $d$。每种运算都对应了芯片上的资源。显然，参与运算的数据位宽越大，占用的资源也会更多。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=0.8\\textwidth]{asic_operations.png}\n    \\caption{ASIC 芯片基本运算操作}\n    \\label{fig:asic_operations}\n\\end{figure}\n\n另一方面，芯片是在时钟主频下一拍一拍运行，一拍运行中只能完成有限个连续的基本运算，但通过加缓存的方式，可以实现流水的结构。例如图 \\ref{fig:buffer_pipeline} 中，若运算 1 结果出来的时候，一拍内剩余的时间无法完成运算 2，则需要在运算 1 的出口加入 1 级 buff 缓存以存储运算 1 的输出数据。每拍运算时，运算 2 读取 buff 中存储的运算 1 的上一拍输出开展计算，而运算 1 则和当前输入数据开展运算，并将结果在存入 buff 中，这样一来，每拍运行可以同时开展运算 1 和运算 2，但会造成输出的结果会比运算 1 和运算 2 在同一拍完成的情况延迟 1 拍。\n\n\\begin{figure}[h]\n    \\centering\n    \\includegraphics[width=0.8\\textwidth]{buffer_pipeline.png}\n    \\caption{缓存实现流水结构}\n    \\label{fig:buffer_pipeline}\n\\end{figure}\n\n不同的运算路径有着不同的时钟延迟，当算法存在不同的计算路径时，需要保证每个路径的延时对准。例如在 CR 算法中，计算出的相位噪声差需要反乘回数据，但相噪计算通常无法在 1 拍内完成，从而导致相位和数据有延时，需要用 buffer 将延时对准。本题中，假设 1 个时钟周期最多完成 1 级乘法，4 级加法，以及 1 级查表操作。\n\n加法、乘法、查表和缓存均需要占用资源，在算法设计也应有所考虑。加法和乘法均是两两操作，加法资源近似与最大位宽呈正比，乘法资源近似与位宽乘积成正比，延时资源和位宽以及延时深度近似呈正比。对于一个M-N的查表，资源与(2^M)*N呈正比。M代表输入位宽，N代表输出位宽，例如：已知信号求相位的查表操作，信号位宽s(10,1)，相位位宽s(9,1)，此时的M=20，N=9。在查表时候的输入为信号的【实部 虚部】组合，需要遍历的地址有2^20，每个地址对应的相位值的位宽为s(9,1)。\n\n\\begin{table}\n\\centering\n\\caption{表1}\n\\begin{tabular}{|c|c|c|c|c|}\n\\hline\n基本操作 & 8+8bit & 8*8bit & 8bit-8bit查表 & 8bit, \\\\\n & 加法器 & 乘法器 & & 每2048符号延时 \\\\\n\\hline\n资源 & 1U & 8U & 128U & 1U \\\\\n\\hline\n\\end{tabular}\n\\end{table}\n\n三、ASIC芯片算法设计的典型步骤\n  \n  综合上述内容，芯片上算法设计的通常包含以下具体步骤：\n\n1) 根据物理模型和系数特性设计算法原型：例如CR算法中，采用Pilot估计相位差，并利用插值等方法计算出净荷的相噪，最终将估计的相位差乘回数据以补偿相噪。\n2）在考虑并行度和时序约束的基础上，将算法细化为可实现的基本操作，并大致考虑算法的实现复杂度对算法实现的影响。此时可假设为浮点数，不需要考虑定点量化噪声。例如CR算法中，可能需要考虑净荷相噪的插值如何由基本操作实现，计算噪声路径的延时如何与补偿噪声路径的延时相匹配等。\n3） 进一步考虑定点量化噪声的影响，尽量以更低的资源实现，此时位宽优化是一个关键步骤。",
  "problem_requirement": "问题1：考虑波特率为150Gbaud的标准16QAM信号，令线宽为100kHz，色散值为2万ps/nm，算法的并行度固定为128，不考虑定点量化。请以基本的加法、乘法、查表和缓存为基础，并以RSNR代价<0.3dB为目标，设计一套CR算法，使得Pilot开销最小？\n\n问题2：考虑线宽从10kHz~10MHz，色散Dz从0~10,000 ps/nm变化场景，以RSNR代价<0.3dB为目标，定量挖掘色散、线宽与Pilot开销的关系。\n\n问题3：在问题2的场景上，进一步将芯片实现的资源纳入考察，此时需考虑定点量化对性能和资源的影响，且导频开销可任意变化（但必须确保净荷的流量为>145Gbaud），如何设计资源最低的CR算法？\n\n问题4：现实中性能和资源的权衡与具体场景有关。例如长距干线传输对性能要求往往比短距离要求更高，长距传输可付出更多的资源以降低RSNR代价。并选出问题3中你队认为有代表性的1种场景，给出统筹性的“性能-资源”综合考虑下的算法设计思路，构造性能和资源的综合代价函数，尝试给出一套自动优化位宽和实现性设计的方案，并给出定量结果，用以指导算法开发。\n\n注：本题中均不考虑色散补偿和误码率计算的复杂度和资源，只需考虑CR算法（计算相噪+补偿相噪）相关的资源即可。",
  "problem_analysis": "总体把握这组问题，首先需要回到宏观层面审视目标与约束：本系列问题的核心目标是以工程可实现的形式（ASIC并行度固定、基本运算资源受限、必须保证净荷速率、有限的功耗/面积预算）设计一种载波恢复（CR）算法，使在各种信号/信道条件下（给定波特率、线宽、色散范围）系统的RSNR代价不超过给定阈值（0.3 dB），并在此约束下尽可能减小Pilot开销或实现所需性能时最小化芯片资源开销。这个目标直接把“性能”（RSNR代价、净荷吞吐）与“资源”（加法器、乘法器、查表器、缓冲、位宽）两类互相冲突的指标连结起来：提高性能通常需要更多Pilot、更复杂的估计器和更宽的定点位宽；压缩资源或Pilot会增加相位估计残差或量化噪声，从而增加RSNR代价。建模与求解路径必须同时答复两个问题类别：一是给定物理噪声模型（Wiener相位噪、加性高斯噪声、已知色散补偿）下，如何用统计估计理论和近似分析得到Pilot间隔/块长度（即Pilot开销）与残余相位方差之间的定量关系；二是在考虑ASIC实现细节（并行度、基本运算延时、位宽相关资源函数、查表规模指数爆炸、缓存时延对齐等）后，把定点化引入模型，求出满足相位残差预算且资源最小的实现方案。整个建模过程需要把随机过程的估计误差分析（为性能端口口供）和硬件资源/时序计算（为实现端口供）耦合起来做联合设计或分层近似优化。\n\n在宏观假设层面应当明确并审视若干显性与隐性前提，以及它们对结论的影响。显性假设包括：相位噪声服从Wiener过程，其逐符号增量方差由式(7) v = Var(dθ) = 2π·LW / f_b 给出；色散已知并在CR之前通过频域补偿（FFT×H(f)×IFFT）被补偿；CR的实现只需考虑“计算相位并反乘到符号”的资源，不考虑色散补偿本身的资源；ASIC上基本原语包括定点加法、乘法、查表、缓存，且资源/延时与位宽、查表输入位宽等按题目给出的近似规则增长；在问题1中暂不考虑定点量化噪声（即用“浮点等价”分析Pilot开销）。隐含假设包括：补偿色散后信号与相位噪声的耦合可以忽略（即相噪行为仍由Wiener过程主导，补偿过程本身不把相位噪声变形为更难估计的结构性误差）、AWGN的统计特性不随频率和色散强度显著变化、相位估计器（线性插值、平均等）在统计上可用较简单闭式表达式近似其误差方差。需要注意，这些隐含假设在极端参数（非常大的色散、非常宽的线宽或非常低的SNR）下可能失真：例如相位噪声与色散补偿器之间会产生交互，从而把相位扰动映射到幅度/相位耦合误差，或使相位的时空相关性在补偿后改变；定点实现中非线性截断、溢出和查表线性化误差也会影响最终的误差预算。因此模型结果在工程应用时必须以仿真/测试数据进行标定和验证，而不是直接当作唯一真理。\n\n在更具体的关系建模上，核心链条是：物理参数（f_b、LW、Dz、加性噪声Pn）→相位过程统计特性（逐样本增量方差 v）→给定Pilot结构与估计/插值算法产生的残留相位方差 σ_φ^2（包含过程插值误差、观测噪声带来的测量误差、以及将来引入的量化误差）→残留相位误差引起的等效噪声功率增量 ΔP_n ≈ P_s·σ_φ^2（小角近似）→RSNR的降低（或在RSNR上需要额外的SNR补偿）。这一链条给出一个极为有用的闭合式近似：在小相位误差假设下（φ 微小），旋转导致的额外噪声功率约等于信号功率乘以相位方差，这就直接把相位估计精度（一个统计量）映射到RSNR代价（工程指标）。因此，要把RSNR代价控制在ΔdB目标下（例如ΔdB=0.3 dB），可以导出允许的最大残留相位方差 σ_φ,max^2 = (10^{ΔdB/10}-1)/SNR_ref，其中SNR_ref为在无相噪时系统需要的基准SNR（以线性尺度表示）。这项公式在设计上非常关键，因为它把性能约束转化为相位估计方差预算，从而把信道统计、Pilot结构和实现噪声都纳入统一误差预算中。\n\n在Wiener相位噪声模型下，若在时域用“隔L个符号插一个Pilot块、每个Pilot块包含M个连续Pilot以便观测平均降噪”的简单策略，并使用线性插值（或对称加权）在Pilot之间估计相位，那么残留误差在两个来源中相加：一是过程插值误差（Brownian bridge插值误差），其在离端点最远处（通常在区间中点）达到最大，最大值约为 v·L/4（这里v为逐符号增量方差）；二是Pilot观测噪声的插值残差，若每端点使用M个连续Pilot并对它们的相位作平均，则单端点相位估计方差近似为 Var_p = 1/(2·SNR·M)（这是相位估计在高SNR近似下的角度方差：Var(arg(z)) ≈ 1/(2·SNR)），这两个端点的观测噪声在内插点合成后在最坏点（中点）贡献约 0.5·Var_p = 1/(4·SNR·M)。于是总的最大残留方差近似为 σ_φ^2 ≈ v·L/4 + 1/(4·SNR·M). 将这一表达式代回RSNR预算公式，便得到一个清晰且可求解的不等式，用来选择(L,M)使得RSNR代价小于阈值。这个近似能直接用来回答问题1和问题2的第一阶定量关系：Pilot间隔L与线宽LW通过v成线性关系，L与允许残差σ_φ^2成正比，因此Pilot开销逆相关于1/L。更具体地，给定SNR与需要的ΔdB，求出σ_φ,max^2后便可以求得 L_max ≈ (4/ v)·(σ_φ,max^2 - 1/(4·SNR·M))，要使得右边为正则可行，说明必须保证M足够大（或SNR足够高），否则测量噪声主导，任何稀疏Pilot都会失败，这是工程中常见的“量测噪声主导”与“过程噪声主导”两种工作域的分界。\n\n基于上面的关系，我们可以对问题1作出有理性的设计策略并给出定量示例（注意问题1规定并行度128、150 Gbaud、LW=100 kHz、Dz=20000 ps/nm、无定点量化噪声）。首先计算符号间的相位增量方差 v = 2π·LW / f_b = 2π·100e3 / 150e9 ≈ 4.19×10^-6 rad^2。假设典型基准SNR（无相噪时使16QAM到达给定BER的SNR）取为20 dB（线性100）作为示例，则RSNR代价0.3 dB对应的残留相位方差预算 σ_φ,max^2 = (10^{0.03} -1)/100 ≈ 0.0007177。用前述公式并令M为每个Pilot端点的平均样本数，得到不等式 (SNR·v·L)/4 + 1/(4·M) < 0.07177，或等价地 L < (0.28708 - 1/M)/(SNR·v). 带入SNR=100、v≈4.19×10^-6得到 L_max≈ (0.28708 - 1/M)/4.1888×10^-4. 若选择M=4（每端点平均4个连续Pilots），数值给出L_max≈88符号，对应Pilot开销大约为 M/(L+M) ≈ 4/92 ≈ 4.35%。如果选择M=8，则L_max≈ (0.28708 - 0.125)/4.1888e-4 ≈ 392，对应开销 ≈8/400≈2.0%。因此有一个清晰的优化方向：为减小Pilot比例，你可以增加每端点的Pilot重复数M（以减小测量噪声），但这增加了每个Pilot块的长度并对总开销的影响按M/(L+M)体现；在很多工程设计中取较小但连续的Pilot块（例如M=4~8）在SNR为常见水平时是一种合理的折衷。并行度128对Pilot开销的最小值本身并不直接影响Pilot的时间间隔设计（Pilot间隔以符号数计），但并行度决定了并行处理资源需求与时钟频率选择，从而间接影响能否在芯片上以给定位宽与延时实现复杂插值/滤波操作（例如Kalman smoother、滤波/平滑器）带来的延时和资源开销。\n\n将上述分析推广到问题2（线宽从10 kHz到10 MHz，色散Dz从0到10,000 ps/nm），可建立参数化的Pilot开销映射。基于Wiener模型，v与LW成线性关系（v ∝ LW/f_b），因此在不考虑色散对测量噪声的额外影响时，L_max与1/v成正比，故Pilot间隔L_max ∝ 1/LW；换言之，在其他条件相同的情况下，线宽增长10倍将使可接受的Pilot间隔缩小约10倍，Pilot开销大增。SNR对Pilot開銷也关键：低SNR时测量噪声项1/(4·SNR·M)将主导，使得即便v很小也需要增加M从而导致最小开销不再随LW线性缩放。在色散方面，如果色散在补偿后对相位跟踪没有引入新的统计相关性并且色散补偿的残余误差可视为附加的等效噪声，那么色散会通过降低有效SNR间接增加Pilot需求；建模上可以把色散引入为对PNR（pilot SNR）的一项增量噪声Pn_resid(Dz)，从而用SNR_eff(Dz) = P_s / (P_n + Pn_resid(Dz))代替SNR。具体Pn_resid(Dz)的形式依赖于色散补偿器实现（FFT长度、窗口、数值误差、带外能量泄露等），在没有明确实现细节时建议用实验/仿真拟合一个简单的单调增长函数，例如Pn_resid(Dz) ≈ k·(Dz)^α（常见工程经验中α在1~2之间），并用测量或仿真数据确定k、α。因此问题2的定量挖掘建议采用两步：一是用上述闭式近似得到Pilot开销关于LW与SNR的主要敏感关系（L_max ∝ 1/LW，当测量噪声可忽略时）；二是将色散视为对SNR的等效侵蚀并用仿真/标定数据确定SNR_eff(Dz)后，再按同样公式计算Pilot开销随Dz的变化，从而得到三维平面PilotOverhead(LW,Dz;SNR)。这种方法既保留了物理的可解释性，又便于工程实施和参数灵敏度分析；在实际工程中应补充Monte-Carlo仿真（发送/接收链含色散补偿+AWGN+Wiener相噪），以验证解析近似并修正Pn_resid模型。\n\n问题3要求在问题2的场景基础上将芯片资源和定点量化噪声纳入设计并以净荷>145 Gbaud为约束寻求资源最小的CR算法。这里的设计维度变为：Pilot开销 p（影响净荷 = f_b·(1-p)），每种算术单元与位宽选择（例如用于相位计算/滤波/插值的乘法器/加法器数目及各自位宽），查表结构或CORDIC实现的选择，缓存深度以匹配不同路径延时的需要，以及可能的算法改进（例如用Kalman滤波或平滑而不是线性内插，或采用判决辅助（decision-directed, DD）来降低Pilot使用率）。在把定点化考虑进来时需要把量化噪声转换成相位估计方差的附加项 σ_q^2，并把它加入总的相位方差预算：σ_φ^2 = v·L/4 + 1/(4·SNR·M) + σ_q^2. 定点量化噪声的建模在工程上通常用均匀量化噪声近似：若一个量在幅度范围被用F个小数位表示，量化步长Δ≈2^{-F}（取决于缩放），则量化噪声方差≈Δ^2/12；对于相位量化（例如相位查表或相位累加器），需要把幅度量化映射到相位误差，近似的相位量化方差取决于算法细节（例如相位通过atan2处理、通过CORDIC迭代或查表获得等）。在资源模型上题目给出了粗线性规则：加法器资源≈与位宽线性相关，乘法器资源≈与位宽乘积成正比，查表资源≈(2^M)·N与查表输入位宽M呈指数关系，缓存资源≈位宽×延时深度成正比。这些关系使得优化成为一个离散混合整数优化问题：目标是最小化资源成本函数R（加法、乘法、查表、缓存的加权和），约束条件包括 σ_φ^2 ≤ σ_φ,max^2（性能约束）、净荷≥145 Gbaud（Pilot overhead约束）、并行度与时序约束（例如1个时钟周期最多能完成1级乘、4级加和1级查表，且位宽越大单元延时和可并行度可能受限）。求解方法上推荐二阶策略：先用上面解析的连续近似在“位宽不计资源差异”的假设下快速确定满足性能与净荷约束的(L,M)对及粗略位宽需求（用于使σ_q^2小于剩余误差预算）；然后在离散资源模型下以穷举或启发式搜索（例如先对关键路径的位宽做二分搜索、采用贪心地从最省资源的实现单元替换到更精确的实现直至满足误差预算）来最低化资源。特别要注意的硬件设计技巧包括：用查表替换复杂函数（atan2、sin/cos）能够显著降低乘法占用，但查表的地址位宽M会导致查表资源以2^M爆炸增长，因此对查表输入位宽的裁剪必须非常谨慎；用CORDIC实现可以以较低查表资源换取更多的迭代步骤（时序/延时成本），在异步并行度较高时通常是更切实的折衷；相位计算中的位宽可以采用逐级放宽策略：对早期低权重内部变量用较窄位宽，对累加器和关键输出用较宽位宽；用“量化噪声预算分配”方法把允许的相位噪声预算按贡献分配到测量噪声、过程噪声和定点化噪声上，以便确定每一类运算的最小位宽。示例性结果（数值只是说明方法而非绝对结论）：在一个中等SNR场景（例如基准SNR≈18~20 dB），若LW在100 kHz量级且Dz令SNR_eff降低有限，要求净荷>145 Gbaud(即Pilot开销p ≤ 1 - 145/150 ≈ 3.33%)，解析公式可能表明仅靠M=4、L≈88取得≈4.35%开销不能满足净荷要求；为压缩开销到≤3.33%需要更高的L（稀疏Pilot）同时提高端点平均数M或采用更优估计（Kalman smoothing），或提高本地SNR（例如通过增加发射功率或改进前端）或使用决策辅助追踪以减少Pilot需求。若必须在有限资源下实现要求，则常见策略为：采用Kalman滤波器/平滑器（基于Wiener模型的MMSE）替代简单线性插值，因为Kalman平滑能在相同Pilot开销下显著降低插值误差，从而允许更长的L；同时对数值实现采用CORDIC+小查表、对相位累加器和乘法器使用更宽位宽（例如9~12位）以保证角度截断误差σ_q^2在允许预算内，而把大规模乘法器位宽限制在数据通路的关键局部以节省资源，查表输入位宽严格控制在能被接受的范围（避免2^M爆炸）。最终通过离散搜索（例如对M在{2,4,8}、对L按不等式上限向下取整、对关键算子位宽在8–12位网格搜索）可以找到一个在资源上局部最优的配置。\n\n问题4要求在代表性场景下构造性能-资源的综合代价函数并给出自动优化位宽和实现的方案。这一步的关键是把“性能”与“资源”映射到统一的标度上，进而做多目标权衡或加权和优化。一个合理的综合代价函数J可以采用加权和形式：J = w_p·ΔRSNR_rel + w_r·R_norm + w_t·Penalty_throughput，其中ΔRSNR_rel是实际RSNR代价（若超过阈值，用大惩罚或连续值表示超过量），R_norm是归一化后的资源消耗（例如归一化到某一参考实现的资源U_ref），Penalty_throughput是对低于净荷约束（145 Gbaud）的惩罚项（例如阶跃惩罚或连续的凸惩罚），权重w_p,w_r,w_t由系统设计者按场景偏好设定（在长距干线w_p大、对性能敏感时将w_p取大；在低成本短链路系统中取w_r大）。在代表场景上（例如长距干线：f_b=150 Gbaud、目标净荷≥145 Gbaud、线宽LW较大例如500 kHz、色散Dz=8000 ps/nm、基准SNR中等20 dB），我们用先前公式建立σ_φ^2表达式并把定点量化符号位宽跟资源模型耦合，形成一个有限维的离散优化问题：设计变量包括Pilot block length M（整数）、Pilot间隔L（整数）、相位相关运算（查表/CORDIC/浮点）的实现方式（二选一）、关键算子位宽向量 F = {f1,f2,...}（每个fi为整数bit数）。求解方法建议采用两层迭代：外层是枚举/启发式搜索Pilot结构（M,L）满足净荷与过程误差预算，内层在R和σ_q约束下以混合整数非线性优化（或启发式搜索）选择位宽组合并评估资源与性能，以获得Pareto前沿。为了快速搜索，可采用代理模型（surrogate）：用解析公式给出σ_φ^2近似值并用简单的资源模型估算R，再用局部搜索/粒子群/遗传算法探索位宽和实现选择空间。通过这种方法可以得到一系列Pareto解（例如：解A性能优先：Pilot开销2.0%、资源消耗1.6·U_ref、位宽平均10位；解B资源优先：Pilot开销3.2%、资源消耗1.0·U_ref、位宽平均8位，但RSNR代价接近0.3 dB阈值），并据此选取满足实际运营要求的解。给出数值示例时应同时指出这些数值高度依赖于基准SNR、查表参数、乘法器资源系数等实现细节，因此推荐以仿真-标定方式将代理模型参数化并用真实硬件库（FPGA/ASIC资源模型）做最后的资源估算。\n\n最后强调模型方法学上的若干不确定性与工程建议。第一，Wiener相位模型与线性/最小二乘或Kalman估计的闭式误差表达式为设计提供了透明且一般适用的第一性分析工具，但在高色散、极低SNR或非Wiener相噪（例如有显著1/f噪声成分或快慢混合的噪声）时，性能会偏离解析近似，必须用Monte-Carlo仿真与实验数据修正参数并验证最终实现。第二，定点量化的实际影响不仅来自均匀量化噪声，还包括截断、饱和/溢出和合并运算中的异常行为，设计时应把安全裕度留出，并在RTL仿真中进行统计验证。第三，查表实现带来的指数爆炸问题是资源优化的一个“钦定点”：对高精度相位估计，优先考虑CORDIC、分段线性逼近或混合查表+小插值技术以避免大规模查表。第四，除静态优化外，推荐利用场景自适应策略：在信道条件较好时可把Pilot开销动态降低并用DD追踪补偿，条件变差时自动提高Pilot密度或切换到更准确但资源更高的估计器；这种动态权衡能大幅提高长期能效与吞吐。第五，建模与设计过程应是迭代式的：用解析表达式初步筛选可行区域，以仿真/测试标定关键模型系数（如色散引入的等效噪声曲线、查表误差曲线、器件级资源延时曲线），再回到算法/硬件一体化设计中做精细优化，最后在硅之前做RTL和系统级仿真验证。\n\n總結性建议是：把相位估计的误差预算作为设计主线（用σ_φ^2预算把物理噪声、测量噪声和量化噪声汇聚），用Wiener模型与Pilot结构导出解析界（便于快速灵敏度分析），把色散当作对SNR的等效侵蚀并通过仿真标定，资源优化采用两层策略（解析筛选 + 离散搜索/启发式优化），查表/cordic/位宽选择采用噪声预算分配原则并注意查表地址位宽的指数成本，最终用Monte-Carlo仿真和硬件仿真闭环验证并留出实现裕量。这样的迭代式、分层化设计流程既能给出工程上可行和可解释的定量解，也能在实际产品开发中保持足够的灵活性以应对实际器件与信道偏离理想模型的情况。",
  "modeling_solution": "总览与建模思路概述：本回答以“把相位估计误差作为性能主线、把误差预算在过程噪声（Wiener相位）、量测噪声（Pilot+AWGN）与定点量化噪声之间分配、并将硬件资源模型（加法/乘法/LUT/缓冲）作为约束或目标”为核心思路，构建一个可解析、可数值优化与可工程实现的统一模型。模型由三部分耦合：物理统计模型（Wiener相位、AWGN、色散产生的等效SNR退化）、估计器误差模型（Pilot结构、插值/滤波算法、决策辅助等产生的残余相位方差）、硬件/定点实现模型（基本运算器资源与延时、位宽对量化噪声的影响、并行度与时序约束）。通过把最终的RSNR代价转换为允许的残留相位方差预算，再将该预算按三类误差来源分配，得到关于Pilot开销与位宽/资源的可解约束和优化问题。下面先列出显式假设和变量，再给出关键方程、解析近似、数值示例（问题1）、参数化关系（问题2）、带资源与定点优化框架（问题3）、以及在长距代表场景下的性能—资源综合代价与自动优化思路（问题4）。\n\n显式假设与符号说明：采用离散符号表示，波特率 f_b (symbols/s), 复基带符号 S_k，接收符号 r_k，Wiener相位噪声模型定义每符号相位增量方差 v = Var(dθ) = 2π·LW / f_b（LW 单位 Hz）。AWGN 的信噪比定义为 SNR = P_s/P_n（线性尺度）。16QAM 基准在无PN时达到给定BER所需的基准 SNR 我们记为 SNR_ref（可视为参数或用典型值 18–22 dB 作数值示例）。Pilot 设计：每隔 L 净荷符号插入一个 Pilot block，Pilot block 长度为 M（连续 M 个 Pilot 用来平均降噪），因此单周期 Pilot 开销 p = M/(L+M)。并行度 P_deg = 128 是芯片并行复制数（表示必须把数据按 P_deg 平行处理，资源按 P_deg 复制或多端口化计）。\n\n残余相位方差近似分解（核心预算公式）：在高 SNR 与小角近似下，对目标 RSNR 增量 ΔdB（例如 0.3 dB）允许的等效残留相位方差 σ_phi,max^2 近似由小角近似把相移引入的信号功率损失与必要的等效噪声增加联系起来。定义 10^{ΔdB/10} - 1 = η (线性比例)，则允许的等效相位方差预算约为 σ_phi,max^2 ≈ η / SNR_ref. 例如 ΔdB = 0.3 dB => η ≈ 10^{0.03} - 1 ≈ 0.07177, 若 SNR_ref = 100 (20 dB) 则 σ_phi,max^2 ≈ 7.177e-4. 我们把实际残留相位方差近似表示为三项和：\nσ_phi^2 ≈ σ_proc^2 + σ_meas^2 + σ_q^2,\n其中 σ_proc^2 为插值的过程误差（Wiener过程插值残差），σ_meas^2 为由Pilot测量噪声（AWGN）导致的相位估计方差（含端点平均降噪与插值贡献），σ_q^2 为定点/算法量化误差造成的相位方差。\n\nWiener过程插值误差（线性内插或MMSE估计的第一阶近似）：当在两个Pilot之间插值 L 净荷符号时，Wiener增量方差 v 导致以线性内插为近似的最大插值误差（区间中心最大）约为 σ_proc^2 ≈ v·L/4. 该公式可从 Brownian-bridge 的方差分布导出，并可作为工程近似。采用更优的 MMSE/Kalman 平滑器会将常数 1/4 降低到更小数值（例如 1/8–1/16，取决于使用平滑还是仅因果滤波），因此选择估计器会直接影响允许的 L。\n\nPilot测量噪声项：单个符号的相位观测方差在高 SNR 下近似 Var(arg(z)) ≈ 1/(2·SNR_pilot)，若每端点用 M 连续 Pilots 做平均，则端点相位估计方差 Var_p ≈ 1/(2·SNR_pilot·M). 插值到区间中心时观测噪声贡献约为 σ_meas^2 ≈ Var_p/2 = 1/(4·SNR_pilot·M). 若Pilot功率与数据功率相等，则 SNR_pilot = SNR_eff（考虑色散导致的等效 SNR 衰减，见下文）。如果采用端点多重加权或最优滤波，常数可改良但形式类似。\n\n定点量化噪声建模：对于某一关键数据通路使用 b 位定点表示、动态范围经缩放以尽量利用位宽，则统一的量化步长 Δ ≈ 2^{-b}·R_norm（R_norm 依据量级），若量化误差可近似为均匀白噪声，单变量量化方差约 Δ^2/12。把幅度量化映射到相位估计误差需要乘以灵敏度系数 κ（依赖于算法，如 atan2 的输入幅度到相位灵敏度、或查表/CORDIC 的近似误差传播），因此可近似取 σ_q^2 ≈ κ·2^{-2b}. 在多路径系统里可把不同运算位宽赋值 b_i，并把各自贡献线性相加或用更精确的方差传播模型。\n\n把上述三项合并，性能约束为 σ_phi^2 ≤ σ_phi,max^2. 这就是把 RSNR 代价目标转化为关于 (L,M,SNR_eff,算法类型,位宽集) 的约束。\n\n问题1（150 Gbaud，16QAM，LW=100 kHz，Dz=20000 ps/nm，并行度=128，忽略定点量化，目标 RSNR 代价 <0.3 dB，最小化 Pilot 开销）：首先计算逐符号相位增量方差 v = 2π·LW / f_b = 2π·100e3 / 150e9 ≈ 4.18879e-6 rad^2. 允许残差 σ_phi,max^2 = η / SNR_ref，η 对应 0.3 dB 为 ≈0.07177。因为基题未给 SNR_ref，设计必须参数化为函数 SNR_ref。以典型 SNR_ref = 100 (20 dB) 作数值示例，则 σ_phi,max^2 ≈ 7.177e-4. 忽略 σ_q^2 后，插值+测量约束为 v·L/4 + 1/(4·SNR_ref·M) ≤ σ_phi,max^2. 解得 L ≤ (4/ v)·(σ_phi,max^2 - 1/(4·SNR_ref·M)). 为极小 Pilot 开销需要极大 L 但 L 受右侧正性约束。把 M 作为可调整数参数，优化 p = M/(L+M) 最小。代入数值：若 SNR_ref = 100，v ≈4.1888e-6，σ_phi,max^2 ≈7.177e-4。若选 M = 4，则右侧 σ_phi,max^2 - 1/(4·100·4) = 7.177e-4 - 6.25e-4 = 9.27e-5, 得 L_max ≈ (4/4.1888e-6)*9.27e-5 ≈ 88.7，取整 L=88，对应 p = 4/(88+4)=4.35%. 若选 M=8，则 1/(4·100·8)=3.125e-4, 剩余 4.052e-4, L_max≈(4/4.1888e-6)*4.052e-4≈387→p≈8/395≈2.03%. 若选更优估计器如 Kalman smoothing 假定过程常数从 1/4 降到 1/12，则 L_max 放大约 factor 3，从而 p 可降到 ≈0.7–1.0%。 结论：在浮点情况下并行度128不限制时间上 L（因为 L 以符号计），最小 Pilot 开销取决于可接受的 M 与估计器精度。若可采纳 Kalman smoothing 或平滑技术，并在端点使用 M=4，理论上可以把 Pilot 开销降到 ~1% 以下；若仅允许简单线性插值，则 M≈8、L≈387 时开销约2% 已能满足0.3 dB 限制（在 SNR≈20 dB 情况下）。因此问题1 的工程回答是：采用短连续 Pilot block (M=4–8) + 长间隔 L (≈100–400) 配合 MMSE/Kalman 平滑可在 RSNR 代价<0.3 dB 下把 Pilot 开销压到 ≈1–4% 之间；要最小化开销优先采取更优估计器（Kalman smoother），使过程误差系数显著下降，从而允许更长 L。\n\n问题2（线宽 LW 从 10 kHz 到 10 MHz，色散 Dz 从 0 到 10000 ps/nm，目标 RSNR 代价<0.3 dB）：因为 v ∝ LW, 插值主导时 L_max ∝ 1/v ∝ 1/LW，故 Pilot 间隔大致按 1/LW 缩放，Pilot 开销 p=M/(L+M) 约随 LW 增大而近似线性增长（当测量噪声可忽略时）。在低 SNR 或 M 小的情况下，测量噪声项 1/(4·SNR·M) 会主导，此时开销与 LW 关系变弱并受 SNR 限制。色散 Dz 的主要影响是通过降低有效 SNR（色散补偿残留、相幅度耦合等），因此模型上可用 SNR_eff(Lz) = SNR / (1 + α·(Dz/D_ref)^β) 来近似，其中 α,β 由仿真或试验标定（经验上 β ≈ 1–2）。将 SNR_eff 代入前述不等式得到 L_max(LW,Dz,SNR) 的显式参数化关系，从而绘出三维曲面 p = p(LW,Dz;SNR). 实践推荐做一组 Monte-Carlo 仿真（真实链路含色散补偿器）来标定 α,β 并验证解析近似。总结性规律：当 LW 增大 10 倍，可接受 L 缩小约 10 倍；当 Dz 增大导致 SNR_eff 降低 t 倍时相当于需要 M 增加或 L 减少以补偿测量噪声增加。\n\n问题3（把芯片资源与定点量化纳入，净荷>145 Gbaud，线宽与色散变化场景中最小化资源的 CR 算法设计）：把资源建模为加法器资源 R_add = c_a · Σ(b_i)（位宽线性叠加），乘法器资源 R_mul = c_m · Σ(b_i·b_j)（乘法器资源近似与被乘数位宽乘积成正比），查表资源 R_LUT ≈ c_l · 2^{M_addr} · b_out（指数增长），缓冲资源 R_buf = c_b · depth · Σ(b_i)。常数 c_* 可由工艺库或题目给例参考（例如 8*8 mul = 8U, 8bit LUT 128U 等）标定。并行度 P_deg=128 意味着若对每条并行通路复制资源则总体资源乘以 128；工程上常采用时间/资源复用把某些昂贵模块共用以降低复制开销，但这受时序约束（1 个时钟周期最多 1 个乘法、4 个加法、1 个查表）限制。优化目标是最小化 R_total = R_add + R_mul + R_LUT + R_buf subject to σ_phi^2 ≤ σ_phi,max^2 and p ≤ 1 - 145/150 = 3.333% (即净荷≥145Gbaud) and timing constraints. 这是一个混合整数非线性优化问题。解决策略建议两阶段：第一阶段用解析预算确定最优 Pilot 结构 (L,M) 在忽略定点量化下的理想值（使 p ≤ 3.33%），以及所需的残余相位容限留给量化 σ_q^2; 第二阶段在给定 σ_q^2 上分配位宽 b_i 以最小化资源。位宽分配可用 Lagrange 方法近似：若某个算子 i 的量化方差贡献约 κ_i·2^{-2 b_i} 且资源代价约 γ_i·b_i^α (通常 α≈1~2，根据加法/乘法不同)，则最小化 Σ γ_i b_i^α subject to Σ κ_i 2^{-2 b_i} ≤ σ_q_budget^2 的近似最优条件给出 2^{-2 b_i} ∝ (γ_i /(λ κ_i))^{1/(something)}, 导致位宽 b_i 按 log 比例分配；在实际工程中以离散 b_i（8–16位）作穷举/启发式搜索并用快速代理模型评估 σ_q^2 与资源 R 即可。对于查表，注意地址位宽 M_addr 有指数成本，优先用 CORDIC 或分段查表+线性插值代替大尺寸查表。对于相位求取（atan2）、复数乘除等关键操作常采用 CORDIC（位宽主导延时而非 LUT 指数成本），调节迭代次数以在时序预算内达成相位精度。应用决策辅助（decision-directed, DD）在净荷约束下非常有效：在良好 SNR 条件下使用少量 Pilot 启动后切换到 DD 以利用判决符号继续跟踪，相比纯 Pilot 方案可显著降低 p 并减小资源（因为可以用更窄位宽的逐步修正器）；不过 DD 受误判循环影响需提供鲁棒性限幅或交替 Pilot 校正。示例性数值策略：要求 p ≤ 3.33% 且 SNR_ref≈18–20 dB 时，可选择 M=4、L≈116（p≈3.33%）并采用 Kalman 平滑将过程系数降低以满足 σ_phi,max^2，同时把算子位宽设为相位路径 10–12 bit、复数数据路径 8–10 bit，查表替换为小查表+CORDIC，最终在资源模型标定下可得到 R_total 最小化解。具体数值需结合工艺库系数 c_* 与并行化策略作数值优化（建议用混合整数启发式优化、Bayesian optimization 或 ILP+离散搜索混合方法）。\n\n问题4（选代表性场景并构造性能—资源综合代价、自动优化位宽与实现）：选择长距干线代表场景： f_b = 150 Gbaud，目标净荷≥145 Gbaud（p ≤3.33%），LW = 500 kHz（较差激光），Dz = 8000 ps/nm（中高色散），基准 SNR_ref = 18 dB。在此场景对性能敏感度高，权衡函数 J 设为加权和： J = w_p · max(0, ΔRSNR_dB/Δ_target)^2 + w_r · (R_total / R_ref) + w_th · max(0, (145 - NetPayload)/145)^2, 其中 ΔRSNR_dB 为实际 RSNR 代价，Δ_target = 0.3 dB，R_ref 为参考资源基线，w_p ≫ w_r 用以体现长距系统对性能优先。 自动优化流程：外层枚举/连续化 Pilot 参数 (L,M) 在 p ≤3.33% 空间内；中层在给定 (L,M) 对应 σ_proc^2、σ_meas^2 后，残余容许量 σ_q_budget^2 = σ_phi,max^2 - σ_proc^2 - σ_meas^2 分配给各量化通路；内层执行位宽离散搜索（b_i ∈ {6..16}）与算法实现选择（CORDIC/查表/混合、Kalman vs linear interp vs DD）以最小化 R_total + λ·penalty(不足)（λ 由 w_r,w_p 转换）；每个候选通过快速代理评估 σ_q^2（基于 2^{-2b} 模型）并通过短时 Monte-Carlo 验证关键候选的真实 ΔRSNR。在代表场景下的示例解（基于上述代理与经验系数）：选 M=4, L=116（p≈3.33%），使用 Kalman smoother（使过程系数从 1/4 降到约 1/12），端点多重平均 M=4 减少测量噪声，位宽分配：相位累加/控制路径 b_phase = 12，复数数据路 b_data = 9，乘法器位宽主要乘数对 b_mul ≈ 9，采用 CORDIC 实现 atan2（替代大 LUT），缓冲按延时深度 D≈stage_count 保存。这种配置在权重 w_p >> w_r 下能得到 ΔRSNR ≈ 0.25–0.28 dB 且 R_total ≈ 1.3·R_ref（R_ref 定为较简单实现的资源），若更注重资源可把 b_phase 降到 10 并使用更密集 Pilot p≈3.33% 但整体 RSNR 逼近阈值。所有数值须用工艺库 c_* 标定并通过 RTL 与系统级蒙特卡洛做最终验证。\n\n求解实现与验证建议：模型复杂且混合整数，推荐如下实践路径：先用解析近似筛出可行 Region（L,M 和估计算子类别），再用代理模型（快速闭式 σ 估计 + 简单资源模型）进行离散搜索与贝叶斯优化以取得候选 Pareto 前沿点；随后对候选点做较重的 Monte-Carlo 仿真（端到端链路含色散补偿、AWGN、Wiener PN、接收机前端）来校正代理模型参数（如 κ、α、β），最后在 RTL/合成层面用真实库估算资源与时序，做最后迭代。敏感性分析通过局部导数（例如 ∂L_max/∂LW ≈ -L_max/LW）及蒙特卡洛抽样实现，便于量化模型对 LW、Dz、SNR 参数偏差的鲁棒性并决定系统应对策略（例如自适应 Pilot density、动态切换 Kalman/决策辅助等）。\n\n扩展与改进方向：把色散对相位估计的耦合用更精细的物理模型替代简单 SNR_eff（例如频域上相位与幅度交叉项的统计建模），并在模型中直接引入色散补偿器参数（FFT 长度、窗函数、数值精度）以更准确地估计 Dz 导致的等效噪声；引入在线自适应控制（根据实时估计的 LW、SNR 与误判率动态调整 Pilot 密度与估计器复杂度）可显著节省长期资源并提升鲁棒性；在位宽优化中引入非均匀量化（块浮点或混合定点）与误差感知量化策略可进一步压低资源。最终建议在算法设计早期即与后端硬件库紧耦合（获得 c_* 参数和可行的复用策略），并在硅前通过仿真标定后进行小规模硅样片测验以修正模型参数，保证设计在真实工艺/噪声条件下满足 RSNR 与吞吐双重约束。",
  "task_descriptions": [
    "子任务 1（物理与性能基线建模与相位误差预算）：本子任务的目标是建立一套清晰、可计算的物理与性能基线模型，将给定的RSNR代价阈值（以ΔdB表示）精确映射为接收端允许的残余相位方差上限，并给出用于后续设计的封闭式约束关系与求解公式；其范围仅限于：定义相位噪声的统计模型、AWGN下相位观测噪声的近似公式、以及将小角近似下的残余相位误差转换为等效RSNR增量的关系。具体要求与步骤为：一、明确输入参数：符号率 f_b (Hz)、激光线宽 LW (Hz)、目标RSNR代价 ΔdB、无相噪基准SNR（线性量 SNR_ref，即在无PN时达到判决门限所需的SNR）、Pilot端点平均数 M（符号个数，用于建模测量噪声）、（如需）相位数值表示的位宽 b 以供量化误差项建模；二、建立物理模型：采用Wiener相位噪声模型并计算逐符号相位增量方差 v = 2π·LW / f_b；假定AWGN使单符号相位观测在高SNR下近似有方差 Var(arg(z)) ≈ 1/(2·SNR_pilot)，其中SNR_pilot为用于Pilot符号的有效SNR（可先取等于SNR_ref）；三、把性能目标转为相位方差预算：将RSNR代价ΔdB换算为线性增益因子 η = 10^{ΔdB/10} − 1，利用小角近似把允许的残余相位方差上限写为 σ_phi,max^2 ≈ η / SNR_ref；四、分解残留相位方差并给出解析近似：将残留相位方差分为三项 σ_phi^2 = σ_proc^2 + σ_meas^2 + σ_q^2，其中过程插值误差取Brownian‑bridge/线性内插近似 σ_proc^2 ≈ v·L/4（L为Pilot间隔的净荷符号数），测量噪声插值贡献近似为 σ_meas^2 ≈ 1/(4·SNR_pilot·M)（端点各平均M个连续Pilot），定点/算法量化误差以一般形式 σ_q^2 ≈ κ·2^{-2b} 表示（κ为算法路径灵敏度常数，可后验标定）；五、给出用于设计与灵敏度分析的封闭式不等式与显式解：建立约束 v·L/4 + 1/(4·SNR_pilot·M) + σ_q^2 ≤ σ_phi,max^2，并从中解析得到 L_max = (4/v)·(σ_phi,max^2 − 1/(4·SNR_pilot·M) − σ_q^2)（用于求可行的最大Pilot间隔及相应的Pilot开销 p = M/(L+M)），同时明确当右侧为负表示在给定M、SNR_pilot及量化误差下无可行L；六、工具与交付物：建议使用符号/数值工具（Python + NumPy/SciPy/ SymPy 或 MATLAB）完成代数推导與數值評估，輸出包括公式化的约束、不等式解的函数实现（可对LW、f_b、SNR_ref、M、b做参数扫描），以及用于后续标定的建议（用Monte‑Carlo仿真验证v·L/4与测量噪声近似的系数并标定κ）；七、关键假设与适用范围须明确写出：小角近似成立（残余相位方差小）、AWGN高SNR近似可用、色散已在前端以已知方式补偿且不会改变Wiener模型的基本行为。该子任务的产出为一组参数化、可复用的闭式表达式和数值计算例程，能够把物理参数（f_b、LW、SNR_ref）、Pilot设计变量（L、M）和量化位宽 b 映射到可直接用于约束与设计决策的相位方差预算表达式。",
    "子任务2的目标是把子任务1中给出的相位误差预算公式转化为可直接用于工程决策的、关于Pilot间隔L与Pilot块长度M的参数化规律和灵敏度结论，明确在不同激光线宽LW和色散Dz条件下应选择何种估计器（线性插值/加权插值、端点平均、卡尔曼滤波/平滑、decision‑directed辅助等）以满足给定RSNR代价约束，并给出可供实现的数值表面和判据边界；为此请按以下步骤执行并产出指定交付物：首先以Wiener相位模型和子任务1中σ_phi^2分解为理论起点，推导并给出闭式近似关系L_max(LW,SNR_pilot,M,estimator)（即在测量噪声项与过程插值误差项下使σ_proc^2+σ_meas^2≤σ_phi,max^2的显式解），同时把估计器类型通过一个经验缩放因子c_est引入（例如线性内插对应c_est≈1/4，卡尔曼平滑对应更小常数），并明确过程项σ_proc^2≈c_est·v·L（或更精确的Brownian‑bridge形式）；其次把色散Dz的影响模块化为对Pilot测量SNR的等效削弱（即定义并拟合一个SNR_eff(Dz)模型，例如SNR_eff = SNR/(1 + α·(Dz/D_ref)^β)或其它单调函数），说明拟合所需的数据和方法：用端到端蒙特卡洛仿真（输入参数：波特率f_b、LW范围10kHz–10MHz、Dz范围0–10000 ps/nm、候选SNR值、候选M值、给定Pilot结构与估计算法实现细节、Wiener PN与AWGN、已完成的色散补偿模块）生成在每组参数下的相位估计方差和BER/RSNR代价统计，利用最小二乘或非线性最小二乘拟合得到α、β以及估计器缩放因子c_est和测量噪声常数；第三步在解析公式与标定参数基础上构造参数化的输出（对每个估计器类型输出L_max、对应Pilot开销p=M/(L+M)、以及在给定SNR下的安全裕度），并生成可视化结果：三维表面或等高线图 p(LW,Dz) 及边界曲线（如过程噪声主导/测量噪声主导的分界线）、以及基于不同估计器的选择区域图；第四步开展灵敏度分析，计算并报告局部灵敏度指标例如∂L_max/∂LW、∂L_max/∂Dz（通过解析导数和数值差分），并识别在参数不确定性下最脆弱的设计点（例如当SNR低于某阈值时测量噪声主导，或当LW超出某值时需要切换估计器）；最后给出工程交付物：一套可运行的脚本（Python或MATLAB）用于生成L_max与p的参数化曲面、标定数据与拟合结果文件、估计器选择建议表以及灵敏度报告。所需输入数据包括：f_b、目标RSNR代价ΔdB→σ_phi,max^2、参考SNR范围、LW和Dz扫描范围、候选M列表及估计算法实现配置；所用工具与方法包括：解析推导（Brownian‑bridge与高SNR相位观测近似）、蒙特卡洛仿真（端到端链路含色散补偿）、非线性曲面拟合、数值微分与可视化。该子任务不涉及硬件资源或定点量化的细节，仅标定估计器对过程误差常数和色散引起的等效SNR衰减，并输出可直接用于Pilot密度与估计器选择的工程准则和数值表格。",
    "子任务3（面向问题3：将ASIC资源与定点化纳入的实现级建模与资源最小化优化）描述：本子任务的目标是在给定系统约束——净荷速率下限（净荷≥145 Gbaud，即Pilot开销 p ≤ 1 − 145/150）与性能上限（残余相位方差 σ_phi^2 ≤ σ_phi,max^2，σ_phi,max^2由目标RSNR代价给定）——下，构建一个可执行的、以硬件资源最小化为目标的实现级优化框架，输出具体的实现配置（Pilot结构 L、M；每条数据/相位路径的定点位宽向量 b_i；关键算子实现选择如 CORDIC vs 查表 vs 分段线性插值；缓冲深度与算子复用/复制策略）并证明约束满足。为此必须精确定义资源与误差模型、变量与约束、以及求解方法：资源模型应至少包括（并行度因子 P_deg 考虑在内）加法资源 R_add = c_a · Σ_i b_i · rep_i，乘法资源 R_mul = c_m · Σ_ij (b_i·b_j · rep_ij)，查表资源 R_LUT = c_l · 2^{M_addr} · b_out · rep_lut，缓存资源 R_buf = c_b · depth · Σ_i b_i · rep_buf，其中 c_* 为工艺/库标定系数，rep_* 为并行或复用复制因子，且时序约束以“每时钟周期最多可完成 1 乘、4 加、1 查表”形式显式加入以限制算子共享与复制方案。定点化噪声用可加方差模型映射到相位误差：σ_q^2 ≈ Σ_i κ_i · 2^{-2 b_i}（κ_i 为各运算路径的灵敏度常数，经仿真或经验标定），因此性能约束写成 σ_proc^2(L,estimator) + σ_meas^2(M,SNR_eff) + Σ_i κ_i 2^{-2 b_i} ≤ σ_phi,max^2，其中 σ_proc^2 可用 Brownian‑bridge/Kalman 常数形式 c_est·v·L 表示，σ_meas^2 ≈ 1/(4·SNR_eff·M) 为端点平均量测项，SNR_eff 可作为输入参数或来自色散诱导的等效SNR衰减模型。优化决策变量为整型或二元变量 {L∈Z+, M∈Z+, b_i∈Z+, choose_op ∈ {CORDIC,LUT,poly}, reuse_scheme}，目标函数为最小化总资源 R_total = R_add + R_mul + R_LUT + R_buf（可加权以反映面积/功耗优先），并受净荷、性能、时序、以及位宽下界/上界（例如 b_i ∈ [b_min,b_max]）与实现可行性约束。求解方法建议采用两阶段流程以兼顾效率与全局性：第一阶段用解析不等式快速筛除不可行 (L,M)（用 σ_proc^2+σ_meas^2 ≤ σ_phi,max^2 − σ_q_min 作保守筛选，σ_q_min 为最小可实现量化误差估计），生成一组候选 Pilot 结构；第二阶段针对每个候选在离散位宽与实现选择空间上求解混合整数优化问题，可采用混合整数非线性规划（MINLP）或组合启发式（贪心位宽分配、Lagrange-relaxation、遗传算法、贝叶斯优化）并结合局部精细搜索；在搜索中使用代理函数快速估计 σ_q^2(b) 与资源 R(b) 以加速评估，并对最优候选用更精确评估（端到端蒙特卡洛仿真输出残余相位方差与RSNR代价，以及工具合成/估算获得实际资源与时序）进行验证与必要的回圈调整。为实现该子任务需要明确的输入数据与工具：输入包括 f_b、目标 σ_phi,max^2（来自RSNR代价）、逐符号方差 v（或LW与f_b）、SNR_eff(Dz) 或 SNR 基线、工艺/库系数 c_a,c_m,c_l,c_b、每类算子随位宽的延时/资源/功耗曲线、并行度 P_deg 与时钟预算、算子实现候选的资源/误差模型（e.g., CORDIC 迭代数 vs 位宽对 κ_i 的影响；查表地址位宽对误差与资源的 trade‑off）、以及 κ_i 标定数据；必备工具链建议包括数值与优化库（Python + NumPy/SciPy、CVXPY、Pyomo）、商业或开源混合整数求解器（Gurobi/CPLEX/SCIP/OR‑Tools）、贝叶斯/遗传优化包、端到端蒙特卡洛仿真模块用于 σ_q 与RSNR验证，以及可选的RTL 合成或高精度资源估算工具以换算代理资源参数。交付物应包括：最优或 Pareto‑前沿的实现配置集合（每个包含 L,M、b_i、算子实现方案、资源明细与复制因子）、对每配置的性能验证报告（σ_phi^2、估计的RSNR代价或仿真统计）、时序可行性证明（满足 1 乘/4 加/1 LUT 每周期限制或给出复用方案）以及用于重复优化的脚本与模型文档，所有输出要能直接用于后续的RTL 实现与硅前验证。",
    "子任务 4（性能—资源综合代价构造与代表性场景下的自动化优化与验证闭环）：本子任务的目标是在给定代表性运行场景下（例如长距离干线）构建并求解一个端到端的自动化优化流程，该流程以明确的“性能—资源”综合代价 J 为目标函数，在满足吞吐/净荷和实时时序约束的前提下输出可直接用于硬件实现的若干 Pareto 最优设计点及其验证证据。具体范围与目标：1) 定义综合代价函数 J 将性能（RSNR 代价 ΔRSNR 或等效残余相位方差 σ_phi^2）、实现资源（总体算力/查表/缓存资源 R_total）与吞吐违约惩罚统一标度化并加权组合；2) 在给定场景参数集合（必须的输入：波特率 f_b、目标净荷下限、目标 RSNR 代价阈值、激光线宽 LW、色散 Dz、基准或测量 SNR、ASIC 工艺/库系数 c_a,c_m,c_l,c_b、并行度和时钟预算、算子时序限制如“每周期最多1乘、4加、1查表”）上自动搜索与优化设计空间，输出满足约束的位宽分配、Pilot 结构(L,M)、估计算法选择（例如线性插值、Kalman/平滑、decision‑directed）、关键算子实现方案（CORDIC/小查表/分段近似）、算子复用/复制策略与缓冲深度等实现细节；3) 对候选解提供三类验证：快速代理评估（解析近似或代理模型估计 σ_phi^2 与 R_total）、高保真端到端蒙特卡洛仿真（包含色散补偿、Wiener 相位噪声、AWGN 与接收机流程）用于测得真实 ΔRSNR 分布，以及 RTL 合成/技术库估算以确认面积/功耗/时序（timing slack）满足要求。方法步骤与自动化流程：A) 构造代价与约束：明确 J 的表达式与权重 w_p,w_r,w_t，规定硬约束（净荷≥阈值、ΔRSNR≤阈值、时序约束、位宽上下界）；B) 初始候选生成：外层枚举或用启发式采样(L,M,算法类别)以覆盖可行 Pilot/算法空间；C) 快速评估与代理模型：对每个候选用解析近似计算 σ_proc^2 与 σ_meas^2，并用资源模型（加法/乘法/查表/缓存按位宽与复制因子累加）估算 R_total；用代理函数估计量化误差与其对 σ_phi 的增幅，合成快速 J 值并筛选若干最优候选；D) 局部连续/离散优化：对筛选候选在位宽 b_i、算子实现选择与复用策略上运行离散优化（混合整数启发式、Bayesian optimization 或遗传算法），以最小化 J 并保证硬约束；E) 高保真验证回路：对优化得到的前 N 候选运行端到端蒙特卡洛仿真核验 ΔRSNR 与 σ_phi^2，同时用 RTL 合成或技术库估算真实资源与时序；若高保真结果偏离代理评估则用这些数据更新代理模型参数（例如 κ、查表误差系数、SNR_eff(Dz) 参数），回到步骤 C–D 迭代直至收敛或满足停止条件（例如 J 改进小于阈值或预算耗尽）；F) 敏感性与稳健性分析：对最终候选做参数扰动测试（LW、SNR、Dz、位宽量化误差）并报告性能/资源的置信区间及最差情形下的裕度要求。必备工具与模型：用于代理/优化和数据处理的环境（Python + NumPy/SciPy，优化库如 Pyomo/Gurobi 或開源替代），端到端仿真环境（MATLAB 或 Python 仿真套件，能模拟色散补偿、Wiener PN、AWGN 与接收流程）、蒙特卡洛框架、RTL 合成与资源估算工具（商用或开源综合器及ASIC库或等效参考系数），以及一套可参数化的资源模型（c_a,c_m,c_l,c_b、查表规模与误差模型、CORDIC 迭代-误差关系、时序限制模型）。交付物（必须清晰交付以便工程后续执行）：一份包含若干 Pareto 可行设计点的清单（每点列出 L,M、位宽向量 b_i、实现方案、R_total 分解、预测 σ_phi^2 与 ΔRSNR、净荷、时序 Slack）、用于复现优化的脚本和代理模型、高保真仿真与 RTL 验证报告（含统计置信区间）、以及敏感性分析报告与实施建议（包含运行时自适应策略触发条件：何时增加 Pilot 密度或切换估计器）。停止准则与质量门：仅当候选满足所有硬约束且高保真仿真与 RTL 验证一致且 J 在若干迭代中不再明显改善时，才输出最终推荐合集；若无可行解则需给出可行性失败的原因（如净荷/RSNR/资源冲突）并建议放宽的最小改动（例如位宽增加或净荷目标放宽）以达成可行设计。"
  ]
}
{
  "task_id": "2021_E",
  "problem": "为解决信号干扰下的超宽带（UWB）精确定位问题，我们通过实际场景实测，采集到一定数量的数据，即利用UWB的定位技术（TOF），采集到锚点（anchor）与靶点（Tag）之间的距离，希望通过数学建模（或算法）方法 ，无论信号是否干扰，都可以给出目标物（靶点）的精确定位（3维坐标）。\n\n在一个 5000mm×5000mm×3000mm 的测试环境中，分别在四个角落 A0、A1、A2、A3 放置 UWB 锚点（anchor），锚点向各个方向发送信号。Tag 是 UWB 标签（靶点），即需要定位的目标，Tag 接收到 4 个 UWB 锚点的信号（无论是否干扰），利用 TOF 技术计算 4 个距离数据。\n\n实验在实验场景1中采集了 Tag 在 324 个不同位置，在信号无干扰和信号干扰下的 UWB 数据，即每个位置各测 2 次，一次信号无干扰，另一次信号有干扰（锚点与靶点间有遮挡）。注意：本次采集数据时，由于 Tag 在同一位置会停留一会儿时间，而锚点与 Tag 之间每 0.2--0.3 秒之间就会发出信号，接收信号一次，所以在同一位置点，UWB 会采集到多组数据（多组数据相代表同一位置的信息），组数的多少视Tag在同一位置的时间而定，停留时间越长，组数就越多。数据集见文件夹“附件 1: UWB 数据集”。\n\n实验场景 1 中，Tag 范围为 5000mm×5000mm×3000mm，锚点位置分别为：A0(0,0,1300)，A1(5000,0,1700)，A2(0,5000,1700)，A3(5000,5000,1300)。\n\n四、数据文件说明\n\n(1) UWB数据集\n “附件1：UWB数据集”有2个文件夹和1个文件，1个文件（Tag坐标信息.txt）存放324个不同位置的编号及3维坐标信息，2个文件夹中1个存放信号无干扰下（正常）采集的数据（各文件名为x.正常.txt，x表示对应的位置编号），另1个存放信号有干扰下（异常）采集的数据（各文件名为x.异常.txt，x表示对应的位置编号）。\n\n（2）数据文件\nTag在每个位置都采集了2个数据文件（1个正常，另1个异常），共有648个数据文件，无论正常、异常数据，数据格式都一样，每个数据文件开头第1行为采集开始行，无实际意义，接下来，每4行为一组，表示UWB采集的一组完整数据（一组数据表示一个样品），如：\n\nT:144235622:RR:0:0:950:950:118:1910\nT:144235622:RR:0:1:2630:2630:118:1910\nT:144235622:RR:0:2:5120:5120:118:1910\nT:144235622:RR:0:3:5770:5770:118:1910\n\n这4行数据的含义分别是:\nTag标识：时间戳：Range Report的缩写：Tag ID：锚点ID：该锚点的测距值(mm)：测距值的校验值：数据序列号：数据编号（每个数据之间用“：”分隔）。实际上就是提供了4个锚点到靶点（Tag）的距离，即\nA0到靶点距离为：950mm \nA1到靶点距离为：2630mm \nA2到靶点距离为：5120mm\nA3到靶点距离为：5770mm\n每个数据文件都有多组数据，表示在同一位置连续时间内UWB自动采集到的多组数据。\n\n五、完成任务\n试根据上述数据，完成如下任务：\n\n任务1：数据预处理（清洗）\n无论是信号无干扰下采集数据，或信号干扰下采集数据，Tag在同一坐标点上都采集多组数据（见附件1中648个数据文件），请用某种方法把每个数据文件相应数值抓取出来，并转换成二维表（矩阵）形式（txt、Excel或其他数据格式），每一行代表一组数据（即一个样品），然后对这些数据文件进行预处理（清洗），删除掉一些“无用”（异常、缺失、相同或相似）的数据（样品）。经处理后，“正常数据”所有数据文件和“异常数据”所有数据文件最后各保留多少组（多少个样品）数据，并重点列出以下4个数据文件，经处理后保留的数据（矩阵形式）；\n“正常数据”文件夹中：24.正常.txt、109.正常.txt\n“异常数据”文件夹中：1.异常.txt、100.异常.txt\n\n任务2: 定位模型\n利用任务1处理后的数据，分别对“正常数据”和“异常数据”，设计合适的数学模型（或算法），估计（或预测）出Tag的精确位置，并说明你所建立的定位模型（或算法）的有效性；同时请利用你的定位模型（或算法）分别对附件2中提供的前5组（信号无干扰）数据和后5组（信号有干扰）数据进行精确定位（3维坐标）；\n注意：（1）定位模型必须体现实验场景信息；（2）请同时给出定位模型的3维（x，y，z）精度、2维（x，y）精度以及1维的各自精度。\n\n任务3：不同场景应用\n我们的训练数据仅采集于同一实验场景（实验场景1），但定位模型应该能够在不同实际场景上使用，我们希望你所建立的定位模型能够应用于不同场景。附件3中10组数据采集于下面实验场景2（前5组数据信号无干扰，后5组数据信号有干扰），请分别用上述建立的定位模型，对这10组数据进行精确定位（3维坐标）；\n实验场景2：\n靶点（Tag）范围：5000mm*3000mm*3000mm\n锚点（anchor）位置（单位：mm）：\nA0（0，0，1200）、A1（5000，0，1600）、A2（0，3000，1600），A3（5000，3000，1200）\n\n任务4: 分类模型\n上述定位模型是在已知信号有、无干扰的条件下建立的，但UWB在采集数据时并不知道信号有无干扰，所以判断信号有无干扰是UWB精确定位问题的重点和难点。利用任务1处理后的数据，建立数学模型(或算法)，以便区分哪些数据是在信号无干扰下采集的数据，哪些数据是在信号干扰下采集的数据？并说明你所建立的分类模型(或算法)的有效性；同时请用你所建立的分类模型（或算法）判断附件4中提供的10组数据（这10组数据同样采集于实验场景1）是来自信号无干扰或信号干扰下采集的？\n\n任务5: 运动轨迹定位\n运动轨迹定位是UWB重要应用之一，利用静态点的定位模型，加上靶点自身运动规律，希望给出动态靶点的运动轨迹。附件5是对动态靶点采集的数据（一段时间内连续采集的多组数据），请注意，在采集这些数据时，会随机出现信号干扰，请对这个运动轨迹进行精确定位，最终画出这条运动轨迹图（数据采集来自实验场景1）。",
  "subtask": {
    "1": {
      "subtask": "子任务1（数据解析、单位统一与稳健预处理）的目标是把“附件1：UWB数据集”中每个文本文件解析成统一、可机器处理的二维表格并对同一位置内多组观测做物理与统计层面的清洗，输出供后续建模使用的标准化样本矩阵与详尽质量元数据；为此请按下列步骤精确执行：首先逐文件解析原始文本（注意每文件首行为无意义行并跳过），将后续内容按每4行一组组合为一个样本组（更稳健地，按行内用“:”分隔字段解析并用锚点ID字段映射到 A0..A3，字段含义参见示例，距离取第6个字段），若某组缺少某锚点或同一组存在重复锚点则将该组标为“不完整样本”并记录索引（默认策略为先将不完整样本移入单独待审表，原则上默认剔除）；第二步进行单位统一：将Tag坐标文件中的坐标从厘米转为毫米以与测距数据统一，并在输出表中把真值坐标（若存在）以mm并入对应文件/样本行；第三步做物理范围过滤：剔除任何单锚测距小于0或大于场景对角线长度（sqrt(5000^2+5000^2+3000^2)≈7830 mm）的观测值或包含此类值的样本组，并把此类剔除计入日志；第四步在同一位置（同一文件）内对剩余多组观测做稳健统计与离群检测：计算每锚点的组内中位数与MAD（中位绝对偏差），构造每样本的四维测距向量並计算以中位数和MAD估计的稳健Mahalanobis距离与逐锚残差（样本距离 − 组中位数），将超出设定阈值（例如Mahalanobis > 3 或单锚残差超过若干倍MAD——阈值可参数化以便调参）的样本标为异常并剔除；同时为避免短时强干扰引入偏差，可在四维测距空间应用密度聚类（如 DBSCAN 或基于高斯混合的聚类）将观测分簇并保留主簇（簇内样本数最大且方差最小），对保留簇可用中位向量或加权平均作为该位置的代表观测，并把被剔除或归入冷门簇的样本单独存档以便审查；第五步处理重复或高度相似样本（冗余压缩）：对簇内高度相似的多条观测（例如四维欧氏或Mahalanobis距离极小）仅保留一个代表样本并记录保留策略（中位/平均/时间最早），以减少冗余同时保留测量不确定度信息；第六步为每个最终保留的样本计算并附加质量度量字段（如每锚残差向量、最大残差、残差方差、组内方差、MAD、Mahalanobis距离、时间戳、原始行号、样本是否来自主簇、不完整标志等），并计算文件级汇总（原始组数、通过物理过滤数、通过统计清洗后保留数、被标记为异常/不完整的组数）；第七步把每个输入文件的清洗结果保存为标准CSV/Excel表（每行一个样本，列包括文件名/样本ID/时间戳/序列号/A0..A3距离(mm)/冗余列差值/质量度量字段/保留标志），同时生成一个全数据汇总表将所有文件并入并与Tag真实坐标（已转为mm）按文件编号关联；第八步输出与交付项应包含：原始解析结果（未清洗版）、清洗后每文件的样本矩阵、全局合并矩阵、每文件保留样本计数统计表（特别列出并保存 24.正常.txt、109.正常.txt、1.异常.txt、100.异常.txt 的最终矩阵与保留样本数）以及可重现的清洗日志（记录每一步的阈值与剔除原因）；实现建议采用可重复执行的脚本（推荐 Python + pandas、numpy、re 用于解析，scikit-learn 用于 DBSCAN/GMM，scipy 用于统计测量及 Mahalanobis 计算），并保证所有中间结果和参数化阈值以机器可读的方式保存以便复现与参数调优。",
      "criteria": {
        "task_understanding": {
          "core_goal": "对UWB原始文本进行解析与清洗，统一单位并稳健预处理，构建可复现的标准化样本矩阵与质量元数据，用于后续定位模型拟合与评估",
          "expected_output": "逐文件未清洗样本表CSV、逐文件清洗后样本矩阵CSV、全局合并矩阵CSV、文件级统计汇总表、四个指定文件（24.正常.txt、109.正常.txt、1.异常.txt、100.异常.txt）的最终矩阵与保留数、参数化阈值与清洗日志、可重复执行的Python脚本与配置",
          "key_inputs_constraints": "输入：UWB数据集文本文件（每4行一组）、Tag坐标信息.txt；约束：首行无意义需跳过；按“:”解析字段并以锚点ID映射A0..A3；距离取第6字段（mm）；不完整样本需标记并默认剔除；单位统一将坐标转为mm；物理范围过滤[0, ~7830]mm；组内稳健统计采用中位数与MAD；密度聚类（DBSCAN/GMM）保留主簇；生成质量度量与日志；确保可复现与参数化",
          "modeling_type": "评价+拟合",
          "role_in_pipeline": "作为数据工程与稳健预处理环节，位于特征工程与定位模型训练之前；前序依赖：原始UWB文本与场景信息；后续依赖：定位模型拟合、分类模型训练与评估、跨场景迁移与轨迹重建",
          "assumptions": "距离字段单位为mm；锚点ID唯一对应A0..A3且每组最多一条；时间戳/序列号可作为样本元数据；DBSCAN/GMM参数可通过网格搜索或启发式设定；Mahalanobis阈值默认3（可调）"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "解析与单位统一的核心识别",
              "description": "是否明确子任务要求：按每4行组合样本、以“:”解析并用锚点ID映射A0..A3，距离取第6字段，并将Tag坐标从厘米统一为毫米。",
              "score": 30,
              "evaluation_focus": "任务拆解/规则提炼",
              "scoring_hint": "高分：逐条点明4行成组、字段位次、ID映射与单位转换；中分：提到解析和单位但缺字段位次或ID映射细节；低分：忽略单位统一或未按4行组样本。"
            },
            {
              "sub_criteria": "物理范围过滤与场景约束",
              "description": "是否正确识别场景对角线约7830mm并据此定义[0,7830]mm物理过滤，覆盖单锚异常与整组剔除策略。",
              "score": 30,
              "evaluation_focus": "物理约束/数据质量",
              "scoring_hint": "高分：给出对角线计算并应用到单锚与整组过滤；中分：仅口头给范围无推导或仅组层面；低分：未设置物理范围或范围错误。"
            },
            {
              "sub_criteria": "不完整样本与重复锚点识别",
              "description": "能否识别缺失锚点或重复锚点组并标记为“不完整样本”，默认剔除且记录索引。",
              "score": 20,
              "evaluation_focus": "异常模式识别",
              "scoring_hint": "高分：清晰定义不完整/重复条件与日志记录；中分：仅说明剔除不完整；低分：未区分或无策略。"
            },
            {
              "sub_criteria": "稳健统计与密度异常识别需求",
              "description": "是否识别采用中位数+MAD、稳健Mahalanobis与DBSCAN/GMM主簇保留以应对干扰与多峰分布。",
              "score": 20,
              "evaluation_focus": "稳健性意识",
              "scoring_hint": "高分：同时提出三者并解释多峰/短时干扰动机；中分：提到其中一项；低分：仅均值/方差或无稳健手段。"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "端到端数据流复述",
              "description": "是否准确复述从原始文本→未清洗表→物理过滤→稳健统计/MAD→密度聚类主簇→冗余压缩→标准矩阵→汇总与日志的流程。",
              "score": 35,
              "evaluation_focus": "流程把握",
              "scoring_hint": "高分：顺序和产出物一致且无缺漏；中分：顺序基本对但漏1-2步；低分：流程割裂或与任务不符。"
            },
            {
              "sub_criteria": "字段级复述（A0..A3/时间戳/序列号）",
              "description": "是否明确输出列需包含文件名、样本ID、时间戳、序列号、A0..A3距离(mm)、残差/MAD/Mahalanobis、保留标志等。",
              "score": 25,
              "evaluation_focus": "细节完整性",
              "scoring_hint": "高分：逐项列出核心字段；中分：列出大部分但遗漏质量度量；低分：仅泛称“特征”。"
            },
            {
              "sub_criteria": "场景与坐标真值并入",
              "description": "是否复述将Tag真值坐标（mm）按文件编号并入样本行用于后续拟合/评估。",
              "score": 20,
              "evaluation_focus": "数据对齐",
              "scoring_hint": "高分：说明文件编号关联与单位一致；中分：仅提到“并入坐标”；低分：未提及真值并入。"
            },
            {
              "sub_criteria": "指定文件的交付强调",
              "description": "是否强调对24.正常.txt、109.正常.txt、1.异常.txt、100.异常.txt生成最终矩阵与保留样本数。",
              "score": 20,
              "evaluation_focus": "需求对齐",
              "scoring_hint": "高分：点名四文件与两项产出；中分：仅点名或仅产出；低分：未提及。"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "单位与字段假设（距离为mm/第6字段）",
              "description": "对距离字段单位与位置（第6字段）不确定性给出明确假设与验证计划。",
              "score": 30,
              "evaluation_focus": "风险管理",
              "scoring_hint": "高分：提出假设并计划抽样校验/断言；中分：仅声明假设；低分：无假设。"
            },
            {
              "sub_criteria": "阈值参数化假设（Mahalanobis/残差倍数/DBSCAN参数）",
              "description": "明确阈值可参数化与可调优，含默认值（如M>3，残差>k*MAD）。",
              "score": 25,
              "evaluation_focus": "可调性设计",
              "scoring_hint": "高分：列出默认与可调范围；中分：仅给默认；低分：硬编码或缺失。"
            },
            {
              "sub_criteria": "主簇选择准则假设",
              "description": "声明主簇定义（样本数最大且方差最小的折中）与冲突处理策略。",
              "score": 25,
              "evaluation_focus": "聚类判据",
              "scoring_hint": "高分：给出数量与方差双准则；中分：仅数量最大；低分：未定义。"
            },
            {
              "sub_criteria": "不完整样本处理假设与审查保留",
              "description": "默认剔除并单独待审存档的策略与原因说明（避免污染统计）。",
              "score": 20,
              "evaluation_focus": "数据治理",
              "scoring_hint": "高分：剔除+存档+理由；中分：仅剔除；低分：混入训练集或未说明。"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "稳健统计量构建（中位数、MAD、稳健Mahalanobis）",
              "description": "构建以组内中位数与MAD为基的四维向量残差与Mahalanobis距离计算方案。",
              "score": 35,
              "evaluation_focus": "统计建模",
              "scoring_hint": "高分：给出MAD缩放/协方差近似与数值稳定性；中分：仅口述使用；低分：用均值/方差替代。"
            },
            {
              "sub_criteria": "密度聚类模型（DBSCAN/GMM）与主簇保留",
              "description": "设计在四维测距空间的DBSCAN或GMM聚类并定义主簇判定与冷门簇剔除。",
              "score": 30,
              "evaluation_focus": "算法选择",
              "scoring_hint": "高分：含参数选择依据与边界情况；中分：仅选择算法；低分：无聚类或不当选择。"
            },
            {
              "sub_criteria": "冗余压缩与代表样本策略",
              "description": "定义簇内相似度阈值与代表样本生成（中位/加权平均/时间最早）及不确定度保留。",
              "score": 20,
              "evaluation_focus": "信息压缩",
              "scoring_hint": "高分：阈值与度量明确并保留方差/MAD；中分：仅保留中位；低分：无策略。"
            },
            {
              "sub_criteria": "质量度量字段与日志结构设计",
              "description": "设计残差、最大残差、残差方差、组内MAD、Mahalanobis、主簇标志、原始行号、剔除原因等字段与日志格式。",
              "score": 15,
              "evaluation_focus": "可追溯性",
              "scoring_hint": "高分：字段全面且机器可读；中分：部分字段；低分：缺日志或仅文本。"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "阈值求解与筛选规则执行",
              "description": "依据M>3与残差>k*MAD等阈值正确标记并剔除异常样本，统计通过/剔除数量。",
              "score": 35,
              "evaluation_focus": "规则执行",
              "scoring_hint": "高分：给出计数与阈值命中率；中分：执行但无统计；低分：执行不一致或遗漏。"
            },
            {
              "sub_criteria": "DBSCAN/GMM参数选择与收敛性",
              "description": "给出eps/min_samples或GMM组件数/初始化与稳定性检查（如多次随机种子一致）。",
              "score": 25,
              "evaluation_focus": "超参与稳定性",
              "scoring_hint": "高分：报告敏感性/稳定性；中分：仅说明参数；低分：默认参数无说明。"
            },
            {
              "sub_criteria": "代表观测计算与不确定度估计",
              "description": "对主簇计算中位向量或加权平均并输出协方差/MAD作为不确定度。",
              "score": 20,
              "evaluation_focus": "数值实现",
              "scoring_hint": "高分：提供代表值+不确定度；中分：仅代表值；低分：无聚合。"
            },
            {
              "sub_criteria": "文件级汇总与四指定文件结果求解",
              "description": "输出原始组数、物理过滤后数、清洗后保留数，并单列24/109正常与1/100异常的最终矩阵与保留数。",
              "score": 20,
              "evaluation_focus": "结果完整性",
              "scoring_hint": "高分：四文件均完整；中分：缺1项；低分：未单列。"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "解析器健壮性（按“:”、锚点ID映射、首行跳过、重复/缺失检测）",
              "description": "Python+pandas实现健壮解析，异常行防御并单元测试样例通过。",
              "score": 30,
              "evaluation_focus": "代码可靠性",
              "scoring_hint": "高分：有断言/异常捕获与测试；中分：能跑但少校验；低分：崩溃或误解析。"
            },
            {
              "sub_criteria": "稳健统计与Mahalanobis计算实现",
              "description": "正确实现中位、MAD、稳健协方差/对角近似及数值稳定处理（零MAD回退）。",
              "score": 25,
              "evaluation_focus": "数值稳健",
              "scoring_hint": "高分：处理零分母/极端值；中分：基本实现；低分：数值异常未处理。"
            },
            {
              "sub_criteria": "DBSCAN/GMM与主簇逻辑代码",
              "description": "sklearn实现聚类，主簇选择与冷门簇剔除逻辑清晰，可参数化。",
              "score": 20,
              "evaluation_focus": "算法工程",
              "scoring_hint": "高分：参数外置配置；中分：硬编码；低分：实现缺陷或误用。"
            },
            {
              "sub_criteria": "产物输出与日志可复现",
              "description": "生成逐文件CSV、全局汇总、四文件单独输出与机器可读日志（含阈值）。",
              "score": 25,
              "evaluation_focus": "可复现性",
              "scoring_hint": "高分：路径/模式稳定且含配置快照；中分：部分产物；低分：仅打印无落盘。"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "清洗效果量化（保留率/剔除原因分布）",
              "description": "报告整体与文件级保留率、异常类型（不完整/物理越界/统计异常/冷门簇）占比。",
              "score": 35,
              "evaluation_focus": "数据诊断",
              "scoring_hint": "高分：图表或表格量化；中分：定性说明；低分：无分析。"
            },
            {
              "sub_criteria": "稳健性验证（阈值/聚类敏感性）",
              "description": "分析不同M阈值、k*MAD、DBSCAN参数对保留结果与代表值的影响。",
              "score": 25,
              "evaluation_focus": "稳健性评估",
              "scoring_hint": "高分：至少2组参数对比；中分：单组讨论；低分：未验证。"
            },
            {
              "sub_criteria": "四指定文件的可读化呈现",
              "description": "展示24.正常、109.正常、1.异常、100.异常的最终矩阵、保留样本数及残差统计。",
              "score": 20,
              "evaluation_focus": "结果呈现",
              "scoring_hint": "高分：矩阵+统计齐备；中分：仅矩阵或仅统计；低分：缺漏。"
            },
            {
              "sub_criteria": "对后续定位模型的影响讨论",
              "description": "解释清洗对定位拟合/评估的正负影响与潜在偏差（如剔除过度）。",
              "score": 20,
              "evaluation_focus": "洞察/外推",
              "scoring_hint": "高分：提出权衡与改进建议；中分：一般性描述；低分：无讨论。"
            }
          ]
        }
      }
    },
    "2": {
      "subtask": "子任务2（静态定位核心模型与锚点偏置联合标定）旨在在已知四个锚点空间坐标 a_i（i=0..3，单位统一为毫米）和若干观测到的测距样本 r_{ij}（样本 j 在锚点 i 的测距，来自子任务1清洗后的数据）情况下，建立并实现一个既能用于单次样本在线定位又能在有标注训练集时同时估计锚点系统偏置 b_i 的数值框架；其范围仅包括：测量模型定义、单样本定位算法、锚点偏置的批量联合估计方法、数值求解细节、权重/鲁棒处理、不确定度量化与实现建议（工具与参数），输出为每个样本的最优位置估计 x̂（含协方差）、校准后的偏置 b̂_i（含不确定度）以及定位残差和诊断量。具体方法步骤如下：1) 模型和输入：采用非线性测量模型 r_{ij} = ||x_j − a_i|| + b_i + ε_{ij}，其中 ε_{ij} 为近似零均值测距噪声（方差 σ_{ij}^2 可由子任务1组内统计给出）；输入为锚点坐标 a_i、观测矩阵 {r_{ij}}、（若有）真值坐标 x_j_true 用于训练与验证。2) 单样本定位流程（线上模块）：先用线性化闭式方法（例如基于差分方程的 Chan 方法或以 a_0 为参考的线性最小二乘差分法）计算初始值 x^0，再以 x^0 作为初始点用 Levenberg–Marquardt (LM) 最小化加权残差的非线性最小二乘问题 x̂ = argmin_x Σ_i w_i (||x − a_i|| − (r_i − b_i_prior))^2，权重 w_i 通常取 1/σ_i^2；为提高对单锚异常的鲁棒性，通过 IRLS 实现 M-估计（例如 Huber 或 Tukey biweight），在每次迭代中根据归一化残差更新权重并解加权最小二乘；数值设定建议：最大迭代 50，函数容忍度 1e−6，步长或 damping 初值 1e−3。雅可比矩阵 J 的每行为 (x − a_i)^T/||x − a_i||，用于构造 LM 雅可比与高斯-牛顿近似海森。3) 锚点偏置联合标定（训练/批量模块）：当存在多位置训练数据且对应真值 x_j_true 可用或可用作变量时，通过交替最小化联合损失 L({x_j},{b_i}) = Σ_{j,i} (||x_j − a_i|| + b_i − r_{ij})^2/σ_{ij}^2 + λ||b − b_prior||^2 来同时估计所有 x_j 与 b_i；实现为交替步骤：固定 b 求每个 x_j（并行执行多个独立的 LM/NLS），然后固定所有 x_j 用闭式更新 b_i = (Σ_j (r_{ij} − ||x_j − a_i||) + λ b_prior_i)/(N_j + λ)（λ 为正则化系数或来自高斯先验方差），重复直至收敛或增量低于阈值；若训练样本少或分布不充分，应增加 λ以防止 b 过拟合。4) 鲁棒化与异常处理：在两类求解中可嵌入 RANSAC（对含强偏差的样本集）以寻求一致性解，或在 LM/IRLS 中通过下降步骤结合残差门控剔除显著离群的观测。5) 不确定度估计：对最终估计 x̂ 计算雅可比 J(x̂)（对参与锚点），构造 Fisher 信息矩阵 I = J^T Σ_r^{-1} J（Σ_r 为测距协方差对角矩阵），并取估计协方差 Cov(x̂) ≈ I^{-1}；由此可计算3D（trace(Cov)或欧几里得RMSE估计）、2D（取 x,y 子块）与单维 z 的标准差/置信区间。对偏置 b̂_i 的不确定度可由闭式更新的残差方差估计得到（Var(b̂_i) ≈ Var_residual/(N_j + λ)）。6) 实现与数值细节：建议使用成熟数值库（Python: scipy.optimize.least_squares 提供 LM/Trust-region、或 Ceres Solver；线性代数用 numpy/eigen），并在实现中注意单位统一为 mm、避免除以零（当 x≈a_i）、数值正则化（对 J^T J 加小量以稳定求逆），以及并行化批量求解（固定 b 时并行求解各 x_j 可显著加速）；默认超参数建议为 λ 根据训练量交叉验证选择、IRLS 中 Huber 参数 k≈1.5·MAD。7) 输出与接口：模块应输出每个输入样本的 x̂ 与 Cov(x̂)、拟合残差向量 e_i、权重/影响值、以及若为训练执行则输出标定后的 b̂_i 与其方差、训练损失值和收敛诊断信息；所有输出应可序列化（CSV/JSON）供下游使用。该子任务不包含分类或时序滤波部分，其成功交付应是可复现、数值稳定的静态定位器和偏置校准器及其不确定度量化工具链。",
      "criteria": {
        "task_understanding": {
          "core_goal": "在已知锚点坐标与测距样本下，拟合并优化非线性测量模型 r_ij = ||x_j − a_i|| + b_i + ε_ij，实现单样本在线定位与批量锚点偏置 b_i 的联合标定，并评估不确定度。",
          "expected_output": "每个样本的位置估计 x̂(mm) 及协方差 Cov(x̂)，每个锚点偏置估计 b̂_i(mm) 及方差，定位残差 e_i、权重与影响值、收敛诊断与训练损失，序列化结果（CSV/JSON）与可复现实现脚本。",
          "key_inputs_constraints": "输入：锚点坐标 a_i(mm)、观测 r_ij(mm)、测距方差 σ_ij^2、（可选）真值 x_j_true(mm)；约束：单位统一为毫米；至少4个有效锚点/样本；采用加权/鲁棒最小二乘；LM 数值设置（max_iter≤50, tol≈1e-6, λ_reg小）。前置：子任务1提供清洗后观测与σ_ij^2、异常样本已剔除。",
          "modeling_type": "拟合+优化+评价",
          "role_in_pipeline": "作为静态定位核心模块与标定器：依赖前序子任务1的清洗与方差估计；其输出供后续分类与轨迹滤波使用。前序：数据解析与清洗；后序：分类模型、时序滤波/轨迹估计与跨场景验证。",
          "assumptions": "若无样本方差σ_ij^2则以组内MAD估计；b_prior默认为0且λ通过交叉验证；场景坐标均在实验范围内，不存在锚点共面退化影响到3D可观测性。"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "非线性测量模型 r_ij 与偏置 b_i 的识别",
              "description": "是否明确提出 r_ij = ||x_j − a_i|| + b_i + ε_ij 并阐明 b_i 为系统偏置需联合估计。",
              "score": 35,
              "evaluation_focus": "建模思维",
              "scoring_hint": "高分：准确写出模型并区分噪声与偏置；中分：给出模型但忽略 b_i 或噪声结构；低分：未给出正确模型形式。"
            },
            {
              "sub_criteria": "单样本在线定位与批量标定的双目标",
              "description": "是否区分并同时覆盖单样本 x̂ 在线定位与多样本联合标定 b̂_i 的需求。",
              "score": 25,
              "evaluation_focus": "任务拆解",
              "scoring_hint": "高分：两条流程清晰且互相衔接；中分：只覆盖其一；低分：目标混淆。"
            },
            {
              "sub_criteria": "权重/鲁棒性需求（IRLS/Huber/Tukey）",
              "description": "是否识别到测距异常与异方差性，需加权与M-估计增强鲁棒性。",
              "score": 20,
              "evaluation_focus": "算法选择",
              "scoring_hint": "高分：明确w_i=1/σ_i^2与IRLS方案；中分：只提权重或只提鲁棒；低分：无加权鲁棒讨论。"
            },
            {
              "sub_criteria": "不确定度量化（Cov(x̂)、Var(b̂_i)）",
              "description": "是否强调J与Fisher信息I=J^TΣ_r^{-1}J及协方差近似I^{-1}用于3D/2D/Z精度评估。",
              "score": 20,
              "evaluation_focus": "评价指标",
              "scoring_hint": "高分：给出J构造与维度拆分；中分：提到协方差但无细节；低分：缺失不确定度。"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "单位与输入约束复述（mm、≥4锚点、σ_ij^2）",
              "description": "是否复述单位统一为毫米、每样本需4锚点、使用σ_ij^2自子任务1。",
              "score": 25,
              "evaluation_focus": "需求契合",
              "scoring_hint": "高分：三者俱全；中分：缺少其一；低分：未提。"
            },
            {
              "sub_criteria": "初值与数值设置复述（Chan/差分+LM）",
              "description": "是否指出用线性化初值（Chan或差分）+ LM（max_iter≈50, tol≈1e-6, damping≈1e−3）。",
              "score": 25,
              "evaluation_focus": "数值意识",
              "scoring_hint": "高分：给出具体阈值；中分：仅泛谈LM；低分：无初值或LM细节。"
            },
            {
              "sub_criteria": "批量联合损失与正则λ复述",
              "description": "是否复述 L({x_j},{b_i}) 带权重与λ||b−b_prior||^2 的作用与动机。",
              "score": 25,
              "evaluation_focus": "目标清晰",
              "scoring_hint": "高分：解释λ防过拟合；中分：只写损失式；低分：未提正则或错误。"
            },
            {
              "sub_criteria": "输出要求复述（x̂、b̂_i、残差、诊断、Cov）",
              "description": "是否覆盖位置与偏置估计、残差向量、权重/影响值、协方差与收敛诊断。",
              "score": 25,
              "evaluation_focus": "产出对齐",
              "scoring_hint": "高分：完整列出；中分：缺2项以内；低分：缺多数。"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "噪声与方差假设（零均值、Σ_r对角、σ_ij^2来源）",
              "description": "明确ε_ij零均值、独立近似、σ_ij^2由组内MAD/方差估计。",
              "score": 30,
              "evaluation_focus": "数理假设",
              "scoring_hint": "高分：说明独立性与估计方法；中分：只说零均值；低分：无噪声假设。"
            },
            {
              "sub_criteria": "偏置先验与正则（b_prior与λ）",
              "description": "提出b_prior≈0及λ选择策略（交叉验证/经验），避免过拟合。",
              "score": 25,
              "evaluation_focus": "正则化",
              "scoring_hint": "高分：给出λ调参逻辑；中分：仅给出常数λ；低分：无先验。"
            },
            {
              "sub_criteria": "可观测性与退化场景假设",
              "description": "讨论锚点布局、共面/近距离导致J秩亏与数值正则对策。",
              "score": 25,
              "evaluation_focus": "稳健性",
              "scoring_hint": "高分：提出J^TJ加εI与锚点选择；中分：只提到风险；低分：无讨论。"
            },
            {
              "sub_criteria": "跨样本独立与RANSAC适用性",
              "description": "说明批量样本可独立优化x_j，强离群时用RANSAC门控样本/锚点。",
              "score": 20,
              "evaluation_focus": "鲁棒假设",
              "scoring_hint": "高分：给出门限如|z|>3剔除；中分：笼统提RANSAC；低分：未涉及。"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "线性化初值（Chan或差分法）构造",
              "description": "给出以a_0为参考的差分线性方程或Chan闭式，形成x^0。",
              "score": 25,
              "evaluation_focus": "算法设计",
              "scoring_hint": "高分：公式明确可实现；中分：概述无公式；低分：缺初值方案。"
            },
            {
              "sub_criteria": "LM加权残差与雅可比J定义",
              "description": "残差 e_i = ||x−a_i|| − (r_i − b_i)，J_i=(x−a_i)^T/||x−a_i||，权重w_i=1/σ_i^2。",
              "score": 25,
              "evaluation_focus": "数理推导",
              "scoring_hint": "高分：残差与J一致且单位正确；中分：有小误；低分：J错误或缺失。"
            },
            {
              "sub_criteria": "IRLS鲁棒权重（Huber/Tukey）",
              "description": "基于归一化残差与MAD设k，迭代更新权重并与LM结合。",
              "score": 25,
              "evaluation_focus": "鲁棒建模",
              "scoring_hint": "高分：给出k≈1.5·MAD或具体函数；中分：只提Huber；低分：未集成。"
            },
            {
              "sub_criteria": "联合标定损失与b_i闭式更新",
              "description": "固定{x_j}时 b_i = (Σ_j (r_ij − ||x_j−a_i||) + λ b_prior_i)/(N_i + λ)。",
              "score": 25,
              "evaluation_focus": "模型结构",
              "scoring_hint": "高分：推导与符号正确；中分：公式有小误；低分：未给闭式或错误。"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "数值设置与收敛控制（max_iter, tol, damping）",
              "description": "LM参数：max_iter≤50, tol≈1e−6, 初始damping≈1e−3，早停准则完备。",
              "score": 25,
              "evaluation_focus": "数值稳定",
              "scoring_hint": "高分：参数齐全且合理；中分：缺一项；低分：未设或极端不合理。"
            },
            {
              "sub_criteria": "正则化与矩阵稳定（J^T J + εI）",
              "description": "在条件数差时采用Tikhonov或阻尼确保可逆，避免除零（x≈a_i）。",
              "score": 25,
              "evaluation_focus": "稳健数值",
              "scoring_hint": "高分：说明ε选择或自动；中分：仅泛谈；低分：未处理。"
            },
            {
              "sub_criteria": "交替最小化收敛判据与并行求解x_j",
              "description": "固定b求{x_j}并行，再固定{x_j}闭式更新b，直至相对增量<阈值。",
              "score": 25,
              "evaluation_focus": "优化实现",
              "scoring_hint": "高分：量化阈值如1e−6或ΔL/L；中分：只说迭代；低分：无收敛标准。"
            },
            {
              "sub_criteria": "异常门控与RANSAC集成",
              "description": "基于标准化残差|z|>3或Mahalanobis门控、可选RANSAC求一致集。",
              "score": 25,
              "evaluation_focus": "鲁棒求解",
              "scoring_hint": "高分：清晰门限与回退策略；中分：模糊阈值；低分：未门控。"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "使用scipy.optimize.least_squares实现LM/Trust-Region",
              "description": "采用Python实现单样本定位，支持权重与IRLS循环，接口清晰。",
              "score": 30,
              "evaluation_focus": "代码可靠性",
              "scoring_hint": "高分：可运行伪码/函数签名与参数齐全；中分：片段化；低分：无实现思路。"
            },
            {
              "sub_criteria": "并行批量求解与b_i闭式更新流程",
              "description": "矢量化或并行计算所有x_j，随后一次性更新b_i并记录损失。",
              "score": 25,
              "evaluation_focus": "工程实现",
              "scoring_hint": "高分：展示并行/批处理设计；中分：串行但正确；低分：流程缺失。"
            },
            {
              "sub_criteria": "数值健壮性与边界处理",
              "description": "包含单位mm检查、零距离防护、正则参数、失败回退（重启初值）。",
              "score": 25,
              "evaluation_focus": "健壮性",
              "scoring_hint": "高分：列出具体断言与回退；中分：部分覆盖；低分：未考虑。"
            },
            {
              "sub_criteria": "输出序列化与诊断日志",
              "description": "导出x̂、Cov、b̂_i、Var(b̂_i)、残差、权重、收敛标志至CSV/JSON并含日志。",
              "score": 20,
              "evaluation_focus": "可复现性",
              "scoring_hint": "高分：字段完整可追溯；中分：缺少2项以内；低分：未序列化或不可复现。"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "不确定度估计（Cov(x̂)）与3D/2D/Z精度",
              "description": "依据I=J^TΣ_r^{-1}J评估std或RMSE，并分别报告3D、2D(x,y)、Z。",
              "score": 35,
              "evaluation_focus": "结果量化",
              "scoring_hint": "高分：给出数值或公式与解释；中分：只给总体；低分：未量化。"
            },
            {
              "sub_criteria": "残差与权重诊断（e_i、影响值）",
              "description": "分析残差分布、加权影响，识别问题锚点或异常观测。",
              "score": 25,
              "evaluation_focus": "诊断能力",
              "scoring_hint": "高分：图表/统计或明确阈值；中分：定性描述；低分：无诊断。"
            },
            {
              "sub_criteria": "偏置估计合理性与方差 Var(b̂_i)",
              "description": "评估b̂_i大小与稳定性，结合样本量N_i与λ解释方差变化。",
              "score": 20,
              "evaluation_focus": "参数解释",
              "scoring_hint": "高分：联系N_i与λ；中分：仅报告数值；低分：不解释或矛盾。"
            },
            {
              "sub_criteria": "收敛与鲁棒性评估（RANSAC/门控效果）",
              "description": "对比门控/无门控性能或损失，说明收敛速度与失败率。",
              "score": 20,
              "evaluation_focus": "稳健评估",
              "scoring_hint": "高分：提供前后指标或比率；中分：定性描述；低分：未评估。"
            }
          ]
        }
      }
    },
    "3": {
      "subtask": "子任务3 — 干扰（NLOS）检测与定位-分类闭环：目标是基于每条观测样本（每组包含四个锚点到 Tag 的测距、时间戳/序列号和组内统计量）自动判别哪些测距受干扰（NLOS/遮挡）并以概率形式输出，以便在线调整定位器对各锚点测量的权重或剔除异常测量，从而在定位过程中形成闭环。具体工作范围和步骤如下：输入为子任务1清洗后每条样本的原始四锚距离、冗余字段差值、时间戳/序列号、同一位置短窗内的统计量（均值、中位数、MAD、方差、聚类标记等）以及来自定位器的初始拟合诊断量（例如按当前估计计算的四锚残差向量、残差的最大值/均方根、稳健 Mahalanobis 距离、观测一致性残差和雅可比条件数或 DOP 指标）；特征工程要系统构建包括：（1）单锚特征：当前距离、与组中位数的差值、短窗内方差与跳变率（当前值与前一值差），冗余列差异；（2）多锚一致性特征：残差向量的最大值、均方残差、方差、偏度、Mahalanobis 距离、几何一致性得分（例如最小二乘拟合残差）与雅可比的条件数；（3）时间/序列特征：时间间隔异常标志与样本密度指标。基于这些特征训练一个概率输出的判别模型（优选树模型如 XGBoost/LightGBM 或 随机森林，因其对特征不需严格预处理且支持特征重要性解释），训练流程要求：用清洗标注的“正常/异常”样本做监督学习，采用分位置分层交叉验证以防止位置相关过拟合，针对类别不平衡采用 class_weight、代价敏感损失或重采样（如 SMOTE）并通过 ROC/AUC 选取工作点；在训练中优先优化对定位影响敏感的度量（例如把“异常判为正常”代价权重设置更高），并用混淆矩阵、精确率/召回率/F1 与 AUC 报告性能。模型输出应为每条样本和每个锚点的 p_NLOS（置信概率），并给出最终样本级决策（例如若任一锚点 p_NLOS>τ_exclude 则标记该锚点为高风险），还需提供特征重要性与可解释性输出以便工程调参。在线集成规则必须明确定义：将 p_NLOS 映射为测量协方差或权重，例如 R_eff,i = R_LOS_i * (1 + α * p_NLOS,i) 或直接在 p_NLOS>0.8 时将该锚点更新为“忽略/极大方差”；同时在滤波/估计中加入创新门控（normalized innovation gating）以避免误用被误判为 LOS 的测量；在 RANSAC/IRLS 等鲁棒估计流程中以 p_NLOS 为先验权重调整采样和重权重策略。在线自适应机制需包括滑窗统计监测与轻量级增量学习：定期（或按触发）使用最近窗口内高置信度样本来自主学习器微调（partial_fit 或小批量重训练），并在检测到新型干扰模式（通过无监督聚类/突变检测）时触发人工审核或自动回退到更保守的规则。实现工具建议使用 Python 生态（pandas/numpy 进行数据处理，scikit-learn 与 xgboost/lightgbm 用于训练，joblib 并行化），并把模型、特征处理流水线与阈值参数序列化（例如用 sklearn Pipeline），同时记录置信日志与决策原因以便回溯。评价与验收标准不仅基于分类指标（AUC、Precision/Recall/F1），还应以分类输出对定位精度的实际改进作为最终判据（例如在使用分类器调整测量权重后定位 RMSE 的下降或鲁棒性的提升）。最终交付物为：训练好的概率分类器、特征处理与模型接口（输入样本→输出每锚 p_NLOS 与推荐权重/排除决策）、性能报告（交叉验证结果与混淆矩阵）、在线自适应策略说明及示例代码接口（调用示例与参数说明）。",
      "criteria": {
        "task_understanding": {
          "core_goal": "基于清洗后的四锚测距与定位残差等特征训练并评估概率分类模型，预测每锚 p_NLOS 并优化定位权重以提升定位精度。",
          "expected_output": "面向样本与锚点的 p_NLOS 概率序列与样本级决策、推荐权重/排除规则、训练好的模型文件与特征流水线、交叉验证报表（AUC/混淆矩阵/PR-F1）、重要性与可解释性图表、在线集成与自适应策略接口代码。",
          "key_inputs_constraints": "输入包括：1) 子任务1生成的样本矩阵：A0..A3 距离(mm)、时间戳/序列号、组内统计量（中位数、MAD、方差、聚类标记等）；2) 子任务2定位器输出：四锚残差、RMS、稳健 Mahalanobis、雅可比条件数/DOP；3) 标签：正常/异常（NLOS）来自清洗标注；约束：单位统一为mm；特征需支持缺失鲁棒处理；训练采用分位置分层交叉验证，类别不平衡需处理；在线需将 p_NLOS 映射为权重或R_eff。",
          "modeling_type": "分类+评价+优化",
          "role_in_pipeline": "作为定位-分类闭环模块：依赖子任务1的数据预处理与子任务2初始定位诊断量，向子任务2回传每锚 p_NLOS 与权重/排除决策以调整测量协方差；后续任务使用其在线自适应输出改善动态定位与鲁棒性。",
          "assumptions": "若个别样本缺少定位诊断量，则用仅基于组内统计与多锚一致性特征的退化模型；若部分文件无明确NLOS标签，使用来源目录（正常/异常）作为弱标签并在训练中降权。"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "识别核心目标：预测每锚 p_NLOS 以优化定位权重",
              "description": "是否明确该任务是概率分类（输出 p_NLOS），并强调其用于调整 R_eff 或权重以提升定位 RMSE/鲁棒性。",
              "score": 30,
              "evaluation_focus": "问题界定",
              "scoring_hint": "高分：清晰提出 p_NLOS→R_eff 映射并以定位精度为最终指标；中分：只提 p_NLOS 分类未连接权重映射；低分：将任务误解为位置预测或仅做二分类标签。"
            },
            {
              "sub_criteria": "输入约束与依赖：四锚距离与定位残差、MAD、DOP",
              "description": "是否点明来自子任务1/2的关键输入与单位(mm)约束、短窗统计与诊断量的重要性。",
              "score": 25,
              "evaluation_focus": "需求抽取",
              "scoring_hint": "高分：列全A0..A3、残差、Mahalanobis、MAD、DOP并说明用途；中分：缺少2项以上关键诊断；低分：仅用原始距离。"
            },
            {
              "sub_criteria": "目标度量：AUC与定位RMSE改进的双指标评价",
              "description": "是否将分类指标（AUC/F1）与定位精度改进（RMSE下降、鲁棒性）共同定义为验收标准。",
              "score": 25,
              "evaluation_focus": "指标设计",
              "scoring_hint": "高分：明确阈值选择基于ROC且报告RMSE改善≥X%；中分：给出AUC无RMSE；低分：无任何定量指标。"
            },
            {
              "sub_criteria": "在线闭环与创新门控",
              "description": "是否识别在线集成需创新门控（normalized innovation）防止误用。",
              "score": 20,
              "evaluation_focus": "系统思维",
              "scoring_hint": "高分：提出门控阈值(如3σ)与回退策略；中分：仅提门控不设阈；低分：无门控设计。"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "复述特征工程：单锚差值/跳变率与多锚一致性（残差RMS、Mahalanobis）",
              "description": "能否具体复述将距离-中位数差、跳变率及残差RMS、Mahalanobis作为核心特征。",
              "score": 35,
              "evaluation_focus": "信息提炼",
              "scoring_hint": "高分：逐项说明计算方式与物理含义；中分：列出名词无定义；低分：泛化表述如“提取若干特征”。"
            },
            {
              "sub_criteria": "训练流程：分位置分层交叉验证与类别不平衡处理",
              "description": "准确复述分位置分层CV与class_weight/SMOTE等策略并说明原因（防位置泄漏）。",
              "score": 35,
              "evaluation_focus": "方法复述",
              "scoring_hint": "高分：给出分层键（位置ID）和不平衡比处理；中分：只提K折；低分：未提CV或不平衡。"
            },
            {
              "sub_criteria": "在线映射：p_NLOS→R_eff 或权重",
              "description": "复述映射公式 R_eff,i = R_LOS_i*(1+α*p_NLOS,i) 或阈值排除策略。",
              "score": 30,
              "evaluation_focus": "机制表达",
              "scoring_hint": "高分：含α范围与阈值如0.8；中分：有公式无参数；低分：未定义映射。"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "标签可靠性与弱监督假设",
              "description": "说明正常/异常标签可能来源于目录并作为弱标签使用，提出降权或噪声标签模型假设。",
              "score": 30,
              "evaluation_focus": "假设清晰",
              "scoring_hint": "高分：给出样本权重<1或噪声率估计；中分：仅口头说明可能噪声；低分：视为完美标签。"
            },
            {
              "sub_criteria": "平稳性与短窗统计有效性",
              "description": "假设短时窗内环境近似平稳，MAD/中位数代表LOS簇中心。",
              "score": 25,
              "evaluation_focus": "建模前提",
              "scoring_hint": "高分：定义窗长与漂移边界；中分：笼统称平稳；低分：无提及。"
            },
            {
              "sub_criteria": "独立性与相关性处理（锚点相关干扰）",
              "description": "阐明不同锚点观测可能相关，模型通过多锚一致性特征间接捕捉。",
              "score": 25,
              "evaluation_focus": "统计意识",
              "scoring_hint": "高分：提出协方差或集成特征；中分：承认相关不处理；低分：假设独立且无说明。"
            },
            {
              "sub_criteria": "在线自适应与概念漂移",
              "description": "假设干扰分布随时间变化，提出滑窗与partial_fit或小批重训练。",
              "score": 20,
              "evaluation_focus": "时变假设",
              "scoring_hint": "高分：明确触发条件（漂移统计/KS检验）；中分：仅提定期更新；低分：无自适应。"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "特征设计覆盖：单锚/多锚一致性/时间特征完整性",
              "description": "是否系统构建单锚差值与跳变、残差RMS/最大值/Mahalanobis、DOP、时间间隔异常等。",
              "score": 35,
              "evaluation_focus": "特征工程",
              "scoring_hint": "高分：列出公式与归一化/缺失处理；中分：缺少时间或一致性特征；低分：仅原始距离。"
            },
            {
              "sub_criteria": "分类器选择与概率输出（XGBoost/LightGBM/RF）",
              "description": "选择支持概率输出与重要性解释的树模型并设置 class_weight/自定义损失。",
              "score": 30,
              "evaluation_focus": "算法选择",
              "scoring_hint": "高分：阐述超参（深度、学习率、min_child_weight）与早停；中分：默认参数；低分：不支持概率或不解释选择。"
            },
            {
              "sub_criteria": "样本级与锚点级多任务输出设计",
              "description": "定义每锚 p_NLOS 与样本级决策规则（如任一锚>τ_exclude则标记高风险）。",
              "score": 20,
              "evaluation_focus": "输出结构",
              "scoring_hint": "高分：清楚区分两层输出与聚合规则；中分：仅样本级；低分：未区分层级。"
            },
            {
              "sub_criteria": "可解释性与重要性分析",
              "description": "提供特征重要性、SHAP 或路径解释用于工程调参。",
              "score": 15,
              "evaluation_focus": "可解释性",
              "scoring_hint": "高分：报告全局/局部SHAP；中分：仅内置重要性；低分：无解释。"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "训练与验证：分位置分层交叉验证与早停",
              "description": "严格执行按位置分层CV、监控AUC/PR，使用验证集早停避免过拟合。",
              "score": 30,
              "evaluation_focus": "训练规范",
              "scoring_hint": "高分：给出K折、分层键、早停轮数；中分：普通K折；低分：无验证策略。"
            },
            {
              "sub_criteria": "不平衡处理与阈值选择（ROC工作点）",
              "description": "使用 class_weight/SMOTE 或代价敏感；阈值基于ROC/PR并偏向降低“异常判为正常”。",
              "score": 25,
              "evaluation_focus": "鲁棒优化",
              "scoring_hint": "高分：提供代价矩阵或权重比例与阈值τ；中分：仅class_weight；低分：忽略不平衡与阈值。"
            },
            {
              "sub_criteria": "在线映射与创新门控集成到定位器",
              "description": "实现 R_eff 映射、p_NLOS>τ_exclude 时加大方差/忽略，并结合normalized innovation gating。",
              "score": 25,
              "evaluation_focus": "系统集成",
              "scoring_hint": "高分：给出门控阈值与回退策略；中分：仅映射无门控；低分：无集成细节。"
            },
            {
              "sub_criteria": "自适应学习与漂移检测",
              "description": "滑窗统计监测+partial_fit/小批重训，异常聚类触发人工审核或保守规则回退。",
              "score": 20,
              "evaluation_focus": "在线优化",
              "scoring_hint": "高分：具体窗长与触发标准；中分：泛化描述；低分：无自适应。"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "特征流水线与缺失鲁棒处理（Pipeline/ColumnTransformer）",
              "description": "以sklearn Pipeline实现特征计算、标准化/稳健缩放、缺失与异常值处理（如Winsor/MAD）。",
              "score": 30,
              "evaluation_focus": "代码可靠性",
              "scoring_hint": "高分：端到端Pipeline可序列化；中分：分散脚本；低分：手工拼接易错。"
            },
            {
              "sub_criteria": "模型训练与持久化（joblib/xgboost.save_model）",
              "description": "提供训练脚本、超参配置、模型与阈值持久化、版本化与随机种。",
              "score": 25,
              "evaluation_focus": "工程规范",
              "scoring_hint": "高分：配置文件+可复现实验；中分：仅脚本；低分：不可复现。"
            },
            {
              "sub_criteria": "在线接口：输入样本→输出每锚 p_NLOS 与 R_eff",
              "description": "实现可调用API/函数，返回 p_NLOS、推荐权重/排除决策与理由（top特征）。",
              "score": 25,
              "evaluation_focus": "接口设计",
              "scoring_hint": "高分：明确IO schema与示例；中分：仅函数无文档；低分：无可调用接口。"
            },
            {
              "sub_criteria": "并行化与效率（joblib/numba）",
              "description": "对大批量样本支持并行推理与批处理，控制时延满足在线要求。",
              "score": 20,
              "evaluation_focus": "性能工程",
              "scoring_hint": "高分：基准与TPS/延迟数据；中分：有并行无指标；低分：串行缓慢。"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "分类性能报告：AUC/PR/F1与混淆矩阵",
              "description": "完整报告分位置分层CV下的AUC、PR、F1、混淆矩阵，含均值±方差。",
              "score": 30,
              "evaluation_focus": "指标呈现",
              "scoring_hint": "高分：含方差与显著性对比基线；中分：部分指标；低分：缺失或单次结果。"
            },
            {
              "sub_criteria": "定位精度改进量化（RMSE/鲁棒性提升）",
              "description": "在分类器调整权重后，报告3D/2D/z RMSE变化与对强干扰场景的鲁棒性提升。",
              "score": 30,
              "evaluation_focus": "效用验证",
              "scoring_hint": "高分：RMSE下降≥10%并给出置信区间；中分：仅趋势；低分：无对比或无改进。"
            },
            {
              "sub_criteria": "阈值敏感性与工作点选择依据（ROC/成本）",
              "description": "分析 p_NLOS 阈值对误报/漏报与定位RMSE的影响，选择成本最优点。",
              "score": 20,
              "evaluation_focus": "稳健性",
              "scoring_hint": "高分：曲线+成本曲线；中分：口头说明；低分：固定阈值无依据。"
            },
            {
              "sub_criteria": "可解释性与失败案例分析",
              "description": "用SHAP/特征重要性解释判错样本与新型干扰模式，并提出改进方向。",
              "score": 20,
              "evaluation_focus": "诊断洞察",
              "scoring_hint": "高分：具体案例与改进建议；中分：泛述；低分：无分析。"
            }
          ]
        }
      }
    },
    "4": {
      "subtask": "子任务4（动态轨迹估计与自适应平滑）的目标是从按时间顺序记录的多时刻UWB测距序列（每个时间步包含四个锚点到Tag的距离与时间戳，锚点坐标为已知常量，测距可伴随不确定性或置信度指标）生成连续、平滑且带置信度的三维运动轨迹，并在在线运行中对测量质量和锚点偏置进行自适应调整以提高鲁棒性；为实现该目标，本任务按以下明确步骤和方法实施：输入为经单位统一与基础过滤后的时间序列数据（每条记录含时间戳、四路距离、可选的重复/校验字段与经验测量方差），首先建立状态空间模型并明确状态向量格式（建议最小为位置与速度 s_k = [x_k, y_k, z_k, v_xk, v_yk, v_zk]^T，必要时扩展加速度或锚点偏置分量）；定义运动模型（可选匀速或匀加速模型，离散时间更新 s_{k+1} = F s_k + w_k，过程噪声协方差Q需通过经验或系统识别设定）与非线性观测模型（每个锚的观测 h_i(s_k) = ||pos(s_k) − a_i|| + b_i，其中b_i为可选的慢变偏置变量）；其次选择并实现适合的时序滤波器：对近线性、低非线性情形采用扩展卡尔曼滤波(EKF)或无迹卡尔曼滤波(UKF)（给出雅可比或sigma点计算细节并在每步计算后验协方差），对高度非线性或多模态不确定性采用粒子滤波并在必要时使用系统化重采样以避免退化；第三在测量更新环节引入基于创新的鲁棒化与量化门控：计算每步innovation并使用卡方门控（自由度等于当前使用的测距数量）判定异常测量，基于归一化残差实施自适应测量协方差调整（例如 R_eff,i = R_nominal,i * (1 + κ * (innovation_norm_i / threshold))）或将高残差锚点设为临时忽略；第四实现滑动窗口的在线自校准与批量平滑：在每N步或事件触发时，采用滑窗EM或最小二乘束调整（bundle-adjustment）联合优化窗口内所有状态轨迹与可参数化的锚点偏置b_i（使用Levenberg–Marquardt或Ceres/Scipy的least_squares），以校正慢变系统偏差并输出更精确的偏置先验；第五在轨迹结束或离线阶段应用Rauch–Tung–Striebel (RTS)平滑器对整个序列进行后验平滑以降低延迟与抖动，并在平滑后再次评估与调整锚点偏置；第六实现缺失测量与异步测率的处理策略：当某些锚点在某时刻缺失时以增大该维测量协方差或直接剔除观测进行更新，同时保持滤波器数值稳定性（对雅可比和协方差矩阵常加小量正则化）；第七为提高实时性与可部署性，明确参数标定与监控要点：过程噪声Q、初始状态协方差P0、测量协方差R_nominal、卡方门控阈值与滑窗长度应通过历史数据或短期在线辨识调整，并记录过滤器健康指标（如创新序列统计一致性、有效样本数）；第八输出要求为时间序列的最优位置估计与伴随协方差矩阵（或置信区间）、平滑后轨迹、每步的测量使用决策与锚点偏置估计及其不确定度，所有算法实现建议使用数值库（Python: numpy/scipy；滤波可用 filterpy 或自实现EKF/UKF；粒子滤波可用自实现或pyParticleEst；批量优化可用 Ceres/G2O 或 scipy.optimize.least_squares），并在代码中明确处理数值边界与单位一致性；最后提供性能验证接口以输出时序平均定位误差、平滑前后误差对比以及置信区间覆盖率，用以在线监控与参数自适应。",
      "criteria": {
        "task_understanding": {
          "core_goal": "利用EKF/UKF/粒子滤波等时序滤波与RTS平滑，预测与平滑UWB动态Tag三维轨迹并自适应优化测量协方差与锚点偏置，评估定位精度与置信覆盖率。",
          "expected_output": "按时间序列输出的位置与速度估计x̂_k、协方差P_k，平滑后轨迹与协方差，在线门控与测量使用日志，时间变偏置b_i估计及方差，性能报表（平均误差、平滑前后对比、覆盖率），可执行代码与参数配置。",
          "key_inputs_constraints": "输入：时间戳序列t_k、四锚测距r_{ik}（mm）、锚点坐标a_i（mm）、名义测量方差R_nominal或经验方差、可选置信/校验字段；约束：单位统一为mm，缺失测距允许；过程模型为匀速/匀加速离散化；Q、R、P0需可调并记录；门控基于卡方阈值；滑窗联合优化与RTS平滑需数值稳定（正定协方差）。",
          "modeling_type": "预测+拟合+优化",
          "role_in_pipeline": "作为在线/离线时序融合环节，依赖子任务1的清洗与单位统一、子任务2的静态定位与偏置先验、子任务3的NLOS概率；向后输出轨迹与不确定度供可视化与性能评估。",
          "assumptions": "若未提供测量方差则以组内MAD换算R_nominal；偏置b_i缓慢漂移可建模为随机游走；时间步长不恒定需基于Δt构造F与Q。"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "动态三维轨迹预测与平滑目标界定",
              "description": "是否明确目标为对按时间顺序UWB测距进行三维位置与速度的在线预测（滤波）与离线平滑（RTS），并输出置信度（协方差）。",
              "score": 35,
              "evaluation_focus": "建模思维",
              "scoring_hint": "高分：清楚区分滤波与平滑并说明输出x̂_k、P_k与平滑结果；中分：仅提到轨迹估计未区分平滑；低分：将任务误解为静态定位或分类。"
            },
            {
              "sub_criteria": "非线性观测与量测门控识别",
              "description": "是否识别到观测模型h_i(s_k)=||pos−a_i||+b_i的非线性与卡方创新门控需求。",
              "score": 30,
              "evaluation_focus": "问题抽象",
              "scoring_hint": "高分：给出创新、自由度和卡方阈值；中分：泛述异常剔除无统计依据；低分：无门控或误将线性化为恒等。"
            },
            {
              "sub_criteria": "自适应测量协方差与偏置建模需求",
              "description": "是否指出R_eff自适应调整与b_i慢变（随机游走/滑窗校准）的必要性。",
              "score": 35,
              "evaluation_focus": "需求把握",
              "scoring_hint": "高分：提出R_eff,i=R_nominal(1+κ·归一化残差)或利用p_NLOS调整；中分：仅调大R无规则；低分：忽略R与偏置适配。"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "状态空间与状态向量s_k复述",
              "description": "是否准确复述s_k=[x,y,z,vx,vy,vz]（可扩展b_i）与过程模型（匀速/匀加速）。",
              "score": 30,
              "evaluation_focus": "表达准确",
              "scoring_hint": "高分：含Δt依赖的F与Q描述；中分：仅文字描述无Δt；低分：状态缺失速度或单位混乱。"
            },
            {
              "sub_criteria": "观测模型与单位(mm)一致性复述",
              "description": "是否说明r_i单位为mm、h_i的欧氏距离与偏置叠加、以及锚点坐标a_i为常量。",
              "score": 30,
              "evaluation_focus": "一致性",
              "scoring_hint": "高分：明确单位与量纲；中分：单位未提但未矛盾；低分：单位错误或混用cm。"
            },
            {
              "sub_criteria": "输出与评估指标复述",
              "description": "是否复述输出轨迹、P_k、平滑轨迹、门控日志、偏置估计与平均误差/覆盖率评估。",
              "score": 40,
              "evaluation_focus": "规格把控",
              "scoring_hint": "高分：列出覆盖率、平滑前后误差对比；中分：仅给位置曲线；低分：无评估指标。"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "过程噪声Q与运动模型假设",
              "description": "是否合理假设匀速/匀加速与Q的结构（基于连续白噪声加速度离散化或经验标定）。",
              "score": 35,
              "evaluation_focus": "数理推导",
              "scoring_hint": "高分：给出Q(Δt)形式或标定策略；中分：仅经验设置常数Q；低分：未说明Q或与Δt无关。"
            },
            {
              "sub_criteria": "测量噪声R与NLOS影响假设",
              "description": "是否提出R_nominal来源（MAD/历史）与NLOS时R_eff放大或门控剔除的规则假设。",
              "score": 35,
              "evaluation_focus": "鲁棒性",
              "scoring_hint": "高分：明确κ或阈值与卡方门控自由度；中分：模糊调权；低分：固定R不变且无门控。"
            },
            {
              "sub_criteria": "锚点偏置b_i时变性假设",
              "description": "是否假设b_i为慢变随机游走或滑窗恒定并说明协方差/正则。",
              "score": 30,
              "evaluation_focus": "建模假设",
              "scoring_hint": "高分：给出Var(b_i)或λ正则；中分：仅文字说明无量化；低分：忽略偏置。"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "EKF/UKF/粒子滤波选择与理由",
              "description": "根据非线性程度与实时性给出EKF/UKF/粒子滤波选择，并说明雅可比或sigma点构造。",
              "score": 30,
              "evaluation_focus": "算法选择",
              "scoring_hint": "高分：列出EKF雅可比H_k与J_pos/||·||或UKF参数α,β,κ；中分：仅说明用EKF；低分：未说明或选择不当。"
            },
            {
              "sub_criteria": "创新统计与卡方门控设计",
              "description": "构造创新ν_k、S_k并给出χ²阈值（自由度=有效测距数）及通过/剔除策略。",
              "score": 25,
              "evaluation_focus": "统计设计",
              "scoring_hint": "高分：写出ν^T S^-1 ν 与阈值映射；中分：简单残差阈值；低分：无门控。"
            },
            {
              "sub_criteria": "自适应R与权重融合规则",
              "description": "基于归一化残差或p_NLOS定义R_eff,i或观测忽略规则，并防止协方差非正定。",
              "score": 20,
              "evaluation_focus": "鲁棒融合",
              "scoring_hint": "高分：提供R_eff公式与下/上界；中分：口头放大R；低分：无自适应。"
            },
            {
              "sub_criteria": "滑窗联合优化与RTS平滑集成",
              "description": "设计滑窗EM/LM束调整优化{s_k,b_i}并在全序列应用RTS平滑，说明触发与窗口长度。",
              "score": 25,
              "evaluation_focus": "系统集成",
              "scoring_hint": "高分：说明least_squares、窗口N与收敛准则；中分：只提到平滑无细节；低分：无平滑。"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "数值稳定性与正定性保障",
              "description": "在更新中确保P、S正定（如加入小正则、Joseph形式更新），处理锚点几何退化与Δt变化。",
              "score": 30,
              "evaluation_focus": "数值技巧",
              "scoring_hint": "高分：提及Joseph更新或对角正则；中分：偶有数值提醒；低分：无任何措施。"
            },
            {
              "sub_criteria": "缺失测量与异步测率处理",
              "description": "当部分r_{ik}缺失时调整H、R或跳过更新，异步Δt下重构F,Q。",
              "score": 25,
              "evaluation_focus": "工程实现",
              "scoring_hint": "高分：清晰的子集更新策略；中分：简单跳过；低分：崩溃或未考虑。"
            },
            {
              "sub_criteria": "滑窗最小二乘/EM求解细节",
              "description": "给出LM/BA目标、雅可比、停止准则与正则λ，输出b_i不确定度。",
              "score": 25,
              "evaluation_focus": "优化求解",
              "scoring_hint": "高分：明确定义代价与λ；中分：仅说明“优化一下”；低分：无细节。"
            },
            {
              "sub_criteria": "RTS平滑器推导与实现",
              "description": "提供平滑增益C_k=P_k F^T P_{k+1|k}^{-1}与后验方程并处理数值逆。",
              "score": 20,
              "evaluation_focus": "推导实现",
              "scoring_hint": "高分：写出关键矩阵关系；中分：仅用库函数；低分：未实现。"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "EKF/UKF/粒子滤波核心代码正确性",
              "description": "实现预测/更新、雅可比或sigma点生成、协方差更新，单元测试通过。",
              "score": 35,
              "evaluation_focus": "代码可靠性",
              "scoring_hint": "高分：含单元测试与数值检查；中分：基本可跑；低分：更新公式错误或崩溃。"
            },
            {
              "sub_criteria": "自适应R与卡方门控的可配置实现",
              "description": "支持参数化κ、阈值、自由度自动计算，输出门控日志。",
              "score": 25,
              "evaluation_focus": "可配置性",
              "scoring_hint": "高分：YAML/JSON参数与日志；中分：硬编码常量；低分：未实现。"
            },
            {
              "sub_criteria": "滑窗优化与RTS平滑接口",
              "description": "提供窗口大小、触发频率、least_squares调用与平滑开关，返回b_i估计与方差。",
              "score": 20,
              "evaluation_focus": "接口设计",
              "scoring_hint": "高分：清晰API与示例；中分：仅脚本；低分：无接口。"
            },
            {
              "sub_criteria": "缺失测量与异步Δt稳健处理",
              "description": "代码在缺失r_{ik}与变Δt下稳定运行并记录使用的锚点集合。",
              "score": 20,
              "evaluation_focus": "稳健工程",
              "scoring_hint": "高分：有集成测试；中分：偶发错误；低分：直接失败。"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "轨迹精度评估与平滑前后对比",
              "description": "报告3D/2D/z误差RMSE或MAE，比较滤波与RTS平滑后的改进幅度。",
              "score": 35,
              "evaluation_focus": "结果解释",
              "scoring_hint": "高分：量化改进≥10%并给出数值；中分：给趋势无量化；低分：无对比。"
            },
            {
              "sub_criteria": "置信区间覆盖率与创新一致性",
              "description": "统计x̂±2σ覆盖率接近95%与创新归一化均方近似1的检验。",
              "score": 25,
              "evaluation_focus": "统计一致性",
              "scoring_hint": "高分：给覆盖率与NEES/NIS指标；中分：只展示误差条；低分：未检验。"
            },
            {
              "sub_criteria": "门控与自适应R对鲁棒性的贡献",
              "description": "比较启用/关闭门控与R_eff时的RMSE/轨迹抖动差异与失败率。",
              "score": 20,
              "evaluation_focus": "消融分析",
              "scoring_hint": "高分：提供消融实验；中分：定性描述；低分：无分析。"
            },
            {
              "sub_criteria": "偏置b_i估计与不确定度报告",
              "description": "展示b_i时间序列与方差，说明校准对误差的改善。",
              "score": 20,
              "evaluation_focus": "诊断能力",
              "scoring_hint": "高分：数值与图表齐全；中分：仅给曲线；低分：未报告或不合逻辑。"
            }
          ]
        }
      }
    }
  }
}
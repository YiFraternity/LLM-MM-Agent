{
  "task_id": "2012_D",
  "problem": "具体要求解决如下问题：\n\n1. 换算视场坐标。给出灰度矩阵元素行列号对应于经纬度坐标的换算公式，建立矩阵形式的经纬度坐标文本文件，这里矩阵的第i行与第j列，分别对应灰度矩阵的450+i行与450+j列，矩阵元素是（经度，纬度）这种形式的二维数组，给出结果的范围为：灰度矩阵中的第451行至550行，第451列至550列，文本文件取名为jwd.txt；而在论文中给出第500行和第500、501、502列三个交叉点处对应的经纬度。\n\n进而将卫星灰度矩阵IR1_2100.mat转化为卫星云图（参考附录中的卫星云图），并在这个卫星云图上添加海岸线。保存卫星云图为PDF或JPEG文件，取名为spic.pdf 或spic.jpg。\n\n2. 根据三个相邻时刻的卫星数据（IR1_2030.mat, IR1_2100.mat, IR1_2130.mat），用适当的方法建立21：00时刻风矢场的度量模型，给出计算方案，这里限定风矢计算中像素块匹配所选用的窗口大小为16×16个像素，搜索范围限定为64×64个像素。\n\n利用你们的方法计算21：00时刻在各个（整数）经纬度处的二维风矢。确定一个二维风矢需要4个指标：起始点的纬度、经度，风矢的方向（单位：从正北方顺时针方向量得的角度）和大小（单位：米/秒）。计算范围为：南纬40度至北纬40度，东经46度至126度。\n\n在论文中给出上面计算结果中全部非零风矢的个数，并给出在纬度26度，经度分别是52，53，54，57，58（度）处的风矢，这些风矢的表示形式可参照下面问题4中对winsh.txt要求的格式。\n\n给出你们对上述窗口大小和搜索范围的限定的理解或评价。\n\n3. 为了提高像素块匹配质量，取消问题2中窗口大小和搜索范围的限定，利用图像特征匹配等思想，设计能自适应地确定窗口大小和搜索范围的有效方法。进而建立风矢场的度量模型和算法。\n\n利用此模型和算法计算问题2中在纬度26度，经度分别是52，53，54，57，58（度）处的风矢。\n\n分析比较你们建立的这两种风矢计算方法的优劣，结论要有定量数据支撑。提出你们关于云图数据量和云导风风矢场计算研究的建议。\n\n4. 应用附件中全球温度数值预报文件temp3.mat计算问题2中非零风矢所在的等压面（用该时刻该处大气的压强值标志，物理单位为毫巴）。并在论文中给出在纬度26度，经度分别是52，53，54，57，58（度）处附近求出的风矢量所在的等压面。\n\n\\begin{table}[h] \\centering \\begin{tabular}{ccccc}\\hline纬度 & 经度 & 角度（北顺） & 速度（米/秒） & 压强（毫巴） \\\\ \\hline36.07 & 68.43 & 263.00 & 22.00 & 218.00 \\\\ -28.90 & 65.42 & 224.00 & 23.00 & 252.00 \\\\ \\hline\\end{tabular}\\end{table}\n\n最后在问题1中画出的卫星云图上添加所计算出的非零风矢量结果（参照附录中的云导风图）, 并将此标有风矢图标的卫星云图（即云导风图）保存为PDF文件或JPEG文件，取名为winsp.pdf 或winsp.jpg。图一：卫星云图图二：云导风图\n注：图二中三个风矢标记   表示风向都是正北风，风速分别为每秒0至20米，20以上至40米，40米以上。所有不同风向的风矢都可以由上述三个风矢经旋转适当角度而得到。",
  "subtask": {
    "1": {
      "subtask": "子任务1（几何定位与卫星云图制作）——目标是把给定 IR1_2100 的 2288×2288 灰度矩阵精确地从像元行列索引映射到地理经纬坐标，生成并保存指定子矩阵的经纬文本输出 jwd.txt（对应灰度矩阵第451行至第550行、第451列至第550列，即按题目约定矩阵元素(i,j) 对应原灰度矩阵第(450+i,450+j)位置），并将 IR1_2100 按 k_temp.txt 做辐射定标生成可视化卫星云图并在其上叠加 coastline0.txt 给出的海岸线后保存为 spic.pdf 或 spic.jpg；为保证可重复实现，需按以下明确步骤和技术要点完成：1) 输入与常量：读取 IR1_2100.mat（2288×2288 灰度矩阵）、k_temp.txt（灰度 0–1023 对应亮温）、coastline0.txt（经度、纬度，(99999.99,99999.99) 为段分隔符），并采用卫星与地球参数：星下点经度 λ0=86.5°、纬度 φ0=0°、中心像素 (i0,j0)=(1145,1145)、像元步进角 Δ=140×10^-6 rad、同步卫星与地心距离 Hs=42164000 m，以及地球椭球长半轴 a=6378136.5 m、短半轴 b=6356751.8 m。2) 灰度→亮温：用 k_temp.txt 做查表/插值，将 IR1_2100 的每一有效灰度值转换为亮温（K），对于灰度为 -1 或超出表的点标记为无效。3) 像元到观测射线定义：对每个像元索引 (i,j) 计算水平偏角 α = (j − j0)·Δ（东西向，东正）和垂直偏角 β = (i0 − i)·Δ（南北向，北正），在卫星本体坐标系构造视线单位向量 v_s = [cosβ·cosα, cosβ·sinα, sinβ]（按所定轴约定），并用星下点经纬构造旋转矩阵将 v_s 旋转到地心ECEF坐标得到 v；卫星位置向量取 S = Hs·[cosφ0·cosλ0, cosφ0·sinλ0, sinφ0]。4) 射线—椭球交点求解：对每条射线求解参数 t 使得 P(t)=S + t v 与椭球方程 (x^2 + y^2)/a^2 + z^2/b^2 = 1 相交，代入得到关于 t 的二次方程 At^2 + Bt + C = 0，系数按 A = (v_x^2+v_y^2)/a^2 + v_z^2/b^2, B = 2[(S_x v_x + S_y v_y)/a^2 + S_z v_z/b^2], C = (S_x^2 + S_y^2)/a^2 + S_z^2/b^2 − 1；若判别式 < tol(≈0 或小负数因数值误差) 则判定该像元不与地球相交并置无效；否则取两个根中正且较小的 t* 得到交点 P = S + t* v。5) ECEF→地理经纬转换：由 P 计算经度 λ = atan2(y,x)；采用椭球地理纬（geodetic latitude）计算方法（如迭代解法或 Bowring 公式）把 P 的坐标转换为地理纬度 φ（确保满足椭球法线定义，以精确反映经纬），并将经度纬度规范化为度数。6) 输出 jwd.txt：对要求的子矩阵（451–550 行与列）按行优先写入经度、纬度对，建议每行对应矩阵的一个行并在行内按列顺序输出每个元素为“lon,lat”或以两列并列的数值对形式，缺测/地球外点以特定标志（如 NaN,NaN 或 -9999）表示；在文稿中明确给出第500行、第500/501/502列对应的精确经纬数值。7) 云图与海岸线叠加：用亮温矩阵按合适色标（线性或分段伪彩色）生成可视化图像；为把 coastline0.txt 中经纬点叠加到图像上，将 coastline 经纬坐标映射回图像像素坐标（即在先前得到的整个或某个覆盖区域的像素→经纬数组上做最近邻或双线性逆映射/插值，或为效率先建立经纬到像素的空间查找结构如 KD-tree），忽略或分段处理 99999.99 标记以得到多段线，并以显著颜色和线宽绘制海岸线。8) 数值与实现细节：所有射线求解与坐标变换应向量化并分块并行计算以提高速度，二次方程判别的数值阈值、地理纬迭代收敛容限（例如 1e-12 rad）和无效点处理规则须在代码中固定；建议使用 MATLAB（内建 .mat 支持与矩阵运算）或 Python+NumPy/SciPy，并可用 pyproj/geographiclib 做 ECEF↔geodetic 互转以保证数值精度。9) 最终产物：保存 jwd.txt（451–550×451–550 经纬对）、保存经 k_temp 定标后的 IR1_2100 云图文件 spic.pdf 或 spic.jpg（含颜色条说明亮温尺度）并在该图中叠加海岸线，所有文件名和无效点表示方法在交付清单中注明，以便审阅与后续处理；此外在实现中应记录用于重现的常量与坐标系约定（单位、角度方向、中心像素索引、Δ 值、星下点经纬和椭球参数）。",
      "criteria": {
        "task_understanding": {
          "core_goal": "构建并求解像元到地理经纬度的几何映射与辐射定标仿真模型，生成 jwd.txt 与叠加海岸线的 IR1_2100 卫星云图。",
          "expected_output": "1) jwd.txt（灰度矩阵第451–550行×第451–550列的经度、纬度矩阵文本）; 2) spic.pdf 或 spic.jpg（IR1_2100 亮温可视化并叠加 coastline0.txt 海岸线，含色标）; 3) 文中列出第500行在第500/501/502列的经纬度数值。",
          "key_inputs_constraints": "输入：IR1_2100.mat（2288×2288 灰度值，含 -1 无效）, k_temp.txt（1024 个亮温K，灰度0–1023映射）, coastline0.txt（经纬对，99999.99为分段）; 常量：λ0=86.5°，φ0=0°，(i0,j0)=(1145,1145)，Δ=140e-6 rad，Hs=42164000 m，椭球 a=6378136.5 m，b=6356751.8 m; 约束：需采用ECEF射线与椭球二次方程交点求解，纬度为地理纬（Bowring/迭代），无效点标记一致; 可视化需颜色条标注亮温范围并正确叠加海岸线。",
          "modeling_type": "仿真+拟合",
          "role_in_pipeline": "作为几何定位与可视化准备环节，位于风矢估计（匹配/速度场）之前，直接依赖原始灰度数据与定标文件；其输出 jwd.txt 与可视化图将被后续风矢计算、海岸线叠加与结果展示复用。"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "明确“几何映射+辐射定标”核心目标与产物（jwd.txt, spic）",
              "description": "是否将子任务界定为像元到地理经纬度的映射与亮温可视化，并点名输出文件 jwd.txt 与 spic.pdf/jpg。",
              "score": 35,
              "evaluation_focus": "问题界定",
              "scoring_hint": "高分：同时点出经纬映射与亮温可视化且文件名准确；中分：只提一项或文件名含糊；低分：目标偏离或未提文件输出。"
            },
            {
              "sub_criteria": "识别关键参数与坐标系（λ0, φ0, i0,j0, Δ, Hs, a,b, ECEF）",
              "description": "是否列出并强调星下点、中心像元、步进角、卫星位置、椭球参数与ECEF坐标系的重要性。",
              "score": 35,
              "evaluation_focus": "要素抓取",
              "scoring_hint": "高分：参数齐全且含单位与方向约定；中分：缺1–2项或无单位；低分：多数参数缺失或混淆。"
            },
            {
              "sub_criteria": "识别无效像元与海岸线分段处理需求",
              "description": "是否明确灰度=-1/不相交点需置无效以及coastline0中99999.99分段绘制。",
              "score": 30,
              "evaluation_focus": "边界条件",
              "scoring_hint": "高分：两类无效处理都覆盖且给出标记规则；中分：仅提及其一或无标记细节；低分：未识别或处理。"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "像元→视角→ECEF→椭球交点→经纬度流程复述",
              "description": "按顺序清晰复述α,β计算、v_s→v旋转、射线与椭球二次方程、经度λ与地理纬φ求解。",
              "score": 40,
              "evaluation_focus": "流程清晰",
              "scoring_hint": "高分：步骤完整且方向约定（东正、北正）明确；中分：步骤完整但方向未述；低分：流程断裂或顺序错误。"
            },
            {
              "sub_criteria": "子矩阵定位与 jwd.txt 格式",
              "description": "准确复述矩阵(i,j)对应原(450+i,450+j)以及输出行列顺序与无效点标志。",
              "score": 30,
              "evaluation_focus": "规范理解",
              "scoring_hint": "高分：索引换算与输出格式一致；中分：说明含糊；低分：索引错误或格式不符。"
            },
            {
              "sub_criteria": "亮温可视化与海岸线叠加规则",
              "description": "复述k_temp定标、色标需标注亮温、海岸线经纬转像素/逆映射策略与分段绘制。",
              "score": 30,
              "evaluation_focus": "实现要点",
              "scoring_hint": "高分：三项齐全；中分：缺其一；低分：仅泛述“画图”。"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "视几何轴约定与旋转矩阵假设",
              "description": "明确v_s=[cosβcosα, cosβsinα, sinβ]的轴定义与从卫星本体系到ECEF的旋转（由星下点λ0,φ0）假设。",
              "score": 35,
              "evaluation_focus": "坐标假设",
              "scoring_hint": "高分：给出旋转方向与右手系说明；中分：仅口头假设；低分：未说明易致旋转错误。"
            },
            {
              "sub_criteria": "数值稳定性与阈值假设（判别式tol、纬度收敛）",
              "description": "设定判别式小负容差与地理纬迭代容限（如1e-12 rad），说明选择理由。",
              "score": 35,
              "evaluation_focus": "数值稳健",
              "scoring_hint": "高分：给具体数值与适用范围；中分：仅定性描述；低分：未设阈值。"
            },
            {
              "sub_criteria": "定标外推与无效值处理假设",
              "description": "灰度超出0–1023或为-1的处理（NaN/-9999）与是否插值（最近邻/线性）假设。",
              "score": 30,
              "evaluation_focus": "数据假设",
              "scoring_hint": "高分：规则清晰、统一；中分：仅提及无细节；低分：忽略导致混用。"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "射线—椭球交点二次方程推导（A,B,C）",
              "description": "正确写出A,B,C: (vx^2+vy^2)/a^2+vz^2/b^2等并说明选择正且较小根t*。",
              "score": 35,
              "evaluation_focus": "数理推导",
              "scoring_hint": "高分：公式正确且根选择合理；中分：少量符号错误；低分：方程错误或根选择不当。"
            },
            {
              "sub_criteria": "ECEF→地理经纬（Bowring/迭代）",
              "description": "采用地理纬（法线定义），给出步骤或引用Bowring公式，确保精度。",
              "score": 30,
              "evaluation_focus": "算法选择",
              "scoring_hint": "高分：明确算法与精度；中分：只给atan2与近似地心纬；低分：错误将地心纬当地理纬。"
            },
            {
              "sub_criteria": "像元角度α,β与坐标系方向",
              "description": "α=(j−j0)Δ（东正），β=(i0−i)Δ（北正），并阐明与图像行列方向关系。",
              "score": 35,
              "evaluation_focus": "几何建模",
              "scoring_hint": "高分：方向一致且与中心像元对应；中分：只给公式无方向解释；低分：符号相反导致镜像。"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "判别式与根选择实现（数值容差）",
              "description": "实现Δ=B^2−4AC判别，允许微小负值；选取t*>0的最小根，异常返回无效。",
              "score": 30,
              "evaluation_focus": "数值实现",
              "scoring_hint": "高分：容差与异常分支完备；中分：有容差无异常；低分：直接报错或取错根。"
            },
            {
              "sub_criteria": "经纬度单位与规范化（度、范围）",
              "description": "确保输出λ,φ为度，λ∈[−180,180)或[0,360)并一致；φ∈[−90,90]。",
              "score": 25,
              "evaluation_focus": "规范一致",
              "scoring_hint": "高分：范围与单位统一；中分：单位正确但范围混乱；低分：弧度输出或混用。"
            },
            {
              "sub_criteria": "k_temp映射与插值策略",
              "description": "灰度0–1023查表/线性插值；-1与越界置无效；亮温矩阵与灰度对齐。",
              "score": 25,
              "evaluation_focus": "数据处理",
              "scoring_hint": "高分：插值与无效规则明确；中分：仅查表不述越界；低分：将-1当0或外推错误。"
            },
            {
              "sub_criteria": "海岸线映射到图像坐标",
              "description": "给出经纬→像素逆映射或查找策略（双线性/最近邻/KD-tree），分段绘制。",
              "score": 20,
              "evaluation_focus": "算法细化",
              "scoring_hint": "高分：策略可执行且说明稠密度/外推；中分：仅口头描述；低分：直接用经纬作像素绘制。"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "数据读取与文件输出一致性（IR1_2100.mat, k_temp.txt, coastline0.txt, jwd.txt）",
              "description": "正确读取三类输入并按行优先、指定索引输出jwd.txt，含无效标志。",
              "score": 25,
              "evaluation_focus": "IO正确性",
              "scoring_hint": "高分：路径、类型、格式均正确；中分：小格式偏差；低分：读取/写出失败或索引错位。"
            },
            {
              "sub_criteria": "向量化/分块加速与内存控制",
              "description": "对射线求解与转换进行向量化或分块处理，避免内存溢出。",
              "score": 25,
              "evaluation_focus": "性能工程",
              "scoring_hint": "高分：明确批大小/时间收益；中分：部分向量化；低分：逐像元循环导致不可用耗时。"
            },
            {
              "sub_criteria": "数值健壮性与异常处理",
              "description": "处理判别式小负、t≤0、NaN传播、经纬规范化边界、插值越界等。",
              "score": 25,
              "evaluation_focus": "可靠性",
              "scoring_hint": "高分：覆盖主要异常并单元测试样例；中分：覆盖不全；低分：异常导致崩溃/错误结果。"
            },
            {
              "sub_criteria": "可视化与海岸线叠加正确性（spic.pdf/jpg）",
              "description": "亮温色标、坐标轴/比例、海岸线分段与对齐、文件保存格式与分辨率。",
              "score": 25,
              "evaluation_focus": "可视化实现",
              "scoring_hint": "高分：色标单位K、线条清晰对齐；中分：对齐基本正确但缺色标；低分：错位或未分段。"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "验证样点（第500行×第500/501/502列）经纬给出与自检",
              "description": "是否输出并核查这三个交叉点经纬，含合理性检查（相邻经纬差与Δ一致级）。",
              "score": 35,
              "evaluation_focus": "结果核验",
              "scoring_hint": "高分：数值给出并解释差异量级；中分：仅给数值；低分：未提供或不合理。"
            },
            {
              "sub_criteria": "可视化质量检查（亮温范围与地理位置直观一致）",
              "description": "检查赤道附近位置、海岸线与大陆轮廓是否合理，亮温梯度与预期匹配。",
              "score": 35,
              "evaluation_focus": "一致性检查",
              "scoring_hint": "高分：指出若干地标对齐证据；中分：笼统描述；低分：未检或明显错位未说明。"
            },
            {
              "sub_criteria": "无效点比例与原因说明",
              "description": "统计地球外/无效像元比例并解释（视场边缘、地球外、-1灰度）。",
              "score": 30,
              "evaluation_focus": "数据解释",
              "scoring_hint": "高分：给出比例或计数并分类；中分：仅定性；低分：无统计或混淆原因。"
            }
          ]
        }
      }
    },
    "2": {
      "subtask": "子任务 2（基线云导风估算，固定窗口与搜索范围）：在已具备将任意给定经纬点转换为 IR1_2100 图像像素坐标的映射函数（或查表）并能读取三幅时序原始灰度矩阵 IR1_2030.mat、IR1_2100.mat、IR1_2130.mat 的前提下，任务目标是在 21:00（IR1_2100）时刻对每个整数经纬格点（纬度从 −40° 到 +40°、经度从 46° 到 126°，步长 1°）按题目限定参数（模板窗口 16×16 像素、搜索窗口 64×64 像素、时间间隔 Δt = 1800 s）计算云迹风矢并输出每个非零风矢的起始点纬度/经度、方向（从正北顺时针角度，度）及大小（米/秒）；为保证结果质量，每个矢量还应伴随匹配质量指标并经前向-后向三帧一致性检验。具体操作步骤如下：对每一目标经纬点，用像素映射获得其在 IR1_2100 中的像素中心 (i0,j0)；若该中心或其周边导致的 16×16 模板或 64×64 搜索窗超出图像边界或包含无效灰度（如 k_temp 对应无效值），则该点标记为无效或输出零风矢；否则从 IR1_2100 提取以 (i0,j0) 为中心的 16×16 模板（在必要时用亚像素插值复原中心），并在 IR1_2030 与 IR1_2130 的各自以 (i0,j0) 为中心的 64×64 区域上分别以逐像素滑动、步长 1 像素执行归一化互相关（NCC）或归一化平方差最小化匹配以找出最佳匹配位置；对每个最佳峰值在其邻域做三点二次抛物线或高斯拟合以获得亚像素偏移 (Δi,Δj) 并记录对应的 NCC 峰值与峰值比（第一峰与第二峰之比）等质量指标。利用前帧（t0←t−Δ）和后帧（t0→t+Δ）的匹配结果施加三帧一致性约束——即前向位移与后向位移方向相反且幅值相近，或者前后向预测在中间帧的误差小于用户设定阈值（建议阈值可选，例如前后向误差 < 2 像素且 NCC 峰值 > 0.6），否则将该点标注为低置信或零风矢。把模板中心与匹配中心两点的像素坐标各自通过像素→经纬映射反算为地理坐标（lat,lon），并用精确测地算法（推荐使用 GeographicLib / Vincenty）计算两点间的水平距离和方位角（方位角按从正北顺时针计）；将该距离在 Δt 时间内除以 Δt 得到风速大小（m/s），取方位角作为风向（若使用方位角 α，则速度分量可写为 V_N = distance·cosα/Δt, V_E = distance·sinα/Δt，方向以 α 度给出并规约到 [0,360)）。实现细节与质量控制：为减小亮度整体偏移影响，匹配前可对模板与搜索区做零均值归一化或高通滤波；对 NCC 峰值使用峰值比和局部温度方差作为判据以剔除纹理不足或平原区域的伪匹配；记录并输出每矢量的质量字段（NCC_peak、peak_ratio、forward-backward_error、local_variance）；对计算效率建议在稀疏经纬格上串行或并行化逐点处理（可用 MATLAB、Python+NumPy/OpenCV 的 matchTemplate(TM_CCORR_NORMED) 或 FFT 互相关加速），并对所有边界与无效像元做明确跳过规则。最终输出文件应列出所有被接受的非零风矢（每行至少含：latitude, longitude, direction_deg_clockwise_from_North, speed_m_per_s）并单独统计非零矢总数；同时生成便于叠加到云图的矢量列表与与每矢量对应的质量指标，以便后续可视化与筛选。",
      "criteria": {
        "task_understanding": {
          "core_goal": "基于三时刻卫星灰度矩阵进行21:00云迹风矢场估计与评价，采用固定窗口相关匹配并施加前后向一致性检验，拟合亚像素位移并评估匹配质量。",
          "expected_output": "1) 非零风矢清单：latitude, longitude, direction_deg_clockwise_from_North, speed_m_per_s；2) 每矢量质量指标：NCC_peak、peak_ratio、forward_backward_error、local_variance；3) 非零矢总数统计；4) 可叠加到云图的矢量列表文件。",
          "key_inputs_constraints": "输入：IR1_2030.mat、IR1_2100.mat、IR1_2130.mat（2288×2288灰度矩阵）；像素↔经纬映射函数；Δt=1800 s；模板16×16像素，搜索窗64×64像素；经纬网格：纬[-40,40]、经[46,126]、步长1°。约束：边界与无效灰度点剔除；NCC峰值阈值>0.6与峰值比阈值；前后向误差<2像素；方向从正北顺时针定义；速度单位m/s。",
          "modeling_type": "拟合+评价",
          "role_in_pipeline": "作为风场构建的基线方法：依赖子任务1的几何定位与亮温有效性掩膜，输出供后续可视化叠加与与自适应方法（子任务3）对比评估；后续任务使用本结果叠加在云图并进行等压面匹配。",
          "assumptions": "像素→经纬映射已给且精度足以支持亚像素位移反投影；亮温仅用于纹理匹配，不做辐射反演；NCC为默认匹配度量，抛物线亚像素拟合。"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "整数经纬网格与21:00风矢估计范围识别",
              "description": "是否准确圈定纬度-40°至40°、经度46°至126°、步长1°，并明确风矢时刻为IR1_2100（21:00）。",
              "score": 30,
              "evaluation_focus": "任务边界",
              "scoring_hint": "高分：网格范围与步长完全正确并注明中心时刻；中分：范围正确但遗漏步长或时刻表述模糊；低分：范围/时刻有误。"
            },
            {
              "sub_criteria": "固定窗口与搜索范围的约束识别",
              "description": "正确识别模板16×16与搜索窗64×64像素、步长1像素、Δt=1800 s为硬性约束。",
              "score": 30,
              "evaluation_focus": "约束把握",
              "scoring_hint": "高分：列明全部并在后续设计中贯彻；中分：缺少其中1项或未在实现中落实；低分：混淆或忽略约束。"
            },
            {
              "sub_criteria": "无效点与边界条件处理认知",
              "description": "明确无效灰度/越界窗口需跳过或输出零风矢，并说明触发条件。",
              "score": 40,
              "evaluation_focus": "异常处理",
              "scoring_hint": "高分：给出明确规则与判定（如包含-1或窗越界）；中分：仅口头说明无效但未细化触发；低分：未考虑或处理不一致。"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "方向与速度定义（北顺时针与m/s）",
              "description": "准确复述风向按从正北顺时针角度给出，速度=测地距离/Δt，单位m/s。",
              "score": 35,
              "evaluation_focus": "指标定义",
              "scoring_hint": "高分：清楚指明方位角定义域[0,360)与单位；中分：单位或方向域未说明；低分：采用东偏北等错误定义。"
            },
            {
              "sub_criteria": "三帧前后向一致性检验要求",
              "description": "复述需前向与后向位移方向相反且幅值相近，或中帧重投影误差阈值（如<2像素）。",
              "score": 35,
              "evaluation_focus": "一致性要求",
              "scoring_hint": "高分：量化阈值与判定逻辑完整；中分：仅叙述一致性，无阈值；低分：忽略该检验。"
            },
            {
              "sub_criteria": "质量指标输出（NCC_peak/peak_ratio/local_variance）",
              "description": "复述并承诺输出NCC峰值、峰值比、局部方差和forward-backward error。",
              "score": 30,
              "evaluation_focus": "结果规范",
              "scoring_hint": "高分：四项全列且解释用途；中分：缺1项；低分：未提质量指标。"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "纹理与亮度稳定性假设（零均值归一化）",
              "description": "阐明采用零均值归一化/NCC减弱亮度漂移，假设小时间隔纹理稳定。",
              "score": 35,
              "evaluation_focus": "建模假设",
              "scoring_hint": "高分：指出为何选NCC及其对亮度偏移的鲁棒性；中分：笼统说明稳定；低分：无相关假设。"
            },
            {
              "sub_criteria": "亚像素拟合与误差模型假设",
              "description": "说明三点二次/高斯拟合假设峰值近似二次型，给出预期像素级误差范围。",
              "score": 35,
              "evaluation_focus": "数理假设",
              "scoring_hint": "高分：给出<0.3像素等量级预期或残差控制；中分：仅说可提升精度；低分：未说明或错误模型。"
            },
            {
              "sub_criteria": "测地距离与方位角计算假设",
              "description": "声明使用Vincenty/GeographicLib等精确测地计算，假设地表为参考椭球。",
              "score": 30,
              "evaluation_focus": "计算假设",
              "scoring_hint": "高分：点名算法并说明优于平面近似；中分：未指明算法；低分：用欧氏距离近似大范围位移。"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "NCC/SSD匹配度量与预处理设计",
              "description": "给出NCC或归一化SSD公式、零均值/高通处理、滑动步长1像素。",
              "score": 30,
              "evaluation_focus": "算法选择",
              "scoring_hint": "高分：公式+预处理+步长齐全；中分：缺任一；低分：度量不当或未定义。"
            },
            {
              "sub_criteria": "前后向匹配与一致性门限设计",
              "description": "定义NCC_peak阈值≥0.6、peak_ratio阈值、forward-backward_error<2像素的接受准则。",
              "score": 30,
              "evaluation_focus": "鲁棒性",
              "scoring_hint": "高分：三阈值齐备且可配置；中分：缺1项或未量化；低分：无门限或不合理。"
            },
            {
              "sub_criteria": "亚像素峰值拟合与不确定度估计",
              "description": "描述在最佳峰邻域做二次抛物线/高斯拟合，输出(Δi,Δj)与拟合残差作为置信度。",
              "score": 25,
              "evaluation_focus": "数值细节",
              "scoring_hint": "高分：含拟合窗口选择与残差用途；中分：仅说明拟合无细节；低分：无亚像素处理。"
            },
            {
              "sub_criteria": "像素↔经纬与测地法方位角映射",
              "description": "定义将模板中心与匹配中心反投影为(lat,lon)，用测地反算速度与方向（北顺时针）。",
              "score": 15,
              "evaluation_focus": "几何映射",
              "scoring_hint": "高分：流程闭环且方向规范；中分：映射正确但方向未规约；低分：映射缺失或错误。"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "边界与无效像元的窗口裁剪/跳过策略",
              "description": "实现对越界窗口与含-1或无效灰度的点跳过或标零，并记录原因。",
              "score": 25,
              "evaluation_focus": "健壮性",
              "scoring_hint": "高分：自动检测并统计跳过数；中分：能跳过但无统计；低分：可能越界崩溃或误算。"
            },
            {
              "sub_criteria": "两侧帧匹配与一致性误差计算",
              "description": "分别在IR1_2030与IR1_2130搜索并计算forward-backward误差，基于阈值筛选。",
              "score": 25,
              "evaluation_focus": "实现严谨",
              "scoring_hint": "高分：前后向都计算并筛除不一致；中分：只做单侧或无误差阈值；低分：未做一致性检验。"
            },
            {
              "sub_criteria": "亚像素位移解与速度计算正确性",
              "description": "将(Δi,Δj)转为两地经纬并用Vincenty/GeographicLib求距离与方位角，速度=距离/1800。",
              "score": 30,
              "evaluation_focus": "数理正确",
              "scoring_hint": "高分：单位、角度域与算法正确；中分：单位或角度细节缺失；低分：显著公式/单位错误。"
            },
            {
              "sub_criteria": "质量门限应用与结果筛选",
              "description": "应用NCC_peak≥0.6、peak_ratio门限、local_variance门限，并输出非零风矢总数。",
              "score": 20,
              "evaluation_focus": "结果筛选",
              "scoring_hint": "高分：门限齐全并给统计；中分：部分门限；低分：无筛选导致大量伪匹配。"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "读取与映射接口的正确集成",
              "description": "正确读取三幅.mat并调用像素→经纬映射，处理NaN/-1无效值。",
              "score": 20,
              "evaluation_focus": "代码可靠性",
              "scoring_hint": "高分：健壮读取与检查；中分：读取可用但异常少处理；低分：路径/变量错误。"
            },
            {
              "sub_criteria": "NCC计算与滑动搜索效率",
              "description": "实现向量化或使用库(matchTemplate/FFT)在64×64搜索窗内逐像素NCC，步长1。",
              "score": 30,
              "evaluation_focus": "性能与正确",
              "scoring_hint": "高分：向量化/库函数且验证与基线一致；中分：可运行但低效；低分：实现错误或步长不对。"
            },
            {
              "sub_criteria": "亚像素拟合与峰值质量提取",
              "description": "在峰邻域进行二次/高斯拟合，并返回NCC_peak、peak_ratio与Δi,Δj。",
              "score": 25,
              "evaluation_focus": "数值实现",
              "scoring_hint": "高分：拟合稳健并处理越界；中分：仅整数峰；低分：拟合返回异常或未实现。"
            },
            {
              "sub_criteria": "一致性检验与输出格式",
              "description": "实现forward-backward误差计算与阈值筛选，输出CSV/文本含lat,lon,dir_deg,speed_mps及质量字段与总数。",
              "score": 25,
              "evaluation_focus": "I/O规范",
              "scoring_hint": "高分：字段齐全、单位正确、统计提供；中分：缺质量或总数；低分：格式不符或缺关键字段。"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "非零风矢总数与空间分布合理性",
              "description": "报告非零矢数量并解释其与云量/纹理分布的一致性（如海洋无云区稀疏）。",
              "score": 30,
              "evaluation_focus": "结果解释",
              "scoring_hint": "高分：数量与分布解释到位；中分：仅给数量；低分：未报告或明显不合理。"
            },
            {
              "sub_criteria": "质量指标分布与阈值敏感性",
              "description": "分析NCC_peak、peak_ratio、forward-backward_error分布，讨论阈值变动对矢量保留率影响。",
              "score": 30,
              "evaluation_focus": "稳健性",
              "scoring_hint": "高分：提供统计或直方图描述；中分：定性描述；低分：无分析。"
            },
            {
              "sub_criteria": "方向与速度单位与方位角校验",
              "description": "抽样核对若干点的方位角（北顺时针）与速度单位（m/s）是否与位移与Δt一致。",
              "score": 25,
              "evaluation_focus": "一致性检查",
              "scoring_hint": "高分：给出核对样例/自检脚本；中分：口头确认；低分：方向单位错误。"
            },
            {
              "sub_criteria": "异常与失败案例说明",
              "description": "说明边界、无纹理、强形变区域被剔除或置零的原因与占比。",
              "score": 15,
              "evaluation_focus": "风险意识",
              "scoring_hint": "高分：列出类别与占比；中分：定性说明；低分：忽略异常。"
            }
          ]
        }
      }
    },
    "3": {
      "subtask": "子任务3目标是设计并实现一个自适应、多尺度且可量化不确定度的云迹风矢估算法，用于替代固定窗口/固定搜索半径的方法，并将每个风矢归属到temp3.mat中给定的等压面（毫巴）并做视差校正；该子任务的输入为三时刻红外灰度图像（IR1_2030.mat、IR1_2100.mat、IR1_2130.mat）、灰度→亮温映射表k_temp.txt、全球温度剖面temp3.mat（36层及对应压强）、以及用于像素↔经纬的投影/几何映射函数（已提供或按题目几何关系可复现）；输出为每个目标经纬点的风矢（起点纬度、经度；方向：从正北顺时针度数；大小：m/s）、对应等压面压强（毫巴）及每矢量的质量指标和不确定度估计，并特别计算并报告纬度26°、经度52、53、54、57、58°处的风矢与压强。方法步骤与技术细节如下：1) 亮温与剖面匹配——先用k_temp将三幅图像转换为亮温场，针对每个经纬点在temp3.mat上用双线性插值获得垂直温度剖面，按最接近亮温做层间线性插值以求出对应压强 p_c，并用局部剖面温差作为压强不确定度估计；2) 云顶几何高度与视差校正——将压强 p_c 与所插值层的温度剖面结合用静力学近似（或标准大气积分）换算为近似几何高度 h_cld，并在射线—椭球求交时把球体外扩 h_cld 来重新计算云顶的精确经纬位置，从而校正因视角引起的地面投影偏移；3) 多尺度位移先验——构建图像金字塔（典型层数 3–5，降采样因子 2），在最粗层用相位相关或FFT块互相关快速估计大尺度位移场作为先验和搜索中心；4) 稀疏特征引导——在中/细尺度用稳健特征检测（如ORB或SIFT）提取描述子并做匹配，应用RANSAC剔除离群，得到高置信稀疏位移集合作为约束；5) 局部自适应模板与搜索策略——对欲估点或局部网格先计算结构张量（或梯度能量、局部方差），根据纹理强度自适应确定模板尺寸（例如纹理强时 8–16 像素，弱纹理时 24–48 像素）和正则化权重，搜索范围由金字塔先验位移的置信区间与局部纹理不确定度联合决定（例如搜索半径 = max(8, ceil(α·|prior_disp|) + β·(1/texture_metric))，α,β为调参常数）；6) 稠密位移求解——在中/细尺度以稀疏匹配和粗场为先验，求解带鲁棒数据项的变分光流能量（E = Σ ρ_photo(I_t(x) − I_{t+Δ}(x+u)) + λ Σ ρ_smooth(∇u)），其中ρ_photo采用Huber或Lorentz以容忍亮度变化，ρ_smooth允许边界保留（TV或Huber on gradients）；用增量/多尺度迭代求解（每层若干迭代，典型10–30次），并在每次迭代中用稀疏匹配做强约束或作为边界条件以稳定解；7) 亚像素精度与不确定度估计——对每个点的位移用高阶插值/二次拟合做亚像素精修，并基于残差、数据项二阶近似（Hessian）及前向-后向一致性计算像素误差σ_pix，进而用测地转换传播得到速度不确定度σ_v；8) 输出与质量控制——为每个风矢输出方向、速度、对应压强 p_c、NCC/残差峰值、峰值比、前向-后向误差、局部纹理指标与σ_v，应用阈值（如残差阈值、峰值比阈值、前后误差阈值）标注或剔除低置信矢量；9) 实现与工具建议——推荐使用 Python + NumPy/SciPy + OpenCV（SIFT/ORB、calcOpticalFlowFarneback 可作为参考实现）或基于CUDA的光流库以加速，多尺度与稀疏-稠密混合求解适合并行化；地理/投影转换使用pyproj或GeographicLib，矩阵插值用SciPy。参数（如金字塔层数、Huber阈值、λ范围、模板尺寸上下限、迭代次数）需通过小规模验证调整并记录。最终按指定输出格式为目标经纬点（尤其是26°与52/53/54/57/58°）提供风矢与对应等压面压强及置信度，以便后续可视化与定量比较。",
      "criteria": {
        "task_understanding": {
          "core_goal": "设计并拟合一个自适应多尺度且量化不确定度的云迹风矢估计算法，并将风矢归属到temp3.mat的等压面同时进行视差校正与质量评估",
          "expected_output": "面向经纬网格的风矢列表（起点纬度、经度、方向[北顺时针度]、速度[m/s]）、对应等压面压强[毫巴]、不确定度σ_v与质量指标（NCC峰值/峰值比、前后向误差、残差、局部纹理），以及指定点(26°,52/53/54/57/58°E)的详细结果；可选矢量场文件与可视化叠加",
          "key_inputs_constraints": "输入：IR1_2030.mat/IR1_2100.mat/IR1_2130.mat灰度矩阵；k_temp.txt亮温查表；temp3.mat（36层温度与压强）；像素↔经纬映射函数。约束：时间间隔Δt=1800s；需进行亮温转换、金字塔多尺度、稀疏+稠密融合、前后向一致性；地理测地距离与方位按椭球。前置：子任务1完成几何映射与无效像元标记；坐标系约定与单位一致；数值阈值固定并记录。",
          "modeling_type": "拟合+评价+仿真",
          "role_in_pipeline": "作为云导风核心计算环节，位于几何定位/亮温定标之后（依赖子任务1与2的映射与基线流程），其输出供后续可视化叠加、定量比较与报告统计；前序：像素→经纬、亮温、数据清洗；后序：风矢绘制与统计、与固定窗口方法对比、报告生成",
          "assumptions": "temp3.mat提供全球规则网格的温度剖面与对应压强层；亮温近似等于云顶有效温度；视差校正以等压面近似云顶高度；地面风切变影响忽略；使用WGS-84等效椭球参数与题设一致"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "亮温→等压面匹配与视差校正需求识别",
              "description": "是否明确本任务需用k_temp将灰度转亮温，并用temp3.mat匹配得到压强p_c进而做云顶高度与视差校正以影响经纬定位与风矢计算",
              "score": 35,
              "evaluation_focus": "问题界定",
              "scoring_hint": "高分：清晰列出亮温匹配→p_c→h_cld→视差链路并说明对位移的影响；中分：提到p_c或视差但无因果细节；低分：未提及或混淆压强与高度"
            },
            {
              "sub_criteria": "多尺度与自适应窗口的必要性",
              "description": "是否识别固定16×16/64×64不足，需金字塔先验与纹理自适应模板和搜索半径以覆盖多尺度流场",
              "score": 25,
              "evaluation_focus": "建模思维",
              "scoring_hint": "高分：给出为何大位移/弱纹理需要自适应与金字塔；中分：仅泛述多尺度；低分：继续固定窗口"
            },
            {
              "sub_criteria": "不确定度与质量指标的输出",
              "description": "是否强调输出σ_v、NCC峰值/峰值比、前后向误差、残差等以量化可信度并用于筛选",
              "score": 20,
              "evaluation_focus": "评价指标",
              "scoring_hint": "高分：列出≥3项指标并说明阈值用途；中分：仅1–2项指标；低分：无质量/不确定度"
            },
            {
              "sub_criteria": "地理测地量与方向定义（北顺时针）",
              "description": "是否识别需用椭球测地距离/方位角并规范方向为从正北顺时针[0,360)",
              "score": 20,
              "evaluation_focus": "规范意识",
              "scoring_hint": "高分：明确椭球距离与方位定义；中分：球面或未定义方向制；低分：像素位移直接当速度"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "核心目标复述（自适应多尺度云迹风矢拟合）",
              "description": "是否将“自适应+多尺度+不确定度”的风矢估计及等压面归属与视差校正完整复述",
              "score": 35,
              "evaluation_focus": "沟通表达",
              "scoring_hint": "高分：完整覆盖四要素；中分：缺1项；低分：偏离或仅泛述风场计算"
            },
            {
              "sub_criteria": "输入输出与指定点需求复述",
              "description": "是否准确列出三时刻影像、k_temp、temp3、映射函数为输入，输出含指定(26°,52/53/54/57/58)结果",
              "score": 35,
              "evaluation_focus": "需求把握",
              "scoring_hint": "高分：点名五个坐标并要求详细报告；中分：提到指定点但不全；低分：忽略指定点"
            },
            {
              "sub_criteria": "时序与一致性约束",
              "description": "是否说明利用2030/2100/2130的前后向一致性检验以提升可靠性",
              "score": 30,
              "evaluation_focus": "约束理解",
              "scoring_hint": "高分：描述前后向误差阈值用于筛选；中分：仅提一致性无细节；低分：未提"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "亮温代表云顶温度与等压面近似",
              "description": "是否清楚声明亮温≈云顶温度，p_c来自与temp3剖面最近匹配/插值，并给出不确定度估算方法",
              "score": 30,
              "evaluation_focus": "假设合理性",
              "scoring_hint": "高分：给出层间插值与温差驱动的不确定度；中分：仅亮温≈云顶；低分：无说明或错误对应"
            },
            {
              "sub_criteria": "静力学高度估计与椭球模型",
              "description": "是否假设静力学近似/标准大气求h_cld，并使用WGS-84等效椭球用于测地",
              "score": 25,
              "evaluation_focus": "物理假设",
              "scoring_hint": "高分：给出p–z关系与椭球选择；中分：仅说标准大气；低分：忽略或用平面距离"
            },
            {
              "sub_criteria": "多尺度先验与纹理自适应规则",
              "description": "是否设定模板尺寸、搜索半径与金字塔层数的自适应规则与边界（如8–48像素、3–5层）",
              "score": 25,
              "evaluation_focus": "策略设定",
              "scoring_hint": "高分：量化范围与基于纹理/先验位移的函数；中分：口头“自适应”；低分：无规则"
            },
            {
              "sub_criteria": "一致性与阈值设定",
              "description": "是否给出前后向误差阈值（如<2像素）、NCC>0.6、峰值比阈值等用于筛除",
              "score": 20,
              "evaluation_focus": "阈值选择",
              "scoring_hint": "高分：列出≥2个数值阈值；中分：仅描述不量化；低分：无阈值"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "亮温–剖面匹配与p_c/σ_p建模",
              "description": "构建层间线性插值选择p_c及由相邻层温差/梯度推导压强不确定度的模型",
              "score": 25,
              "evaluation_focus": "数理推导",
              "scoring_hint": "高分：明确插值与σ_p来源；中分：仅最近层；低分：无方法"
            },
            {
              "sub_criteria": "视差校正几何与射线–椭球(外扩h_cld)交点",
              "description": "建立用h_cld外扩椭球并重新求交得到云顶经纬的几何模型",
              "score": 25,
              "evaluation_focus": "几何建模",
              "scoring_hint": "高分：给出At^2+Bt+C=0形式与取正小根；中分：只说校正；低分：未校正"
            },
            {
              "sub_criteria": "多尺度先验+稀疏特征+变分光流融合",
              "description": "在金字塔上用相位/互相关估先验，SIFT/ORB+RANSAC得稀疏约束，构建Huber数据项+TV/Huber平滑的能量函数",
              "score": 30,
              "evaluation_focus": "算法设计",
              "scoring_hint": "高分：清楚三者融合与正则；中分：两者其一；低分：仅单一方法"
            },
            {
              "sub_criteria": "不确定度σ_pix→σ_v传播与质量指标定义",
              "description": "从残差/Hessian与前后向误差估计σ_pix并经测地映射到σ_v，同时定义NCC峰值、峰值比、局部方差",
              "score": 20,
              "evaluation_focus": "误差分析",
              "scoring_hint": "高分：给出传播关系与多指标；中分：仅σ_v或单指标；低分：无不确定度"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "金字塔与搜索半径自适应实现",
              "description": "实现3–5层金字塔，搜索半径基于先验位移与纹理指标动态设定，避免过度或不足搜索",
              "score": 25,
              "evaluation_focus": "算法实现",
              "scoring_hint": "高分：层数、缩放与半径公式明确；中分：金字塔无自适应；低分：无金字塔"
            },
            {
              "sub_criteria": "稀疏匹配与RANSAC稳健化",
              "description": "实现ORB/SIFT特征匹配并用RANSAC去除离群，输出稀疏位移及置信区间",
              "score": 20,
              "evaluation_focus": "鲁棒估计",
              "scoring_hint": "高分：RANSAC参数与内点率报告；中分：匹配无稳健；低分：无特征匹配"
            },
            {
              "sub_criteria": "变分光流数值求解与收敛",
              "description": "采用多尺度Gauss-Newton/迭代更新，Huber/TV正则，10–30次每层，含终止条件与线性化细节",
              "score": 30,
              "evaluation_focus": "数值优化",
              "scoring_hint": "高分：给出迭代次数、步长/终止准则；中分：泛述光流；低分：无求解细节"
            },
            {
              "sub_criteria": "前后向一致性与筛选阈值应用",
              "description": "计算forward-backward误差、NCC阈值、峰值比阈值并用于剔除/标注低置信",
              "score": 25,
              "evaluation_focus": "质量控制",
              "scoring_hint": "高分：列出阈值与实际筛除策略；中分：仅报告误差；低分：未使用一致性"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "数据管线与模块化（k_temp、temp3、映射）",
              "description": "是否实现清晰的模块：亮温转换、剖面插值、几何映射、视差校正、测地计算，接口明确可复用",
              "score": 25,
              "evaluation_focus": "代码结构",
              "scoring_hint": "高分：模块分离与单元测试/断言；中分：函数化但耦合；低分：脚本堆叠"
            },
            {
              "sub_criteria": "性能与向量化/并行化",
              "description": "关键环节（互相关/光流/射线求交）向量化或并行，处理大幅面图像时效率可接受",
              "score": 25,
              "evaluation_focus": "性能工程",
              "scoring_hint": "高分：用NumPy/FFT/OpenCV并报告耗时；中分：部分向量化；低分：全循环缓慢"
            },
            {
              "sub_criteria": "数值稳定性与边界/无效值处理",
              "description": "二次方程判别式容差、迭代收敛阈值、NaN/-1像元、边界越界、单位与角度规范均有防护",
              "score": 25,
              "evaluation_focus": "鲁棒性",
              "scoring_hint": "高分：显式阈值与单元用例；中分：零散处理；低分：常见崩溃/NaN传播"
            },
            {
              "sub_criteria": "输出规范与指定点报告",
              "description": "生成包含纬度、经度、方向、速度、p_c、σ_v与质量指标的结构化文件，并单独报告(26°,52/53/54/57/58°E)",
              "score": 25,
              "evaluation_focus": "可用性",
              "scoring_hint": "高分：CSV/JSON规范且字段齐全；中分：字段不全；低分：无指定点结果"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "风矢与等压面合理性检查",
              "description": "检查速度量级、方向连续性、p_c分布是否与区域气候常识一致（如副热带急流、季风带）",
              "score": 30,
              "evaluation_focus": "结果验证",
              "scoring_hint": "高分：定性+定量阈值（速度分布、方向散度）；中分：仅定性；低分：无检查"
            },
            {
              "sub_criteria": "不确定度与质量指标解读",
              "description": "分析σ_v与NCC/峰值比/前后向误差的空间分布，阈值对留存率与错误率的影响",
              "score": 25,
              "evaluation_focus": "不确定性",
              "scoring_hint": "高分：给出留存率、平均σ_v；中分：描述趋势；低分：未分析"
            },
            {
              "sub_criteria": "与固定窗口基线对比（定量）",
              "description": "对比非零矢数量、平均NCC、前后向误差、速度偏差，展示自适应方法改进幅度",
              "score": 25,
              "evaluation_focus": "对比评估",
              "scoring_hint": "高分：≥3项指标与百分比改进；中分：1–2项；低分：无对比"
            },
            {
              "sub_criteria": "指定点(26°,52/53/54/57/58°E)详解",
              "description": "逐点报告方向、速度、p_c与σ_v，并解释差异来源（纹理、视差、高度）",
              "score": 20,
              "evaluation_focus": "案例分析",
              "scoring_hint": "高分：五点齐全且解释充分；中分：缺项或无解释；低分：未报告"
            }
          ]
        }
      }
    },
    "4": {
      "subtask": "子任务 4（不确定度量化、质量控制、验证和产品输出）的目标是对每个计算得到的风矢及其对应等压面值提供定量的不确定度估计、统一的质量控制（QC）判据、标准化的数据与图形产品输出格式，并给出可重复的验证与敏感性测试流程；该子任务的输入为每个矢量的原始匹配信息（像素位移及其残差、NCC/相关峰值与峰值比、前向—后向匹配误差、模板局部方差/结构张量等）、像素角步进（Δ，弧度）、对应位置的经纬（φ）、图像时间间隔 Δt 以及用于亮温→等压面反演时的温度剖面数据（用于估算压强匹配残差）；实现应按以下步骤严格执行并输出规定字段：1) 像素误差到速度误差的传播——从匹配过程得到的亚像素拟合误差 σ_pix（像素单位，来自二次拟合或残差统计）先转换为角度不确定度 σ_angle = σ_pix × Δ（弧度），再用局部曲率半径将角度不确定度转换为经向/纬向米单位误差：σ_lon = R_east(φ)·cosφ·σ_angle, σ_lat = R_north(φ)·σ_angle（其中 R_north, R_east 由椭球参数计算），水平位移不确定度 σ_dist = sqrt(σ_lon^2 + σ_lat^2)，速度不确定度即 σ_v = σ_dist / Δt；2) 等压面（压强）不确定度估算——用亮温与同点温度剖面插值的残差 δT 来估计压强不确定度：在剖面邻近层以有限差分近似求 dT/dp（K/mbar），若 |dT/dp| 足够大则 σ_p ≈ δT / |dT/dp|，若梯度接近零则标为高不确定度或采用蒙特卡洛法（见下）；3) 联合不确定度与蒙特卡洛校验——当需估计联合不确定度或非线性耦合效应时，对像素位置误差（以高斯分布 N(0,σ_pix) 为模型）与亮温测量误差/剖面误差联合进行蒙特卡洛采样（典型 1000 次），将每次扰动后的位移与压强重算以得到速度与压强的经验置信区间（例如 95% 区间）；4) 质量控制判据与置信度评分——为每个矢量计算并存储关键质量指标：NCC_peak、peak_ratio（第一/第二峰比）、forward_back_error（像素或米）、local_variance、residual_RMS 与蒙特卡洛样本的 σ_v、σ_p；基于这些量构建规范化置信度分数 conf∈[0,1]（例如 conf = w1·norm(NCC_peak) + w2·norm(peak_ratio) + w3·(1 − norm(forward_back_error)) + w4·norm(local_variance) ，权重 wi 可默认设置并记录），并按阈值（示例：NCC_peak<0.5 或 peak_ratio<1.2 或 forward_back_error>2 pixels → 标记为低置信/剔除；conf<0.4 → 标记为可疑）进行自动标签；5) 场内一致性与异常剔除——执行空间一致性检测：在每个矢量的邻域（例如 3×3 或 5×5）计算速度向量的中位数和 MAD，若某矢量与邻域中位数偏差超过设定倍数（例如 3×MAD）且自身质量低，则把该点替换为缺测或用邻域加权平滑值填补；同时进行时间一致性检查（若有多时刻结果）：检验相邻时间步的速度变化是否在物理可接受范围内，异常点标注并记录。6) 统计汇总与诊断输出——计算并保存总体与分区统计量：非零矢总数、按纬带/经度带的速度均值/中位/标准差、方向玫瑰图数据、置信度分布、剔除率及剔除原因分布；同时生成诊断图表（速度直方图、置信度累计分布、空间分布的误差热图）以便快速评估产品质量。7) 规范化产品文件与可视化要求——数值输出采用逗号分隔文本或 CSV（并同时提供 GeoJSON 或 netCDF 以便 GIS/后续处理），每条非零矢记录至少包含字段： latitude_deg, longitude_deg, direction_deg_clockwise_from_North, speed_m_per_s, pressure_mbar, sigma_speed_m_per_s, sigma_pressure_mbar, NCC_peak, peak_ratio, forward_back_error_pixels, local_variance, confidence_score, qc_flag（OK/LOW_CONF/REJECT）; 同时生成可视化产品：一幅带有速度矢量叠加的卫星云图（矢量颜色或粗细按速度档分类：0–20、20–40、>40 m/s，矢量透明度或颜色饱和度按 confidence_score 显示），并保存为 PDF/JPEG，另生成单独的风矢图（winsp）及图例说明三类速度符号和置信度编码；8) 验证与敏感性测试流程——规定必须执行的验证步骤：前向—后向一致性统计、邻域平滑一致性检验、用蒙特卡洛产生的置信区间评估主要不确定来源占比，并做参数敏感性试验（改变模板大小、搜索半径、NCC 阈值与光流正则化强度等若干组合）并记录关键输出指标（非零矢数量、平均速度、剔除率与平均置信度）的变化；当存在独立参考数据（探空、雷达或同格局数值预报）时计算偏差与 RMSE、偏差分布并在报告中列出。9) 实现与工具建议——建议使用可复现且广泛可用的软件栈：Python（NumPy, SciPy, pandas）、OpenCV（计算相关峰、特征检测）、pyproj/GeographicLib（经纬与米转换）、matplotlib/Cartopy（绘图）、并行化（multiprocessing 或 GPU）以加速蒙特卡洛与批量误差传播；所有阈值、权重与配置参数应写入可版本化的配置文件并在输出元数据中记录以保证可重复性。10) 错误与缺测处理——明确缺测编码（例如 NaN 或 qc_flag=REJECT），对连续缺测区域输出掩膜并在产品元数据中说明缺测原因统计。按上述步骤完成的产品应包含：主数据表（CSV/GeoJSON/netCDF）、置信度与 QC 报告（JSON 或文本）、诊断图表包（PDF）及交互式或静态地图图像；所有输出文件在元数据中注明生成参数、时间戳和软件环境信息以便审计和复现。",
      "criteria": {
        "task_understanding": {
          "core_goal": "对云迹风矢与等压面结果进行不确定度量化与质量控制评估，并输出标准化产品与验证报告",
          "expected_output": "包含每条风矢的CSV/GeoJSON/netCDF（字段含speed、direction、pressure、sigma_speed、sigma_pressure、NCC_peak、peak_ratio、forward_back_error、local_variance、confidence、qc_flag），QC与置信度报告JSON/文本，诊断图表PDF，以及叠加矢量的云图PDF/JPEG",
          "key_inputs_constraints": "输入需包含：亚像素拟合误差σ_pix（像素）、像素角步进Δ（弧度）、地理纬度φ、时间间隔Δt（秒）、NCC_peak与peak_ratio、forward_back_error（像素或米）、local_variance/结构张量、亮温与剖面差δT及剖面用于计算dT/dp；需使用椭球R_north(φ), R_east(φ)；阈值与权重需可配置且记录；缺测需有统一编码",
          "modeling_type": "评价",
          "role_in_pipeline": "作为最终质量评估与产品生成环节；前序依赖子任务2/3的风矢与等压面反演以及子任务1的几何映射；后序提供给可视化发布与对外数据服务。若进行敏感性试验需回调前序算法参数。",
          "assumptions": "若未提供R_north/R_east实现，可用WGS-84椭球近似公式计算；若剖面dT/dp在局部接近0，采用高不确定度标记并可选用蒙特卡洛估计。"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "不确定度传播（σ_pix→σ_v）识别",
              "description": "明确从亚像素误差σ_pix经角度Δ到R_north/R_east下的米制位移与速度σ_v的误差传播路径，并指出纬向需乘cosφ。",
              "score": 35,
              "evaluation_focus": "建模思维",
              "scoring_hint": "高分：给出σ_angle=σ_pix·Δ，σ_lon=R_east·cosφ·σ_angle，σ_lat=R_north·σ_angle，σ_v=√(σ_lon²+σ_lat²)/Δt；中分：缺少cosφ或只给球半径；低分：仅口述不确定度无公式。"
            },
            {
              "sub_criteria": "等压面不确定度（δT与dT/dp）识别",
              "description": "指出用亮温-剖面残差δT与剖面梯度dT/dp估计压强不确定度σ_p的必要性，并识别梯度接近零的风险。",
              "score": 25,
              "evaluation_focus": "建模思维",
              "scoring_hint": "高分：提出σ_p≈|δT|/|dT/dp|及小梯度退化方案；中分：只提到δT影响未给公式；低分：未识别温度剖面对σ_p的作用。"
            },
            {
              "sub_criteria": "质量控制（NCC_peak/peak_ratio/FB误差）关键指标",
              "description": "识别需用NCC_peak、peak_ratio、forward_back_error与local_variance进行QC并设置阈值。",
              "score": 25,
              "evaluation_focus": "评价标准",
              "scoring_hint": "高分：列出阈值示例如NCC_peak≥0.6、peak_ratio≥1.2、FB≤2像素；中分：提到指标未量化；低分：未提及关键指标。"
            },
            {
              "sub_criteria": "空间一致性与敏感性测试需求",
              "description": "识别必须进行邻域MAD异常检测与参数敏感性试验（模板、搜索半径、NCC阈值、正则强度）。",
              "score": 15,
              "evaluation_focus": "验证设计",
              "scoring_hint": "高分：明确3×3/5×5与3·MAD规则与参数列表；中分：只提到一致性或敏感性之一；低分：无相关内容。"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "核心目标复述（评估+输出）",
              "description": "用任务术语复述：评估云迹风矢与等压面不确定度、执行QC并生成标准化产品（CSV/GeoJSON/netCDF与PDF/JPEG）。",
              "score": 30,
              "evaluation_focus": "表达准确",
              "scoring_hint": "高分：同时覆盖σ_v、σ_p、QC、conf与产品格式；中分：缺少一种输出或不确定度项；低分：偏离评估与产品生成。"
            },
            {
              "sub_criteria": "输入约束复述（Δ、φ、Δt、σ_pix、NCC）",
              "description": "准确陈述依赖的Δ、φ、Δt、σ_pix、NCC_peak/peak_ratio、FB误差、δT与dT/dp。",
              "score": 25,
              "evaluation_focus": "需求对齐",
              "scoring_hint": "高分：逐项列明并说明用途；中分：遗漏1–2项；低分：泛泛而谈。"
            },
            {
              "sub_criteria": "QC标签与conf规则复述",
              "description": "复述conf∈[0,1]构成与qc_flag规则（OK/LOW_CONF/REJECT）。",
              "score": 25,
              "evaluation_focus": "规则理解",
              "scoring_hint": "高分：包含权重法或归一化说明与阈值示例；中分：仅有定性描述；低分：无明确规则。"
            },
            {
              "sub_criteria": "验证与诊断输出复述",
              "description": "复述需要前后向一致性统计、邻域一致性、速度直方图、置信度分布与误差热图。",
              "score": 20,
              "evaluation_focus": "验证梳理",
              "scoring_hint": "高分：列出≥3个诊断图和两类一致性；中分：仅一种；低分：未涉及。"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "椭球半径R_north/R_east近似假设",
              "description": "明确采用WGS-84公式或等效近似计算R_north(φ), R_east(φ)并说明适用范围。",
              "score": 30,
              "evaluation_focus": "数理假设",
              "scoring_hint": "高分：给出计算式或引用并说明误差级别；中分：仅称使用椭球；低分：默认球体无说明。"
            },
            {
              "sub_criteria": "δT与dT/dp线性化假设",
              "description": "说明σ_p≈|δT|/|dT/dp|基于局部线性，遇到|dT/dp|≈0时退化为高不确定度或MC估计。",
              "score": 30,
              "evaluation_focus": "误差建模",
              "scoring_hint": "高分：提出阈值与备选MC；中分：仅提线性；低分：无处理。"
            },
            {
              "sub_criteria": "σ_pix与观测误差分布假设",
              "description": "假定σ_pix为高斯且独立，用于蒙特卡洛采样与误差传播，并说明样本量（≥1000）。",
              "score": 25,
              "evaluation_focus": "不确定度",
              "scoring_hint": "高分：阐明N与收敛标准；中分：给分布无样本量；低分：未定义分布。"
            },
            {
              "sub_criteria": "QC阈值与权重可配置性假设",
              "description": "假设阈值/权重来自配置文件并在元数据记录，支持复现实验。",
              "score": 15,
              "evaluation_focus": "工程假设",
              "scoring_hint": "高分：指明配置与元数据内容；中分：仅提可配置；低分：硬编码或未提。"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "误差传播模型（σ_pix→σ_angle→σ_v）",
              "description": "构建从像素到速度的不确定度方程，含cosφ、R_north/R_east与Δt。",
              "score": 35,
              "evaluation_focus": "数理推导",
              "scoring_hint": "高分：公式完整并单位一致；中分：缺一项或单位未核；低分：无可执行公式。"
            },
            {
              "sub_criteria": "压强不确定度模型（σ_p）",
              "description": "建立σ_p=|δT|/|dT/dp|及小梯度下的替代（MC或上界标记）。",
              "score": 25,
              "evaluation_focus": "数理推导",
              "scoring_hint": "高分：含稳定性讨论；中分：仅线性；低分：缺失。"
            },
            {
              "sub_criteria": "置信度评分模型（conf）",
              "description": "构建归一化并加权的conf∈[0,1]，使用NCC_peak、peak_ratio、FB误差、local_variance等。",
              "score": 25,
              "evaluation_focus": "算法设计",
              "scoring_hint": "高分：说明归一化与权重、阈值；中分：仅线性组合；低分：模糊打分。"
            },
            {
              "sub_criteria": "空间一致性与异常检测（MAD）",
              "description": "建立基于邻域中位数与MAD的异常剔除/替换策略。",
              "score": 15,
              "evaluation_focus": "鲁棒性",
              "scoring_hint": "高分：给出3·MAD与窗口大小；中分：仅说平滑；低分：无机制。"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "蒙特卡洛联合不确定度实现",
              "description": "实现对σ_pix与亮温/剖面误差的MC采样（≥1000次），输出速度与压强95%区间。",
              "score": 35,
              "evaluation_focus": "数值计算",
              "scoring_hint": "高分：报告置信区间与收敛检验；中分：样本少或无区间；低分：未实现MC。"
            },
            {
              "sub_criteria": "QC阈值与标签判定",
              "description": "按NCC_peak、peak_ratio、FB误差和conf阈值生成qc_flag（OK/LOW_CONF/REJECT）。",
              "score": 25,
              "evaluation_focus": "规则执行",
              "scoring_hint": "高分：阈值清晰且统计剔除率；中分：阈值不全；低分：无一致标签。"
            },
            {
              "sub_criteria": "空间一致性修正与缺测处理",
              "description": "执行邻域检验并对异常点置NaN或邻域加权填补，输出缺测掩膜与原因统计。",
              "score": 25,
              "evaluation_focus": "稳健求解",
              "scoring_hint": "高分：提供掩膜与原因分布；中分：仅置NaN；低分：忽略异常。"
            },
            {
              "sub_criteria": "统计汇总与诊断生成",
              "description": "计算非零矢总数、按纬带统计、方向玫瑰数据、置信度分布与误差热图。",
              "score": 15,
              "evaluation_focus": "结果产出",
              "scoring_hint": "高分：≥4类统计；中分：2–3类；低分：无系统统计。"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "误差传播与椭球半径计算正确性",
              "description": "代码正确计算R_north/R_east与σ_v，单位一致，包含cosφ与Δt。",
              "score": 30,
              "evaluation_focus": "代码可靠性",
              "scoring_hint": "高分：单元测试或数值对拍；中分：有实现无测试；低分：单位或公式错误。"
            },
            {
              "sub_criteria": "QC与conf可配置与可追溯",
              "description": "阈值/权重读取自配置文件，并写入输出元数据（时间戳、版本、参数）。",
              "score": 25,
              "evaluation_focus": "工程化",
              "scoring_hint": "高分：含配置与元数据；中分：硬编码但记录；低分：不可追溯。"
            },
            {
              "sub_criteria": "蒙特卡洛并行与性能",
              "description": "MC实现具并行或向量化，采样数可调，运行在合理时间内。",
              "score": 20,
              "evaluation_focus": "性能工程",
              "scoring_hint": "高分：并行/矢量化且可控N；中分：串行但可运行；低分：不可用或极慢。"
            },
            {
              "sub_criteria": "标准化产品输出与绘图",
              "description": "输出CSV/GeoJSON/netCDF与PDF/JPEG图，字段完整且示例可视化正确映射速度分档与conf。",
              "score": 25,
              "evaluation_focus": "产物合规",
              "scoring_hint": "高分：字段齐全、图例正确；中分：缺少一种格式或图例；低分：输出不规范。"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "不确定度与置信度分布解读",
              "description": "解读σ_v、σ_p与confidence_score的空间分布与主要来源。",
              "score": 30,
              "evaluation_focus": "结果解释",
              "scoring_hint": "高分：定位主因（纹理、视角、dT/dp）；中分：泛泛描述；低分：无解释。"
            },
            {
              "sub_criteria": "验证与一致性统计",
              "description": "报告前后向一致性、邻域一致性与剔除率，并对异常点给出示例分析。",
              "score": 25,
              "evaluation_focus": "验证能力",
              "scoring_hint": "高分：量化指标齐全；中分：部分指标；低分：无统计。"
            },
            {
              "sub_criteria": "敏感性试验对关键指标影响",
              "description": "分析模板/搜索半径/NCC阈值/正则强度变化对非零矢数量、平均速度、剔除率、平均conf的影响。",
              "score": 25,
              "evaluation_focus": "稳健性评估",
              "scoring_hint": "高分：表格或图示对比≥2参数维度；中分：单参数；低分：未做。"
            },
            {
              "sub_criteria": "产品完整性与可复现性说明",
              "description": "检查输出文件、元数据、缺测掩膜、图表是否齐全且可复现（参数记录）。",
              "score": 20,
              "evaluation_focus": "可复现性",
              "scoring_hint": "高分：列出清单与复现实验步骤；中分：部分缺失；低分：不完整。"
            }
          ]
        }
      }
    }
  }
}
{
  "task_id": "2009_B",
  "problem": "1. 在光学设备上采集弹头上痕迹的3维数据时，用于采集数据的光源和数据采集仪器是固定不动的，光源在被测弹头的侧上方，感光器在弹头的正上方；弹头由人工固定在支架上，可以由人工调节该弹头的位置和姿态（姿态是指弹头在空间的姿势或状态，通常与转动有关）。人工调节很难使两个弹头在同样位置和同样姿态情况下被测量，从而会造成测量误差。通常会造成0.03mm左右的平移误差和$0.2^{\\circ}$的转动误差。第一个问题是：如何处理由位置和姿态造成的测量误差，使得两个弹头可以尽量在相同位置和相同姿态的情况下进行比对。（这里假设弹头的直径为7.90mm，长度约为12mm）\n\n2. 弹头表面的损伤、锈迹、油斑、杂质物及痕迹生成的随机性，会造成数据误差和噪声。第二个问题是：采取怎样的方法去消除这些误差和噪声。\n\n3. 文件名以77开头的12个文件分别是6支枪发射的12个弹头（每支枪发射2个弹头）的次棱部分的测量数据,每个文件包含有4个以c开头的次棱数据子文件。 数据文件名中的t1和t2分别表示对应同一支枪的2个弹头，其他数字是枪支的编号；子文件名中的c1，c2，c3，c4分别为同一个弹头的4个次棱按固定顺序的编号。第三个问题是：\n\n依据这些数据，你们认为怎样的特征可以用于比对；并给出提取这些特征的方法。\n\n依据这些数据，你们认为采用数据的哪一部分用作比对，其效果比较好。\n\n给出完整的比对方案、算法，并在电子版附件中给出程序。\n\n4. 文件名以t开头的22个文件分别是另外11支枪发射的22个弹头（每支枪发射2个弹头）次棱部分的测量数据，每个文件包含有4个以c开头的次棱数据子文件，子文件名中的c1，c2，c3，c4的意义同上。第四个问题是：请你们，\n\n（1） 用解决第三个问题的方法给出这22个弹头痕迹两两之间的相似程度，并列表表示；\n\n（2） 根据（1）的结果，用列表的方式给出每个弹头按相似度由高到低给出与之相似的前5位的弹头文件号。",
  "subtask": {
    "1": {
      "subtask": "子任务1（几何归一化与三维到二维展开）的目标是将每个次棱的原始三维点云从独立测量坐标系精确归一化到以弹头圆柱轴线为基准的局部坐标系，并在该坐标系下把点云展开成规则的θ–z高度图与相应的置信权重图，以消除由人工装夹导致的大约±0.03 mm平移和±0.2°小角度旋转的测量误差并为后续比对提供统一基准；该任务的输入为单个次棱的三列(x,y,z)点坐标（采样步长2.75 μm，z精度约1 μm），输出应包括：拟合得到的圆柱参数（轴线点p0、单位方向u、半径R）、保存刚体变换矩阵、每点沿轴向的坐标z_i与圆周角θ_i以及高度残差h_i、基于规则网格的高度图H(θ,z)、权重/采样密度图W(θ,z)、有效性掩膜M(θ,z)和拟合残差统计用于质量控制。实现步骤和方法应包括：1) 初步预处理——读取原始点云并剔除远离点集中心的显著离群点（例如基于距离或局部密度阈值）；2) 轴向方向初值估计——对点云做主成分分析(PCA)以获得轴线方向u0与中心点p0_0作为优化初始值；3) 鲁棒圆柱拟合——采用RANSAC筛选内点以抵抗局部污染，再在内点上以带先验正则化的非线性最小二乘优化精拟合圆柱参数，最小化目标为∑( ||(x_i−p0)−((x_i−p0)·u)u|| − R )^2 + α (R−R0)^2，约束||u||=1（R0取已知先验半径约3.95 mm），参数化u（例如用球面角或在每次迭代后归一化）并用Levenberg–Marquardt或scipy.optimize.least_squares实现；4) 点到圆柱坐标映射——对所有点计算轴向坐标z_i=(x_i−p0)·u、局部正交基(v1,v2)以得到θ_i=atan2((x_i−p0)·v2,(x_i−p0)·v1)并计算径向残差h_i=||(x_i−p0)−z_i u||−R；5) 网格参数确定与插值——以原始采样步长Δs=2.75 μm和拟合半径R计算角度步长Δθ=Δs/R并取轴向步长Δz=2.75 μm，定义θ和z的覆盖范围并在该规则格点上用加权插值（例如带权重的双线性或三次样条插值）将离散(h_i,θ_i,z_i)投影生成高度图H，并同时计算每格的采样计数和到近邻点的平均距离以形成权重图W；6) 置信度与有效性记录——基于RANSAC内点标识、插值时的采样密度与点到网格距离阈值生成二值有效性掩膜M，记录每像素的原始点索引映射以便可视化与逆映射；7) 精细化刚体修正与质量评估——若需要，允许在θ方向（周期性环向）和z方向上做小幅度刚体调整以最小化高度残差，计算并保存残差的统计量（均值、RMS、MAD及直方图）并在残差超出预设质量阈值时标注该次棱为拟合失败或需人工复核。实现建议使用Matlab或Python生态（numpy/scipy、scikit-learn用于PCA与RANSAC、scipy.optimize用于非线性最小二乘、可选的C/C++或GPU加速用于大数据插值与网格化），并保证输出文件包括拟合参数、变换矩阵、规则高度图H、权重图W、有效性掩膜M及残差报告，以便后续独立模块直接使用。",
      "criteria": {
        "task_understanding": {
          "core_goal": "拟合圆柱参数并进行几何归一化：将单个次棱的三维点云通过PCA初值、RANSAC+正则化非线性最小二乘拟合圆柱(得到p0,u,R)并保存刚体变换，展开为θ–z高度图H(θ,z)及权重图W和有效性掩膜M，同时评估残差和质量。",
          "expected_output": "数值文件：圆柱参数(p0,u,R)与刚体变换矩阵；数组/图像：高度图H(θ,z)、权重/密度图W(θ,z)、有效性掩膜M(θ,z)；点云到圆柱坐标表(z_i,θ_i,h_i)及原始点索引映射；残差统计报表（均值、RMS、MAD、直方）；可复现的代码与运行示例。",
          "key_inputs_constraints": "1) 输入数据：单个次棱点云，列格式(x,y,z)浮点数，采样步长Δs=2.75μm，z精度≈1μm；2) 先验约束：半径先验R0≈3.95mm，可作为正则化中心；3) 测量误差范围：人工装夹导致约±0.03mm平移和±0.2°旋转；4) 点云规模：每子文件可达数十万点，需考虑内存与计算效率；5) 点云可能包含显著离群点、局部污染与不连续区域。",
          "modeling_type": "拟合+预处理（归一化与投影/网格化）",
          "role_in_pipeline": "作为特征工程前的几何归一化子模块，输入为原始次棱点云（依赖前序数据采集与初步数据读取/格式化），输出为统一基准下的θ–z高度图与置信权重，供后续特征提取/比对模块使用；直接依赖：点云预处理；后续依赖：特征提取、相似度比对。"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "识别平移与旋转测量误差(±0.03mm,±0.2°)",
              "description": "明确指出人工装夹引入的平移和小角度旋转误差对点云对齐与圆柱拟合的影响，并量化误差范围。",
              "score": 25,
              "evaluation_focus": "建模思维",
              "scoring_hint": "高分：明确写出±0.03mm和±0.2°并说明对z/θ映射影响；中分：提到平移或旋转但未量化影响；低分：未识别或误差范围显著错误。"
            },
            {
              "sub_criteria": "识别点云污染与离群点问题",
              "description": "识别锈迹、油斑、杂质和测量噪声等造成的局部污染与离群点，并说明需剔除或降权处理。",
              "score": 25,
              "evaluation_focus": "问题分析",
              "scoring_hint": "高分：给出定量污染情形（如异常高h_i或低密度区域），并建议剔除阈值；中分：描述噪声存在但无定量策略；低分：忽视污染影响。"
            },
            {
              "sub_criteria": "识别坐标系不一致与需保存刚体变换矩阵",
              "description": "识别多次测量在不同独立坐标系下，需要估计并保存刚体变换矩阵以实现统一基准的必要性。",
              "score": 25,
              "evaluation_focus": "实现准备",
              "scoring_hint": "高分：明确要求保存刚体变换矩阵并说明格式；中分：提出变换但不强调保存细节；低分：未识别或忽略保存。"
            },
            {
              "sub_criteria": "识别质量控制指标与残差需求",
              "description": "识别必须输出的残差统计（均值、RMS、MAD、直方图）与基于残差的拟合失败/复核标注需求。",
              "score": 25,
              "evaluation_focus": "质量控制",
              "scoring_hint": "高分：列出所有统计量并给出建议阈值（例如RMS≤0.01mm）；中分：列出统计量但无阈值；低分：遗漏主要统计量。"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "复述圆柱拟合目标(得到p0,u,R)",
              "description": "准确复述需通过PCA初值、RANSAC与正则化最小二乘得到圆柱参数p0,u,R，并约束||u||=1且使用R0先验。",
              "score": 25,
              "evaluation_focus": "任务对齐",
              "scoring_hint": "高分：完整复写p0,u,R、PCA初值、RANSAC与正则化目标；中分：描述拟合但遗漏先验或约束；低分：复述不准确或遗漏核心步骤。"
            },
            {
              "sub_criteria": "复述点到圆柱坐标映射(z_i,θ_i,h_i)",
              "description": "清晰写出z_i=(x_i−p0)·u、θ_i用(v1,v2)的atan2定义及径向残差h_i=||...||−R的计算流程。",
              "score": 25,
              "evaluation_focus": "数学表述",
              "scoring_hint": "高分：给出准确公式并说明局部基(v1,v2)构建；中分：给出大致公式但符号或基向量说明不足；低分：公式错误或缺失。"
            },
            {
              "sub_criteria": "复述θ–z网格化与Δθ,Δz的确定",
              "description": "说明以Δs=2.75μm和R计算Δθ=Δs/R，轴向步长Δz=2.75μm，定义θ,z覆盖范围并在规则格点插值生成H。",
              "score": 25,
              "evaluation_focus": "数值网格",
              "scoring_hint": "高分：准确给出Δθ计算并处理θ周期性；中分：提到网格但未说明Δθ来源；低分：未能给出合理网格步长。"
            },
            {
              "sub_criteria": "复述质量掩膜M与权重W的生成原则",
              "description": "重述基于RANSAC内点、采样密度和点到网格距离阈值生成有效性掩膜M及采样密度/平均距离形成权重图W的逻辑。",
              "score": 25,
              "evaluation_focus": "置信记录",
              "scoring_hint": "高分：说明具体阈值与权重计算方法；中分：描述原则但无参数；低分：未说明权重或掩膜生成。"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "假设半径先验R0≈3.95mm并用于正则化",
              "description": "声明并合理化使用R0≈3.95mm作为正则化中心(α权重)以提高拟合稳定性，并说明α选择原则。",
              "score": 30,
              "evaluation_focus": "建模假设",
              "scoring_hint": "高分：给出R0来源并给出α取值范围或交叉验证方法；中分：使用R0但未说明α选取；低分：未使用或R0错误。"
            },
            {
              "sub_criteria": "假设点云为单条连续次棱数据段且采样间距≈2.75μm",
              "description": "说明点云代表单个次棱连续测量块，采样步长Δs=2.75μm用于网格化和Δθ计算，若不连续需额外分段处理。",
              "score": 25,
              "evaluation_focus": "数据假设",
              "scoring_hint": "高分：明确处理不连续情形并说明分段策略；中分：假定连续但无分段策略；低分：忽视不连续问题。"
            },
            {
              "sub_criteria": "假设噪声与离群点模型及RANSAC内点率预期",
              "description": "给出噪声分布假设（例如径向残差近似零均值高斯）及预计离群点比例用于RANSAC参数设定。",
              "score": 25,
              "evaluation_focus": "统计假设",
              "scoring_hint": "高分：给出具体噪声σ估计（例如σ_z≈0.001mm）和离群率上限；中分：给出定性假设；低分：无噪声模型说明。"
            },
            {
              "sub_criteria": "假设测量误差界限以便刚体微调",
              "description": "假设人工装夹误差在±0.03mm/±0.2°内，使得允许进行小幅θ和z方向刚体修正以最小化高度残差。",
              "score": 20,
              "evaluation_focus": "操作假设",
              "scoring_hint": "高分：提供具体微调范围并理由；中分：提到微调但无范围；低分：无相关假设。"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "PCA初值估计轴线(u0)与中心(p0_0)",
              "description": "使用PCA对点云求主方向作为u0并取点云质心或投影质心作为p0_0，说明PCA的实现细节和解释方差比。",
              "score": 30,
              "evaluation_focus": "算法选择",
              "scoring_hint": "高分：提供PCA实现、解释方差>0.9及用于初值的具体代码/公式；中分：描述PCA但无方差阈；低分：未用PCA或实现错误。"
            },
            {
              "sub_criteria": "RANSAC鲁棒圆柱拟合与正则化最小二乘",
              "description": "构建RANSAC筛选内点的流程，随后用带先验α(R−R0)^2的非线性最小二乘(如LM)精拟合圆柱并约束||u||=1（参数化u）。",
              "score": 30,
              "evaluation_focus": "拟合方法",
              "scoring_hint": "High: 明确RANSAC阈值、迭代数、α选择并实现LM收敛；Mid: 有流程但参数未说明；Low: 无鲁棒拟合或仅线性方法。"
            },
            {
              "sub_criteria": "点到圆柱坐标映射与局部正交基(v1,v2)",
              "description": "给出如何构造局部正交基(v1,v2)垂直于u并使用atan2稳定计算θ_i，同时计算z_i与径向残差h_i。",
              "score": 20,
              "evaluation_focus": "坐标变换",
              "scoring_hint": "高分：提供数值稳定的基构造（避免奇异）和周期性处理；中分：方法正确但无数值注意事项；低分：θ计算或基构造存在错误。"
            },
            {
              "sub_criteria": "网格化插值生成H(θ,z)、W(θ,z)和掩膜M",
              "description": "基于Δθ=Δs/R和Δz=2.75μm定义规则格，用加权双线性/三次样条插值填充高度图并统计每格采样计数构造W与二值掩膜M。",
              "score": 20,
              "evaluation_focus": "数值实现",
              "scoring_hint": "高分：正确计算Δθ并处理θ边界、使用加权插值并生成密度图与掩膜；中分：插值实现但忽视周期边界；低分：直接粗糙投票无插值。"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "实现带先验的非线性最小二乘(Levenberg–Marquardt)拟合",
              "description": "实现LM或scipy.optimize.least_squares求解带正则化的最小二乘，参数化u并保证约束||u||=1或每步归一化，记录迭代信息与收敛标准。",
              "score": 30,
              "evaluation_focus": "数值优化",
              "scoring_hint": "高分：提供收敛准则、迭代次数、Jacobian或数值近似并且在实测数据上收敛良好；中分：实现LM但未报告细节；低分：使用不稳定或不收敛方法。"
            },
            {
              "sub_criteria": "RANSAC内点筛选与内点比例报告",
              "description": "在RANSAC中明确内点阈值、最大迭代数，并报告最终内点比例与内点残差分布作为质量依据。",
              "score": 25,
              "evaluation_focus": "鲁棒性",
              "scoring_hint": "高分：给出阈值(例如≤0.05mm)、迭代数并报告内点率>70%或解释低内点率；中分：RANSAC实现但无报告；低分：无RANSAC或无内点统计。"
            },
            {
              "sub_criteria": "插值加权方案与θ周期性数值处理",
              "description": "实现带权插值(基于采样密度或距网格距离)并正确处理θ在0–2π的周期性连接与边界平滑。",
              "score": 25,
              "evaluation_focus": "数值稳定",
              "scoring_hint": "高分：使用加权样条或加权双线性并验证周期连续性；中分：插值但未处理周期；低分：插值导致边界不连续或数值振荡。"
            },
            {
              "sub_criteria": "精细刚体修正(θ,z方向)以最小化高度残差",
              "description": "若需要，实施小幅θ和z方向刚体校正优化以减小整体残差并记录修正量与改进幅度。",
              "score": 20,
              "evaluation_focus": "后处理",
              "scoring_hint": "高分：提供修正前后残差数值改进(如RMS下降>10%)并限制修正在±0.2°/±0.03mm内；中分：有修正但无量化；低分：无或超出合理范围。"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "输出拟合参数与刚体变换矩阵并可复现",
              "description": "代码必须导出p0,u,R、刚体变换矩阵、H,W,M和残差报告，采用通用数据格式(npy/mat/csv)并提供加载示例。",
              "score": 30,
              "evaluation_focus": "可复现性",
              "scoring_hint": "高分：所有文件格式规范、示例脚本能重现并包含版本/依赖；中分：输出齐全无示例；低分：输出不完整或不可加载。"
            },
            {
              "sub_criteria": "性能与可扩展性：支持≥4e5点的点云处理",
              "description": "实现对数十万点点云的内存友好与向量化处理或提供分块/GPU加速方案，并报告典型运行时间与内存占用。",
              "score": 30,
              "evaluation_focus": "工程实现",
              "scoring_hint": "高分：能在合理时间(例如单文件<5min在现代PC)内完成并报告资源；中分：能运行但效率低或无报告；低分：无法处理大文件或频繁崩溃。"
            },
            {
              "sub_criteria": "模块化、测试与文档(README、参数配置)",
              "description": "代码结构清晰模块化，含单元测试/示例输入输出、参数配置文件与使用说明，便于他人复现与调整。",
              "score": 20,
              "evaluation_focus": "代码质量",
              "scoring_hint": "高分：含自动化测试、示例及详细README；中分：有README但无测试；低分：无文档或难以运行。"
            },
            {
              "sub_criteria": "可视化与逆映射工具支持(H/W/M与原点云关联)",
              "description": "提供将高度图像素逆映射回原始点索引的工具及可视化脚本(残差热图、掩膜、采样密度图)。",
              "score": 20,
              "evaluation_focus": "辅助工具",
              "scoring_hint": "高分：有逆映射脚本并能可视化任意像素到原点云；中分：有可视化但无逆映射；低分：无可视化工具。"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "残差统计与直方图报告(均值,RMS,MAD,分位数)",
              "description": "提供h_i残差的均值、RMS、MAD及多个分位数，并绘制残差直方图/热图供质量评估。",
              "score": 35,
              "evaluation_focus": "结果解释",
              "scoring_hint": "高分：报告并解释统计量（RMS≤0.01mm为优）；中分：有统计但无解释或阈值；低分：无残差统计或数据错误。"
            },
            {
              "sub_criteria": "质量判断规则与拟合失败/需复核标注",
              "description": "给出明确的质量阈值和判定规则（例如内点率阈值、RMS阈值、掩膜覆盖率阈值）并标注需人工复核的次棱。",
              "score": 30,
              "evaluation_focus": "质量控制",
              "scoring_hint": "高分：给出可操作阈值(如RMS>0.03mm或内点率<40%触发复核)并统计异常比例；中分：有规则但无阈值；低分：无复核机制。"
            },
            {
              "sub_criteria": "可视化验证与逆映射示例",
              "description": "展示若干样例的H、W、M与原点云的逆映射对比图，验证网格化与插值的正确性与掩膜合理性。",
              "score": 20,
              "evaluation_focus": "可视验证",
              "scoring_hint": "高分：包含数个代表性样例并展示改进或问题点；中分：仅单一示例；低分：无示例或示例不能说明问题。"
            },
            {
              "sub_criteria": "局限性讨论与后续建议(用于比对的注意事项)",
              "description": "讨论模型假设的局限（如不连续点云、局部严重污染）并给出后续比对模块的建议（如权重阈值、掩膜最小覆盖率）。",
              "score": 15,
              "evaluation_focus": "批判性思维",
              "scoring_hint": "高分：具体指出局限并提供可执行建议；中分：泛泛而谈无具体措施；低分：忽略局限与建议。"
            }
          ]
        }
      }
    },
    "2": {
      "subtask": "子任务2（去趋势、噪声与污染分离）目标是：从已按圆柱坐标格化并插值得到的高度图 H(θ,z)（及其对应的采样置信度/权重图 W(θ,z)；采样步长约2.75 μm，z测量精度约1 μm）中，系统性地去除低频基面与姿态趋势、抑制高频测量噪声、识别并标记稀疏污染（锈斑、油污、杂质）与孤立异常点，输出可用于比对的“干净”高度图 L(θ,z)、稀疏异常图 S(θ,z)、二值有效性掩膜 M(θ,z)、每像素置信度图 C(θ,z) 及质量统计报告；为保证可重复性和可调性，应按如下明确步骤和方法实现：首先对每一行/列或二维上估计低频基线并从原始高度图中去除（可选方法：沿轴向对每一θ做低阶多项式拟合（2–3次）或在二维上用高斯低通卷积，建议低通半径依据待保留条纹的空间频率设定，通常选取能滤掉大尺度曲率但保留毫米及以下尺度特征的尺度），产生去趋势矩阵 D = H − baseline；其次以鲁棒低秩 + 稀疏分解分离污染与背景，即求解 D = L + S 的优化问题 min ||L||_* + λ||S||_1（对大矩阵用增广拉格朗日/ALM、加速近端法或近似随机SVD实现，常用经验初值 λ = 1/√max(m,n)），得到平滑低秩背景 L 与稀疏异常 S；第三步基于 S 的幅值和权重图 W 生成初始污染掩膜 M0 = (|S| > τ_S) ∨ (W < τ_W)，阈值可按局部统计量自适应设定（例如 τ_S = k·MAD(S) 或绝对值阈值，k≈3–5；τ_W 根据每像素原始采样点数或距离设定）；第四步对 L 进行边缘保留去噪以抑制高频测量噪声同时保护条纹边界，优选双边滤波或非局部均值（NL-Means），参数建议以像素为单位设定空间半径 σ_s 为1–3像素、幅度半径 σ_r 为1–3 μm（可按z精度与条纹对比度微调）；第五步在去噪后的 L 上做基于局部中位数与MAD的孤立异常检测：在滑动窗口内若 |L − median| > k2·MAD 标记为异常（k2≈4），并将这些像素合并入 S 与掩膜；第六步对掩膜做形态学清理（小孔填充、去小碎斑）与连通域过滤，生成最终二值有效性掩膜 M(θ,z)，同时计算每像素置信度 C = f(W, 1− normalized|S|, local_variance)（例如 C = sigmoid(α1·(W−τ_W) + α2·(τ_S−|S|) − α3·normalized_var)），并输出阈值化的高置信区域用于后续比对；第七步为增强稳健性与多尺度比对，迭代或并行在若干尺度（不同低通半径）上重复上述分解以产生多尺度 L_k 与对应掩膜 M_k，并保留多尺度结果以供后续特征提取选择；第八步生成质量报告（拟合/分解残差统计、污染像素比例、有效像素分布、置信度直方图）并将所有中间产物 L、S、M、C、参数和日志以标准格式保存（如Matlab .mat 或 NumPy/Pickle），以便审查与参数回溯。实现建议使用成熟工具链（Matlab 或 Python：numpy/scipy、scikit-image、OpenCV、r_pca 或自实现 ALM、sklearn 的局部统计函数），对大尺寸矩阵采用分块 RPCA 或近似随机SVD 以控制内存与计算时间；所有阈值、滤波半径与 λ 均应通过交叉验证或小样本手工标注调整并记录以保证可重复性。",
      "criteria": {
        "task_understanding": {
          "core_goal": "去趋势、抑制噪声并识别稀疏污染：对已格化的高度图 H(θ,z) 拟合并分解出平滑背景 L(θ,z)、稀疏异常 S(θ,z)，生成二值有效性掩膜 M(θ,z) 与置信度图 C(θ,z)，以便后续比对",
          "expected_output": "数值矩阵与二值掩膜（L(θ,z), S(θ,z), M(θ,z), C(θ,z)），多尺度变体 L_k/S_k/M_k/C_k，质量统计报表（残差、污染比例、置信度直方图）、参数日志与可执行代码",
          "key_inputs_constraints": "1) 输入为规则格化高度图 H(θ,z) 与权重图 W(θ,z)，采样步长Δs≈2.75μm，z精度≈1μm；2) 需假定条纹为毫米及以下尺度高频成分，基面为大尺度低频曲率；3) 计算受内存限制，需支持分块/RPCA近似；4) 无：外部标注污染真值（可选但不是必需）",
          "modeling_type": "拟合+分类+评价",
          "role_in_pipeline": "作为特征工程前的清洁与标准化子任务：依赖前序的圆柱拟合与格化输出(H,W,M初始)，为后续特征提取与比对提供干净高度图与置信度，后序任务依赖本任务输出进行特征提取与相似度计算"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "识别并区分低频基面与姿态趋势（去趋势）",
              "description": "评估是否识别并量化了需去除的低频基线/姿态趋势尺度和方法（逐行多项式或二维低通），并提出保留条纹的频率带",
              "score": 40,
              "evaluation_focus": "问题分解",
              "scoring_hint": "高分：明确给出基线去除尺度（例如低通半径）并提供去趋势后残差RMS下降≥30%；中分：描述去趋势方法但未定量；低分：未区分低频基面与待保留条纹"
            },
            {
              "sub_criteria": "识别高频测量噪声与条纹边界保护需求",
              "description": "评估是否识别测量噪声特征与条纹的空间频谱差异，并据此选择边缘保留去噪方法（双边/非局部）",
              "score": 30,
              "evaluation_focus": "频谱分析",
              "scoring_hint": "高分：提供频谱或能谱图并说明噪声/条纹带；中分：口头区分高频/条纹但无频谱验证；低分：混淆噪声与条纹导致不当滤波"
            },
            {
              "sub_criteria": "识别稀疏污染与孤立异常（S）",
              "description": "评估是否将锈斑/油污/杂质建模为稀疏分量并说明稀疏性假设与预期占比范围",
              "score": 30,
              "evaluation_focus": "异常识别",
              "scoring_hint": "高分：给出稀疏占比估计（例如<15%）并说明阈值策略；中分：提出稀疏假设但无占比或阈值；低分：未将污染视为稀疏或忽视其空间聚集性"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "复述去趋势与基线拟合目标（输出L）",
              "description": "检查是否清晰复述目标为从H去除低频基面以获得平滑背景L(θ,z)，并说明度量（残差、RMS等）",
              "score": 30,
              "evaluation_focus": "目标明确性",
              "scoring_hint": "高分：明确写出L的定义与质量度量（RMS/MAD）；中分：描述L但未给量化指标；低分：未明确L与去趋势关系"
            },
            {
              "sub_criteria": "复述稀疏分解与S的判定（RPCA）",
              "description": "检查是否准确复述 D=H−baseline 分解为 L+S，给出优化目标（核范数+L1）与λ初值策略",
              "score": 35,
              "evaluation_focus": "方法复述",
              "scoring_hint": "高分：精确写出 min ||L||_* + λ||S||_1 并给出λ=1/√max(m,n)或自适应策略；中分：提及RPCA但无公式或λ值；低分：错误描述分解目标"
            },
            {
              "sub_criteria": "复述最终产物与质量报告要求（M、C、多尺度）",
              "description": "检查是否复述需输出二值掩膜M、置信度图C及多尺度结果并列出要包含的统计指标",
              "score": 35,
              "evaluation_focus": "输出规范",
              "scoring_hint": "高分：列出M,C及统计项（污染比例、置信度直方图、残差直方图）；中分：提到M或C但未列统计；低分：未复述多尺度或质量报告"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "基频尺度与条纹保留假设",
              "description": "评估是否明确假设条纹为毫米及以下尺度高频成分，且低频基面可用低阶多项式或高斯低通去除",
              "score": 25,
              "evaluation_focus": "物理假设",
              "scoring_hint": "高分：给出具体尺度数值（如保留<1mm频率）并能映射到像素/Δθ；中分：口头说明尺度关系；低分：无尺度或矛盾假设"
            },
            {
              "sub_criteria": "污染稀疏性与独立性假设",
              "description": "评估是否假设锈斑/油污为稀疏突变，孤立异常可用局部统计(MAD)检测",
              "score": 25,
              "evaluation_focus": "统计假设",
              "scoring_hint": "高分：说明稀疏占比上限与空间聚集性假设；中分：仅说明稀疏概念；低分：无或与RPCA假设冲突"
            },
            {
              "sub_criteria": "噪声分布与权重W可用性假设",
              "description": "评估是否明确噪声近似高斯且权重图W可反映采样密度/置信度并用于阈值化",
              "score": 25,
              "evaluation_focus": "数据假设",
              "scoring_hint": "高分：说明噪声模型并给出W阈值策略；中分：承认噪声存在但未建模；低分：忽视W或错误使用"
            },
            {
              "sub_criteria": "计算资源与分块处理假设",
              "description": "评估是否假设内存/时间有限并提出分块RPCA或近似SVD以控制资源",
              "score": 25,
              "evaluation_focus": "工程假设",
              "scoring_hint": "高分：给出分块策略与复杂度估计；中分：提出分块但无细节；低分：未考虑大矩阵计算约束"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "去趋势模块设计（多项式/二维低通）",
              "description": "检查是否给出具体去趋势算子（如每θ二次多项式或二维高斯低通），并给出参数选择原则",
              "score": 25,
              "evaluation_focus": "算子设计",
              "scoring_hint": "高分：给出公式/卷积核半径并说明为何保留条纹；中分：描述方法但无参数；低分：未明确去趋势算子"
            },
            {
              "sub_criteria": "低秩+稀疏分解（RPCA）建模",
              "description": "检查是否明确 D= L+S 的优化形式、λ选择原则与求解算法（ALM/近端法）",
              "score": 25,
              "evaluation_focus": "优化建模",
              "scoring_hint": "高分：写出目标函数、λ初值及迭代终止条件；中分：提到RPCA但无算法细节；低分：缺少λ或求解策略"
            },
            {
              "sub_criteria": "边缘保留去噪设计（双边/非局部）",
              "description": "评估是否选定双边滤波或NL-Means并给出像素半径σ_s与幅度σ_r建议与理由",
              "score": 25,
              "evaluation_focus": "滤波设计",
              "scoring_hint": "高分：给出σ_s=1–3像素、σ_r≈1–3μm 并说明标定方法；中分：提出方法无参数；低分：选用不适当滤波导致条纹损失"
            },
            {
              "sub_criteria": "异常检测与掩膜生成（MAD+形态学）",
              "description": "检查是否给出基于局部中位数/MAD的阈值k2、基于W的τ_W与形态学清理策略",
              "score": 25,
              "evaluation_focus": "阈值设定",
              "scoring_hint": "高分：给出k2≈4、τ_W策略并描述连通域筛除参数；中分：有阈值但无理由；低分：未提供掩膜生成方法"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "RPCA/ALM 求解与数值稳定性",
              "description": "评估是否实现或说明 ALM/加速近端法，包含收敛条件、近似SVD策略及内存控制（分块/随机SVD）",
              "score": 30,
              "evaluation_focus": "算法实现",
              "scoring_hint": "高分：提供收敛阈值、分块/随机SVD细节及时间复杂度估计；中分：有算法但无资源估计；低分：无法处理大矩阵或无收敛控制"
            },
            {
              "sub_criteria": "去噪滤波与并行/加速的实现",
              "description": "评估双边/NL-Means等的近似实现、参数调参方法和并行加速策略（多线程/GPU/向量化）",
              "score": 20,
              "evaluation_focus": "性能优化",
              "scoring_hint": "高分：给出向量化或GPU选项并报告运行时间缩减；中分：实现但无加速；低分：实现低效不可用"
            },
            {
              "sub_criteria": "阈值自适应与置信度C计算",
              "description": "评估是否实现 C=f(W,1−|S|,local_var) 并给出sigmoid/归一化参数和映射规范",
              "score": 25,
              "evaluation_focus": "置信度设计",
              "scoring_hint": "高分：给出具体函数、参数α并验证置信度与真实质量相关性；中分：提供函数但无标定；低分：仅给二值掩膜无置信度"
            },
            {
              "sub_criteria": "多尺度迭代与结果汇总策略",
              "description": "评估是否并行/迭代在多尺度上运行分解并给出如何融合多尺度 L_k 与 M_k 的规则",
              "score": 25,
              "evaluation_focus": "多尺度策略",
              "scoring_hint": "高分：给出融合规则（例如按置信度加权或交并比阈值）并展示改进；中分：运行多尺度但无融合策略；低分：未考虑多尺度"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "可重复性与输入/输出接口（保存L,S,M,C与日志）",
              "description": "评估代码是否能保存所有中间产物（.mat/.npz）、参数日志与可重现的随机种子设置",
              "score": 30,
              "evaluation_focus": "可复现性",
              "scoring_hint": "高分：提供脚本/函数、示例运行命令、随机种子与完整输出；中分：输出完整但无运行说明；低分：缺少中间产物或不可复现"
            },
            {
              "sub_criteria": "性能与资源控制（分块/并行）",
              "description": "检查是否实现大矩阵分块RPCA或随机SVD并报告内存与时间性能",
              "score": 25,
              "evaluation_focus": "工程实现",
              "scoring_hint": "高分：分块实现并在样本上报告内存峰值与运行时；中分：有说明无测试；低分：直接OOM或超时"
            },
            {
              "sub_criteria": "参数化与可调节性（超参记录与默认值）",
              "description": "评估是否在代码中暴露关键超参（λ, τ_S, τ_W, σ_s, σ_r, k2）并提供默认与推荐范围",
              "score": 25,
              "evaluation_focus": "可调性",
              "scoring_hint": "高分：全部超参可配置并有注释推荐；中分：部分参数可调；低分：硬编码参数不可调"
            },
            {
              "sub_criteria": "代码质量与测试（单元/集成测试示例）",
              "description": "评估代码是否有基本输入校验、边界条件处理与示例测试脚本（小样本示例）",
              "score": 20,
              "evaluation_focus": "代码可靠性",
              "scoring_hint": "高分：包含测试用例并通过；中分：有示例但无断言；低分：无测试、易崩溃"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "质量统计报告（残差、污染比例、置信度直方图）",
              "description": "评估是否生成残差RMS/MAD、S非零像素比例、置信度直方图并解释其含义与阈值化策略",
              "score": 30,
              "evaluation_focus": "定量评估",
              "scoring_hint": "高分：报告RMS/MAD并给出阈值判定（例如污染率>10%需复核）；中分：报告但无解释；低分：无质量统计"
            },
            {
              "sub_criteria": "掩膜M与置信度C的可视化与验证",
              "description": "检查是否提供M/C的可视化（热图/覆盖）并与原始H/W叠加以便人工审查",
              "score": 25,
              "evaluation_focus": "可视化验证",
              "scoring_hint": "高分：提供多图叠加并示例说明误判和漏报；中分：提供图像但无对比注释；低分：无可视化"
            },
            {
              "sub_criteria": "异常检测性能评估（若有标注，则报告Precision/Recall）",
              "description": "若存在少量手工标注，评估S/M的检测精度；若无标注，则用合成注入实验评估检测率",
              "score": 25,
              "evaluation_focus": "检测评估",
              "scoring_hint": "高分：给出Precision/Recall≥0.8或合成实验并列出结果；中分：给出单一指标；低分：无评估或仅主观描述"
            },
            {
              "sub_criteria": "多尺度结果一致性与对后续比对的影响分析",
              "description": "评估多尺度L_k/M_k对后续特征提取的敏感性，给出推荐尺度或融合策略并量化改进",
              "score": 20,
              "evaluation_focus": "鲁棒性分析",
              "scoring_hint": "高分：量化多尺度带来的比对性能提升或稳定性；中分：描述差异但无量化；低分：未考虑多尺度影响"
            }
          ]
        }
      }
    },
    "3": {
      "subtask": "子任务3（多尺度特征提取与局部/全局配准）旨在从已预处理并格化成规则θ–z高度图 L(θ,z)（输入同时包括对应的有效性掩膜 M(θ,z)、置信度图 C(θ,z) 以及格点步长 Δθ、Δz）自动提取能反映膛线条痕细节且对局部损伤鲁棒的多尺度/多模态描述子，并在θ（环向）与z（轴向）两个自由度上实现先粗后精的配准以估计并输出最佳刚体或小仿射对齐参数、配准残差图及一组可用于融合的相似度分量；具体要求和步骤为：输入验证与裁剪（根据 M 和 C 去除无效区并确定比较子窗口）；局部分段与多尺度构造——按轴向将高度图分为可重叠的段（段长与重叠由Δz和目标判别尺度决定，例如段长几百到几千像素、重叠20%–50%）并在每段上构造若干尺度（采用高斯金字塔）以保留不同空间频率的信息；1D剖面与频谱特征——在每个θ位置提取归一化的轴向剖面 p(z)，对其做去均值后计算FFT/功谱密度(PSD)，并记录若干频带能量比、主峰频率与能量谱形状作为频域描述子；峰/槽序列提取——在平滑后的剖面上用导数零交叉与基于局部噪声的自适应阈值检测峰/谷位置和幅值，输出位置序列、峰间距分布与幅值比序列；二维梯度与方向直方图（HOG-like）——在每个段的二维窗口内计算(∂H/∂θ,∂H/∂z)并构建方向/幅值直方图以表征条纹方向性；尺度关键点与描述子——在高度图尺度空间用DoG或Hessian检测关键点并计算基于局部梯度直方图的SIFT-like描述子（或使用现成SIFT/ORB对高度图做微调参数），记录关键点坐标、尺度与描述子；脊线/槽线轨迹提取——用Hessian主曲率追踪槽脊中心线并以其几何曲率与沿线高度剖面构成轨迹型描述子；配准流程：先用2D相位相关（FFT-based phase correlation，带窗与掩膜补偿）在整段或整图上快速估计粗对齐位移(Δθ_coarse,Δz_coarse)（θ为周期性循环），再在粗对齐基础上用加权归一化互相关（NCC）在局部窗口或多尺度上细化位移并返回NCC最大值；并行地用关键点描述子做最近邻匹配并通过RANSAC剔除离群点以估计精配准（可扩展为仿射），最后在精配准结果上用连续优化（例如Levenberg–Marquardt或梯度法）最大化掩膜加权NCC或最小化加权RMSE以输出最终对齐变换与像素级残差图；匹配与相似度输出：计算并输出若干可直接用于融合的相似度分量（归一化互相关最大值 NCC_max、配准后归一化RMSE RMSE_norm、关键点匹配率 KP_match_frac（并给出匹配对列表与其距离分布）、峰位序列相似度（可用DTW或最小均方匹配成本表示）、PSD相关度 PSD_corr、以及槽脊线轨迹重合度），并为每一分量给出对应的有效性掩膜交集与置信指标；实现细节与参数建议：在FFT相位相关中应用窗函数并在掩膜上做有效像素补偿，多尺度金字塔通常使用2–4层，关键点匹配使用比值测试与交叉验证并在RANSAC中采用基于像素距离的内点阈（例如内点阈与高度图像素尺度对应的几微米），峰检测阈依据局部MAD自适应设置，所有计算应支持并行处理并将结果以结构化格式（关键点/描述子文件、对齐参数、残差热图、分量相似度向量）保存以便下游融合与可视化审查；最终输出应包括：段级与整体级描述子集合、配准参数(Δθ,Δz,可选仿射分量)、配准残差矩阵、每项相似度分量及其置信度和用于证明配对的关键点/峰位匹配可视化清单。",
      "criteria": {
        "task_understanding": {
          "core_goal": "从已格化的θ–z高度图提取多尺度描述子并实施先粗后精的配准，拟合并优化刚体/小仿射对齐参数以评估弹头痕迹相似度与输出残差图和相似度分量。",
          "expected_output": "段级与整体级多尺度描述子集合（文件）、关键点/描述子文件、配准参数(Δθ,Δz,可选仿射分量)、配准残差矩阵/热图、相似度分量向量（NCC_max、RMSE_norm、KP_match_frac、PSD_corr、轨迹重合度等）、置信度掩膜、可视化匹配清单和代码实现文件（脚本与依赖说明）。",
          "key_inputs_constraints": "1) L(θ,z)：已去噪去趋势的高度图，数值矩阵，含NaN/掩膜；2) M(θ,z)、C(θ,z)：二值有效性掩膜与置信度图，矩阵与相同格点步长Δθ、Δz（周期性θ）；3) 网格参数Δθ、Δz与周期性边界条件、段划分参数（段长、重叠）、内存/计算资源限制（大矩阵需分块）；（其它约束：θ周期性需环向连续处理；掩膜导致数据不完整）。",
          "modeling_type": "混合（拟合+特征提取+评价）",
          "role_in_pipeline": "作为特征工程与局部/全局配准模块，位于Subtask1(几何归一化)与Subtask2(去趋势/污染分离)之后，为后续相似度融合与判别/分类提供配准参数、残差图与多模态相似度分量；直接依赖前序：θ–z高度图L、掩膜M、置信度C；输出供后序：相似度融合/判决模块使用。"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "识别θ–z高度图与周期性θ处理需求",
              "description": "是否明确指出输入为格化的θ–z高度图并识别θ方向的周期性环绕边界需特殊处理（环绕插值、相位相关时的周期补偿）。",
              "score": 40,
              "evaluation_focus": "建模思维",
              "scoring_hint": "高分：明确提出环向周期性处理并给出实现细节（如环绕插值或模运算）；中分：识别周期性但未给出具体实现；低分：未提及θ周期性或将θ误处理为线性边界。"
            },
            {
              "sub_criteria": "识别掩膜/置信度对配准的影响",
              "description": "是否识别到M(θ,z)与C(θ,z)会造成数据缺失与权重差异，并提出掩膜补偿或加权配准策略（相位相关/互相关的掩膜补偿）。",
              "score": 30,
              "evaluation_focus": "算法选择",
              "scoring_hint": "高分：给出基于掩膜的补偿方法（窗函数、有效像素补偿）和置信度加权策略；中分：提及掩膜影响但仅作笼统处理；低分：忽视掩膜与置信度影响。"
            },
            {
              "sub_criteria": "识别多尺度/局部损伤与段化需求",
              "description": "是否识别到条纹在不同尺度上的信息且需将高度图按轴向分段（含重叠）以增强对局部损伤的鲁棒性。",
              "score": 30,
              "evaluation_focus": "问题分解",
              "scoring_hint": "高分：给出段长、重叠比例与多尺度层数的选择原则；中分：提出分段与多尺度但无参数依据；低分：未考虑段化或仅做整体处理导致对局部损伤不鲁棒。"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "复述需‘提取多尺度描述子’的具体目标",
              "description": "是否用任务术语复述要从L(θ,z)提取哪些多尺度描述子（FFT/PSD、峰/谷序列、HOG-like、关键点/描述子、槽脊线轨迹）。",
              "score": 40,
              "evaluation_focus": "建模表达",
              "scoring_hint": "高分：逐项列出并说明每类描述子的物理含义及其预期稳健性；中分：列出描述子但无物理解释；低分：未列出或模糊描述。"
            },
            {
              "sub_criteria": "复述配准的‘先粗后精’流程与目标参数",
              "description": "是否明确复述使用相位相关做粗配准、NCC/关键点+RANSAC做精配准并输出Δθ、Δz及可选仿射分量与残差图。",
              "score": 35,
              "evaluation_focus": "流程规划",
              "scoring_hint": "高分：按步骤说明粗配准与细配准方法并给出输出格式；中分：说明方法但缺少连接细节；低分：复述不完整或方法互相矛盾。"
            },
            {
              "sub_criteria": "复述相似度分量与置信度输出要求",
              "description": "是否复述需输出NCC_max、RMSE_norm、KP_match_frac、PSD_corr、轨迹重合度及每项的置信/有效性掩膜交集。",
              "score": 25,
              "evaluation_focus": "结果定义",
              "scoring_hint": "高分：列出分量并说明置信度计算方式；中分：列出分量但无置信说明；低分：缺少关键相似度分量或置信考虑。"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "说明刚体/小仿射对齐假设与适用范围",
              "description": "是否明确假设两个段间为刚体或小的仿射变形并给出变形界限（例如θ偏移、z平移、少量尺度/剪切）。",
              "score": 40,
              "evaluation_focus": "物理假设",
              "scoring_hint": "高分：量化允许的仿射分量范围并说明不适用场景；中分：提出刚体/仿射假设但未量化；低分：无明确对齐假设或假设与任务不符。"
            },
            {
              "sub_criteria": "说明噪声、缺失与异常为局部稀疏/高频的假设",
              "description": "是否假定污染为稀疏异常（S）且条纹为低秩或可在局部尺度保留的信号，用以支撑局部对齐与鲁棒描述子设计。",
              "score": 30,
              "evaluation_focus": "统计假设",
              "scoring_hint": "高分：明确将污染建模为稀疏且说明对描述子/配准的影响；中分：定性说明噪声/污染特性；低分：未区分噪声与结构信号。"
            },
            {
              "sub_criteria": "假设多尺度可区分特征频带",
              "description": "是否假设不同空间频率（毫米级、次毫米级）分别承载不同可匹配信息并据此设置金字塔尺度。",
              "score": 30,
              "evaluation_focus": "多尺度假设",
              "scoring_hint": "高分：给出频带划分原则并与Δz/Δθ对应；中分：提出多尺度但无频率依据；低分：忽略尺度选择。"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "构建并实现‘多尺度描述子集合’（FFT/PSD、峰序列、HOG、关键点）",
              "description": "描述并实现从L(θ,z)提取FFT/PSD能量比、峰/槽位置序列、二维梯度直方图（HOG-like）与尺度关键点及其SIFT-like描述子的具体流程与参数。",
              "score": 25,
              "evaluation_focus": "特征工程",
              "scoring_hint": "高分：实现并参数化所有列举描述子，给出参数与归一化方法；中分：实现部分描述子或参数未充分说明；低分：仅实现单一描述子或无实现细节。"
            },
            {
              "sub_criteria": "设计粗配准方法：相位相关（FFT-based）实现与掩膜补偿",
              "description": "实现带窗与掩膜补偿的FFT相位相关以估计(Δθ_coarse,Δz_coarse)，并说明周期性与窗函数选择。",
              "score": 25,
              "evaluation_focus": "粗配准",
              "scoring_hint": "高分：实现掩膜补偿的相位相关并给出鲁棒性评估；中分：实现相位相关但无掩膜/窗补偿；低分：未采用相位相关或实现错误。"
            },
            {
              "sub_criteria": "设计精配准：加权NCC、关键点+RANSAC与连续优化",
              "description": "实现在粗配准基础上用置信度加权的NCC细化位移，用关键点描述子匹配+RANSAC估计精配准（可仿射），并用非线性优化最大化加权NCC或最小化加权RMSE。",
              "score": 25,
              "evaluation_focus": "精配准",
              "scoring_hint": "高分：链式实现NCC细化、关键点RANSAC和LM/梯度优化并输出残差矩阵；中分：实现二者之一；低分：仅简单像素平移匹配或未加权。"
            },
            {
              "sub_criteria": "定义并输出相似度分量与置信度融合规则",
              "description": "明确每个相似度分量的计算方法（NCC_max、RMSE_norm、KP_match_frac、PSD_corr、轨迹重合度）及其基于C、M的置信度权重和最终融合建议。",
              "score": 25,
              "evaluation_focus": "相似度定义",
              "scoring_hint": "高分：给出量化计算公式与置信度融合权重；中分：列出分量但融合策略模糊；低分：仅输出单一分数或无置信考量。"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "算法求解与数值稳定性（RANSAC、LM、FFT）",
              "description": "是否在实现中对RANSAC内点阈、LM收敛条件、FFT窗与零填充等数值参数给出合理设置并检查稳定性/收敛性。",
              "score": 25,
              "evaluation_focus": "数值实现",
              "scoring_hint": "高分：给出具体参数并有收敛/鲁棒性测试（例：内点阈对应μm）；中分：参数给出但无稳定性测试；低分：参数缺失或数值不稳定导致失败。"
            },
            {
              "sub_criteria": "配准精度评估与残差统计输出",
              "description": "是否计算并保存配准残差矩阵与统计量（均值、RMS、MAD、直方图）并判断是否满足质量阈值。",
              "score": 25,
              "evaluation_focus": "质量控制",
              "scoring_hint": "高分：给出残差统计并基于阈值（如RMSE_norm≤1μm）标注通过/失败；中分：提供残差但无判定阈值；低分：未提供残差统计。"
            },
            {
              "sub_criteria": "参数选择与多尺度/交叉验证",
              "description": "是否对金字塔层数、峰检测阈、窗口大小等通过交叉验证或小样本人工标注进行调优并报告结果。",
              "score": 25,
              "evaluation_focus": "参数调优",
              "scoring_hint": "高分：有系统的交叉验证或手工标注对比并给出最优参数与敏感性；中分：有经验性参数但无验证；低分：参数随意设定且未验证。"
            },
            {
              "sub_criteria": "计算复杂度与可扩展性（并行/分块）",
              "description": "是否评估算法复杂度并提供并行化或分块处理策略以处理大尺寸θ–z矩阵。",
              "score": 25,
              "evaluation_focus": "工程实现",
              "scoring_hint": "高分：提供并行/分块实现并给出时间/内存基准；中分：提出方案但无基准；低分：忽视可扩展性，出现内存/时间不可行。"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "可复现的代码与输出文件（脚本、参数、示例）",
              "description": "代码是否可运行生成题目要求的输出（描述子文件、配准参数、残差图、相似度向量），并附示例调用与依赖说明。",
              "score": 30,
              "evaluation_focus": "可复现性",
              "scoring_hint": "高分：提供可直接运行的脚本/说明并能复现关键结果；中分：代码可运行但需人工改动路径/参数；低分：代码无法运行或无说明。"
            },
            {
              "sub_criteria": "掩膜/周期性/置信度处理在代码中的实现",
              "description": "代码是否实现了对M(θ,z)掩膜、θ周期性处理与置信度C加权的具体细节（相位相关掩膜补偿、循环边界处理）。",
              "score": 25,
              "evaluation_focus": "实现细节",
              "scoring_hint": "高分：代码中有模块化实现并经测试；中分：处理存在但耦合或仅部分实现；低分：无掩膜或周期性处理。"
            },
            {
              "sub_criteria": "关键点/描述子与RANSAC实现可靠性",
              "description": "关键点检测、描述子计算、匹配策略与RANSAC内点筛选在代码中实现是否可靠且有可配置阈值。",
              "score": 20,
              "evaluation_focus": "算法可靠性",
              "scoring_hint": "高分：实现交叉验证、比值测试与可调阈并提供匹配可视化；中分：实现基本匹配但缺少鲁棒性控制；低分：匹配不稳定或无RANSAC过滤。"
            },
            {
              "sub_criteria": "单元测试、文档与运行效率说明",
              "description": "是否包含单元测试示例、函数/参数文档与时间/内存复杂度说明或性能基准。",
              "score": 25,
              "evaluation_focus": "软件工程",
              "scoring_hint": "高分：附带单元测试、API文档与性能基准；中分：有文档或测试之一；低分：无文档与无测试。"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "配准残差与质量判定报告",
              "description": "是否提供配准残差矩阵、均值/RMS/MAD与直方图，并按预设阈值标注通过/复核/失败的片段或段级结果。",
              "score": 30,
              "evaluation_focus": "结果解释",
              "scoring_hint": "高分：提供量化判定（例如RMSE_norm≤1μm为通过）并列出需复核的区域；中分：提供残差但无明确判定策略；低分：无残差分析或分析不足。"
            },
            {
              "sub_criteria": "相似度分量的展示与置信度融合分析",
              "description": "是否按段级与整体给出各相似度分量（NCC_max、RMSE_norm、KP_match_frac、PSD_corr、轨迹重合度）并用置信度C/M融合给出排序或综合得分建议。",
              "score": 25,
              "evaluation_focus": "结果融合",
              "scoring_hint": "高分：给出分量值、置信度权重及最终融合得分并能解释排序；中分：列出分量但融合规则模糊；低分：仅给单一分值或无置信考量。"
            },
            {
              "sub_criteria": "关键匹配/峰位可视化与验证清单",
              "description": "是否输出关键点匹配对图、峰位匹配示意、轨迹重合可视化及对应的匹配对列表以便人工复核证据链。",
              "score": 25,
              "evaluation_focus": "可审计性",
              "scoring_hint": "高分：提供完整可视化清单并能逆映射至原始点；中分：提供部分可视化；低分：无可视化或无法追溯。"
            },
            {
              "sub_criteria": "失败分析与灵敏度/鲁棒性测试",
              "description": "是否分析典型失败模式（大范围污染、严重缺失数据、非刚体变形）并给出对参数/预处理的灵敏度实验结果。",
              "score": 20,
              "evaluation_focus": "稳健性分析",
              "scoring_hint": "High: 系统列出失败模式并给出缓解策略及灵敏度曲线；中: 提及部分失败情形并做少量测试；低: 无失败分析或仅笼统说明。"
            }
          ]
        }
      }
    },
    "4": {
      "subtask": "子任务4（相似度融合、判决规则、置信度估计与输出）：本子任务的目标是将每一对弹头比对所得的多个基础相似度分量（例如归一化互相关 N NC_max、配准后归一化RMSE、关键点匹配率 KP_match_frac、峰位序列相似度 Peak_sim、频谱相关度 PSD_corr 等，每个分量均伴随其有效性掩膜和置信度权重）融合为单一的可解释相似度分数、为判决提供经过校准的概率与阈值规则、并对指定数据集产出完整的两两相似度矩阵与每枚弹头的Top‑5相似弹头清单及对应的可视化诊断证据；实现时按如下精确步骤执行：1) 数据输入与预处理：接收并验证每对比对的向量化分量 s_i ∈ R (i=1..m) 及其对应的有效性指标 v_i∈[0,1]（由掩膜交集与置信度函数给出），对缺失或不可比的分量用NaN标识并在后续归一化/训练中按有效性屏蔽或以中性值替代；2) 分量标准化：对每种分量在训练集上估计单峰或双尾分布参数并采用稳健缩放（例如基于中位数和MAD的零均值单位尺度变换或分位数映射到[0,1]），以保证不同量纲分量的一致性，并保留每个分量的有效性权重 w_eff = v_i^γ（γ≥1 为调节参数）；3) 权重学习与融合模型：在有标签训练对（同源/异源）上以加权逻辑回归或加权线性模型学习融合权重 W=(w_i)，优化目标为最大化验证集的AUC或最小化交叉熵，并在目标函数中加L2正则项以防过拟合；训练时采用分层交叉验证（如按枪分组的leave‑one‑gun‑out）确保同一枪的数据不跨训练/验证集，并通过网格搜索或贝叶斯优化调参（正则化系数、γ、阈值选择准则）；对存在大量NaN分量的对，用有效权重归一化融合（S_total = ∑_i w_i w_eff s_i / ∑_i w_i w_eff），并记录有效分量数作为可靠性指标；4) 决策阈值与概率校准：基于训练/验证ROC选择操作点，允许用户按司法需求固定FPR或FNR并据此确定阈值 t；同时用Platt缩放或等距回归对融合分数进行概率校准得到 P_same = Calib(S_total)，并在输出中给出概率置信区间；5) 不确定性量化：对每对比对执行蒙特卡洛扰动试验（在高度图上按已知测量噪声 zσ、装夹误差分布模拟若干次扰动并重复比对与融合），从而获得 S_total 的经验分布、置信区间与置信度指标（例如95%区间宽度、P(S_total>t)），并将模拟参数记录以便复现；6) 输出与可视化证据：生成并保存（a）完整的对称相似度矩阵 S_total_{N×N}；（b）每枚弹头按 S_total 降序的Top‑K（K=5）列表，包含文件编号、分数、校准概率、置信区间与用于排序的主要分量贡献比例；（c）每对比对的诊断包（对齐残差热图、关键点匹配可视化图、轴向剖面叠加图、被掩盖/排除区域图及分量分解表），以满足可审查性要求；7) 性能评估与稳健性报告：计算并报告在训练/验证分割上的ROC曲线、AUC、在选定阈值下的混淆矩阵、FPR/FNR、精确率-召回率曲线，并进行参数敏感性分析（主要对正则化强度、融合权重、阈值选择准则、有效性权重γ）；8) 工程实现与可复现性：建议使用Python科学栈（numpy/scipy/pandas）、scikit‑learn（逻辑回归、校准、交叉验证）、joblib或dask并行化批量比对、OpenCV或matplotlib做可视化、并以标准格式（CSV/JSON for matrices and lists, HDF5/.mat for diagnostics）存储输出；所有训练脚本应记录随机种子、版本依赖及参数配置文件以保证可复现性；9) 运行与资源说明：设计并行化批处理以支持N(N−1)/2两两比对的可扩展运行，估计并行节点与内存需求并在报告中给出每对比对的平均时间与蒙特卡洛重复次数的建议值；10) 最终交付：提供可执行脚本/函数库以输入分量矩阵与有效性信息产出相似度矩阵与Top‑5列表、训练与校准的模型文件、完整的性能评估报告及每对的诊断可视化包，所有输出均包含明确的置信度指标与可审查证据以供后续司法或科研使用。",
      "criteria": {
        "task_understanding": {
          "core_goal": "融合多项相似度分量并通过拟合/训练得到加权融合模型、校准概率与决策阈值，输出可解释的相似度矩阵与每枚弹头的Top-5比对结果并给出蒙特卡洛不确定性评估",
          "expected_output": "数值：N×N 相似度矩阵（CSV/JSON）；列表：每枚弹头Top-5相似弹头及分数/校准概率/置信区间（CSV/JSON）；模型文件：训练好的融合模型（逻辑回归或线性权重）与标定器（Platt或Isotonic）；诊断包：每对的配准残差图、关键点匹配图、剖面叠加图（HDF5/.mat 或 影像文件）；代码：训练与推理脚本、参数配置、随机种子、运行日志。",
          "key_inputs_constraints": "1) 分量向量 s_i ∈ R^m（每对比对的若干基础相似度分量），包含 NaN 表示不可比；2) 有效性指标 v_i∈[0,1] 或掩膜交集，用于计算有效权重 w_eff = v_i^γ；3) 有标签训练对（同源/异源二分类），并要求按枪分组以进行分层交叉验证；4) 计算资源限制（需要支持 N(N−1)/2 两两比对及蒙特卡洛重复）；5) 要求可审查性：输出每对的分量贡献与诊断可视化。",
          "modeling_type": "混合（拟合 + 分类 + 评价）",
          "role_in_pipeline": "作为最后的相似度融合与判决模块，位于特征提取/配准（前序子任务3）和司法/展示环节之间；依赖前序：子任务1的归一化高度图与坐标变换参数、子任务2的去噪/掩膜输出、子任务3的配准残差与各相似度分量。输出被后续用于生成报告、Top-5列表与司法证据包。"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "识别融合目标与输出（融合 相似度矩阵 与 Top-5）",
              "description": "是否明确识别任务要“融合”多项分量以输出N×N相似度矩阵与每枚弹头的Top-5列表并供司法审查。",
              "score": 30,
              "evaluation_focus": "问题抽取",
              "scoring_hint": "高分：明确列出相似度矩阵、Top‑5、诊断包和模型文件并说明格式；中分：列出相似度矩阵与Top‑5但未说明诊断包细节；低分：未明确输出形式或遗漏Top‑5/矩阵之一。"
            },
            {
              "sub_criteria": "识别有效性权重与NaN处理（v_i, w_eff, γ）",
              "description": "是否识别并描述输入有效性指标v_i、有效权重w_eff=v_i^γ与NaN分量的屏蔽或中性值替代策略。",
              "score": 30,
              "evaluation_focus": "数据约束",
              "scoring_hint": "高分：给出明确NaN策略并说明γ作用与默认值范围；中分：说明存在NaN与掩膜但未给出明确公式；低分：忽视有效性权重或未说明NaN如何处理。"
            },
            {
              "sub_criteria": "识别校准与司法阈值需求（Platt/阈值 t）",
              "description": "是否识别需要对融合分数进行概率校准（如Platt缩放）并依据司法需求给出可配置的阈值t（固定FPR或FNR）。",
              "score": 25,
              "evaluation_focus": "判决约束",
              "scoring_hint": "高分：明确校准方法并描述按FPR/FNR选阈流程；中分：提出校准但缺少阈值选择细则；低分：未涉及校准或司法阈值选择。"
            },
            {
              "sub_criteria": "识别不确定性量化（蒙特卡洛扰动）",
              "description": "是否识别并计划执行基于测量噪声与装夹误差的蒙特卡洛扰动以估计融合分数的置信区间与P(S>t)。",
              "score": 15,
              "evaluation_focus": "不确定性",
              "scoring_hint": "高分：给出扰动模型、重复次数建议（≥100）与输出置信区间；中分：指出要做蒙特卡洛但未给重复次数或扰动分布细节；低分：无不确定性量化。"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "复述“融合并校准”的核心流程",
              "description": "是否用自己的话复述从分量标准化→加权融合→训练（逻辑回归/线性模型）→校准→阈值决策的完整流程。",
              "score": 40,
              "evaluation_focus": "流程理解",
              "scoring_hint": "高分：按步骤列出并包含标准化、w_eff、训练目标与校准；中分：流程完整但缺少某一步细节；低分：流程描述混乱或缺少核心步骤（如校准或w_eff）。"
            },
            {
              "sub_criteria": "复述训练与交叉验证策略（按枪分层）",
              "description": "是否明确按枪分组进行分层交叉验证（如leave‑one‑gun‑out）以防信息泄露并用于调参与正则化选择。",
              "score": 35,
              "evaluation_focus": "验证设计",
              "scoring_hint": "高分：明确分层方案并说明用于AUC/交叉熵优化；中分：提出交叉验证但未按枪分层；低分：无有效交叉验证策略。"
            },
            {
              "sub_criteria": "复述可审查性与输出诊断包要求",
              "description": "是否复述需要为每对输出诊断包（残差热图、关键点匹配图、剖面叠加）以满足可审查性。",
              "score": 25,
              "evaluation_focus": "可审查性",
              "scoring_hint": "高分：列出诊断包具体内容与存储格式；中分：提出诊断输出但无细节；低分：未提诊断证据或审查要求。"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "假设分量可经稳健标准化统一量纲",
              "description": "是否明确采用基于中位数与MAD或分位映射对每种分量做稳健标准化以适配不同分布。",
              "score": 30,
              "evaluation_focus": "数据假设",
              "scoring_hint": "高分：给出具体标准化公式与训练集估计方法；中分：说明要标准化但未给稳健统计量；低分：未指定标准化或使用不稳健方法（如简单min-max）。"
            },
            {
              "sub_criteria": "假设有效性权重w_eff形式与γ可调",
              "description": "是否假定w_eff = v_i^γ，说明γ≥1的意义并计划通过CV调优γ。",
              "score": 25,
              "evaluation_focus": "权重假设",
              "scoring_hint": "高分：明确γ的效果并提出调优范围；中分：给出公式但未提调优策略；低分：未说明γ或权重形式。"
            },
            {
              "sub_criteria": "假设训练集标签可信且可分层（按枪）",
              "description": "是否假设训练对的同源/异源标签为真且可按枪分层以避免数据泄露，并说明若标签不充分的降级策略。",
              "score": 25,
              "evaluation_focus": "标签假设",
              "scoring_hint": "高分：说明按枪分层并提出标签不足时的半监督/重抽样方案；中分：仅声明按枪分层但无备选措施；低分：忽视标签可靠性与分层问题。"
            },
            {
              "sub_criteria": "假设蒙特卡洛扰动模型与次数",
              "description": "是否假定测量噪声分布（如zσ）与装夹误差分布并规划蒙特卡洛重复次数与可复现种子。",
              "score": 20,
              "evaluation_focus": "扰动假设",
              "scoring_hint": "高分：给出噪声标准差范围、扰动参数与建议重复次数（≥200）并记录随机种子；中分：提出蒙特卡洛但参数粗略；低分：未定义扰动分布或重复次数。"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "分量标准化与有效性归一化实现（中位数/MAD 映射）",
              "description": "是否实现稳健标准化并在训练集上估计分位映射，将各分量映射到统一尺度[0,1]且支持NaN屏蔽。",
              "score": 25,
              "evaluation_focus": "预处理方法",
              "scoring_hint": "高分：提供训练集统计量、稳健变换代码并处理NaN；中分：说明方法但无训练/实现细节；低分：无稳健标准化或无法处理NaN。"
            },
            {
              "sub_criteria": "权重学习模型与正则化（逻辑回归/加权线性）",
              "description": "是否选择加权逻辑回归或加权线性模型并在目标中包含L2正则以学习融合权重W，使用w_eff作为样本或分量权重。",
              "score": 30,
              "evaluation_focus": "模型选择",
              "scoring_hint": "高分：模型公式清晰、包含加权项并实现正则化调参；中分：选择逻辑回归但未明确加权或正则化；低分：无权重学习或使用不合适模型。"
            },
            {
              "sub_criteria": "缺失分量与有效权重归一化策略",
              "description": "是否在存在NaN时按S_total = ∑ w_i w_eff s_i / ∑ w_i w_eff 对有效分量归一化并记录有效分量数作为可靠性指标。",
              "score": 25,
              "evaluation_focus": "缺失处理",
              "scoring_hint": "高分：实现并证明归一化公式且记录可靠性；中分：提出公式但无实现或统计记录；低分：未考虑NaN归一化或遗漏可靠性指标。"
            },
            {
              "sub_criteria": "概率校准与阈值决策（Platt/Isotonic 与按FPR/FNR）",
              "description": "是否实现Platt缩放或Isotonic回归对融合分数做概率校准并提供按固定FPR/FNR或最优ROC点选取阈值的机制。",
              "score": 20,
              "evaluation_focus": "校准与判决",
              "scoring_hint": "高分：实现校准流程并报告校准误差/Brier分数；中分：实现校准但无误差报告；低分：无校准或阈值选择策略。"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "训练方案与分层交叉验证（leave‑one‑gun‑out）",
              "description": "是否在有标签训练集上按枪分层进行交叉验证用于超参调优（正则强度、γ）并报告验证AUC。",
              "score": 30,
              "evaluation_focus": "训练验证",
              "scoring_hint": "高分：实施分层CV并给出AUC≥0.9或多折AUC分布；中分：使用CV但未按枪分层或AUC在0.8–0.9；低分：无CV或AUC<0.8且无说明。"
            },
            {
              "sub_criteria": "优化细节与正则化选择",
              "description": "是否说明并实现带L2正则的优化目标（最小交叉熵/最大AUC代理）并通过网格或贝叶斯优化选择正则化系数。",
              "score": 25,
              "evaluation_focus": "求解细节",
              "scoring_hint": "高分：实现自动化调参并报告最优正则及敏感性；中分：手动选参或浅层搜索；低分：无正则化或无调参说明。"
            },
            {
              "sub_criteria": "概率校准求解与可重复性",
              "description": "是否对校准器（Platt/Isotonic）做CV并保存校准映射以保证可复现概率P_same计算。",
              "score": 20,
              "evaluation_focus": "校准求解",
              "scoring_hint": "高分：保存校准模型并报告校准误差（如ECE或Brier）；中分：实现校准但无误差报告；低分：未校准或不可复现。"
            },
            {
              "sub_criteria": "蒙特卡洛不确定性求解与资源估计",
              "description": "是否实现蒙特卡洛扰动实验、计算融合分数分布、置信区间与P(S_total>t)，并提供计算时间与并行化方案。",
              "score": 25,
              "evaluation_focus": "不确定性求解",
              "scoring_hint": "高分：提供≥200次仿真结果、CI、P值和并行时间估计；中分：有仿真但次数<100或无时间估计；低分：无蒙特卡洛或无法复现。"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "可复现性与文档（随机种子、版本、配置文件）",
              "description": "是否提供训练与推理脚本、参数配置文件、依赖版本与固定随机种子以保证可复现性。",
              "score": 25,
              "evaluation_focus": "代码可靠性",
              "scoring_hint": "高分：完整脚本、requirements/conda文件、示例运行命令与随机种子；中分：有脚本但缺少环境或种子；低分：无运行说明或不可复现。"
            },
            {
              "sub_criteria": "输入/输出规范与存储格式（CSV/JSON/HDF5）",
              "description": "是否实现标准化I/O：读取分量矩阵与v_i、写出相似度矩阵、Top‑5列表、模型文件与诊断包并有示例。",
              "score": 30,
              "evaluation_focus": "工程接口",
              "scoring_hint": "高分：I/O遵循规范并提供示例文件；中分：I/O实现但无示例；低分：I/O混乱或不可用。"
            },
            {
              "sub_criteria": "并行化与性能（批量N(N−1)/2 可扩展）",
              "description": "是否实现并行批处理（joblib/dask）以处理大量两两比对并报告每对平均时间与资源需求估计。",
              "score": 25,
              "evaluation_focus": "性能优化",
              "scoring_hint": "高分：并行实现并给出每对平均时间与节点估计；中分：支持并行但无性能报告；低分：串行实现且无法扩展。"
            },
            {
              "sub_criteria": "测试与诊断输出自动化",
              "description": "是否包含单元/集成测试及自动生成每对的诊断包（图像/表格）以便审查。",
              "score": 20,
              "evaluation_focus": "测试覆盖",
              "scoring_hint": "高分：提供测试套件与示例诊断包；中分：有少量测试或部分诊断自动化；低分：无测试与无诊断输出。"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "相似度矩阵与Top-5输出质量评估（AUC/混淆矩阵）",
              "description": "是否计算并报告整体ROC/AUC、在选定阈值下的混淆矩阵、FPR/FNR和Top‑5召回与精确率指标。",
              "score": 30,
              "evaluation_focus": "性能评价",
              "scoring_hint": "高分：AUC≥0.9并提供混淆矩阵与Top‑5召回；中分：AUC∈[0.8,0.9)且部分指标齐全；低分：AUC<0.8或无完整评价指标。"
            },
            {
              "sub_criteria": "概率校准与置信区间可信度（Platt 与 MC CI）",
              "description": "是否报告校准性能（ECE或校准曲线）、Brier分数，并给出蒙特卡洛置信区间及其覆盖率评估。",
              "score": 25,
              "evaluation_focus": "不确定性",
              "scoring_hint": "高分：提供校准误差≤0.05、Brier低且MC CI 有覆盖率统计；中分：有校准但误差中等；低分：无校准误差报告或MC CI 缺失。"
            },
            {
              "sub_criteria": "可审查诊断证据与分量贡献解释",
              "description": "是否为每个Top‑5配对提供可视化证据（残差热图、关键点匹配图、剖面叠加）并列出关键分量的贡献比例。",
              "score": 25,
              "evaluation_focus": "可解释性",
              "scoring_hint": "高分：每对提供完整诊断包与分量贡献条形图；中分：部分对有诊断或贡献说明；低分：无诊断或贡献信息。"
            },
            {
              "sub_criteria": "敏感性分析与稳健性报告（γ、正则、阈值）",
              "description": "是否进行参数敏感性分析（γ、正则化强度、阈值t）并报告性能随参数变化的稳定性。",
              "score": 20,
              "evaluation_focus": "稳健性",
              "scoring_hint": "高分：展示参数网格的AUC/误差曲线并指出稳健区间；中分：有少量参数检验；低分：未做敏感性分析。"
            }
          ]
        }
      }
    }
  }
}
{
  "task_id": "2023_E",
  "problem": "\\section*{二、数据集介绍及建模目标}\n\n赛题提供了 160 例（100 例训练数据集 + 60 例独立测试数据集）出血性脑卒中患者的个人史、疾病史、发病及治疗相关信息、多次重复的影像学检查（CT 平扫）结果及患者预后评估，该部分信息可在“表 1-患者列表及临床信息”中查询。\n\n如图 1 为脑出血患者 CT 平扫，红色为血肿区域，黄色为水肿区域。赛题提供影像学检查数据，包括各个时间点血肿/水肿的体积、位置、形状特征及灰度分布等信息。体积及位置信息可在“表 2-患者影像信息血肿及水肿的体积及位置”中查询。形状及灰度分布信息可在“表 3-患者影像信息血肿及水肿的形状及灰度分布”中查询。\n\n赛题目标：通过对真实临床数据的分析，研究出血性脑卒中患者血肿扩张风险、血肿周围水肿发生及演进规律，最终结合临床和影像信息，预测出血性脑卒中患者的临床预后。\n\n\\subsection*{目标变量：}\n\\begin{itemize}\n    \\item 发病 48 小时内是否发生血肿扩张：1 是；0 否。\n    \\item 发病后 90 天 mRS：0-6，有序等级变量。其中 mRS 是评估卒中后患者功能状态的重要工具，详见附件 2 相关概念。\n\\end{itemize}\n\n\\subsection*{临床信息：相关信息在“表 1-患者列表及临床信息”中获取。}\n\\begin{itemize}\n    \\item ID：患者 ID。\n \\begin{itemize} \n        \\item 训练数据集：sub 001 至 sub 100，共计 100 例。包含：患者信息、首次及所有随访影像数据及 90 天 mRS。\n       \\item 测试数据集 1：sub 101 至 sub 130，共计 30 例。包含：患者信息、首次影像数据。不包含：随访影像数据及 90 天 mRS。\n       \\item 测试数据集 2：sub 131 至 sub 160，共计 30 例。包含：患者信息、首次及所有随访影像数据。不包含：90 天 mRS。\n\\end{itemize}   \\item 入院首次影像检查流水号：一个 14 位数字编码。前 8 位代表年月日，后 6 位为顺序编号（注意：不是时分秒）。流水号是影像检查的唯一编码，具体影像检查时间点可通过对应流水号在“附表 1-检索表格-流水号 vs 时间”中检索。\n    \\item 年龄：岁\n    \\item 性别：男/女\n    \\item 脑出血前 mRS 评分：0-6，有序等级变量\n    \\item 高血压病史：1 是 0 否\n    \\item 卒中病史：1 是 0 否\n    \\item 糖尿病史：1 是 0 否\n    \\item 房颤史：1 是 0 否\n    \\item 冠心病史：1 是 0 否\n    \\item 吸烟史：1 是 0 否\n    \\item 饮酒史：1 是 0 否\n\\end{itemize}\n\n\\subsection*{发病相关特征，共计2字段。}\n\\begin{itemize}\n    \\item 血压：收缩压/舒张压。单位：毫米汞柱\n    \\item 发病到首次影像检查时间间隔：单位：小时\n\\end{itemize}\n\n\\subsection*{治疗相关特征，共计7字段。}\n\\begin{itemize}\n    \\item 脑室引流：1是0否\n    \\item 止血治疗：1是0否\n    \\item 降颅压治疗：1是0否\n    \\item 降压治疗：1是0否\n    \\item 镇静、镇痛治疗：1是0否\n    \\item 止吐护胃：1是0否\n    \\item 营养神经：1是0否\n\\end{itemize}\n\n\\subsection*{影像相关特征，共计84字段/时间点。}\n\\begin{itemize}\n    \\item 血肿及水肿的体积和位置信息在“表2-患者影像信息血肿及水肿的体积及位置”中获取，包含了：每个时间点血肿（Hemo）总体积及水肿（ED）总体积及不同位置的占比。体积占比定义：血肿/水肿在该位置的体积占总体积大小的比例，取值范围为：0-1。如：0代表该区域没有发生血肿/水肿，1则代表该患者所有血肿/水肿均发生在该区域，可通过占比换算出该位置绝对体积。本赛题采用通用模板，区分左右侧大脑前动脉（ACA\\_L，ACA\\_R），左右侧大脑中动脉（MCA\\_L，MCA\\_R），左右侧大脑后动脉（PCA\\_L，PCA\\_R），左右侧脑桥/延髓（Pons\\_Medulla\\_L，Pons\\_Medulla\\_R），左右侧小脑（Cerebellum\\_L，Cerebellum\\_R）共十个不同位置，具体位置和参考文献见附件2-相关概念。综上，总体积：2个字段（单位：$10^{-3}$ml），位置：20个字段。在每个时间点，体积及位置特征共计22个字段。\n    \\item 血肿及水肿的形状及灰度分布在“表3-患者影像信息血肿及水肿的形状及灰度分布”的两个不同标签页存放，可通过流水号检索对应数据。每个时间点血肿及水肿的形状及灰度特征，反映目标区域内体素信号强度的分布（17个字段）及三维形状的描述（14个字段），因此，在每个时间点，血肿及水肿的形状+灰度分布特征共62字段。\n\\end{itemize}\n注：重复影像数据根据临床真实情况提供，重复时间个体间可能存在差异。\n\n\\section*{三、请建模回答如下问题}\n\n\\section*{1 血肿扩张风险相关因素探索建模。}\n\\begin{enumerate}\n    \\item[a)] 请根据“表1”（字段：入院首次影像检查流水号，发病到首次影像检查时间间隔），“表2”（字段：各时间点流水号及对应的HM\\_volume），判断患者sub001至sub100发病后48小时内是否发生血肿扩张事件。\n\\end{enumerate}\n结果填写规范：1是0否，填写位置：“表4”C字段（是否发生血肿扩张）。\n\n如发生血肿扩张事件，请同时记录血肿扩张发生时间。\n\n\n\n\\textbf{结果填写规范：}如10.33小时，填写位置：“表4”D字段（血肿扩张时间）。\n\n是否发生血肿扩张可根据血肿体积前后变化，具体定义为：后续检查比首次检查绝对体积增加≥6 mL或相对体积增加≥33%。\n\n注：可通过流水号至“附表1-检索表格-流水号vs时间”中查询相应影像检查时间点，结合发病到首次影像时间间隔和后续影像检查时间间隔，判断当前影像检查是否在发病48小时内。\n\n\\item[b)] 请以是否发生血肿扩张事件为目标变量，基于“表1” 前100例患者（sub001至sub100）的个人史，疾病史，发病相关（字段E至W）、“表2”中其影像检查结果（字段C至X）及“表3”其影像检查结果（字段C至AG，注：只可包含对应患者首次影像检查记录）等变量，构建模型预测所有患者（sub001至sub160）发生血肿扩张的概率。\n\n注：该问只可纳入患者首次影像检查信息。\n\n\\textbf{结果填写规范：}记录预测事件发生概率（取值范围0-1，小数点后保留4位数）；填写位置：“表4”E字段（血肿扩张预测概率）。\n\n\\end{enumerate} \\section*{2 血肿周围水肿的发生及进展建模，并探索治疗干预和水肿进展的关联关系。}\n\na) 请根据“表2”前100个患者（sub001至sub100）的水肿体积（ED\\_volume）和重复检查时间点，构建一条全体患者水肿体积随时间进展曲线（x轴：发病至影像检查时间，y轴：水肿体积，$y=f(x)$），计算前100个患者（sub001至sub100）真实值和所拟合曲线之间存在的残差。\n\n\\textbf{结果填写规范：}记录残差，填写位置“表4”F字段（残差（全体））。\n\nb) 请探索患者水肿体积随时间进展模式的个体差异，构建不同人群（分亚组：3-5个）的水肿体积随时间进展曲线，并计算前100个患者（sub001至sub100）真实值和曲线间的残差。\n\n\\textbf{结果填写规范：}记录残差，填写位置“表4”G字段（残差（亚组）），同时将所属亚组填写在H段（所属亚组）。\n\nc) 请分析不同治疗方法（“表1”字段Q至W）对水肿体积进展模式的影响。\n\nd) 请分析血肿体积、水肿体积及治疗方法（“表1”字段Q至W）三者之间的关系。\n\n\\section*{3 出血性脑卒中患者预后预测及关键因素探索。}\n\na) 请根据前100个患者（sub001至sub100）个人史、疾病史、发病相关（“表1”字段E至W）及首次影像结果（表2，表3中相关字段）构建预测模型，预测患者（sub001至sub160）90天mRS评分。\\textbf{注：该问只可纳入患者首次影像检查信息。}\n\n\\textbf{结果填写规范：记录预测 mRS 结果，0-6，有序等级变量。填写位置“表 4”I 字段（预测 mRS（基于首次影像））。}\n\nb) 根据前 100 个患者（sub001 至 sub100）所有已知临床、治疗（表 1 字段 E 到 W）、表 2 及表 3 的影像（首次+随访）结果，预测所有含随访影像检查的患者（sub001 至 sub100，sub131 至 sub160）90 天 mRS 评分。\n\n\\textbf{结果填写规范：记录预测 mRS 结果，0-6，有序等级变量。填写位置“表 4”J 字段（预测 mRS）。}\n\nc) 请分析出血性脑卒中患者的预后（90 天 mRS）和个人史、疾病史、治疗方法及影像特征（包括血肿/水肿体积、血肿/水肿位置、信号强度特征、形状特征）等关联关系，为临床相关决策提出建议。",
  "subtask": {
    "1": {
      "subtask": "子任务1 聚焦于数据准备与衔接以生成用于后续分析的、可复现的时间序列与“48小时内血肿扩张”标签：输入文件为“表1-患者列表及临床信息.xlsx”（含每例的入院首次影像流水号与发病到首次影像时间间隔等）、“表2-患者影像信息血肿及水肿的体积及位置.xlsx”（按随访序列给出每次流水号与 HM_volume/ED_volume 等）、以及“附表1-检索表格-流水号vs时间.xlsx/…(1).xlsx”；输出为标准化的长表（每条为一例一扫描）并在“表4-答案文件.xlsx”相应 C（是否发生血肿扩张）与 D（扩张发生时间）字段写入结果。具体步骤：1) 数据导入与重整：用 Python(pandas)/R(dplyr) 将表2 从宽表转为长表，字段至少包含 patient_id、scan_seq、scan_流水号、HM_volume、ED_volume、其它位置占比字段；2) 扫描时间映射与发病时刻重构：通过附表1 将每一流水号映射为绝对扫描时间（精确到分钟/小时）；对于每位患者计算 onset_time = first_scan_time - 发病到首次影像时间间隔（小时），再为每次扫描计算 t_from_onset = scan_time - onset_time（小时，浮点）；在无法映射流水号时记录为缺失并在日志中标注；3) 体积单位与一致性校验：检测 HM_volume/ED_volume 的原始单位（若为 mm^3 或文档指明为 mm³，则统一转换为 mL：mL = mm³ / 1000），确保所有体积以 mL 存储并对负值、零值或极端离群值做 plausibility check（超出生理范围或 >99.9 百分位的值标为异常并记录）；4) 基线与时间窗口定义：对每位训练集中（sub001–sub100）患者识别基线 HM0 = HM at first scan（若基线缺失则在日志标注并将该例标记为“无法判定”以供人工复核或后续规则处理）；5) 血肿扩张自动判定逻辑：对每位患者遍历其后续扫描点（按 t_from_onset 升序），仅考虑 t_from_onset ≤ 48 小时的扫描；对每次扫描计算绝对增量 ΔHM = HM(t) - HM0（mL）与相对增量 rHM = HM(t)/HM0 - 1；若存在最早时间点满足 ΔHM ≥ 6 mL 或 rHM ≥ 0.33，则将该患者的扩张指示 E = 1，扩张时间 Tau = 对应 t_from_onset（小时，保留两位小数），并在遇到相同时间点有多次记录时取最大 HM 值用于判定；若在 48 小时窗口内无任何扫描满足条件则设 E = 0；6) 缺失与边界情况处理规则：若患者无任何随访扫描或无可用体积值则将 E 置为 0 并单独标注为“缺乏随访数据/需人工核查”，若基线 HM0 极小（接近零）导致相对增幅计算不稳定，则优先采用绝对阈值并同时保留异常标志；7) 质量控制与日志：对每一步（流水号未映射、时间负值、体积单位不一致、异常值、缺失记录数、判定为无法判定的病例）写入处理日志，并保存中间文件（长表、时间映射表、异常清单）；8) 可重复性与工具建议：实现时在脚本中固定随机种子、版本化数据与代码（git），常用工具为 Python (pandas, numpy) 或 R (tidyverse)，并将最终标注结果（E 与 Tau）以规定格式写回“表4”指定字段，同时输出一份含方法说明、缺失统计与判定例外的处理报告以便审查与后续使用。",
      "criteria": {
        "task_understanding": {
          "core_goal": "题目要考什么——按题型拆解关键能力：本子任务的核心目标是构建可复现的数据衔接与判定流程，将散布在多张表格的影像随访记录标准化为按扫描为单位的长表（包含 patient_id、scan_seq、scan_流水号、scan_time、t_from_onset、HM_volume（mL）、ED_volume（mL）等字段），基于首次影像确定基线 HM0 并在发病 48 小时窗口内自动判定血肿扩张事件（E）和首次满足阈值的扩张时间（Tau）。任务强调数学建模思维：先明确判定规则与时间参照（建模），再实现映射与计算（实现/求解），最后生成日志与异常清单供复核（验证）。",
          "expected_output": "（1）标准化的长表（每行一例一次扫描），字段至少含 patient_id、scan_seq、scan_流水号、scan_time（绝对时间）、t_from_onset（小时浮点）、HM_volume_mL、ED_volume_mL、位置占比等；（2）对训练集中 sub001–sub100 的二分类标签 E（是否在48小时内扩张，写入表4.C，值0/1）及扩张发生时间 Tau（小时，两位小数，写入表4.D，若无扩张则空白或 NA）；（3）中间产物：流水号->时间映射表、异常值清单、缺失记录与判定无法确定的样例清单及处理日志；（4）方法说明与可复现的脚本（含固定随机种子与版本信息）。",
          "key_inputs_constraints": "输入：表1（患者列表含首次影像流水号与发病到首次影像时间间隔）、表2（每次流水号对应 HM_volume/ED_volume/位置占比 的随访记录，可能为宽表需长表化）、附表1（流水号 vs 绝对扫描时间映射，精确到分钟/小时）。关键约束/假设：使用首次影像作为基线 HM0；体积单位需统一为 mL（若源为 mm^3 则 mL = mm^3/1000）；扩张判定阈值为 ΔHM ≥ 6 mL 或 相对增幅 rHM ≥ 0.33；仅考虑 t_from_onset ≤ 48 小时的随访；若基线缺失或无随访则需标注并供人工复核；遇相同时间点多条记录取最大 HM 值用于判定；必须记录并上报所有映射失败或异常值。",
          "modeling_type": "数据预处理 + 规则化判定（数据工程/分类判定/时间序列整理），属于“数据整理与规则判定”范畴（结合工程实现的判定逻辑而非统计建模或机器学习训练），涉及时间映射与阈值判别。",
          "role_in_pipeline": "本子任务是整个建模流程的前置数据准备与标签生成环节：为后续血肿扩张预测建模、序列建模与预后分析提供干净、时间对齐、可追溯的训练标签和时间序列。其难点在于跨表时间映射、单位一致性、临床阈值精确实现与缺失/异常的稳健处理，任何错误会系统性污染后续模型训练与评估。"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "核心判定目标识别",
              "description": "明确并表述本子任务的关键判定目标：为 sub001–sub100 生成是否在发病 48 小时内发生血肿扩张的二进制标签 E（写表4.C）及扩张发生时间 Tau（小时，两位小数，写表4.D），并产出可复现的长表与日志。",
              "score": 40,
              "evaluation_focus": "任务目标抽象能力与对输出形式（表4.C/D、长表、日志）的识别",
              "scoring_hint": "高分：准确指出 E 与 Tau 的定义、输出位置（表4.C/D）及长表和日志需求；中分：识别为标签生成但未指明具体字段或时间精度；低分：未能明确 E/Tau 的阈值或输出位置。"
            },
            {
              "sub_criteria": "关键规则与阈值识别",
              "description": "识别并列明判定规则：基线 HM0 = first scan HM；只考虑 t_from_onset ≤ 48 小时的随访；扩张为 ΔHM ≥ 6 mL 或 rHM ≥ 0.33；相同时间点取最大 HM 值等具体业务规则。",
              "score": 35,
              "evaluation_focus": "业务规则理解与细节把控",
              "scoring_hint": "高分：完整列出绝对与相对阈值、时间窗口、同时间点处理方式和基线定义；低分：缺失任一关键规则或将阈值写错（例如把 6 mL 写为 6 cm^3）。"
            },
            {
              "sub_criteria": "数据源与字段依赖识别",
              "description": "明确输入表格与必须字段：表1（首次流水号、发病到首次影像小时数）、表2（流水号、HM_volume、ED_volume、位置占比）、附表1（流水号->时间映射），并指出需将表2由宽表转为长表。",
              "score": 25,
              "evaluation_focus": "原始数据映射与字段依赖识别",
              "scoring_hint": "高分：列出所有必需表与字段并说明长表化必要性；低分：遗漏关键表或未指出流水号->时间映射需求。"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "以步骤化语言复述任务流程",
              "description": "用步骤化（pipeline）语言复述从导入、长表化、时间映射、单位转换到判定与输出的完整流程，突出每步的输入/输出与中间产物（例如 onset_time、t_from_onset、HM0、ΔHM、rHM 表/列）。",
              "score": 35,
              "evaluation_focus": "流程化思维与结果可追溯性表达",
              "scoring_hint": "高分：按序列化步骤列出并输出中间表名与关键列；低分：只笼统描述未给出中间产物或缺少时间计算细节。"
            },
            {
              "sub_criteria": "边界与异常情况复述",
              "description": "明确并列出需处理的边界情况：基线缺失、无随访、流水号无法映射、体积单位多样或异常值、基线极小导致相对增幅不稳定等，并说明需要日志记录及人工复核标注。",
              "score": 40,
              "evaluation_focus": "异常识别与稳健性考虑",
              "scoring_hint": "高分：全面列出并为每种异常提出处理方向（例如将 E 置为 0 并标注或标为‘无法判定’）；低分：仅提及少数异常或未说明如何标注复核。"
            },
            {
              "sub_criteria": "可复现性与审计痕迹复述",
              "description": "说明需保存的审计信息：中间文件（长表、时间映射表、异常清单）、处理日志、脚本版本与依赖（tools、seed、git 提交或版本号）。",
              "score": 25,
              "evaluation_focus": "数据工程/可追溯性意识",
              "scoring_hint": "高分：列出具体需保存的文件与版本控制方法；低分：未提及版本控制或日志。"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "基线与时间假设明确性",
              "description": "明确假设首次影像为基线（HM0），发病时刻可通过 first_scan_time - 发病到首次影像时间间隔 重构；流水号映射表时间精确度足以计算 t_from_onset（小时）。",
              "score": 30,
              "evaluation_focus": "临床时间参照与基线定义的合理性判断",
              "scoring_hint": "高分：说明并合理化为何采用首次影像为基线并考虑时间映射精度问题；低分：未说明或盲目假设时间精确度。"
            },
            {
              "sub_criteria": "体积与单位处理假设",
              "description": "列出单位统一策略（若为 mm^3 则除以 1000 转为 mL），并假设转换后值在生理范围内，同时设定 plausibility 检查阈（例如体积<0 或 >99.9 百分位为异常）。",
              "score": 30,
              "evaluation_focus": "数据一致性与单位换算意识",
              "scoring_hint": "高分：给出明确转换公式与异常判定阈；低分：遗漏单位转换或不做合理 plausibility 检查。"
            },
            {
              "sub_criteria": "相同时间点与基线极小的优先决策",
              "description": "说明若同一 t_from_onset 有多条扫描记录应取最大 HM 值用于判定；并在 HM0 很小（接近零）时优先采用绝对阈值 ΔHM ≥ 6 mL 并标记相对判断不稳定。",
              "score": 20,
              "evaluation_focus": "边界决策与优先规则的建立",
              "scoring_hint": "高分：清楚写明优先级并说明原因；低分：不处理或处理不一致。"
            },
            {
              "sub_criteria": "缺失处理与人工复核规则",
              "description": "假设并说明当流水号无法映射或无随访体积时将该例标注为需人工复核，并将 E 设为 0（或标识为无法判定），记录在日志中以便后续人工检查。",
              "score": 20,
              "evaluation_focus": "业务操作与可审计性假设",
              "scoring_hint": "高分：给出清晰的缺失标注与默认策略；低分：无默认策略或可能导致标签不一致。"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "数据长表化与关键字段构造",
              "description": "实现从表2（宽表）到长表的稳定转换，输出包含 patient_id、scan_seq、scan_流水号、scan_time（从附表1 映射）、t_from_onset（小时）、HM_volume_mL、ED_volume_mL、位置占比等列，并记录缺失与重复情况。",
              "score": 30,
              "evaluation_focus": "数据工程能力与字段工程（时间与体积列）",
              "scoring_hint": "高分：长表列完整、时间列精确、重复与缺失处理有记录；低分：列不完整或时间映射缺失。"
            },
            {
              "sub_criteria": "时间映射与 onset_time 重构",
              "description": "正确实现流水号->scan_time 映射，计算 onset_time = first_scan_time - 发病到首次影像小时数，并据此计算每次 scan 的 t_from_onset（小时浮点，保留至少两位小数）。缺失映射需记录并不破坏其他样例流程。",
              "score": 30,
              "evaluation_focus": "时间算术与时间序列对齐能力",
              "scoring_hint": "高分：映射准确且处理了映射失败样例；低分：映射错误导致负时间或 t_from_onset 计算错误。"
            },
            {
              "sub_criteria": "扩张判定逻辑编码设计",
              "description": "构建遍历后续扫描按时间升序判定的逻辑：仅考虑 t_from_onset ≤ 48 小时；当 ΔHM ≥ 6 mL 或 rHM ≥ 0.33 时记录最早满足时间 Tau；在相同时间点取最大 HM 判定；处理 HM0 极小情形的优先策略。",
              "score": 25,
              "evaluation_focus": "规则化判定逻辑的完整性与临床阈值实现",
              "scoring_hint": "高分：逻辑覆盖所有判定情形且实现最早时间取值；低分：仅部分实现或忽略最早判定/相同时间点处理。"
            },
            {
              "sub_criteria": "异常检测与记录机制",
              "description": "在模型中嵌入 plausibility 检查（负值、极端值、单位不一致、超 99.9 百分位），并将异常样例输出至单独清单供人工复核。",
              "score": 15,
              "evaluation_focus": "质量控制机制设计",
              "scoring_hint": "高分：异常规则明确并有清单输出；低分：无异常检测或仅抛出错误不记录。"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "判定逻辑的正确执行与最早时间识别",
              "description": "检验并证明遍历后续扫描按时间升序可正确识别最早满足 ΔHM ≥ 6 mL 或 rHM ≥ 0.33 的时间点，并输出 Tau 两位小数（小时）。",
              "score": 40,
              "evaluation_focus": "逻辑推理与时间点选择正确性",
              "scoring_hint": "高分：所有测试样例（含同时间点、多随访、基线极小）均正确识别最早时间；低分：在边界情形下识别错误或时间精度不足。"
            },
            {
              "sub_criteria": "单位转换与数值稳定性验证",
              "description": "验证体积单位转换是否正确（mm^3->mL），并在转换后对 ΔHM 与 rHM 计算无数值异常（如除以零、Inf），对基线为零或接近零做保护性处理并记录策略。",
              "score": 30,
              "evaluation_focus": "数值处理与稳定性检验",
              "scoring_hint": "高分：所有样例无数值异常且基线零处理合理；低分：出现 NaN/Inf 或无基线保护。"
            },
            {
              "sub_criteria": "完整性检测（覆盖所有训练样例）",
              "description": "确认对 sub001–sub100 每例给出 E 值与 Tau（或明确的缺失/无法判定标注），并统计无随访或无法判定的样例数。",
              "score": 20,
              "evaluation_focus": "任务覆盖性与输出完整性",
              "scoring_hint": "高分：100 例均有明确标注或被列为需人工复核；低分：有若干例未处理或漏写表4 字段。"
            },
            {
              "sub_criteria": "可重复性测试（闭环验证）",
              "description": "在不同数据子集或随机化顺序下重复运行判定流程，结果一致且记录版本信息与随机种子（若用到随机过程）。",
              "score": 10,
              "evaluation_focus": "流程稳健性与可复现性",
              "scoring_hint": "高分：多次运行结果一致并提供版本/种子；低分：结果不稳定或无复现说明。"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "脚本结构与可读性",
              "description": "提供清晰、模块化的实现脚本（Python/pandas 或 R/tidyverse），包含数据导入、长表化、时间映射、单位转换、判定逻辑、异常检测与输出模块，代码注释和 README 描述每一步的输入/输出文件路径和依赖库及版本。",
              "score": 35,
              "evaluation_focus": "工程化实现能力与可维护性",
              "scoring_hint": "高分：模块化、注释充分且 README 明确；中分：功能齐全但注释或结构欠清晰；低分：脚本臃肿、不可运行或无说明。"
            },
            {
              "sub_criteria": "错误处理与日志记录",
              "description": "代码中应包含对流水号映射失败、单位未知、负值/极端值、无随访等情况的异常处理与日志（可写入文件），并输出异常清单与统计汇总。",
              "score": 30,
              "evaluation_focus": "稳健编码与异常审计实现",
              "scoring_hint": "高分：所有异常被捕获并记录到日志文件；低分：错误导致脚本中断或无日志记录。"
            },
            {
              "sub_criteria": "结果写回与文件输出格式",
              "description": "实现将 E 与 Tau 写回表4 指定字段（表4.C、表4.D）并保存最终长表、流水号映射表和异常清单，文件格式（例如 xlsx/csv）与列名应与题目要求一致，输出有 checksum 或行数校验报告。",
              "score": 20,
              "evaluation_focus": "输出准确性与交付物规范性",
              "scoring_hint": "高分：写回准确、格式符合题目并包含校验信息；低分：位置错误、格式不符或缺少中间文件。"
            },
            {
              "sub_criteria": "可复现与版本控制实践",
              "description": "提供运行脚本或说明如何在环境中复现（requirements.txt 或 renv lock 文件），并说明代码版本（git commit id），若使用随机过程固定随机种子。",
              "score": 15,
              "evaluation_focus": "工程化复现实践",
              "scoring_hint": "高分：有完整依赖列表与 git 版本号与复现命令；低分：无依赖说明或无版本管理信息。"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "输出一致性与异常统计报告",
              "description": "对生成的 E/Tau 结果进行汇总统计（E=1 比例、扩张发生时间分布、无随访/无法判定样例数），并列出流水号映射失败、单位异常与体积异常样例清单，提供这些异常对总体标签质量的潜在影响评估。",
              "score": 35,
              "evaluation_focus": "结果汇总与质量评估",
              "scoring_hint": "高分：包含详尽统计表与异常分析并对数据质量影响给出定量估计；低分：仅输出标签无统计或无异常影响讨论。"
            },
            {
              "sub_criteria": "边界情形与判定敏感性分析",
              "description": "对关键决策（例如在 HM0 非常小情况下选择绝对阈值 vs 相对阈值；同时间点取最大值的影响）做敏感性分析，报告在不同处理策略下 E/Tau 的变动情况并建议优选策略。",
              "score": 30,
              "evaluation_focus": "建模思维下的验证与稳健性评估",
              "scoring_hint": "高分：提供量化的敏感性对比并给出合理建议；低分：无敏感性分析或结论无支撑数据。"
            },
            {
              "sub_criteria": "可供后续使用的文档化说明",
              "description": "输出一份方法说明文档，包含处理流程图、字段定义、判定规则、异常处理策略与中间文件说明，以便后续建模团队使用并复核标签生成流程。",
              "score": 25,
              "evaluation_focus": "可交付文档编写能力与沟通清晰度",
              "scoring_hint": "高分：文档清晰、覆盖所有关键点并附示例；低分：文档缺失重要步骤或不便阅读。"
            },
            {
              "sub_criteria": "对后续建模影响的诊断建议",
              "description": "基于标签质量与异常分布，提出对下游血肿扩张预测建模的建议（例如：剔除/标注异常样例、对少数样例采用人工复核、是否需要补充时间精度信息等）。",
              "score": 10,
              "evaluation_focus": "面向后续建模的洞察与建议能力",
              "scoring_hint": "高分：提出具体可行的建议并说明理由；低分：泛泛而谈或无建议。"
            }
          ]
        }
      }
    },
    "2": {
      "subtask": "子任务2（48小时内血肿扩张判定与概率预测）旨在两步完成：一是基于表1（含首次影像流水号与发病到首次影像时间间隔）、表2（每次检查流水号与 HM_volume）及附表1（流水号→绝对检查时间映射）生成训练集中每例（sub001–sub100）的二元标签 E（48 小时内是否发生血肿扩张）和扩张发生时间 Tau（首个满足阈值的 t，从发病起，单位小时，保留两位小数）；判定规则为仅检索 t ≤ 48 小时的随访影像，先将所有体积统一单位（mm^3→mL，1 mL = 1000 mm^3），以首次影像 HM0 为基线，遍历后续扫描若存在 HM(t) - HM0 ≥ 6 mL 或 HM(t)/HM0 ≥ 1.33 则记录最早满足条件的 t 为 Tau 并设 E=1，否则 E=0；在基线 HM0 极小或缺失、流水号无法映射、同一时间点有多次测量等异常情形应按预先定义的规则处理（优先绝对阈值、以该时间点最大 HM 判定、记录为需人工复核），并将所有处理与异常写入处理日志。二是以仅含首次影像和入院临床信息（表1 的临床变量、表2/表3 中首次影像的体积/位置/形状/灰度特征）为输入，在 sub001–sub100 上训练概率化模型 P(E=1|features) 并将对所有患者（sub001–sub160）给出事件发生概率（0–1，保留4位小数）；实施细节包括：数据预处理（缺失值多重插补或缺失指示、连续特征标准化、类别变量独热/有序编码、体积单位统一）、高维影像特征降维或稀疏选择（方差/共线性过滤、基于单变量筛选后 PCA 或 LASSO/ElasticNet 选择）、处理类别不平衡（类别权重或 SMOTE/欠采样），模型候选为带正则化的 Logistic 回归（ElasticNet）以输出校准概率为首选，备用/比较为梯度提升树（XGBoost/LightGBM）并在训练后使用独立验证折进行 Platt 或 Isotonic 校准；训练与评估采用嵌套交叉验证进行超参调优并以 AUC、Brier score、灵敏度/特异度、校准曲线与决策阈值敏感性作为主要度量，最终模型在独立或留出集上预测概率并导出四位小数的结果写入答案表（表4 指定字段），同时保存模型、特征重要性（标准化回归系数或 SHAP 值）、不确定性与处理日志以保证可复现性（固定随机种子、记录软件包版本）。",
      "criteria": {
        "preface": "题目要考什么——按题型拆解关键能力：本子任务检验选手在真实临床影像-时间序列数据上进行可复现的数据整合、时间重构、临床事件（48小时内血肿扩张）自动判定与基于首次影像的概率化预测的完整建模流程能力。强调先建模（明确判定规则与前处理）、再选算法（校准概率输出、处理不平衡）、再验证（嵌套CV与校准评估）与完备日志与可复现性。",
        "task_understanding": {
          "core_goal": "对训练集(sub001–sub100)基于流水号→时间映射与 HM_volume 时间序列，自动判定每例在发病后48小时内是否发生血肿扩张（E=0/1）及最早满足阈值的发生时间 Tau（小时，保留两位小数）；并基于仅首次影像与入院临床变量训练概率模型，输出所有病例(sub001–sub160)发生扩张的预测概率（0-1，保留4位小数）。",
          "expected_output": "两个层次的输出：1) 结构化长表中为每例写回二元标签 E 与扩张时间 Tau（表4 C、D）；2) 概率化预测向量 P(E=1|features) 对所有病例（表4 E），并保存模型文件、特征重要性、校准曲线与处理日志。",
          "key_inputs_constraints": "输入：表1（首次影像流水号、发病到首次影像时间间隔及临床变量）、表2（每次流水号与 HM_volume/ED_volume 等）、附表1（流水号→绝对影像时间）。约束与必须遵守的判定规则：统一体积单位为 mL（mm^3→mL，1 mL=1000 mm^3）；基线 HM0=首次影像 HM；仅考虑 t_from_onset ≤ 48 小时的后续扫描；判定阈值 ΔHM ≥ 6 mL 或 相对增幅 HM/HM0 ≥ 1.33；遇基线极小、流水号无法映射或缺失数据须按预定义规则记录并标注需人工复核；同一时间点多次测量取该时间点最大 HM 值用于判定；所有异常记录在处理日志并保存中间文件。性能评估需输出校准和不确定性度量。",
          "modeling_type": "二元事件判定（规则化时间序列判定）+ 概率预测（分类/概率化机器学习模型，带校准）；涉及数据拟合与概率估计，属监督学习与时间序列数据预处理范畴。",
          "role_in_pipeline": "该子任务是上游关键数据准备与第一级临床事件标注（标签化）与基于首次影像的风险建模：其判定结果为后续所有分析（如水肿进展建模、预后预测）的输入标签或对照，且对可重复性与审计追踪要求高。主要难点包括流水号→时间精确映射、体积单位与极端值处理、基线近零导致的相对增幅不稳定、训练数据不平衡与小样本高维影像特征选择与校准。"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "核心目标明确度（48小时扩张判定与概率预测）",
              "description": "明确指出需要两类产出：基于随访序列生成训练集中每例的二元标签 E 与扩张时间 Tau（遵循 ΔHM≥6 mL 或 HM/HM0≥1.33 且 t≤48h 的最早时间点），以及基于首次影像与临床信息训练并输出概率化模型 P(E=1)。",
              "score": 40,
              "evaluation_focus": "将临床事件判定规则与机器学习风险预测任务分层描述的能力",
              "scoring_hint": "高分：清晰区分判定规则任务与概率建模任务并逐条列出阈值/时间窗/单位要求；低分：将两项混为一谈或遗漏关键阈值与时间窗要求。"
            },
            {
              "sub_criteria": "输入-输出数据映射识别",
              "description": "准确识别并列明需要用到的具体字段：表1的首次流水号与发病到首次影像时间、表2的所有流水号与 HM_volume、附表1的流水号→扫描时间映射，输出为长表（每条为一例一次扫描）并在表4写回E与Tau和概率列。",
              "score": 30,
              "evaluation_focus": "数据工程与字段映射能力、理解数据关联系数的能力",
              "scoring_hint": "高分：明确列出必须字段并说明长表结构与写回位置；低分：泛泛而谈或遗漏关键字段（如流水号或HM_volume）。"
            },
            {
              "sub_criteria": "时间重建与窗口策略识别",
              "description": "识别 onset_time 的重构方法（first_scan_time - 发病到首次影像间隔），以及计算 t_from_onset 并仅筛选 t≤48 h 的扫描用于判定的必要性。",
              "score": 20,
              "evaluation_focus": "时序重构与窗口约束理解能力",
              "scoring_hint": "高分：给出 onset_time 计算公式并说明对无法映射流水号的影响；低分：忽略时间映射或错误使用流水号编码（如将流水号后6位误作时间）。"
            },
            {
              "sub_criteria": "异常与缺失数据风险识别",
              "description": "识别基线 HM0 缺失或接近零、流水号无法映射、重复同一时间点多值等异常情形，并说明需记录日志与标注为需人工复核或按规则处理（优先绝对阈值、取该时间点最大HM）。",
              "score": 10,
              "evaluation_focus": "数据完整性评估与异常情形前瞻性考虑",
              "scoring_hint": "高分：列出主要异常情形并给出处理原则；低分：未识别关键异常或无处理方案。"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "流程化判定复述（从导入到写回）",
              "description": "用流程化步骤复述完整任务：宽表→长表、流水号映射时间、onset 重构、单位转换、基线定义、48h内遍历判定、写回表4并输出日志与中间文件。",
              "score": 30,
              "evaluation_focus": "将复杂处理步骤线性分解并形成可执行流程的能力",
              "scoring_hint": "高分：按可执行顺序列出所有关键步骤并标注输出；低分：步骤混乱或遗漏写回/日志/中间文件要求。"
            },
            {
              "sub_criteria": "基线与判定逻辑的精确复述",
              "description": "明确HM0=首次影像的HM_volume，判定条件为任一 t≤48h 的 HM(t)-HM0≥6 mL 或 HM(t)/HM0≥1.33，遇同一时间点多测量取最大HM，记录最早满足条件的 t 为 Tau。",
              "score": 30,
              "evaluation_focus": "将数学判定规则准确转述为可编程条件的能力",
              "scoring_hint": "高分：严格写出数学表达式并处理多测量情形；低分：表达含糊或阈值与基线混淆。"
            },
            {
              "sub_criteria": "缺失与边界情况的复述",
              "description": "复述异常情形处理规则：无随访则 E=0 并标注缺乏随访；流水号映射失败记录缺失并人工核查；基线极小优先应用绝对阈值并标注异常。",
              "score": 20,
              "evaluation_focus": "边界条件考虑与风险控制意识",
              "scoring_hint": "高分：列出并解释每种边界情形的具体编码规则；低分：没有具体处理策略或随机设定标记。"
            },
            {
              "sub_criteria": "输出格式、精度与审计要求复述",
              "description": "说明 Tau 的单位与精度（小时，保留两位小数）、概率输出保留4位小数、需保存长表、中间映射表、异常清单与处理日志，写回至表4指定字段。",
              "score": 20,
              "evaluation_focus": "结果格式约束与可审计输出意识",
              "scoring_hint": "高分：精确列出字段/精度并说明审计文件；低分：未规定输出精度或缺少审计文件要求。"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "时间映射与发病时刻假设",
              "description": "明确假设首次影像时间与表1给出的发病到首次影像时间间隔一致，可用来反推实际发病时刻；若流水号无法映射则需记录并视为缺失，不随意插值。",
              "score": 30,
              "evaluation_focus": "合理处理时间数据的可操作性假设能力",
              "scoring_hint": "高分：说明时间精度假设（到分钟/小时）并给出无法映射时的保守策略；低分：忽视时间精度或对缺失做不合理插值。"
            },
            {
              "sub_criteria": "体积测量与单位一致性假设",
              "description": "假设所有原始体积若非以 mL 表示需统一换算（mm^3→mL），并假定测量误差在可接受范围内；对极端离群值假设为测量或录入错误并须人工核查。",
              "score": 25,
              "evaluation_focus": "将单位转换与测量误差显式化的能力",
              "scoring_hint": "高分：列明单位转换公式并给出离群判定界（如>99.9百分位或超生理值）；低分：没处理单位或不考虑测量误差。"
            },
            {
              "sub_criteria": "基线近零与相对增幅处理假设",
              "description": "对 HM0 极小（接近零）可能导致 HM/HM0 不稳定的情形，假设优先使用绝对阈值 ΔHM≥6 mL 并将该例标注为需人工复核或采用稳健规则（如以最小可测体积阈值替代）。",
              "score": 25,
              "evaluation_focus": "对数值稳定性与判定鲁棒性假设的把握",
              "scoring_hint": "高分：给出具体替代策略或稳健性阈值并说明其合理性；低分：忽视基线近零问题或无替代策略。"
            },
            {
              "sub_criteria": "训练数据与模型可推广性的假设",
              "description": "假设训练集(sub001–sub100)的随访与首检分布代表待预测总体(sub001–sub160)，并说明若不满足时需在结果中限制外推性声明。",
              "score": 20,
              "evaluation_focus": "对样本代表性与外推风险的认识",
              "scoring_hint": "高分：明确指出可推广性限制并建议验证策略；低分：无相关讨论或过度自信宣称普适性。"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "特征工程与预处理策略",
              "description": "针对首次影像与表1临床变量明确缺失值处理（多重插补或缺失指示）、连续变量标准化、类别变量编码（有序与无序分开）、以及体积与位置字段的派生（如绝对各区体积 = 总体积 × 占比）。",
              "score": 30,
              "evaluation_focus": "数据预处理与从临床要求到可用特征的转化能力",
              "scoring_hint": "高分：给出合理的插补方法与编码方案，并生成临床可解释的派生特征；低分：未处理占比转换或缺失处理随意。"
            },
            {
              "sub_criteria": "高维影像特征降维/稀疏选择策略",
              "description": "提出针对表3高维灰度/形状特征的降维或选择策略（先方差/共线性过滤→单变量筛选→PCA或LASSO/ElasticNet），并说明保留解释性与避免过拟合的权衡。",
              "score": 25,
              "evaluation_focus": "高维特征选择与保持临床可解释性的能力",
              "scoring_hint": "高分：制定分步筛选方案并说明参数选择依据；低分：直接塞入模型或无降维策略。"
            },
            {
              "sub_criteria": "不平衡样本处理与模型候选理由",
              "description": "针对 E=1 可能为少数的情况，提出类别权重、SMOTE 或欠采样的方案并说明优先选择带正则化的概率模型（ElasticNet Logistic）与备用树模型（XGBoost/LightGBM）及校准计划。",
              "score": 20,
              "evaluation_focus": "处理不平衡与模型选择的实用性判断能力",
              "scoring_hint": "高分：选择合理手段并解释对概率输出影响；低分：忽视不平衡或只提出单一模型无解释。"
            },
            {
              "sub_criteria": "概率校准与验证设计",
              "description": "提出嵌套交叉验证用于超参调优，外层评估用于性能估计；对输出概率提供校准（Platt/Isotonic），并明确评估指标（AUC、Brier、灵敏度/特异度、校准曲线）。",
              "score": 25,
              "evaluation_focus": "模型评估、概率校准与避免信息泄露的建模思维",
              "scoring_hint": "高分：指定嵌套CV流程并列明校准方法与评估指标；低分：无校准或交叉验证设计存在数据泄露风险。"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "超参数调优与嵌套交叉验证实施",
              "description": "执行嵌套CV（外层用于性能估计、内层用于超参搜索），并在报告中给出超参搜索空间、评价指标与最终选取策略（如基于Brier与AUC的综合考量）。",
              "score": 30,
              "evaluation_focus": "避免过拟合的实验设计与超参优化能力",
              "scoring_hint": "高分：实现完整嵌套CV并报告每层结果与稳定性；低分：只用单层CV或在训练/验证混淆数据。"
            },
            {
              "sub_criteria": "性能度量的全面性与临床相关性",
              "description": "报告AUC、Brier score、灵敏度/特异度（在预先设定阈值下）、PPV/NPV、校准曲线与决策曲线分析以评估临床可用性。",
              "score": 20,
              "evaluation_focus": "从统计指标到临床实践可用性的桥接能力",
              "scoring_hint": "高分：提供多种指标并解释临床意义；低分：只报单一指标或无临床意义解释。"
            },
            {
              "sub_criteria": "模型稳定性与不确定性评估",
              "description": "给出模型在不同折、随机种子下的性能波动、置信区间或引导法评估，并对特征重要性稳定性（如回归系数区间、SHAP值分布）进行检验。",
              "score": 25,
              "evaluation_focus": "不确定性量化与结果稳健性检验能力",
              "scoring_hint": "高分：提供可信区间/波动范围并讨论潜在不稳因素；低分：仅给点估计无不确定性考量。"
            },
            {
              "sub_criteria": "最终模型持久化与可复现性记录",
              "description": "保存最终模型（含预处理流水线）、特征标准化参数及随机种子，导出用于表4的概率文件，并提供模型元数据（软件版本、运行命令）。",
              "score": 25,
              "evaluation_focus": "产出可复现可部署模型工件的能力",
              "scoring_hint": "高分：提供完整模型文件、预处理脚本与环境信息；低分：仅给结果表无模型或元数据。"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "数据管道与长表生成实现",
              "description": "用 Python(pandas) 或 R(tidyverse) 实现宽表到长表的转换，生成字段 patient_id、scan_seq、scan_流水号、scan_time（映射后）、t_from_onset、HM_volume(mL)、ED_volume(mL)、位置占比派生列，并保存为中间文件。",
              "score": 30,
              "evaluation_focus": "数据工程实现与可复现数据输出能力",
              "scoring_hint": "高分：代码清晰、模块化并输出可审计的中间文件；低分：一步到位无中间产物或不可重复步骤。"
            },
            {
              "sub_criteria": "时间映射、onset 计算与单位转换实现",
              "description": "实现附表1的流水号→扫描时间映射、计算 onset_time = first_scan_time - 发病到首次影像时间（小时）、计算 t_from_onset（浮点小时）并实现 mm^3→mL 转换（除以1000），处理无法映射的流水号以缺失并写日志。",
              "score": 20,
              "evaluation_focus": "关键数值转换与时间计算的程序正确性",
              "scoring_hint": "高分：边界情况稳健处理、记录无法映射流水号；低分：时间计算有偏差或单位转换错误。"
            },
            {
              "sub_criteria": "判定逻辑、异常处理与日志记录实现",
              "description": "实现遍历 t≤48h 的判定逻辑（按时间升序，单时间点多值取最大HM），对每例输出 E 与 Tau 并记录为何被标记为需人工核查（如基线缺失、基线过小、无随访），将所有异常写入日志文件与异常清单。",
              "score": 20,
              "evaluation_focus": "将判定规则无歧义地转为可执行代码并保留审计日志的能力",
              "scoring_hint": "高分：代码覆盖边界情况、日志详尽且可追溯；低分：判定逻辑有遗漏或无日志。"
            },
            {
              "sub_criteria": "可复现性、版本控制与自动化执行",
              "description": "提供可重复运行的脚本/Notebook，固定随机种子、记录依赖包与版本（requirements.txt 或 renv），并建议将代码版本化（git）与输出文件命名规则以支持审查。",
              "score": 30,
              "evaluation_focus": "工程化部署意识与可审计性实现能力",
              "scoring_hint": "高分：完整记录环境并提供运行说明；低分：无环境记录或随机性不可控制。"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "扩张标签与Tau的质量审查",
              "description": "对生成的 E 与 Tau 做一致性检查（如 Tau 是否≤48、Tau 对应的 HM 增幅是否满足阈值、重复时间点选择最大HM的影响），报告因缺失/基线异常被标注为需人工复核的病例清单与数量。",
              "score": 25,
              "evaluation_focus": "结果校验、错误发现与数据质量控制能力",
              "scoring_hint": "高分：提供详细一致性检测与异常列表并分析原因；低分：仅给出标签无质量检验。"
            },
            {
              "sub_criteria": "概率输出的校准与临床解释",
              "description": "对预测概率报告校准图、Brier score，并在不同概率分段（如0-0.1,0.1-0.2...）给出实际扩张发生率；解释模型输出在临床筛查（如高灵敏度阈值）下的性能与适用性。",
              "score": 25,
              "evaluation_focus": "将概率预测与临床决策连接的能力与校准评估能力",
              "scoring_hint": "高分：提供校准曲线并基于临床需求推荐阈值；低分：只报AUC或概率无校准评估。"
            },
            {
              "sub_criteria": "特征重要性与可解释性分析",
              "description": "输出特征重要性（标准化回归系数或SHAP值）、并分析最关键的临床/影像特征（如首检 HM_volume、发病到首检时间、某位置占比等）对扩张风险的影响及可信度。",
              "score": 25,
              "evaluation_focus": "可解释性分析与临床可用性说明能力",
              "scoring_hint": "高分：提供稳定性检验后的重要特征并解释其临床含义；低分：无特征重要性或解释模糊。"
            },
            {
              "sub_criteria": "报告完整性与审计材料提交",
              "description": "提交包含方法说明、数据缺失统计、中间文件清单、处理日志、模型文件与预测结果的报告，明确哪些病例需人工复核与建议的后续动作。",
              "score": 25,
              "evaluation_focus": "将技术输出转化为可审阅、可复核的临床工程交付物的能力",
              "scoring_hint": "高分：交付完整报告与所有审计材料并列出复核建议；低分：仅交付预测表无方法或日志。"
            }
          ]
        }
      }
    },
    "3": {
      "subtask": "子任务 3（仅关于血肿周围水肿 ED 的发生与进展建模、亚组划分及治疗干预关联分析）的目标是：基于前100例患者的随访影像（按流水号映射到发病后时间点）构建群体水平的 ED 随时间曲线、量化全体拟合残差，提取并表征个体间进展异质性以划分 3–5 个可解释的亚组并计算亚组残差，同时评估不同治疗对 ED 进展的因果关联并建立血肿（HM）与水肿（ED）动态耦合模型；为实现该目标，请按以下步骤精确实现：1) 数据准备与质量控制：将表2 中每次扫描的 ED_volume 按流水号映射为 t（小时，从发病起），统一体积单位为 mL（若为 mm^3 则 /1000），排除明显错误值并记录缺失/观测次数；为保证时间序列可建模，初步纳入至少有两次（建议 ≥3 次优先）有效 ED 测量的个体，保留不规则采样信息以供后续建模。2) 群体平均曲线拟合与全体残差计算：以功能形式表示 ED_i(t)（t 连续），用带惩罚样条的线性混合效应模型或广义可加混合模型（例如 ED_i(t)=mu(t)+b_i(t)+ε，mu(t)=∑α_m B_m(t)，b_i 为患者特异随机函数）在 REML/贝叶斯框架下估计mu(t)，并用均方根残差 RMS_all = sqrt(∑_{i,j}(ED_i(t_{ij})-μ̂(t_{ij}))^2 / N_all) 表征全体拟合误差；样条基、节点数和惩罚强度通过 REML、AIC 或交叉验证选择。3) 个体差异提取与亚组划分：对患者间偏离 mu(t) 的函数残差应用功能主成分分析（FPCA）提取前 K 个主成分分数（K 依据累积解释方差或信息准则选择），以这些 FPCA 分数为低维特征用 K-means 或高斯混合聚类确定 3–5 个亚组；为每个亚组单独拟合 mu_g(t) 并计算亚组残差 RMS_sub（同 RMS_all 公式但以组内数据），选择使 RMS_sub 明显小于 RMS_all 的划分，同时用轮廓系数和 BIC/silhouette 指标确定聚类数并输出每例所属亚组标签。4) 治疗干预因果分析（基线与时变）：针对表1 中的每种治疗（Q–W），先估计基于基线协变量 X 和首诊影像 Z0 的倾向评分 P(A=1|X,Z0)；对于基线固定治疗使用倾向评分匹配/加权（IPW）并检验平衡（标准化均差），对于随访期间可能的时变治疗采用边缘结构模型（MSM）并构建稳定化逆概率权重 w_i(t)=∏_{s≤t} P(A_i(s)|history) 分母/分子形式以校正时变混淆，裁剪极端权重以避免高方差；在加权或匹配后的数据上用加权混合效应模型（或 MSM 对应的加权样条模型）拟合 ED 曲线并在模型中包含治疗×spline(t) 交互项以估计治疗对 ED 时序的即时与时间依赖效应，报告效应大小（mL）、95% CI、p 值及权重诊断指标。5) HM—ED 耦合建模：构建联合或耦合模型以量化血肿动态对水肿的影响，例如联合混合效应模型（HM_i(t)=μ_H(t)+b_i^H(t)+e; ED_i(t)=μ_E(t)+θ·b_i^H(t)+b_i^E(t)+e），或在 ED 方程中加入滞后/当期 HM(t−τ) 与患者特异随机斜率，以及/或共享随机效应框架；参数估计可用 REML（频率学）或在需要完整不确定性量化时采用贝叶斯 MCMC（Stan/brms）；通过比较包含/不包含耦合项的模型的 AIC/WAIC 和拟合残差评估耦合强度与显著性。6) 诊断、敏感性与输出：在每一步提供诊断（基线/时变倾向评分平衡表、权重分布、模型残差图、FPCA 解释方差、聚类稳定性指标），对关键假设（如权重截断阈值、FPCA 组件数、样条复杂度）做敏感性分析，并生成最终输出：群体 mu(t)、每个亚组 mu_g(t)、RMS_all、RMS_sub、每例亚组标签及治疗效应估计（含不确定性区间）；建议使用 R（mgcv/gamm4、nlme/lme4、refund/fdapace、MatchIt、survey、brms）或 Python（scikit-learn、statsmodels、PyMC/NumPyro）实现，所有代码应记录随机种子、软件包版本并保存中间数据以确保可复现。",
      "criteria": {
        "task_understanding": {
          "core_goal": "题目要考什么——按题型拆解关键能力：基于前100例出血性脑卒中患者的随访影像（表2 经流水号映射到发病后时间点），构建群体水平的血肿周围水肿（ED）随时间进展函数 μ(t)，量化整体拟合残差（RMS_all），刻画个体间异质性并通过 FPCA+聚类划分 3–5 个可解释亚组、计算亚组拟合曲线 μ_g(t) 与组内残差（RMS_sub）；同时评估多种治疗（表1 Q–W）的时变或基线影响（倾向评分/IPW 或 MSM），并建立 HM—ED 的动态耦合模型（共享随机效应或滞后项）以量化血肿对水肿的驱动作用，提供诊断、敏感性分析与可复现代码与输出（曲线、残差、亚组标签、治疗效应估计、耦合参数及模型比较指标）。",
          "expected_output": "数值与可视化并重的可复现输出：群体 μ(t) 曲线与置信区间、每个亚组 μ_g(t) 曲线与置信区间、RMS_all 与每组 RMS_sub、每例的亚组标签、各治疗（Q–W）对 ED(t) 的即时与时间依赖效应（mL、95% CI、p 值）、HM—ED 耦合参数 θ（及模型比较 AIC/WAIC）、诊断图（残差图、权重分布、倾向评分平衡表、FPCA 解释方差、聚类稳定性）、处理日志与中间数据文件，以及方法说明与敏感性分析报告。",
          "key_inputs_constraints": "输入：表2 中每次扫描的 ED_volume（需统一为 mL）及流水号→绝对扫描时间映射（附表1），仅前100例（sub001–sub100）为分析主样本；约束与注意事项：采样不规则、随访次数差异（建议至少纳入有≥2次——优先≥3次的个体）、体积单位/异常值需转换与质控、治疗为基线或时变（表1 Q–W），样本量有限（N≈100），需显式记录缺失与需人工复核的病例，所有结果须可复现（固定随机种子、记录软件版本）。",
          "modeling_type": "以拟合/函数数据分析为主，包含：函数拟合（混合效应样条 / GAMM）、功能主成分分析（FPCA）与聚类（分群）、因果推断（倾向评分 / IPW / MSM）、联合/耦合混合效应模型（HM—ED 动态耦合）、诊断与敏感性分析。",
          "role_in_pipeline": "中枢分析模块：依赖前置的数据清洗/时间映射（子任务1），为后续预后预测与临床决策提供时序表征、治疗因果证据与 HM—ED 机制参数；关键难点包括不规则采样、时变处理的混淆校正、样本量与模型可识别性、以及耦合模型参数的不确定性估计。"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "识别并量化核心建模目标（ED 群体曲线与残差）",
              "description": "明确指出需拟合群体水肿进展曲线 μ(t)、计算全体均方根残差 RMS_all，并解释这些量化指标如何反映群体趋势与拟合质量（数值单位 mL、时间单位小时）。",
              "score": 40,
              "evaluation_focus": "任务目标理解、度量指标抽象能力（从临床问题到数学量化）",
              "scoring_hint": "高分：准确给出 μ(t) 与 RMS_all 的数学定义并说明单位与解释；低分：只给出模糊描述（如“拟合曲线”）或未指明残差定义/单位。"
            },
            {
              "sub_criteria": "识别个体异质性与亚组划分需求（FPCA+聚类）",
              "description": "说明需提取患者偏离 μ(t) 的函数残差并用 FPCA 得到低维分数作为聚类特征，以划分 3–5 个亚组并为每组拟合 μ_g(t)。",
              "score": 30,
              "evaluation_focus": "功能数据分析认知与降维/聚类方法选择能力",
              "scoring_hint": "高分：明确 FPCA 目的、输出（主成分分数）与聚类数取值依据（解释方差/轮廓系数/BIC）；低分：提出聚类但不说明如何从时序函数得到聚类特征或聚类数选择标准。"
            },
            {
              "sub_criteria": "识别治疗为时变/基线混淆因子及 HM—ED 耦合问题",
              "description": "识别表1 Q–W 中治疗可能为时变，并指出需要用倾向评分/IPW（基线）或 MSM（时变）来校正混淆；同时识别需要建立 HM—ED 耦合模型来量化血肿对水肿的动态影响（共享随机效应或滞后项）。",
              "score": 30,
              "evaluation_focus": "因果推断思维与机制建模识别能力",
              "scoring_hint": "高分：正确区分基线/时变治疗并提出相应方法（IPW/MSM），并提出耦合模型候选；低分：忽视时变性或仅提出描述性比较而无因果校正方案。"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "用数学形式重述任务（μ(t)、b_i(t)、RMS）",
              "description": "将问题以数学形式重述，例如 ED_i(t)=μ(t)+b_i(t)+ε_ij，RMS_all 及 RMS_sub 的具体公式，并说明估计目标和可检验的假设（如 μ 平滑度、随机效应结构）。",
              "score": 40,
              "evaluation_focus": "从应用到数学模型的转化能力",
              "scoring_hint": "高分：给出清晰模型方程并标注术语含义；低分：只有文字描述或数学表达不完整/含糊。"
            },
            {
              "sub_criteria": "明确可交付的数值与图形结果清单",
              "description": "罗列必须输出的文件与图形（群体与亚组曲线、每例标签、RMS 值、治疗效应表、耦合参数表、诊断图、处理日志），并说明格式和单位（如 CSV/xlsx、PNG/PDF）。",
              "score": 35,
              "evaluation_focus": "工程化思维与结果交付可重复性规划",
              "scoring_hint": "高分：完整列出所有交付项及文件格式；低分：仅笼统提到“输出曲线/报告”而无具体格式/内容。"
            },
            {
              "sub_criteria": "时间与样本选择规则重述",
              "description": "明确纳入样本的时间序列要求（至少2次/优先≥3次测量）、如何处理不规则采样与缺失、以及对时间单位（小时）和体积单位（mL）的统一要求。",
              "score": 25,
              "evaluation_focus": "数据约束识别与可行性判断",
              "scoring_hint": "高分：详述纳入/排除标准与单位转换规则；低分：忽视随访次数或未说明单位统一。"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "测量与单位一致性假设",
              "description": "明确假设 ED_volume 的测量误差可忽略或为均匀噪声；要求将 mm^3 转换为 mL（/1000），并列出对异常值的判定阈（例如 >99.9 百分位或超出生理上限）。",
              "score": 25,
              "evaluation_focus": "数据质量假设与可操作化规则制定能力",
              "scoring_hint": "高分：给出明确数据质量假设与异常值处理策略并记录日志；低分：无单位/误差假设或未给出处理阈值。"
            },
            {
              "sub_criteria": "时间映射与发病时点假设",
              "description": "说明如何通过附表1 将流水号映射至绝对扫描时间并重构 onset_time（first_scan_time - 发病到首次影像间隔），以及在映射失败时的替代处理（标注缺失并人工复核）。",
              "score": 25,
              "evaluation_focus": "时间序列前处理假设与异常容错规划",
              "scoring_hint": "高分：清楚写明映射规则与失败处理流程；低分：仅口头提及或无替代方案。"
            },
            {
              "sub_criteria": "因果推断相关的可识别性假设",
              "description": "对于基线治疗假设无未测混淆（可通过倾向评分校正达成），对于时变治疗需假设可观测历史记录足以建模治疗概率（MSM 的可识别性前提），并说明权重截断策略以控制极端权重影响。",
              "score": 25,
              "evaluation_focus": "因果假设意识与风险控制设计",
              "scoring_hint": "高分：清晰列出可识别性假设并给出权重裁剪方案；低分：未讨论混淆或忽视极端权重问题。"
            },
            {
              "sub_criteria": "亚组稳健性与模型复杂度假设",
              "description": "规定聚类数在 3–5 之间，且假设 FPCA 的前 K 个成分可以解释大部分个体差异（给出解释方差阈值，如≥80%），并对样条基复杂度与节点数提出事先合理范围。",
              "score": 25,
              "evaluation_focus": "模型可解释性假设与参数选择先验规划",
              "scoring_hint": "高分：提出量化阈值与备选范围并说明选择准则；低分：聚类数/组件数任意给出且无理由。"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "群体曲线模型的规范化构建（GAMM/混合样条）",
              "description": "构建 ED_i(t)=μ(t)+b_i(t)+ε 的混合效应样条或 GAMM，其中 μ(t) 用惩罚样条表示并通过 REML/AIC/交叉验证选择平滑度；明确随机效应 b_i(t) 的形式（随机截距或随机函数）。",
              "score": 30,
              "evaluation_focus": "函数拟合建模能力与平滑正则化设计",
              "scoring_hint": "高分：给出完整模型式、平滑/惩罚选择方法与理由；低分：仅说明拟合但无正则化/随机效应细节。"
            },
            {
              "sub_criteria": "FPCA 与聚类流程设计（降维到聚类）",
              "description": "明确用 FPCA 提取函数残差的前 K 个分数作为聚类输入，说明 K 的选取标准（解释方差或信息准则），并给出聚类方法（K-means/GMM）、聚类数选择准则（轮廓系数/BIC）与稳定性评估方案（重采样）。",
              "score": 25,
              "evaluation_focus": "功能数据降维与群组识别方法设计",
              "scoring_hint": "高分：流程完整并含稳定性检验；低分：降维/聚类步骤无衔接或无选择标准。"
            },
            {
              "sub_criteria": "治疗因果模型构建（IPW/MSM 与加权模型）",
              "description": "为基线治疗构建倾向评分模型并使用匹配或稳定化 IPW；为时变治疗提出 MSM 的权重构造方法（分子/分母模型）并规划极端权重裁剪；在加权数据上拟合加权混合效应模型并在模型中包含 treatment×spline(t) 交互项以估计时间依赖效应。",
              "score": 25,
              "evaluation_focus": "因果推断模型构建与时间依赖效应建模能力",
              "scoring_hint": "高分：对基线与时变情况分别给出具体模型结构与平衡检验指标；低分：提出倾向评分但不阐明加权/时变处理细节。"
            },
            {
              "sub_criteria": "HM—ED 耦合模型设计（共享随机效应/滞后项）",
              "description": "提出至少一种联合模型或耦合策略（例如共享随机效应的联合混合模型或在 ED 方程中加入当期/滞后 HM(t−τ) 和患者特异随机斜率），并说明估计方法（REML 或贝叶斯 MCMC）与模型比较计划（AIC/WAIC）。",
              "score": 20,
              "evaluation_focus": "机制建模与联合建模设计能力",
              "scoring_hint": "高分：给出明确耦合模型形式并说明估计与比较方法；低分：仅口头提及耦合但无可行构造或估计方案。"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "参数估计方法与数值稳定性（REML / MCMC）",
              "description": "说明用于估计混合样条与联合模型的具体数值方法：REML/优化器设置或 MCMC（Stan/brms）配置（迭代数、收敛诊断），并提出解决收敛/数值不稳的方法（重参数化、弱信息先验、权重裁剪）。",
              "score": 30,
              "evaluation_focus": "数值统计估计能力与收敛诊断意识",
              "scoring_hint": "高分：给出具体估计算法参数、收敛诊断指标与应对策略；低分：仅列方法名无实现细节或未考虑收敛问题。"
            },
            {
              "sub_criteria": "模型选择与超参数搜索（样条节点、FPCA K、聚类数）",
              "description": "列出用于选择样条复杂度、FPCA 组件数与聚类数的量化准则（REML/AIC/CV/轮廓系数/BIC），并说明搜索与验证流程（嵌套 CV 或信息准则比较）。",
              "score": 25,
              "evaluation_focus": "模型选择策略与泛化评估设计能力",
              "scoring_hint": "高分：给出可执行的超参搜索与验证流程并记录选择理由；低分：超参选择任意或无验证。"
            },
            {
              "sub_criteria": "诊断与敏感性分析执行（残差、权重、聚类稳定性）",
              "description": "应提供残差分布图、时间相关残差检验、权重分布与极端值检查、倾向评分平衡表、FPCA 解释方差与聚类稳定性（重采样或轮廓系数）的敏感性分析方案并报告结果。 ",
              "score": 25,
              "evaluation_focus": "模型诊断能力与稳健性检验",
              "scoring_hint": "高分：完整执行并解释诊断图与敏感性结果；低分：诊断缺失或仅给出单一指标无解释。"
            },
            {
              "sub_criteria": "不确定性量化（CI、WAIC/AIC、预测区间）",
              "description": "提供关键参数（如治疗效应、耦合参数 θ）的置信区间或后验区间，报告模型比较指标（AIC/WAIC）与预测区间以反映估计不确定性。 ",
              "score": 20,
              "evaluation_focus": "不确定性评估与统计解释能力",
              "scoring_hint": "高分：所有关键估计均伴置信/后验区间并解释其临床含义；低分：仅报告点估计无不确定性信息。"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "数据准备与时间映射脚本（可复现）",
              "description": "提交可运行脚本（R/Python）完成流水号→时间映射、体积单位统一（mm^3→mL）、缺失/异常标注、并生成分析用长表；脚本应记录随机种子、输入/输出文件路径与软件包版本。 ",
              "score": 30,
              "evaluation_focus": "数据工程能力与可复现性实施",
              "scoring_hint": "高分：代码完整可运行且有注释、版本记录与日志；低分：脚本片段或需大量手工干预才能运行。"
            },
            {
              "sub_criteria": "模型实现代码与封装（mgcv/brms/PyMC 等）",
              "description": "提供用于拟合群体样条、FPCA、聚类、IPW/MSM、联合模型的代码模块，并在注释中标明关键超参与调用顺序。优先给出可重复的脚本或 R Markdown/Python notebook。 ",
              "score": 25,
              "evaluation_focus": "统计建模实现能力与可移植性",
              "scoring_hint": "高分：模型脚本结构清晰、能在给定环境下复现结果；低分：模型代码缺失或不可运行。"
            },
            {
              "sub_criteria": "日志、异常处理与中间文件保存",
              "description": "代码应自动生成处理日志（映射失败、缺失个体、异常体积列表）、保存中间数据（长表、FPCA 分数、权重分布）并提供结果输出接口（CSV/图像）。",
              "score": 25,
              "evaluation_focus": "工程化输出与审计追踪能力",
              "scoring_hint": "高分：日志详尽，中间文件与最终结果自动输出；低分：无日志或需人工查找中间结果。"
            },
            {
              "sub_criteria": "可视化自动化与报告生成",
              "description": "包含自动生成关键可视化（μ(t) 与 μ_g(t) 曲线、残差图、权重分布、FPCA 成分图、聚类热图）并将分析结果汇总为报告（PDF/HTML）。",
              "score": 20,
              "evaluation_focus": "结果可视化与报告自动化能力",
              "scoring_hint": "高分：可视化完整且与数值结果一致并自动嵌入报告；低分：仅提供少量静态图且需手工集成。"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "群体与亚组曲线结果解读与 RMS 对比",
              "description": "解释 μ(t) 与每组 μ_g(t) 的形状（何时达到峰值、上升/下降速率）、报告 RMS_all 与各 RMS_sub 并讨论亚组划分是否显著降低残差及其临床含义（mL 与小时级别）。",
              "score": 30,
              "evaluation_focus": "统计结果解释与临床可解释性结合能力",
              "scoring_hint": "高分：定量比较 RMS 并将差异与临床意义（例如水肿峰值时间/体积变化量）联系起来；低分：仅列数值无解释或解释脱离临床。"
            },
            {
              "sub_criteria": "治疗效应估计与因果解释（含平衡检验）",
              "description": "报告每种治疗（Q–W）在加权/匹配或 MSM 框架下对 ED(t) 的即时与时间依赖效应（以 mL 表示）、95% CI、p 值，并展示倾向评分平衡表与权重诊断以支撑因果解释。 ",
              "score": 30,
              "evaluation_focus": "因果推断结果解读与证据链构建",
              "scoring_hint": "高分：给出平衡检验结果、权重分布并基于加权分析谨慎解释因果效应；低分：直接以原始对比宣称因果关系或忽视平衡检验。"
            },
            {
              "sub_criteria": "HM—ED 耦合参数与机制性解释",
              "description": "解释耦合模型中 HM 对 ED 的影响强度（θ 或滞后系数）、模型比较结果（AIC/WAIC）以及这种耦合对临床干预时机的含义（例如 HM 增长在 t 后 k 小时内驱动 ED 增幅）。",
              "score": 20,
              "evaluation_focus": "机制模型结果解读与临床推论能力",
              "scoring_hint": "高分：定量报告耦合系数并讨论生理/临床含义与不确定性；低分：耦合结果缺乏量化或不讨论临床含义。"
            },
            {
              "sub_criteria": "敏感性分析与局限性讨论",
              "description": "报告关键假设（权重截断、FPCA 成分数、样条复杂度）的敏感性分析结果，列出研究局限（样本量、观测不规则、潜在未测混淆）并给出未来改进建议与临床应用建议。 ",
              "score": 20,
              "evaluation_focus": "批判性分析能力与风险沟通",
              "scoring_hint": "高分：提供多种敏感性检验并据此得出稳健结论与局限；低分：无敏感性分析或局限陈述空泛。"
            }
          ]
        }
      }
    },
    "4": {
      "subtask": "子任务4的目标是构建、训练、验证并交付两类有序结局（mRS 0–6）的预测模型：一是仅基于入院/首次影像（表1的临床与治疗基线变量、表2/表3的首次影像体积、位置、形状与灰度特征）在训练集（sub001–sub100）上建立的静态有序预测器并对所有病例（sub001–sub160）输出每类概率分布及最可能等级；二是利用训练集中所有可得纵向影像与治疗记录（首次+随访影像、表1的时序治疗变量、表2/表3的随访影像量化）构建的联合/增强预测器，用随访信息提高对含随访患者（sub001–sub100 与 sub131–sub160）的mRS预测精度并输出概率分布与不确定区间。为实现该目标须按下列步骤实施：① 数据准备与清洗——从表1/表2/表3抽取指定字段，统一体积单位（mm^3→mL）、用流水号映射时间并计算自发病的时间点，对缺失采用多重插补（mice）或在模型中使用缺失指示变量并记录缺失机制；② 特征工程——保留医学先验重要临床变量，对高维影像组学做稳健预筛（方差/相关性过滤）随后采用有监督筛选或PCA/稀疏PCA降维；当使用纵向影像时，提取每例的功能主成分分数（FPCA）、样条基系数或基于混合效应样条的个体随机效应作为跨时间的低维表征；③ 模型架构与训练——静态路径优先使用有序Logit/有序回归（proportional odds）并结合ElasticNet正则化以输出校准概率，作为对照并行训练基于树的模型（LightGBM/XGBoost）或基于ordinal objective的模型以捕捉非线性；纵向路径采用两种可选实现：A）将纵向特征（FPCA分数或个体随机效应估计值）作为协变量代入有序回归；B）构建联合模型（共享随机效应的混合效应-有序回归或在贝叶斯框架下用brms/Stan联合建模），直接在单一框架中同时拟合纵向过程与有序结局以获得更一致的参数估计与不确定性量化；④ 超参数调优与模型选择——采用嵌套交叉验证（对小样本防止信息泄露）进行超参搜索并以加权Kappa、平均绝对误差（MAE）、准确率、ordinal c-index、Brier score 及校准曲线为主要选择标准；在存在类不平衡时使用类别权重或重采样策略；⑤ 校准、置信区间与不确定性评估——对概率输出做Platt或Isotonic校准并通过自助法或贝叶斯后验获得预测不确定区间与置信区间，报告预测分布而非单一点估计；⑥ 可解释性与临床可用输出——提供全局重要性（标准化系数、SHAP值）、局部解释示例、部分依赖图与变量影响方向，输出每例的完整概率向量、最可能等级及 95% 置信/可信区间；⑦ 验证与外部评估——在题目提供的独立集上分别验证静态模型（仅首诊可用者 sub101–130）与纵向/联合模型（含随访者 sub131–160），并报告上述性能指标与校准图；⑧ 实施与可重复性——代码使用 Python（scikit-learn, lightgbm, statsmodels, mord）或 R（ordinal, glmnet, brms, lme4, fdapace），模型与数据处理流水线版本化（git）、固定随机种子并保存训练集/验证集划分、模型权重与数据预处理参数以便复现；对于贝叶斯联合模型，指出需要更高计算资源（并行链、多核 CPU 与更大内存），并为部署提供模型序列化格式与调用说明。最终输出为两套可解释、校准的预测结果与不确定性估计（静态模型用于所有病例的首次影像预测，联合模型用于含随访的更精细预测），并伴随完整的性能评估报告、变量重要性解释和再校准建议。",
      "criteria": {
        "task_understanding": {
          "core_goal": "构建并交付两类有序结局（mRS 0–6）的预测系统：一是基于入院/首次影像与临床基线变量的静态有序预测器（输出每类的概率分布、最可能等级及置信/可信区间）；二是基于训练集中全部纵向影像与时序治疗记录的联合/增强预测器（将随访影像信息以低维纵向表征或共享随机效应形式纳入模型）以提升对含随访患者（sub001–sub100 与 sub131–sub160）90天 mRS 的预测精度与不确定性量化。整个建模过程要贯彻“先建模再选算法、再验证”的思路，保证可复现、可校准、可解释并在题目约束（样本量、数据字段、时间映射规则、单位统一）下交付概率化与不确定性输出。",
          "expected_output": "数值化结果：每例的 mRS 七类概率向量（和为1，建议同时提供概率置信区间）、最可能等级预测、概率校准图与混淆/序贯性能指标（weighted kappa、ordinal c-index、MAE、Brier score），模型持久化文件（权重/后验样本）、变量重要性解释（标准化回归系数/SHAP/partial dependence）、模型训练与预处理流水线、以及在不同验证子集（sub101–130 静态验证；sub131–160 纵向验证）上的性能报告与再校准建议。",
          "key_inputs_constraints": "输入：表1（临床基线与治疗基线变量 Q–W、入院首次流水号与发病到首次影像时差）、表2/表3（首次影像的 HM/ED 体积、位置占比、形状与灰度分布；以及随访影像量化用于纵向模型）、附表1（流水号→绝对检查时间映射）。约束与关键点：必须统一体积单位（mm^3→mL）；静态模型仅可使用首次影像记录；训练集为 sub001–sub100；独立验证分为 sub101–130（无随访）与 sub131–160（含随访但无 mRS）；样本量小且类别可能不平衡，随访时间不规则与缺失、基线/随访治疗为潜在混杂；需输出可复现代码、固定随机种子并记录软件版本与处理日志。",
          "modeling_type": "预测类（有序分类/概率估计）为主，兼具拟合/时序建模（混合效应模型/FPCA/联合贝叶斯模型）与不确定性量化（bootstrap/贝叶斯后验），并包含模型校准与可解释性分析。",
          "role_in_pipeline": "本子任务是最终预后预测模块，依赖前序的数据准备（流水号→时间映射、体积单位统一、48小时扩张标注等）与纵向特征提取（FPCA/混合效应），其输出用于临床决策支持与模型比较验证，难点在于小样本高维影像特征、时序不规则与缺失、模型校准与可解释性要求。"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "静态与纵向预测目标区分与陈述",
              "description": "能否明确区分并精确陈述两个并行目标：①静态模型——仅用入院/首次影像与基线临床变量预测90天 mRS 的概率分布；②纵向/联合模型——将随访影像与时序治疗信息纳入以提高含随访患者的 mRS 预测准确性与不确定性评估。",
              "score": 35,
              "evaluation_focus": "目标拆解能力与面向题目约束的建模思路（先建模再选算法）",
              "scoring_hint": "高分：准确写出两条路径的输入限制、输出形式与验证子集（sub101–130 vs sub131–160）；低分：把两类任务混为一谈或未说明静态模型只能用首次影像。"
            },
            {
              "sub_criteria": "训练/验证队列与数据边界识别",
              "description": "明确训练集（sub001–sub100）、静态验证集（sub101–130，仅首次影像可用）与纵向验证集（sub131–160 含随访）之间的角色与限制，并指出哪些样本可用于纵向增强模型预测。",
              "score": 30,
              "evaluation_focus": "数据集划分识别与实验设计能力",
              "scoring_hint": "高分：精准列出每一子集的可用字段与预测任务；低分：混淆训练/测试集或未识别哪些样本缺乏随访/标签。"
            },
            {
              "sub_criteria": "关键约束与潜在风险识别",
              "description": "识别并说明此任务的关键数据/方法约束：样本量偏小、类不平衡、随机/系统性缺失、时序不规则、体积单位需统一、静态模型不得使用随访数据、纵向模型需解决时间依赖与治疗混杂问题。",
              "score": 35,
              "evaluation_focus": "风险识别与前瞻性建模准备",
              "scoring_hint": "高分：列出并解释对模型选择（正则化、降维、校准、贝叶斯或频率学权衡）的具体影响；低分：仅泛泛提到风险但未联系到建模策略。"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "输入输出精确映射复述",
              "description": "将题目要求复述为明确的输入→输出映射：输入字段（表1 基线临床+表2/3 首次影像特征）到输出（每类 mRS 的概率向量与最可能等级）；纵向路径增加随访影像的 FPCA/随机效应作为额外协变量或用于联合建模。",
              "score": 40,
              "evaluation_focus": "从语义到数学对象的转换能力与可执行性表达",
              "scoring_hint": "高分：给出明确特征清单、输出格式（概率向量+CI）与样本约束；低分：输出笼统或未具体说明哪些字段作为输入。"
            },
            {
              "sub_criteria": "评价指标与验证方案复述",
              "description": "明确用于模型选择与报告的评价指标（weighted kappa、ordinal c-index、MAE、Brier score、校准曲线）和验证策略（嵌套交叉验证用于超参与避免信息泄露；独立验证集分组测试）。",
              "score": 30,
              "evaluation_focus": "实验设计与统计评估规划能力",
              "scoring_hint": "高分：列出指标与各自用途，并说明嵌套CV如何避免信息泄露；低分：仅给出一两个指标或未说明验证分层策略。"
            },
            {
              "sub_criteria": "输出交付与可复现性要求复述",
              "description": "复述交付物要求：每例概率分布与置信区间、模型文件、预处理流水线、日志与软件/随机种子记录、以及对 sub101–130 与 sub131–160 的独立性能报告。",
              "score": 30,
              "evaluation_focus": "工程化与可复现性意识",
              "scoring_hint": "高分：明确文件格式、保存路径与版本控制建议；低分：未提及可复现或交付细节。"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "缺失数据机制与处理假设",
              "description": "明确对缺失值的假设（MCAR/MAR/MNAR）并提出对应处理策略：多重插补（mice）在MAR情形、缺失指示变量或模型内处理，在MNAR场景提出敏感性分析方案。",
              "score": 30,
              "evaluation_focus": "统计假设识别与缺失处理策略设计",
              "scoring_hint": "高分：根据不同变量类型给出具体的插补方案与敏感性检验；低分：只做单一盲目填补或忽视缺失机制。"
            },
            {
              "sub_criteria": "模型结构假设（有序性与比例优势等）",
              "description": "针对静态有序回归需说明是否采用比例优势假设（proportional odds），若不满足需提出替代（partial proportional odds 或 non-proportional models、树/GBM）。",
              "score": 25,
              "evaluation_focus": "统计模型适配性判断与备选方案准备",
              "scoring_hint": "高分：给出检验比例优势的方法并规划若不满足时的具体替代模型；低分：机械选择有序Logit而无检验与备选。"
            },
            {
              "sub_criteria": "纵向表征与随机效应假设",
              "description": "对纵向信息的建模假设要说明：使用 FPCA/样条随机效应能捕捉个体时序差异、随机效应与结局之间通过共享随机项或滞后HM影响联结，并声明平稳性/光滑度假设与基于样条节点选择的影响。",
              "score": 25,
              "evaluation_focus": "时序建模思想与可解释性假设能力",
              "scoring_hint": "高分：明确FPCA组件选择标准、滞后窗口设定与共享随机效应形式；低分：未说明纵向表征如何映射到有序结局。"
            },
            {
              "sub_criteria": "因果/混杂处理假设（若讨论治疗影响）",
              "description": "若将治疗作为预测协变量或用于因果推断，应声明关于治疗分配的可忽略性/可调整性假设，并提出用倾向评分/IPW或时间相关MSM校正时变混杂的策略。",
              "score": 20,
              "evaluation_focus": "因果思维与混杂校正预设",
              "scoring_hint": "高分：明确何时可作预测性调整与何时需做因果校正并提出实现方法；低分：忽视治疗时序与混杂问题。"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "静态模型架构与特征工程合理性",
              "description": "静态路径须说明特征选择流程（基础临床优先保留）、影像高维组学的筛选（方差/相关阈值）、降维或稀疏选择（PCA/ElasticNet/LASSO）及最终选用的有序模型（有序Logit+ElasticNet或ordinal GBM），并解释为何先建结构再选算法。",
              "score": 30,
              "evaluation_focus": "特征工程与模型匹配能力（先建模再选算法）",
              "scoring_hint": "高分：提供逐步筛选细节、正则化与超参范围并解释医学先验在筛选中的角色；低分：直接喂入高维特征到复杂模型且无筛选策略。"
            },
            {
              "sub_criteria": "纵向/联合模型设计与低维表征方法",
              "description": "纵向路径须给出具体实现方案：A) 用 FPCA/样条基或混合效应估计的个体随机效应作为额外协变量进入有序回归；或 B) 构建共享随机效应的联合模型（混合效应+有序结局、或贝叶斯联合建模），并说明如何处理不规则采样与时间对齐（流水号→时间）。",
              "score": 30,
              "evaluation_focus": "时序特征提取与联合建模能力",
              "scoring_hint": "高分：明确FPCA组件数选择、样条复杂度、随机效应结构与算法实现工具（brms/Stan 或 gamm4/ordinal）；低分：仅笼统提及“用纵向信息”而无可执行细节。"
            },
            {
              "sub_criteria": "正则化/降维与应对小样本高维策略",
              "description": "提出对小样本与高维影像特征的稳健策略：交叉验证内的稀疏正则（ElasticNet）、PCA前置、基于单变量的保守预筛、或基于领域知识的特征优先保留，并说明如何评估过拟合（学习曲线、外部验证）。",
              "score": 25,
              "evaluation_focus": "泛化能力保障与过拟合控制",
              "scoring_hint": "高分：给出具体阈值/筛选顺序及验证方法；低分：无过拟合防护或仅依赖默认模型参数。"
            },
            {
              "sub_criteria": "概率校准与不确定性量化设计",
              "description": "明确概率校准方法（Platt/Isotonic）和不确定性评估策略（自助法置信区间、或贝叶斯后验区间），并说明何时采用哪种方法以满足题目对概率与不确定性输出的要求。",
              "score": 15,
              "evaluation_focus": "概率输出与可信区间设计能力",
              "scoring_hint": "高分：细化校准流程与使用场景并安排校准后验证；低分：忽视概率校准或不提供不确定性估计。"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "超参调优与验证策略执行",
              "description": "在模型训练中是否采用嵌套交叉验证进行超参调优以避免信息泄露，并在外层CV或独立集上评估最终模型性能（对静态与纵向模型分别设定CV策略）。",
              "score": 35,
              "evaluation_focus": "实验可靠性与避免过拟合的执行力",
              "scoring_hint": "高分：实现嵌套CV、分层抽样（按mRS分布）并记录随机种子与分割；低分：仅简单CV或用测试集调参导致信息泄露。"
            },
            {
              "sub_criteria": "类别不平衡处理与评价指标选择",
              "description": "针对 mRS 类别不平衡是否采取类别权重、重采样或阈值调整，并选择适合有序结局的评价指标（weighted kappa、ordinal c-index 而非仅 accuracy）。",
              "score": 25,
              "evaluation_focus": "类别不平衡处理与指标对齐能力",
              "scoring_hint": "高分：给出具体权重或重采样方案并报告多种指标；低分：只用 accuracy 或忽视不平衡。"
            },
            {
              "sub_criteria": "概率校准实现与不确定性估计",
              "description": "执行概率校准（在验证集上）并提供预测置信区间：自助法置信区间用于频率学模型，贝叶斯后验区间用于联合模型。需报告校准曲线与 Brier score。",
              "score": 25,
              "evaluation_focus": "概率质量控制与不确定性量化能力",
              "scoring_hint": "高分：展示校准前后对比、Brier score改善及CI覆盖率；低分：无校准或置信区间计算。"
            },
            {
              "sub_criteria": "模型选择与稳健性检验",
              "description": "比较候选模型（有序Logit+ElasticNet、LightGBM/ordinal tree、联合贝叶斯模型）并用统计或实用指标（AIC/WAIC、外部验证表现）选择最终模型，同时做敏感性分析（如特征筛选阈值、FPCA组件数）。",
              "score": 15,
              "evaluation_focus": "模型比较判断与敏感性分析能力",
              "scoring_hint": "高分：提供多模型比较表、选择理由与若干敏感性分析；低分：单模型报告或无比较依据。"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "可复现的数据处理流水线实现",
              "description": "实现从表1/表2/表3抽取、流水号→时间映射、mm^3→mL 转换、首次影像筛选到特征表生成的自动化脚本，记录处理日志并保存中间文件（长表、映射表、异常清单）。",
              "score": 30,
              "evaluation_focus": "数据工程与重现性实现能力",
              "scoring_hint": "高分：脚本可一键重跑并产生相同中间/最终文件，且有错误/异常记录；低分：手工步骤多或中间文件缺失。"
            },
            {
              "sub_criteria": "模型训练/评估代码规范性与封装",
              "description": "训练、调参、校准与预测模块应实现为可复用函数/类并支持固定随机种子、参数化超参搜索、模型持久化（序列化）与性能报告生成。",
              "score": 25,
              "evaluation_focus": "软件工程实践与实验可重现性",
              "scoring_hint": "高分：代码结构清晰、参数可配置、保存训练分割与模型版本；低分：一体化脚本、难以复现。"
            },
            {
              "sub_criteria": "资源与依赖管理与可移植性",
              "description": "记录并固定软件包版本（requirements.txt 或 renv/packrat）、设置随机种子、并对贝叶斯联合模型或大模型给出计算资源估计与并行化方案。",
              "score": 20,
              "evaluation_focus": "工程可部署性与环境可移植性",
              "scoring_hint": "高分：提供环境文件、版本锁定与并行建议；低分：未记录依赖或无法在有限资源下运行。"
            },
            {
              "sub_criteria": "代码测试与日志监控",
              "description": "包含基本单元/集成测试（数据转换、指标计算）、异常处理与详细运行日志以便问题追溯（包括随机种子、数据切分、异常病例清单）。",
              "score": 25,
              "evaluation_focus": "代码健壮性与可审计性",
              "scoring_hint": "高分：有测试用例与日志输出并能人工重现异常案例；低分：无测试、异常直接导致中断。"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "全面性能报告与子集验证",
              "description": "提供静态模型在 sub101–130 上、纵向/联合模型在 sub131–160 上的性能表（weighted kappa、ordinal c-index、Brier、MAE、精确度分层），并对训练集内外差异进行分析与原因讨论（样本量、特征差异、过拟合迹象）。",
              "score": 30,
              "evaluation_focus": "统计解读与验证一致性判断",
              "scoring_hint": "高分：分子群报告并解释差异，低分：只给全体平均指标或忽视验证集表现。"
            },
            {
              "sub_criteria": "概率校准与决策实用性分析",
              "description": "给出校准曲线、Brier score 与决策阈值敏感性分析，讨论概率化预测在临床决策（转入/出院/手术）中的实际可用性与风险/收益阐释，并提出再校准建议。",
              "score": 25,
              "evaluation_focus": "概率解释与临床可用性评价",
              "scoring_hint": "高分：提出实际阈值建议并说明对不同阈值下灵敏度/特异度的临床含义；低分：仅报告数值不解释临床意义。"
            },
            {
              "sub_criteria": "可解释性输出与变量重要性分析",
              "description": "提供全局与局部解释：标准化回归系数、SHAP 值或部分依赖图，展示关键预测因子（例如基线 HM 体积、年龄、关键影像形状/灰度特征、随访 HM/ED 动态表示）对 mRS 的影响方向与幅度，并讨论生物学/临床一致性。",
              "score": 25,
              "evaluation_focus": "模型可解释性与医学一致性判断",
              "scoring_hint": "高分：输出多种解释工具并解释与已知临床证据的吻合性；低分：无变量重要性或解释与临床不符。"
            },
            {
              "sub_criteria": "不确定性与敏感性分析报告",
              "description": "展示不确定性来源（模型选择、特征筛选、缺失处理）并给出敏感性分析结果（如不同FPCA组件数、不同插补策略、不同正则化强度下的性能稳定性），以及对关键异常/需人工核查病例的单独说明。",
              "score": 20,
              "evaluation_focus": "不确定性意识与稳健性检验",
              "scoring_hint": "高分：多角度敏感性分析且提供结论稳定性评估；低分：无敏感性分析或结果对小改动极不稳。"
            }
          ]
        }
      }
    }
  }
}
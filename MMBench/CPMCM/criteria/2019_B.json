{
  "task_id": "2019_B",
  "problem": "请你们团队利用附件提供的相关背景材料和数据，建模分析下面问题：\n\n问题 1 $P_1$、$P_2$、$P_3$ 是 3 颗已知位置的恒星，即它们在天球坐标系下的赤经和赤纬 $\\left( \\left( \\alpha_i, \\delta_i \\right), i=1,2,3 \\right)$ 已知；$Q_1$、$Q_2$、$Q_3$ 是来自恒星 $P_1$、$P_2$、$P_3$ 的平行光经过星敏感器光学系统成像在感光面上的星像点质心中心位置（参见图1）；记 $O'Q_1 = a_1$，$O'Q_2 = a_2$，$O'Q_3 = a_3$，$OO' = f$。\n\n(1) 建立由 $f$，$a_i$，$\\left( \\alpha_i, \\delta_i \\right)$（$i=1,2,3$）等参数解算 $D$ 点在天球坐标系的位置信息的数学模型，并给出具体的求解算法；\n\n(2) 若不利用 $f$ 值的信息，试建立由 $a_i$，$\\left( \\alpha_i, \\delta_i \\right)$（$i=1,2,3$）等参数求解 $D$点在天球坐标系中的位置信息的数学模型，并给出具体的求解算法；\n\n(3) 一般来说，星敏感器视场内的恒星数量多于3颗，请讨论如何选择不同几何位置的三颗星，提高解算 $D$ 点在天球坐标系中的位置信息的精度，并分析相应的误差。\n\n问题2 传统的星图识别方法主要是以角距（即星与星之间的球心角，可直观理解为两颗恒星分别与地心连线之间的夹角）或其衍生的形式为特征，这类方法比较简单，但一般需要较大的存储空间，识别算法实时性不好，且识别率普遍不高。通过对星图中的星点信息进行更为精细的特征提取，构建更高层次的特征，可能会提高星图识别算法的实时性和降低误匹配率。基于附件2提供的简易星表信息，请构建相应的特征提取模型，设计对应的星图识别算法，确定出附件3给出的8幅星图中每一个星像点所对应的恒星编号（对应附件2简易星表的恒星编号），并对算法的性能进行评估。",
  "subtask": {
    "1": {
      "subtask": "子任务1（数据预处理、坐标与物理假设、基准标定）的目标是把原始星表与星图观测数据规范化为统一、可直接用于几何建模的输入——包括（1）统一单位与参考系的星表赤经/赤纬与观测像点坐标、（2）由赤经/赤纬到天球方向单位向量的确定、以及（3）建立并标定针孔投影的相机内参基准（最少包含有效焦距 f、主点坐标、像素尺度，并可选估计径向/切向畸变系数）并对这些量给出协方差估计；为实现上述目标本子任务应按以下步骤精确执行：首先解析所有输入文件并标准化单位与命名（把赤经α、赤纬δ统一为弧度或度并注明历元，把像素坐标统一为以图像左上角或感光面中心为参考的像素/物理长度，并记录各表格中字段映射和空表单情形），其次进行星表时标校正——若有观测时间信息则按给定时刻对星表坐标施加岁差/章动与恒星自行修正以把星表坐标变换到观测历元；若无观测时间则明确假定使用星表原历元并记录该假设；第三将每颗导航恒星的赤经/赤纬经球面到直角坐标变换为天球方向单位向量 s = [cosδ cosα, cosδ sinα, sinδ]^T，并输出单位向量集合与其标识符；第四规范化并校验观测像点数据：把像素坐标减去初始主点猜测（例如图像中心）、用已知或预设的像素尺寸换算为物理像面单位，并统一量纲以便与焦距 f 配合使用；第五在针孔成像假设下建立初始相机内参估计：若文档或设备给出近似 f 则采用该值并通过最小二乘用若干已知对应（若数据集包含部分已知对应）线性求解校正主点与像素尺度，否则用观测中的已知星对（星表方向向量与像面坐标）构造线性化投影关系并用SVD/最小二乘估计初值（至少3个非退化对应），同时记录解的条件数以判别退化几何；第六为提高精度，用鲁棒非线性优化（例如以Levenberg–Marquardt实现的束调整/最小二乘）对相机内参（f、主点、可选畸变系数）及存在的少量外参进行联合精化，目标函数是像点的重投影误差，优化过程中应使用鲁棒损失或RANSAC去除异常对应并输出最终残差统计；第七通过雅可比与近似Hessian计算参数协方差（或由优化器直接给出拟合协方差估计），并把这些不确定性与残差一起作为标定质量度量；最后把所有处理结果保存为统一数据结构：校准后的相机内参与协方差、规范化的像点坐标（物理量或角度）、每颗星对应的天球单位向量、以及处理日志（单位转换、历元假设、异常剔除信息、残差与条件数），并提供基本一致性检查（重投影残差分布、参数协方差、三点几何判定）以便下游使用。实现本子任务应使用数值线性代数（SVD/QR）、非线性最小二乘器（LM或信赖域）、天文坐标变换例程（岁差/章动/自行修正）及鲁棒估计方法；所有假设（针孔模型、星为无穷远、是否估计畸变、历元处理策略）必须在输出日志中明确记录。",
      "criteria": {
        "task_understanding": {
          "core_goal": "规范化与拟合星表与星图观测数据，建立并优化针孔成像内参（f、主点、像素尺度与可选畸变），并评估协方差与重投影残差。",
          "expected_output": "统一单位与参考系的星表（α、δ）与像点坐标，天球方向单位向量列表s_i，初始与优化后的相机内参（f、主点、像素尺度、可选畸变）、其协方差矩阵，鲁棒优化日志（残差统计、条件数、异常剔除），一致性检查报告及标准化数据文件。",
          "key_inputs_constraints": "输入：附件星表（含α、δ、历元与可选自行/亮度）、星图像点像素坐标、可选观测时间；约束：单位统一（度/弧度、像素/物理长度）、历元处理（岁差/章动/自行）、至少3个非共线对应用于SVD估计、针孔模型与星无穷远假设、鲁棒估计剔除粗差；前置：文件完整可解析、字段映射清晰、像素尺寸或其可辨识比例。",
          "modeling_type": "拟合+优化+评价",
          "role_in_pipeline": "作为数据预处理与基准标定环节，位于星图识别与姿态估计前；前序依赖：原始星表与星图数据读取；后续任务：几何配准、姿态求解、识别与导航解算。",
          "assumptions": "若缺失观测时间则默认使用星表原历元；若无厂家f与像素尺寸，则通过≥3对已知匹配做SVD初始化；畸变项可选（默认零）并在非线性阶段可被估计。"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "统一单位与参考系识别（α/δ弧度或度、像素/物理长度）",
              "description": "是否明确该子任务需将赤经α、赤纬δ及像点坐标统一到一致单位与参考系，并指出主点参考（图像中心或O'）。",
              "score": 35,
              "evaluation_focus": "需求界定",
              "scoring_hint": "高分：给出具体单位转换方案与参考点约定；中分：只提单位统一未给方法；低分：忽略单位或参考系。"
            },
            {
              "sub_criteria": "历元与时标处理识别（岁差/章动/自行）",
              "description": "是否识别到需将星表坐标变换到观测历元或阐明使用星表原历元的假设及影响。",
              "score": 30,
              "evaluation_focus": "领域要点",
              "scoring_hint": "高分：明确岁差/章动/自行并给出选择规则；中分：仅提历元未细化；低分：完全忽略时标校正。"
            },
            {
              "sub_criteria": "针孔成像内参标定目标与鲁棒性需求",
              "description": "是否将内参（f、主点、像素尺度、可选畸变）拟合与鲁棒非线性优化、异常点剔除定义为核心目标。",
              "score": 35,
              "evaluation_focus": "目标聚焦",
              "scoring_hint": "高分：清楚列出参数、鲁棒优化与残差统计；中分：提到优化未含鲁棒/统计；低分：未识别内参标定为目标。"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "核心目标复述（规范化与拟合+优化）",
              "description": "准确复述需先规范化数据，再拟合针孔内参并优化重投影误差、输出协方差与日志。",
              "score": 40,
              "evaluation_focus": "沟通准确",
              "scoring_hint": "高分：覆盖规范化、拟合、优化、协方差；中分：缺1项；低分：偏离或不完整。"
            },
            {
              "sub_criteria": "输入输出边界复述（s向量、内参、协方差）",
              "description": "清晰陈述输入（星表、像点、时间）与输出（s_i、内参与协方差、残差统计、异常剔除）。",
              "score": 30,
              "evaluation_focus": "范围界定",
              "scoring_hint": "高分：枚举主要I/O；中分：遗漏协方差或异常信息；低分：I/O混乱。"
            },
            {
              "sub_criteria": "依赖与位置复述（前序/后序）",
              "description": "说明任务在流水线中的定位与依赖（后续姿态/识别、前序数据读取）。",
              "score": 30,
              "evaluation_focus": "流程意识",
              "scoring_hint": "高分：列出前后依赖；中分：仅泛述位置；低分：未说明。"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "历元假设与时标可用性",
              "description": "对缺失观测时间时使用星表原历元的假设与误差影响评述（角秒级偏差）。",
              "score": 30,
              "evaluation_focus": "假设管理",
              "scoring_hint": "高分：量化或定性影响并记录日志策略；中分：仅陈述不量化；低分：未声明。"
            },
            {
              "sub_criteria": "成像模型假设（针孔、星无穷远、畸变项）",
              "description": "明确针孔模型、星在无穷远、是否估计径向/切向畸变及其先验。",
              "score": 35,
              "evaluation_focus": "物理合理性",
              "scoring_hint": "高分：说明何时估计畸变与先验范围；中分：只提针孔；低分：模型含糊。"
            },
            {
              "sub_criteria": "像素尺度与主点初值假设",
              "description": "缺少厂家信息时，采用图像中心为主点、单位像素尺度或等效焦距的设定及其验证计划。",
              "score": 35,
              "evaluation_focus": "可操作性",
              "scoring_hint": "高分：给出初始化与校验/更新机制；中分：仅给初值；低分：无初值策略。"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "α/δ到天球方向单位向量s的变换公式",
              "description": "正确给出s=[cosδ cosα, cosδ sinα, sinδ]^T，并处理单位（弧度/度）与历元修正。",
              "score": 25,
              "evaluation_focus": "数理推导",
              "scoring_hint": "高分：公式正确并含单位注意；中分：公式对但无单位细节；低分：公式错误。"
            },
            {
              "sub_criteria": "像面规范化与主点/像素尺度处理",
              "description": "构建像素到物理像面坐标的转换，包含减主点与尺度统一以匹配焦距f量纲。",
              "score": 25,
              "evaluation_focus": "建模实现",
              "scoring_hint": "高分：给完整变换链；中分：缺尺度或主点；低分：无统一量纲。"
            },
            {
              "sub_criteria": "针孔投影与重投影误差目标函数",
              "description": "建立针孔模型x≈f*s_x/s_z等关系，定义重投影误差与鲁棒损失（Huber/Cauchy）。",
              "score": 25,
              "evaluation_focus": "目标设计",
              "scoring_hint": "高分：含归一化、鲁棒损失；中分：仅L2；低分：未明确定义。"
            },
            {
              "sub_criteria": "退化几何与条件数判别",
              "description": "设计基于SVD的设计矩阵条件数评估，识别三点共线或视场退化。",
              "score": 25,
              "evaluation_focus": "稳健性",
              "scoring_hint": "高分：明确阈值或报告条件数；中分：仅口述；低分：未考虑。"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "线性初始化（SVD/QR）求解f/主点/像素尺度",
              "description": "构造线性化投影关系，使用≥3个非退化对应进行SVD或QR初始化并报告条件数。",
              "score": 35,
              "evaluation_focus": "算法选择",
              "scoring_hint": "高分：明确矩阵构造与样本要求；中分：仅提SVD；低分：无初始化或不当方法。"
            },
            {
              "sub_criteria": "非线性鲁棒优化（LM/信赖域）",
              "description": "使用LM最小化重投影误差，含鲁棒损失/RANSAC剔除，报告收敛准则与最终残差。",
              "score": 35,
              "evaluation_focus": "数值优化",
              "scoring_hint": "高分：阐明迭代停止、损失类型；中分：无鲁棒或停止准则；低分：未优化。"
            },
            {
              "sub_criteria": "协方差估计（雅可比/Hessian近似）",
              "description": "由近似Hessian或优化器输出给出参数协方差并解释不确定性来源。",
              "score": 30,
              "evaluation_focus": "不确定性",
              "scoring_hint": "高分：给出Cov与尺度解释；中分：只提可得；低分：无协方差。"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "文件解析与单位标准化实现",
              "description": "可靠解析星表/像点文件，完成α/δ单位转换、像素到物理坐标转换并记录字段映射与空值处理。",
              "score": 30,
              "evaluation_focus": "代码可靠性",
              "scoring_hint": "高分：含异常处理与日志；中分：基本成功；低分：脆弱或遗漏。"
            },
            {
              "sub_criteria": "天文历元变换模块（岁差/章动/自行）",
              "description": "实现或调用例程将星表坐标变换到观测历元，可切换到原历元并记录假设。",
              "score": 25,
              "evaluation_focus": "模块完备",
              "scoring_hint": "高分：可配置与单测；中分：仅实现部分；低分：缺失。"
            },
            {
              "sub_criteria": "线性SVD与LM优化管线",
              "description": "提供SVD初始化、LM优化、鲁棒损失/RANSAC与条件数计算的可复现实验代码。",
              "score": 30,
              "evaluation_focus": "数值实现",
              "scoring_hint": "高分：数值稳定、可复现；中分：功能有但不稳健；低分：实现缺失。"
            },
            {
              "sub_criteria": "结果导出与日志",
              "description": "输出内参与协方差、s向量、残差统计、异常剔除报告，统一数据结构。",
              "score": 15,
              "evaluation_focus": "工程完结",
              "scoring_hint": "高分：结构化输出；中分：零散输出；低分：缺失关键输出。"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "重投影残差统计与阈值评估",
              "description": "报告RMSE/MAE/95分位及像素到角度的量纲转换，评估是否达成标定目标。",
              "score": 35,
              "evaluation_focus": "结果解释",
              "scoring_hint": "高分：提供多指标与阈值对比；中分：仅RMSE；低分：无量化。"
            },
            {
              "sub_criteria": "参数协方差与可识别性讨论",
              "description": "解读f、主点、像素尺度、畸变的标准差与相关性，识别近共线导致的不良条件。",
              "score": 30,
              "evaluation_focus": "不确定性",
              "scoring_hint": "高分：结合条件数解释相关性；中分：只列数值；低分：缺解释。"
            },
            {
              "sub_criteria": "异常剔除与鲁棒性验证",
              "description": "量化RANSAC内外点比例，分析剔除对参数与残差的影响。",
              "score": 20,
              "evaluation_focus": "稳健性评估",
              "scoring_hint": "高分：给出比例与对比；中分：定性描述；低分：未分析。"
            },
            {
              "sub_criteria": "一致性检查与三点几何判定",
              "description": "给出条件数、三点几何退化判定与通过/失败结论，并提出改进建议。",
              "score": 15,
              "evaluation_focus": "质量控制",
              "scoring_hint": "高分：有判定标准与建议；中分：仅报告；低分：缺检查。"
            }
          ]
        }
      }
    },
    "2": {
      "subtask": "子任务 2 的目标是根据输入观测（每颗恒星的天球位置 α_i, δ_i，转为单位方向向量 p_i，以及感光面上像心 O' 到星像质心的径向距离 a_i）在两种情形下稳定、数值可靠地求解星敏感器光轴方向 d（单位向量，代表天球上 D 点方向）与在未知焦距情形下同时估计有效焦距 f；本任务的范围仅包括建立明确的数学方程、给出逐步数值求解流程、必要的参数化与约束处理、初值策略、雅可比与协方差计算方法以及退化判别准则，并产出解、残差与不确定性估计。 对于已知 f 的情形：先将每对 (α_i,δ_i) → p_i = [cosδ_i cosα_i, cosδ_i sinα_i, sinδ_i]^T，计算标量 c_i = 1/√(1+(a_i/f)^2)，构成线性系统 P d = c（P 的 i 行为 p_i^T）；若恰好 n=3 且 det(P) 非退化，则用 SVD/QR 计算 d = P^{-1} c 并归一化为单位向量；若 n>3 或存在测量噪声，则用加权最小二乘求解 d_ls = argmin_d ||W^{1/2}(P d − c)||_2（W 为对角权重矩阵，权值为各 c_i 测量方差的倒数），可通过正规化后归一化或通过拉格朗日乘子将单位范数约束包含进解法（等价于解 (P^T W P) d = λ d 的本征问题）；数值实现应使用伪逆/SVD 以处理欠定或病态情况，并报告 P 的条件数；用残差 r = P d − c 计算残差方差 σ^2 ≈ ||W^{1/2} r||^2/(n−m)（m=未知数维度），并用近似协方差 Cov(d) ≈ (P^T W P)^{-1} σ^2 估计不确定性。 对于未知 f 的情形：采用联合非线性最小二乘估计参数向量 x，其中可选参数化为 x = [φ,θ,f]（用两个球面角 φ,θ 表示单位向量 d，以保证 ||d||=1，或直接用 3 元向量 d 并在优化中显式约束归一化），构造残差 r_i(x) = p_i·d(φ,θ) − f/√(f^2 + a_i^2)，并最小化 Σ_i w_i r_i^2 以得到最优 x；建议用 Levenberg–Marquardt 或信赖域算法实现，优先提供解析雅可比以加速与稳定收敛： ∂r_i/∂f = −a_i^2/(f^2 + a_i^2)^{3/2}（负号），而对 d 的参数化角度的偏导可由链式法则给出（或若直接优化 d，则 ∂r_i/∂d = p_i 并需在每步归一化 d）；初始化采用经验或分步策略：用一个合理的 f0（设备说明或典型值）计算 c_i0 并用已知-f 的线性解得 d0，或以多重初值（不同 f0）并行运行以避免局部极小；迭代结束后用雅可比 J(x*) 估算参数协方差 Cov(x) ≈ (J^T W J)^{-1} σ^2 并报告 f 与 d 的置信区间。 实施细节与数值鲁棒性：所有优化应强制 f>0 且对 d 保持单位化（通过参数化或每步投影），当 J^T W J 条件数过大或秩不足时指示问题不可辨识（需更多观测点或更好的几何），并在输出中返回条件数、残差 RMS、收敛状态与迭代历史；测量权重 W 由像心测量方差与星表方向不确定性共同设定；若解析雅可比难以推导，可采用自动微分或数值差分但需控制步长。 输出包括：单位向量 d（对应天球上的 D 点方向）、若估计则返回 f 的标量值、残差向量与残差 RMS、参数协方差矩阵与由其导出的角度不确定度估计、以及诊断量（P 或 J 的条件数、是否收敛、是否存在退化），推荐实现工具为高质量线性代数库与非线性最小二乘器（例如 LAPACK/SVD、scipy.optimize.least_squares 或 Ceres），并在实现中记录初值与权重设置以便结果可重复。",
      "criteria": {
        "task_understanding": {
          "core_goal": "基于观测径向距离与恒星方向向量的拟合与优化，稳健求解星敏感器光轴方向 d（单位向量）并在未知焦距情形下联合估计有效焦距 f，评估残差与协方差不确定性。",
          "expected_output": "数值解与评估报告：d 的单位向量（天球方向）、若未知则估计的 f 标量、残差向量与RMS、参数协方差矩阵与角度不确定度、条件数/收敛状态/退化判别、使用的初值与权重设定。",
          "key_inputs_constraints": "输入：{(α_i, δ_i)}→p_i∈R^3 单位向量，像面径向距离 a_i>0，权重/方差 w_i；约束：||d||=1、f>0；数据量：n≥3 且几何非退化（P 满秩）；数值：使用SVD/LM，报告条件数；残差模型：r_i = p_i·d − f/√(f^2 + a_i^2)。",
          "modeling_type": "拟合+优化",
          "role_in_pipeline": "作为姿态解算核心环节，位于子任务1（数据预处理与内参基准）之后、姿态/定向与后续识别验证之前；依赖前序已标准化的 p_i、a_i、权重与初值 f0，向后续姿态应用与性能评估提供 d、f 与不确定性。"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "明确定义拟合与优化目标：求 d 与（可选）f",
              "description": "是否准确识别两种情形（已知 f 的线性拟合、未知 f 的非线性优化）及其共同目标为最小化 r_i 残差并满足 ||d||=1, f>0。",
              "score": 35,
              "evaluation_focus": "建模思维",
              "scoring_hint": "高分：区分两情形并写出目标函数与约束；中分：仅描述一种情形或漏掉约束；低分：未指出拟合/优化目标。"
            },
            {
              "sub_criteria": "数据与约束条件识别：p_i、a_i、权重 w_i",
              "description": "是否明确输入变量来源（α_i,δ_i→p_i，a_i），测量方差与权重设计，以及 n≥3 与 P 满秩等可辨识条件。",
              "score": 25,
              "evaluation_focus": "需求抽取",
              "scoring_hint": "高分：说明权重与秩条件；中分：仅列变量不述秩；低分：遗漏关键输入或误解量纲。"
            },
            {
              "sub_criteria": "数值稳定性与退化识别",
              "description": "是否强调 SVD/条件数、病态与退化几何（共面/共线）需判别与报告。",
              "score": 20,
              "evaluation_focus": "数值意识",
              "scoring_hint": "高分：提出条件数阈值与SVD；中分：笼统提稳定性；低分：无任何稳定性考量。"
            },
            {
              "sub_criteria": "输出与评估指标识别：残差RMS与协方差",
              "description": "是否要求输出 r、RMS、Cov(d,f) 与角度不确定度，给出σ^2估计与自由度。",
              "score": 20,
              "evaluation_focus": "评价指标",
              "scoring_hint": "高分：包含RMS、σ^2、DOF；中分：仅RMS；低分：无量化评估。"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "线性系统 P d = c 的复述准确性",
              "description": "能否给出 c_i=1/√(1+(a_i/f)^2) 并说明 n=3 可逆与 n>3 WLS。",
              "score": 30,
              "evaluation_focus": "表述精确",
              "scoring_hint": "高分：写出公式与求解策略；中分：有式无求解细节；低分：误写或遗漏 c_i。"
            },
            {
              "sub_criteria": "非线性残差 r_i(x) 的清晰表达",
              "description": "正确写出 r_i = p_i·d − f/√(f^2+a_i^2)，参数化 x=[φ,θ,f] 或 d+归一化。",
              "score": 30,
              "evaluation_focus": "表述精确",
              "scoring_hint": "高分：残差与参数化齐全；中分：残差正确但参数化不明；低分：残差式错误。"
            },
            {
              "sub_criteria": "约束与边界的复述（||d||=1, f>0）",
              "description": "明确如何施加单位范数与正值约束（球面参数化或投影/重参数）。",
              "score": 20,
              "evaluation_focus": "约束理解",
              "scoring_hint": "高分：给出具体施加方式；中分：仅文字说明；低分：未复述。"
            },
            {
              "sub_criteria": "诊断输出需求复述",
              "description": "准确列出条件数、收敛状态、迭代历史、初值与权重记录。",
              "score": 20,
              "evaluation_focus": "规范意识",
              "scoring_hint": "高分：逐项罗列；中分：部分；低分：无提及。"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "针孔模型与星为无穷远假设",
              "description": "明确采用针孔投影且星体在无穷远，忽略畸变或说明是否估计畸变。",
              "score": 25,
              "evaluation_focus": "模型假设",
              "scoring_hint": "高分：写出并讨论影响；中分：仅声明；低分：未提及或自相矛盾。"
            },
            {
              "sub_criteria": "误差模型与权重 W 假设",
              "description": "定义测量噪声（像点与星表方向）如何合成到 w_i，独立同分布或异方差。",
              "score": 25,
              "evaluation_focus": "统计建模",
              "scoring_hint": "高分：可操作的权重构造；中分：笼统方差；低分：无误差假设。"
            },
            {
              "sub_criteria": "可辨识性与非退化条件假设",
              "description": "阐明 n≥3、P 满秩、p_i 几何分布（不共线/不过近）等条件。",
              "score": 25,
              "evaluation_focus": "可辨识性",
              "scoring_hint": "高分：列条件并给检查方法；中分：仅条件；低分：未说明。"
            },
            {
              "sub_criteria": "初值策略与收敛假设",
              "description": "设定 f0、d0 的获取（线性解/多初值）及 LM 收敛区域假设。",
              "score": 25,
              "evaluation_focus": "优化意识",
              "scoring_hint": "高分：多初值或稳健策略；中分：单一初值；低分：无初值说明。"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "已知 f 的线性模型与权重最小二乘",
              "description": "正确构建 P、c、W，含单位范数约束处理（归一化或拉格朗日/本征）。",
              "score": 30,
              "evaluation_focus": "数理推导",
              "scoring_hint": "高分：两种约束处理给法；中分：仅普通WLS；低分：模型不完整。"
            },
            {
              "sub_criteria": "未知 f 的非线性目标与参数化",
              "description": "构造 Σ w_i r_i^2，参数化 d 为[φ,θ]或投影归一化并说明优缺点。",
              "score": 25,
              "evaluation_focus": "建模设计",
              "scoring_hint": "高分：清晰权衡与选择；中分：给出一种；低分：无参数化。"
            },
            {
              "sub_criteria": "雅可比矩阵的解析推导",
              "description": "提供 ∂r_i/∂f=−a_i^2/(f^2+a_i^2)^{3/2} 与对 d 的导数（p_i 或角度链式）。",
              "score": 25,
              "evaluation_focus": "推导能力",
              "scoring_hint": "高分：给出完整表达；中分：部分导数；低分：无雅可比或错误。"
            },
            {
              "sub_criteria": "协方差与不确定度估计公式",
              "description": "给出 Cov ≈ (J^T W J)^{-1} σ^2、σ^2估计与角度不确定度换算。",
              "score": 20,
              "evaluation_focus": "统计推断",
              "scoring_hint": "高分：含DOF与角度化；中分：仅矩阵形式；低分：缺失。"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "线性情形的数值解法与SVD/伪逆",
              "description": "采用SVD/QR解 P d=c，报告条件数，病态时正则或拒绝并归一化 d。",
              "score": 25,
              "evaluation_focus": "算法选择",
              "scoring_hint": "高分：含条件数阈值与处理；中分：仅SVD；低分：直接求逆。"
            },
            {
              "sub_criteria": "LM/信赖域的稳健实现",
              "description": "设置阻尼、终止准则、步长控制与鲁棒损失/RANSAC 剔除异常点。",
              "score": 25,
              "evaluation_focus": "数值优化",
              "scoring_hint": "高分：含鲁棒损失与收敛准则；中分：仅LM默认；低分：无实现细节。"
            },
            {
              "sub_criteria": "约束处理：||d||=1 与 f>0",
              "description": "通过球面参数化或每步投影保持单位化；对 f 采用重参数化（如 f=exp(ξ)）。",
              "score": 25,
              "evaluation_focus": "约束处理",
              "scoring_hint": "高分：给出可实现的策略；中分：只口头说明；低分：忽略约束。"
            },
            {
              "sub_criteria": "初值与多初值策略",
              "description": "利用已知-f 线性解得 d0，尝试多 f0 并行或网格以避免局部极小。",
              "score": 25,
              "evaluation_focus": "收敛稳定",
              "scoring_hint": "高分：多初值+筛选RMS；中分：单初值；低分：未提初值。"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "线性代数与最小二乘库正确使用",
              "description": "使用 SVD/QR、伪逆与加权最小二乘，避免手写不稳定求逆。",
              "score": 30,
              "evaluation_focus": "代码可靠性",
              "scoring_hint": "高分：调用成熟库并检查返回状态；中分：自写且可用；低分：直接矩阵求逆。"
            },
            {
              "sub_criteria": "LM/信赖域优化与雅可比实现",
              "description": "实现解析雅可比或自动微分，提供终止条件与最大迭代限制。",
              "score": 30,
              "evaluation_focus": "工程实现",
              "scoring_hint": "高分：解析雅可比+稳健终止；中分：数值差分；低分：无雅可比或易发散。"
            },
            {
              "sub_criteria": "约束与归一化、正值强制",
              "description": "每步归一化 d 或使用角参数化；对 f 采用正值重参数或投影。",
              "score": 20,
              "evaluation_focus": "实现细节",
              "scoring_hint": "高分：一致实现并有单元测试；中分：偶尔处理；低分：未处理导致异常值。"
            },
            {
              "sub_criteria": "诊断与日志：条件数/残差/协方差输出",
              "description": "输出条件数、RMS、迭代历史、Cov 与角度不确定度，记录初值与权重。",
              "score": 20,
              "evaluation_focus": "可观察性",
              "scoring_hint": "高分：结构化日志；中分：部分输出；低分：无诊断信息。"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "残差与RMS解读（线性/非线性）",
              "description": "比较两情形残差与RMS，判断拟合优度与是否存在异常点。",
              "score": 30,
              "evaluation_focus": "结果解释",
              "scoring_hint": "高分：量化RMS与异常占比；中分：定性描述；低分：未分析。"
            },
            {
              "sub_criteria": "协方差与角度不确定度评估",
              "description": "报告 Cov(d,f) 并将 d 的不确定度转换为角度（弧度/角秒）解释可行性。",
              "score": 25,
              "evaluation_focus": "不确定性",
              "scoring_hint": "高分：给角度区间；中分：仅矩阵；低分：无不确定度。"
            },
            {
              "sub_criteria": "退化与条件数诊断结论",
              "description": "结合条件数与秩分析给出是否几何退化及改进建议（更多星或几何分散）。",
              "score": 25,
              "evaluation_focus": "诊断能力",
              "scoring_hint": "高分：给阈值与建议；中分：泛述；低分：未结论。"
            },
            {
              "sub_criteria": "初值与多初值敏感性分析",
              "description": "比较不同 f0/d0 的收敛解与RMS差异，评估局部极小风险。",
              "score": 20,
              "evaluation_focus": "稳健性",
              "scoring_hint": "高分：报告多初值结果一致性；中分：单一尝试；低分：未分析。"
            }
          ]
        }
      }
    },
    "3": {
      "subtask": "子任务3聚焦于对用于求解光轴方向（及必要时焦距）的观测子集进行误差传播评估、最优三点(或更大子集)选择以及解算过程的稳健化判据和步骤的系统化实现：其范围包括（1）输入与假设：接受规范化的天球单位向量 p_i（由赤经/赤纬转换）、对应观测量（例如像面径向距 a_i 或已转换的角余弦 c_i）、每个观测的测量方差（像心提取误差σ_px及其换算到 c_i 的方差）和星表方向不确定度作为噪声模型；（2）理论误差传播：对线性情形（已知焦距或线性化模型）计算雅可比并使用近似协方差公式 Cov(d) ≈ (P^T W P)^{-1} σ^2（其中 P 的行为 p_i^T，W 为观测权重矩阵，σ^2 为残差方差估计），对非线性联合估计情形计算整体雅可比 J = ∂r/∂x（x 为待估参数向量，如方向参数化与/或 f），并用 Cov(x) ≈ (J^T W J)^{-1} σ^2 估计参数不确定度；同时计算 Fisher 信息量、条件数与最小特征值等诊断量以量化信息量与数值稳定性。基于上述基础，制定明确的三点选择与评分准则：对任一候选三元组构建评分函数 S（可选形式包括 S1 = λ_min(P^T P)（越大越好）、S2 = 1/cond(P) 或 S3 = 1/trace(Cov(d))），并结合几何量（球面三角形面积、三点之间的最小/最大角距）与观测置信度（星等/测量方差）做加权评分，优先选择角距分布广、三角形面积大且观测方差小的组合以降低误差放大。实现策略：若候选星数较小则枚举所有三元组并计算上述评分与协方差，若候选星数较大则采用启发式搜索（贪心法：先选高SNR星，再按角距或增益量最大化选择；或随机采样与多次优化，类似 RANSAC 的采样验证）以降低计算负担；对评分最高的若干三元组进行蒙特卡洛仿真（用给定噪声模型对观测扰动多次抽样并解算，得到经验协方差与偏差分布）以验证一阶线性传播的近似并检验有无系统偏差。稳健化与退化检测：对每个候选组计算 P 或 J 的秩与条件数并与预设阈值比较（若秩不足或 cond 超阈值则判为几何退化并剔除），在实际解算中采用加权最小二乘或带正则化项的最小二乘以缓和病态问题，并在存在异常观测或潜在错误匹配时使用 RANSAC/一致性检验剔除离群子集；对于冗余方案，建议并行用多组高评分三元组求解并以协方差为权重进行加权融合或用最小化重投影残差的全局加权拟合替代单一三元组结果。输出与诊断要求：为所选最优三点（或融合后的解）输出数值结果、预期协方差矩阵、蒙特卡洛估计的经验标准差、评分值、条件数与退化标志、残差 RMS 以及若干决策建议（如需更多观测或切换到冗余拟合）；实现上应使用可靠的线性代数工具（SVD/QR）、数值优化与雅可比计算库、以及用于蒙特卡洛模拟的随机采样模块，并把所有阈值、权重设定与噪声模型记录在日志以保证结果可复现。",
      "criteria": {
        "task_understanding": {
          "core_goal": "建立并优化用于误差传播评估与最优三点选择的模型，评估并拟合星敏感器光轴方向 d（及必要时焦距 f），并对解的稳健性与不确定度进行量化评估",
          "expected_output": "最优三点组合列表与评分 S 值、对应解 d（及可选 f）与其协方差矩阵、P/J 条件数与退化标志、蒙特卡洛经验协方差与残差统计、决策建议与处理日志（含初值与权重）",
          "key_inputs_constraints": "1) p_i: 天球单位向量数组（数值向量，已规范化，单位无）；2) a_i 或 c_i: 像面径向距离或角余弦（实数，物理单位需一致）；3) 测量方差: 像心提取误差σ_px及换算到 c_i 的方差、星表方向不确定度（数值或协方差）；4) 相机内参先验（可选 f、主点、像素尺度）或明确声明未知；5) 约束：f>0，d 为单位向量（归一化约束）",
          "modeling_type": "优化+评价+仿真+拟合",
          "role_in_pipeline": "本子任务位于规范化与标定（子任务1）和单次解算（子任务2）之后，作为观测子集选择与不确定度评估模块，依赖前序提供的规范化 p_i、a_i 与协方差，后续可将融合结果输入整体冗余拟合或姿态确定步骤"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "识别误差传播目标及量化输出（协方差/置信区间）",
              "description": "是否明确将误差传播目标写为输出协方差 Cov(d) 或 Cov(x)，并指定要给出的置信区间、RMS、Fisher 信息等量化指标",
              "score": 40,
              "evaluation_focus": "建模思维",
              "scoring_hint": "高分：明确输出 Cov 与置信区间并给出计算公式和诊断指标（λ_min、cond）；中分：只给出残差RMS或单一不确定度；低分：仅口头描述不提供量化计算或指标。"
            },
            {
              "sub_criteria": "识别三点选择目标与评分函数 S（如 S1/S2/S3）",
              "description": "是否识别并列出用于三点选择的评分函数 S（例如 λ_min(P^T P)、1/cond(P)、1/trace(Cov)）及其与几何量（球面三角形面积、角距）的关联",
              "score": 30,
              "evaluation_focus": "问题分解",
              "scoring_hint": "高分：明确至少两种 S 形式并说明几何意义；中分：只列出一种 S 且说明有限；低分：未提出具体 S 或无几何关联说明。"
            },
            {
              "sub_criteria": "识别退化情形与稳健化需求（条件数/秩检测）",
              "description": "是否识别几何退化（P 或 J 秩亏或高条件数）并提出退化判别准则与稳健化手段（正则化、RANSAC、冗余拟合）",
              "score": 30,
              "evaluation_focus": "诊断能力",
              "scoring_hint": "高分：提供明确阈值（如 cond>1e8 或 λ_min<thresh）及对应措施；中分：描述退化与措施但无阈值；低分：忽略退化或无应对策略。"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "复述误差传播与协方差计算目标",
              "description": "是否准确复述要对线性已知 f 情形用 Cov(d)≈(P^T W P)^{-1} σ^2，非线性情形用 J 计算 Cov(x) 的要求",
              "score": 40,
              "evaluation_focus": "数理推导",
              "scoring_hint": "高分：给出公式并注明 W、σ^2 与自由度；中分：给出公式但对权重或σ^2说明不全；低分：公式错误或混淆线性/非线性情形。"
            },
            {
              "sub_criteria": "复述三点选择评分与几何量的权衡（面积/角距/观测方差）",
              "description": "是否复述通过结合球面三角形面积、最小/最大角距与观测方差加权来构造综合评分并优先选择角距分布广且方差小的组合",
              "score": 35,
              "evaluation_focus": "方法理解",
              "scoring_hint": "高分：清楚列出加权方案并说明权重依据（SNR或σ）；中分：描述几何优先但无方差加权；低分：只提几何或只提方差，未结合。"
            },
            {
              "sub_criteria": "复述蒙特卡洛验证与线性近似检验要求",
              "description": "是否复述要用蒙特卡洛对高评分三元组进行噪声采样验证以检验线性传播近似并输出经验协方差与偏差分布",
              "score": 25,
              "evaluation_focus": "仿真验证",
              "scoring_hint": "高分：说明抽样次数、噪声模型与对比度量；中分：提出蒙特卡洛但细节欠缺；低分：仅建议仿真不说明指标。"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "针孔成像与恒星无穷远假设的明确性",
              "description": "是否明确声明针孔成像、恒星视为无穷远点源、像点径向距离与角余弦转换关系的前提条件",
              "score": 25,
              "evaluation_focus": "物理假设",
              "scoring_hint": "高分：写明针孔模型、无穷远假设并讨论其适用性；中分：声明但未讨论局限；低分：未声明或与模型冲突。"
            },
            {
              "sub_criteria": "噪声模型与独立性假设的明确性（σ_px 与星表不确定度）",
              "description": "是否明确测量误差模型（像心误差、星表方向不确定度）、是否假定独立同分布或给出协方差结构",
              "score": 25,
              "evaluation_focus": "噪声建模",
              "scoring_hint": "高分：给出具体 σ_px 值或换算公式并说明独立性/耦合；中分：给出σ_px但未说明协方差结构；低分：无误差模型或假设不清。"
            },
            {
              "sub_criteria": "参数约束（f>0 与 d 单位化）的处理假设",
              "description": "是否明确约束 f>0 与 d 为单位向量，并说明采用参数化（角度）或投影归一化策略",
              "score": 25,
              "evaluation_focus": "约束处理",
              "scoring_hint": "高分：明确约束并给出实现方法（参数化或每步归一化）；中分：声明约束但实现欠缺；低分：未提或违反约束。"
            },
            {
              "sub_criteria": "线性化近似与小角近似的适用性说明",
              "description": "是否说明在用线性误差传播时对 a_i/f 或噪声大小的线性化适用范围及何时需用非线性求解",
              "score": 25,
              "evaluation_focus": "近似范围",
              "scoring_hint": "High: 定量给出近似阈值（如 a/f<0.1）及换用非线性条件；中: 定性说明；低: 无近似讨论或不合理。"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "构建线性模型并给出 Cov(d) 计算（已知 f）",
              "description": "是否按 P d = c 构建线性系统、说明权重矩阵 W 构成并给出 Cov(d)≈(P^T W P)^{-1} σ^2 的实现细节",
              "score": 25,
              "evaluation_focus": "线性代数",
              "scoring_hint": "高分：提供矩阵维度、求逆或伪逆步骤并考虑条件数与正则化；中分：公式正确但数值细节欠缺；低分：公式错误或忽略权重。"
            },
            {
              "sub_criteria": "构建非线性联合模型并给出残差 r_i 与雅可比 J",
              "description": "是否为未知 f 状况给出残差 r_i = p_i·d − f/√(f^2+a_i^2) 的定义，并推导或说明 J 的解析形式或数值计算方法",
              "score": 25,
              "evaluation_focus": "雅可比导数",
              "scoring_hint": "高分：给出解析导数并处理 d 参数化；中分：仅给出数值差分策略；低分：无 J 或错误导数。"
            },
            {
              "sub_criteria": "构建三点评分函数 S 与几何量结合的综合评分",
              "description": "是否给出 S 的明确形式（如线性信息量 λ_min(P^T P) 与球面三角形面积加权的组合）及权重设定原则",
              "score": 25,
              "evaluation_focus": "评分设计",
              "scoring_hint": "高分：给出可计算 S 并说明权重来源（SNR、σ）；中分：给出 S 但权重主观；低分：无明确 S 或不可计算形式。"
            },
            {
              "sub_criteria": "退化检测与稳健化模型（正则化/RANSAC/多组融合）",
              "description": "是否在模型中加入退化检测阈值与稳健化策略，例如条件数阈值、带正则化的加权最小二乘或多组解的协方差加权融合",
              "score": 25,
              "evaluation_focus": "稳健化",
              "scoring_hint": "高分：实现正则化与 RANSAC 流程并说明参数；中分：提出方法但无实现细节；低分：无稳健化或不可行策略。"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "线性代数求解（SVD/加权最小二乘）实现与条件数报告",
              "description": "是否使用数值稳健的方法（SVD 或带正则化的最小二乘）求解 P d = c 并报告 P 的条件数与秩判别",
              "score": 25,
              "evaluation_focus": "数值稳定",
              "scoring_hint": "高分：用 SVD/伪逆并给出 cond 与秩；中分：用普通求逆但报告条件数；低分：直接反解且无条件数检验。"
            },
            {
              "sub_criteria": "非线性优化实现（LM/信赖域）与解析雅可比利用",
              "description": "是否用 LM 或信赖域方法优化联合参数（d 参数化与 f），并优先使用解析雅可比以提高收敛性与协方差估计精度",
              "score": 25,
              "evaluation_focus": "优化实现",
              "scoring_hint": "高分：实现 LM 并提供解析 J 与收敛历史；中分：使用库优化但仅数值差分；低分：无收敛判断或易陷局部极小。"
            },
            {
              "sub_criteria": "初值策略、多重初值与退化提示",
              "description": "是否给出合理初值策略（用已知-f 线性解做初值或多重 f0 并行尝试）并在 J^T W J 条件差时提示不可辨识",
              "score": 25,
              "evaluation_focus": "初始化",
              "scoring_hint": "高分：提供多重初值与并行策略并在不可辨识时返回提示；中分：有单一初值策略；低分：无初值说明或易不收敛。"
            },
            {
              "sub_criteria": "蒙特卡洛仿真验证与经验协方差估计",
              "description": "是否用蒙特卡洛对高评分三元组实施噪声采样，比较经验协方差与线性传播结果并输出偏差与置信区间",
              "score": 25,
              "evaluation_focus": "仿真验证",
              "scoring_hint": "高分：提供抽样次数、拟合统计与对比图表并量化偏差；中分：做仿真但统计欠详；低分：无仿真或仿真样本不足（如<100）。"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "可复现的实现与完整日志（初值、权重、阈值）",
              "description": "代码是否记录初值、权重 W、噪声模型、条件数阈值、RANSAC 参数与迭代历史并能复现结果",
              "score": 30,
              "evaluation_focus": "可复现性",
              "scoring_hint": "高分：提供可运行脚本与日志且能复现结果；中分：代码可运行但日志不全；低分：代码缺失或不可复现。"
            },
            {
              "sub_criteria": "数值鲁棒性与异常处理（SVD/正则化/归一化）",
              "description": "代码是否在求解中使用 SVD、处理高条件数、保证 d 单位化并对异常（NaN、发散）给出处理逻辑",
              "score": 25,
              "evaluation_focus": "数值鲁棒",
              "scoring_hint": "高分：包含条件数检查、正则化与异常捕获；中分：部分检查；低分：无异常处理导致崩溃。"
            },
            {
              "sub_criteria": "单元测试与蒙特卡洛自动化模块",
              "description": "是否提供单元测试覆盖核心函数（P 构造、雅可比、Cov 计算）并自动化蒙特卡洛仿真以便批量验证",
              "score": 25,
              "evaluation_focus": "代码质量",
              "scoring_hint": "高分：有覆盖关键函数的测试与可配置蒙特卡洛驱动；中分：有手动测试脚本；低分：无测试。"
            },
            {
              "sub_criteria": "性能与可扩展性（并行采样/大 N 策略）",
              "description": "代码是否对大候选星数提供枚举/启发式搜索（贪心、随机采样/RANSAC）并支持并行蒙特卡洛以提升效率",
              "score": 20,
              "evaluation_focus": "效率扩展",
              "scoring_hint": "高分：实现并行采样与启发式搜索并给出复杂度；中分：有启发式但无并行；低分：暴力枚举且不可扩展。"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "输出协方差与线性/蒙特卡洛不确定度对比",
              "description": "是否对比线性传播得到的 Cov 与蒙特卡洛经验协方差，并分析二者差异及线性近似的适用性",
              "score": 30,
              "evaluation_focus": "不确定度分析",
              "scoring_hint": "高分：给出定量差异、图表与判断（线性适用或否）；中分：给出数值但无深入分析；低分：仅给一方结果。"
            },
            {
              "sub_criteria": "对最优三点的决策建议与备选策略（冗余拟合）",
              "description": "是否基于评分 S、条件数与蒙特卡洛结果给出决策建议（接受、拒绝或要求更多观测），并提出冗余融合方案",
              "score": 25,
              "evaluation_focus": "决策支持",
              "scoring_hint": "高分：提供明确阈值驱动建议与融合流程；中分：建议定性但无阈值；低分：无实用建议。"
            },
            {
              "sub_criteria": "敏感性分析（对噪声、f 初值与权重的影响）",
              "description": "是否分析结果对像心噪声σ_px、星表方向误差及 f 初值的敏感性并给出量化指标（如角度标准差随σ_px变化曲线）",
              "score": 25,
              "evaluation_focus": "敏感性",
              "scoring_hint": "高分：提供曲线/表格与临界点；中分：定性说明敏感趋势；低分：无敏感性分析。"
            },
            {
              "sub_criteria": "诊断报告（cond、λ_min、残差RMS与退化标志）",
              "description": "是否在输出中包含 P/J 条件数、最小特征值、残差 RMS 与退化判定标志并记录于日志以便审阅",
              "score": 20,
              "evaluation_focus": "诊断输出",
              "scoring_hint": "高分：完整报告并在退化时给出替代方案；中分：报告部分诊断量；低分：无诊断信息。"
            }
          ]
        }
      }
    },
    "4": {
      "subtask": "子任务4 的目标是设计并实现一条完整、可复现且高效的星图识别流水线——从观测星点到导航星表编号的映射——包括特征设计与提取、离线索引构建、在线候选检索、几何验证与精化，以及统一的性能评估指标与测试程序。具体范围与输入：输入为经预处理的单幅星图数据（每个星像的像素/像面坐标与质心不确定度、若有则包含星等/亮度信息）、导航星表（恒星编号、赤经/赤纬→单位方向向量、视星等）以及可选的相机近似内参（像素尺度/主点/近似焦距）；本子任务不承担像点去噪或历元校正等工作，但需明确记录输入格式与单位。方法与步骤（一体化描述）：1）坐标与尺度归一化：将观测像素坐标统一到以感光面中心或主点为原点的物理像面单位，必要时用像素尺度换算并记录不确定度；2）局部与多点不变特征设计：为每颗观测星构造局部邻域不变描述子 LND(k)（以该星为中心按极角排序的最近 k 个邻星的径向比 r_j/r_k 与角差序列，使用对数与归一化以增强数值稳定性），同时在图上枚举若干三角形/四元组并计算边长比、余弦不变量与星等比值作为补充特征；3）特征量化与离线索引：对上述实值特征进行对数/归一化处理后量化为离散码（每分量划分 B 个区间），在导航星表上预计算相同类别的特征并建立多级索引结构——粗筛可采用哈希表或 LSH，精筛用 KD-tree 或倒排索引，以平衡存储与在线检索时间；4）在线候选检索：对观测特征先用粗筛快速检索出若干候选星表子图（每特征保留 top-N 候选），合并重复候选并按照特征匹配得分（基于距比差、角差和星等差的加权和）排序；5）几何验证与鲁棒估计：对每个候选子图执行基于几何一致性的验证——若能构造方向向量则求解旋转（Wahba/Davenport q-method 或 Procrustes），若焦距未知则联合估计旋转与尺度/焦距，所有几何拟合采用 RANSAC 去除离群并计算重投影残差；6）精化与全局束调整：在确认若干可靠匹配后，用非线性最小二乘（Levenberg–Marquardt 或 Ceres）对姿态（旋转）、可观测内参（如焦距）和可选径向畸变参数进行束调整，输出最终的点对映射与残差统计；7）置信度打分与输出：为每个映射返回匹配置信度、重投影 RMS、参与拟合的观测数量及其不确定度估计，最终输出每幅图的映射表（观测点→星表编号）与相关元数据。实现细节与参数：建议取 k（邻域大小）为 4–8，量化区间 B 依据星表密度调节（常用 8–16），粗筛保留候选数 N 以 10–50 为宜，RANSAC 迭代次数根据容错率与置信度设定；使用对数距离比与亮度排序可显著提升对尺度与亮度扰动的鲁棒性；为嵌入式实时场景优先采用量化哈希做在线检索并限制精筛次数以控制延迟。所需工具与库：离线/在线索引可用 KD-tree、LSH 或 Faiss；几何计算与线性代数用 Eigen、NumPy/SciPy 或 OpenCV；非线性最小二乘与束调整可用 Ceres、ceres-solver 或 scipy.optimize.least_squares；RANSAC 可用 sklearn 或自实现。性能评估与测试协议（必须包含）：统一衡量指标包括识别率（正确匹配数/观测星数）、误识率、平均每幅匹配时间、重投影残差均值与方差；评估应包含噪声敏感性测试（像心误差范围的蒙特卡洛仿真）、缺星率测试（模拟漏检或遮挡）、以及焦距不确定性测试；所有测试需输出 ROC/精度-召回曲线和在不同参数设置下的运行时间曲线以供折衷选择。输出与交付物：实现代码（含离线索引构建与在线匹配模块）、一份输入/输出格式规范、每幅星图的匹配结果文件（观测ID→星表编号、置信度、重投影残差）、索引统计（条目数、平均候选数）、以及一份标准化的性能报告（按上述指标）。本子任务不涉及星表历元校正或像点质心提取，但要求在实现中明确记录所有假设、参数与单位以确保结果可重复与可移植。",
      "criteria": {
        "task_understanding": {
          "core_goal": "设计与实现一条鲁棒的星图识别流水线：从观测星点特征提取与索引，到在线候选检索、几何验证与束调整精化，并对识别率与实时性进行评估",
          "expected_output": "代码与可复现实验：离线索引文件、每幅星图的匹配结果表(观测ID→星表编号、置信度、重投影残差)、性能报告(识别率/误识率/用时/残差RMS、ROC/PR曲线)、日志(参数与单位)、可运行测试脚本",
          "key_inputs_constraints": "输入包含：1) 观测星点像面坐标与质心不确定度(单位与原点需统一)；2) 导航星表(编号、赤经/赤纬→单位向量、视星等)；3) 可选相机近似内参(像素尺度/主点/焦距)。约束：特征需尺度/旋转鲁棒；检索需Top-N限幅；几何验证需RANSAC与重投影误差阈值；评估需多噪声/缺星/焦距扰动工况。",
          "modeling_type": "分类+拟合+评价",
          "role_in_pipeline": "作为识别阶段的核心执行环节：位于数据预处理与几何解算之后、姿态/焦距精化之前；依赖子任务1的数据规范化与子任务2/3的几何与误差判据，向下游姿态估计和定位提供已配对的观测-星表映射与不确定度"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "端到端星图识别目标界定与评估指标",
              "description": "是否明确该任务是将观测星点映射到星表编号并需输出置信度、重投影残差、识别率/误识率/时间等统一指标与ROC/PR。",
              "score": 40,
              "evaluation_focus": "任务边界与指标",
              "scoring_hint": "高分：列出识别率、误识率、RMS、用时、ROC/PR；中分：仅识别率+用时；低分：仅给出匹配对，无指标"
            },
            {
              "sub_criteria": "输入约束与单位规范识别",
              "description": "是否识别像面坐标原点/尺度、质心不确定度、星表单位向量与视星等等关键输入及其单位一致性需求。",
              "score": 30,
              "evaluation_focus": "数据理解",
              "scoring_hint": "高分：明确原点、像素尺度→物理单位、误差单位；中分：部分说明；低分：未提单位与不确定度"
            },
            {
              "sub_criteria": "实时性与存储折中",
              "description": "是否识别离线索引节省在线时间与Top-N候选上限控制延迟的需求与约束。",
              "score": 30,
              "evaluation_focus": "系统权衡",
              "scoring_hint": "高分：明确N范围(10–50)与索引结构；中分：笼统提到加速；低分：无检索/加速考虑"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "流水线七步清晰复述",
              "description": "是否按坐标归一化→LND/三角形特征→量化索引→候选检索→几何验证(RANSAC)→束调整→置信度输出复述并对齐术语。",
              "score": 40,
              "evaluation_focus": "流程把握",
              "scoring_hint": "高分：逐步对应且无遗漏；中分：缺1–2步或术语含混；低分：流程错乱"
            },
            {
              "sub_criteria": "关键超参数与范围复述",
              "description": "是否复述k(4–8)、B(8–16)、Top-N(10–50)、RANSAC迭代设定与阈值含义。",
              "score": 30,
              "evaluation_focus": "参数理解",
              "scoring_hint": "高分：含数值范围与作用；中分：列参数缺范围；低分：未提参数"
            },
            {
              "sub_criteria": "几何验证与精化关系",
              "description": "是否区分候选几何一致性(Wahba/Procrustes, 联合焦距)与最终LM束调整的作用与先后顺序。",
              "score": 30,
              "evaluation_focus": "方法衔接",
              "scoring_hint": "高分：清楚先RANSAC验证再LM精化；中分：顺序模糊；低分：只做其一或混淆"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "不变特征与成像假设",
              "description": "明确针孔模型、星为无穷远、局部邻域径向比/角差对尺度与旋转的鲁棒性假设，及亮度排序稳健性。",
              "score": 35,
              "evaluation_focus": "建模假设",
              "scoring_hint": "高分：逐条列明并解释鲁棒性来源；中分：提到针孔或不变性其一；低分：无假设说明"
            },
            {
              "sub_criteria": "误差模型与权重设定",
              "description": "对质心不确定度与星表误差构建权重W并在RANSAC/LM中使用的假设与来源。",
              "score": 35,
              "evaluation_focus": "噪声建模",
              "scoring_hint": "高分：给出权重与残差阈值依据；中分：仅称加权；低分：未建模误差"
            },
            {
              "sub_criteria": "内参与畸变处理策略",
              "description": "是否明确近似焦距的使用、是否估计径向畸变以及在束调整中的可观测性假设。",
              "score": 30,
              "evaluation_focus": "可观测性",
              "scoring_hint": "高分：阐述何时估计f/k1及退化；中分：仅说可选估计；低分：忽略内参处理"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "LND与多点不变特征设计",
              "description": "构造局部邻域不变描述子(径向比r_j/r_k、角差序列、对数归一化)及三角形/四元组边长比、余弦不变量与星等比值。",
              "score": 35,
              "evaluation_focus": "特征工程",
              "scoring_hint": "高分：给出计算细节与数值稳定化；中分：仅列特征类型；低分：缺少可实现细节"
            },
            {
              "sub_criteria": "特征量化与索引结构",
              "description": "对数/归一化后分桶(B=8–16)并建立哈希/LSH粗筛与KD-tree/倒排精筛的多级索引设计。",
              "score": 25,
              "evaluation_focus": "数据结构",
              "scoring_hint": "高分：阐述码设计、碰撞控制、内存估计；中分：仅说用KD-tree或LSH；低分：无索引或全表扫描"
            },
            {
              "sub_criteria": "几何验证模型",
              "description": "使用Wahba/Davenport或Procrustes估计旋转；焦距未知时联合估计旋转与尺度/焦距的目标函数与约束。",
              "score": 25,
              "evaluation_focus": "几何建模",
              "scoring_hint": "高分：写出代价函数与约束、配套RANSAC核；中分：仅提Wahba；低分：缺几何验证"
            },
            {
              "sub_criteria": "束调整与损失函数",
              "description": "LM最小化重投影误差，使用鲁棒损失(Huber/Cauchy)，可选估计f/k1并说明参数化与边界。",
              "score": 15,
              "evaluation_focus": "优化建模",
              "scoring_hint": "高分：明确残差、雅可比与收敛准则；中分：仅说用LM；低分：无精化步骤"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "候选检索与Top-N融合",
              "description": "粗筛Top-N(10–50)合并候选并按距比差/角差/星等差加权排序的求解流程。",
              "score": 30,
              "evaluation_focus": "算法流程",
              "scoring_hint": "高分：有明确打分公式与N设定；中分：描述模糊；低分：无排序融合"
            },
            {
              "sub_criteria": "RANSAC几何一致性与阈值",
              "description": "迭代次数估计、内点阈值(基于重投影像面误差/角度阈值)、退化检测与中止条件。",
              "score": 30,
              "evaluation_focus": "鲁棒估计",
              "scoring_hint": "高分：给出p,ε→迭代数公式与阈值来源；中分：仅经验阈值；低分：无RANSAC或无阈值依据"
            },
            {
              "sub_criteria": "LM/信赖域实现细节",
              "description": "参数化(四元数/旋转向量)、雅可比、步长/阻尼更新、收敛与条件数报告、失败回退。",
              "score": 25,
              "evaluation_focus": "数值稳定",
              "scoring_hint": "高分：含J^T J条件数与早停；中分：基本LM无诊断；低分：无可重复求解细节"
            },
            {
              "sub_criteria": "置信度打分与不确定度",
              "description": "基于残差RMS、内点数、协方差近似(J^T W J)^{-1}的匹配置信度构造与输出。",
              "score": 15,
              "evaluation_focus": "不确定性",
              "scoring_hint": "高分：组合多因素并量化；中分：仅RMS或内点数；低分：无置信度"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "模块化与可复现性",
              "description": "离线索引构建与在线匹配解耦，参数/单位记录日志，随机种子固定，脚本一键复现实验。",
              "score": 30,
              "evaluation_focus": "工程质量",
              "scoring_hint": "高分：配置文件+日志+seed固定；中分：部分可复现；低分：手工步骤多且不可复现"
            },
            {
              "sub_criteria": "性能与内存控制",
              "description": "索引统计(条目数、平均候选数)、时间剖分、Top-N与精筛次数限制，满足实时性目标。",
              "score": 25,
              "evaluation_focus": "性能工程",
              "scoring_hint": "高分：提供基准并达标；中分：有统计无优化；低分：无统计且延迟高"
            },
            {
              "sub_criteria": "数值鲁棒与异常处理",
              "description": "RANSAC异常捕获、LM不收敛回退、退化几何检测(条件数/秩)与降级策略。",
              "score": 25,
              "evaluation_focus": "可靠性",
              "scoring_hint": "高分：覆盖主要失败路径；中分：零散处理；低分：崩溃或静默失败"
            },
            {
              "sub_criteria": "依赖库与实现选择",
              "description": "合理使用KD-tree/LSH/Faiss、Eigen/NumPy、Ceres/scipy.optimize并避免不必要的自实现低效代码。",
              "score": 20,
              "evaluation_focus": "工具选型",
              "scoring_hint": "高分：恰当选型+可替换接口；中分：混用/耦合大；低分：低效自实现导致瓶颈"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "统一性能指标报告",
              "description": "输出识别率、误识率、平均用时、重投影RMS(均值/方差)与ROC/PR曲线，并解释权衡。",
              "score": 35,
              "evaluation_focus": "结果呈现",
              "scoring_hint": "高分：完整指标+曲线；中分：部分指标；低分：仅个例展示"
            },
            {
              "sub_criteria": "噪声/缺星/焦距不确定性测试",
              "description": "蒙特卡洛敏感性、漏检模拟与焦距扰动下的稳健性对比，参数扫描与图表。",
              "score": 30,
              "evaluation_focus": "稳健性评估",
              "scoring_hint": "高分：三类测试齐全；中分：1–2类；低分：无系统测试"
            },
            {
              "sub_criteria": "误匹配与失败案例复盘",
              "description": "分析误匹配来源(特征碰撞、退化几何、RANSAC阈值)，提出改进(增大k、调整B/N、改损失/阈值)。",
              "score": 20,
              "evaluation_focus": "诊断改进",
              "scoring_hint": "高分：定位根因并量化改进效果；中分：定性分析；低分：无改进建议"
            },
            {
              "sub_criteria": "不确定度与置信度一致性",
              "description": "检查置信度排序与实际正确率的校准(可靠性图/ECE)并调整打分或阈值。",
              "score": 15,
              "evaluation_focus": "校准评估",
              "scoring_hint": "高分：提供可靠性曲线与ECE；中分：粗略一致性检查；低分：未校准"
            }
          ]
        }
      }
    }
  }
}
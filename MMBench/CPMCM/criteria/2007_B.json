{
  "task_id": "2007_B",
  "problem": "1．根据市场需求，机械臂制造厂打算为他们的产品研发一个软件系统，能够直接将用户的运动命令自动转换成机器指令序列。即为这类机器人设计一个通用的算法，用来计算执行下面指定动作所要求的指令序列，并要求对你们算法的适用范围、计算效率以及你们的近似算法所造成的误差和增量离散取值所造成的误差大小进行讨论（不考虑其他原因造成的误差）：\n\n①．已知初始姿态$\\Phi_0$和一个可达目标点的空间位置$ (O_x, O_y, O_z)$，计算指尖到达目标点的指令序列。\n\n②．要求指尖沿着预先指定的一条空间曲线 $x = x(s), y = y(s), z = z(s), a \\le s \\le b$ 移动，计算满足要求的指令序列。\n\n③．在第①个问题中，假设在初始位置与目标位置之间的区域中有若干个已知大小、形状、方向和位置的障碍物，要求机械臂在运动中始终不能与障碍物相碰，否则会损坏机器。这个问题称机械臂避碰问题，要求机械臂末端在误差范围内到达目标点并且整个机械臂不碰到障碍物（机械臂连杆的粗细自己设定）。\n\n2. 应用你的算法就下面具体的数据给出计算结果，并将计算结果以三组六维的指令序列（每行6个数据）形式存放在Excel文件里，文件名定为answer1.xlsx，answer2.xlsx和answer3.xlsx。\n\n假设在机械臂的旁边有一个待加工的中空圆台形工件，上部开口。工件高$180\\text{mm}$，下底外半径$168\\text{mm}$，上底外半径$96\\text{mm}$，壁厚$8\\text{mm}$。竖立地固定在$xy$－平面的操作台上，底部的中心在 $(210, 0, 0)$。\n\n①．要求机械臂（指尖）从初始位置移动到工具箱所在位置的 $(20, -200, 120)$ 处，以夹取要用的工具。\n\n②．如果圆台形工件外表面与平面 $x = 2z$ 的交线是一条裂纹需要焊接，请你给出机械臂指尖绕这条曲线一周的指令序列。\n\n③．有一项任务是在工件内壁点焊四个小零件，它们在内表面上的位置到$xy$平面的投影为 $(320, -104)$、$(120, 106)$、$(190, -125)$和$(255, 88)$。要求机械臂从圆台的上部开口处伸进去到达这些点进行加工，为简捷起见，不妨不计焊条等的长度，只考虑指尖的轨迹。\n\n3．制造厂家希望通过修改各条连杆的相对长度以及各关节最大旋转角度等设计参数提高机械臂的灵活性和适用范围。请根据你们的计算模型给他们提供合理的建议。",
  "subtask": {
    "1": {
      "subtask": "子任务 1（几何建模、坐标系与正运动学）——范围与目标：在给定题图的“七段直线连杆＋六个旋转关节”简化结构下，建立一个精确、一致且可计算的正运动学模块，其输入为关节角向量 Θ = [θ1…θ6]（度或弧度）和连杆几何参数（至少包含已知长度 AB=140 mm、BC=255 mm、CD=255 mm、DE=65 mm，以及其余连杆中心线长度与节点位置的设计数据），输出为末端点 E 的笛卡尔位置 p(Θ)（可选输出末端姿态旋转矩阵 R(Θ)）和位置雅可比 Jp(Θ)，并提供完整的坐标系、变量定义与数值实现细则以保证后续模块可直接调用；方法与必要步骤：1) 坐标系与单位约定——在点 A 处建立右手直角坐标系，原点置于 A，z 轴沿 AB 指向 B，x 轴垂直纸面向外，y 轴由右手法则决定；长度单位为毫米，角度计算采用弧度（输入/输出可在接口处支持度/弧度转换）；初始关节向量 Θ0 = [0°, −90°, 0°, 0°, −90°, 0°]（在实现中以弧度表征）；2) 几何抽象——将各连杆用中心线段表示、节点按 A–B–C–D–E… 排列，明确各旋转关节为纯旋转（六个复回转），并记录每一关节轴的方向关系：题目说明中第1、4、6 关节（对应图中 F,G,H）其旋转轴与相邻连杆平行（“笔帽式”），第2、3、5 关节（对应图中 B,C,D）其旋转轴垂直连杆（“摇柄式”）；在模型中应以统一描述将“平行/垂直”的几何关系映射为每关节在某一坐标系下的旋转轴单位向量；3) 参数化方法——采用标准 Denavit–Hartenberg（DH）或改良 DH 表述来参数化每一关节的变换，明确并填写每一节的 (ai, αi, di, θi)（或改 DH 对应参数）并在文档中给出表格形式以保证可复现；4) 齐次变换链与正运动学公式——为每一关节构造 4×4 齐次变换矩阵 Ai(θi)=Rotz(θi)·Transz(di)·Transx(ai)·Rotx(αi)（或按选用的 DH 约定写出等价表达），通过复合 T0E(Θ)=∏_{i=1}^6 Ai(θi) 得到末端齐次矩阵，末端位置为 p(Θ)=T0E(Θ)[0:2]（前三分量），末端姿态为旋转子矩阵 R(Θ)=T0E(Θ)[0:2,0:2]；5) 雅可比导出——按经典剖析法构造 6×6 雅可比 J(Θ)，位置部分 Jp 的第 i 列当关节 i 为转动时为 z_{i−1} × (p_e − p_{i−1})，其中 z_{i−1}、p_{i−1} 由前向变换递推得到；实现时同时计算并返回 Jp(Θ) 与可选的角速度/力学相关部分；6) 数值实现与验证细节——建议使用 MATLAB/Octave、Python（NumPy、SciPy、SymPy）或现成机器人库（例如 Peter Corke 的 Robotics Toolbox 或 ROS 的 tf/robot_state_publisher）实现符号/数值表达、自动微分或数值差分检验雅可比的一致性；实现要包含输入校验（连杆长度与 Θ 在物理允许范围内）、单位一致性检测及稳健的数值容错（例如避免浮点下溢/溢出）；7) 接口与输出——提供函数/方法 f_pos(Θ, params)→p（和可选 f_pose→(p,R)），以及 jacobian(Θ, params)→Jp，函数文档明确参数含义、默认初始姿态 Θ0、坐标系说明及返回值精度；8) 文档与可复现性——在模块说明中列出所用的几何假设（中心线近似、关节轴取向定义）、DH 表及示意图索引，给出至少一组数值例子用于单元测试（采用 Θ0 和其它典型角度）以便下游模块验证正运动学实现的正确性。该子任务的交付物为：一份明确的 DH 参数表与坐标系说明、可执行的正运动学实现代码（含 p 和 J 的计算）、输入校验与单元测试用例，以及足够的文档注释以保障此模块在不依赖其他子任务的情况下独立理解与调用。",
      "criteria": {
        "task_understanding": {
          "core_goal": "题目要考什么——按题型拆解关键能力：建立精确、一致且可计算的正运动学模块，输入关节角向量 Θ 和连杆几何参数，计算并返回末端位置 p(Θ)、可选姿态 R(Θ) 及位置雅可比 Jp(Θ)，并提供坐标系定义、DH 参数表、数值实现与单元测试。",
          "expected_output": "DH 参数表（ai, αi, di, θi或改良DH）、坐标系说明文档、可调用函数 f_pos(Θ,params)→p, f_pose→(p,R) 与 jacobian(Θ,params)→Jp 的可执行代码（MATLAB/Python等）、若干数值单元测试和示例输出（矩阵/向量数值），以及实现细节与接口说明文件。",
          "key_inputs_constraints": "1) Θ：6维关节角向量（数值数组，建议以弧度内部表示，可接口支持度→弧度转换）；2) 连杆几何参数：已知 AB=140, BC=255, CD=255, DE=65（mm）与其它中心线长度；3) 关节轴类型与初始姿态Θ0=[0°,−90°,0°,0°,−90°,0°]（以弧度表述）；4) 单位约定：长度 mm，角度内部用弧度；5) 输入校验：连杆长度>0，Θ 在物理允许范围内或允许多圈。",
          "modeling_type": "仿真",
          "role_in_pipeline": "作为整体系统的几何基础模块：位于逆运动学/轨迹规划/避障算法的下游输入端（这些模块依赖 p(Θ), Jp(Θ)）；直接依赖连杆几何参数和关节轴定义，后续为 IK 求解、路径生成、碰撞检测提供几何与雅可比信息。"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "识别正运动学输出 p(Θ)、R(Θ) 与 Jp(Θ)",
              "description": "明确列出并量化正运动学需要输出的末端位置 p(Θ)、可选姿态 R(Θ) 以及位置雅可比 Jp(Θ) 的矩阵尺寸与物理含义。",
              "score": 40,
              "evaluation_focus": "建模思维",
              "scoring_hint": "高分：清楚列出 p(3×1)、R(3×3)、Jp(3×6) 并说明物理意义；中分：只列出 p 与 Jp，但未明确矩阵尺寸或含义；低分：未明确至少两项输出或混淆位置/姿态/雅可比。"
            },
            {
              "sub_criteria": "识别坐标系与单位约定（A 点为原点，z=AB）",
              "description": "确认原点置于 A、z 轴沿 AB 向 B、x 轴垂直纸面向外、单位为 mm，内部角度以弧度计算并说明接口度→弧度转换。",
              "score": 30,
              "evaluation_focus": "细节规范",
              "scoring_hint": "高分：完整写明坐标系方向、单位 mm、内部弧度制并示例转换；中分：坐标系或单位说明不完整；低分：无明确坐标系或单位混用导致不可复现。"
            },
            {
              "sub_criteria": "识别已知几何参数与初始姿态 Θ0",
              "description": "列明已知连杆长度 AB,BC,CD,DE、需补全的其它中心线长度，以及初始关节向量 Θ0=[0°,−90°,0°,0°,−90°,0°]（以弧度给出）。",
              "score": 30,
              "evaluation_focus": "数据完整性",
              "scoring_hint": "高分：列出所有已知参数并标注缺省需提供的参数；中分：只列出给定参数，未给出 Θ0 的数值或单位；低分：遗漏已知参数或错误标注单位。"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "复述采用 DH/改良 DH 参数化并给出理由",
              "description": "明确声明采用标准 DH 或改良 DH，并说明选择理由（便于实现齐次变换链、与库兼容等）。",
              "score": 40,
              "evaluation_focus": "方法选择",
              "scoring_hint": "高分：清晰说明选用（标准或改良）DH 的具体优势并指出与关节轴平行/垂直关系的适配方式；中分：声明使用 DH 但未给出选择理由；低分：未声明或错误采用与关节结构不匹配的参数化方法。"
            },
            {
              "sub_criteria": "复述关节轴“平行/垂直”映射为轴向量",
              "description": "将题目“第1、4、6 关节轴平行”与“第2、3、5 关节轴垂直”映射为每一节中 z_{i−1}（或旋转轴）在本地坐标系下的单位向量表示。",
              "score": 30,
              "evaluation_focus": "几何表达",
              "scoring_hint": "高分：对每个关节给出轴向量(例如 z0=[0,0,1], z1=[1,0,0] )并解释坐标变换；中分：给出部分关节轴向量；低分：未映射或与 DH 表不一致。"
            },
            {
              "sub_criteria": "复述接口签名 f_pos 与 jacobian 的输入输出与单位",
              "description": "明确 f_pos(Θ,params)→p(3×1) 与 jacobian(Θ,params)→Jp(3×6) 的参数含义、单位及默认 Θ0。",
              "score": 30,
              "evaluation_focus": "工程接口",
              "scoring_hint": "高分：完整接口签名、参数说明、默认值与返回精度；中分：接口存在但说明不全；低分：接口未定义或单位不一致。"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "声明中心线近似与连杆粗细忽略假设",
              "description": "明确采用连杆中心线建模，忽略连杆厚度/形变并说明在后续碰撞检测中需补偿的条件。",
              "score": 25,
              "evaluation_focus": "物理假设",
              "scoring_hint": "高分：明确写出中心线近似并说明适用范围与误差影响；中分：说明近似但未讨论限制；低分：未说明或矛盾。"
            },
            {
              "sub_criteria": "关节为纯旋转且轴线固定（不随 θ 变化）",
              "description": "陈述关节模型为纯回转关节，轴线在节间坐标系中固定，说明多圈允许性与角度环绕处理。",
              "score": 25,
              "evaluation_focus": "运动学假设",
              "scoring_hint": "高分：明确轴线固定并处理多圈与角度归一化；中分：声明纯旋转但未讨论多圈；低分：未明确或与 DH 不符。"
            },
            {
              "sub_criteria": "数值实现假设与容错边界（单位/范围校验）",
              "description": "给出数值稳定性假设（双精度）、输入校验规则（长度>0、Θ 数值范围或允许多圈）、避免除零或浮点溢出措施。",
              "score": 25,
              "evaluation_focus": "数值可靠性",
              "scoring_hint": "高分：给出具体校验阈值与异常处理策略；中分：仅部分校验或无异常处理；低分：无数值容错说明。"
            },
            {
              "sub_criteria": "简化假设对雅可比/动力学的影响说明",
              "description": "说明忽略连杆截面/关节摩擦等对 kinematics 与雅可比 Jp 的影响及适用场景（几何精度优先）。",
              "score": 25,
              "evaluation_focus": "影响评估",
              "scoring_hint": "高分：提供对误差来源与量级的定性或定量评估；中分：仅定性说明；低分：未讨论影响。"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "完整 DH 参数表（ai, αi, di, θi）与坐标系索引",
              "description": "为 6 个关节给出 DH 表格（数值或符号）并标注每行对应的坐标系与连杆（含 AB,BC,CD,DE 对应项）。",
              "score": 25,
              "evaluation_focus": "参数化",
              "scoring_hint": "高分：提供完整数值 DH 表并能直接用于代码；中分：提供符号表但缺少数值替换；低分：DH 表不完整或与题意不符。"
            },
            {
              "sub_criteria": "齐次变换链 Ai(θi) 与 T0E(Θ) 的正确公式",
              "description": "写出每节 Ai(θi)=Rotz(θi)Transz(di)Transx(ai)Rotx(αi)（或等价改DH）并展示 T0E(Θ)=∏Ai 的组合推导步骤。",
              "score": 20,
              "evaluation_focus": "矩阵推导",
              "scoring_hint": "高分：每步推导正确且符号一致；中分：主要公式正确但有符号或次序小错；低分：变换链次序或构造错误。"
            },
            {
              "sub_criteria": "末端位置 p(Θ) 与姿态 R(Θ) 的提取方法",
              "description": "说明如何从 T0E(Θ) 提取 p(Θ)（前三分量）与 R(Θ)（左上 3×3）并给出示例数值替换。",
              "score": 20,
              "evaluation_focus": "结果表达",
              "scoring_hint": "高分：明确定义提取规则并给出数值示例；中分：提取规则正确但无示例；低分：提取错误或模糊。"
            },
            {
              "sub_criteria": "雅可比 Jp 的解析推导（列公式 z_{i−1} × (p_e−p_{i−1})）",
              "description": "按经典剖析法给出 J(Θ) 的位置部分推导，明确 p_{i−1} 与 z_{i−1} 的来源并给出计算步骤。",
              "score": 20,
              "evaluation_focus": "数学推导",
              "scoring_hint": "高分：推导完整且与变换链一致，给出数值验证点；中分：推导主要思想正确但细节缺失；低分：推导错误或缺乏连接到变换链。"
            },
            {
              "sub_criteria": "初始姿态 Θ0 与坐标系一致性检查",
              "description": "验证 Θ0=[0°,−90°,0°,0°,−90°,0°] 在所选 DH 表下得到的 p(Θ0) 与题给初始平面位置一致，并记录预期数值。",
              "score": 15,
              "evaluation_focus": "一致性验证",
              "scoring_hint": "高分：提供 p(Θ0) 数值并与图中初始位置一致；中分：给出Θ0但未计算验证；低分：Θ0 与坐标系不一致或未提及。"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "数值稳定性与矩阵计算鲁棒性措施",
              "description": "说明数值实现中避免奇异矩阵、处理浮点误差、使用双精度与稳定求逆/伪逆方法等细节。",
              "score": 40,
              "evaluation_focus": "数值方法",
              "scoring_hint": "高分：给出具体数值策略（奇异值阈值、regularization、条件数监测）；中分：提到需要稳定性但无具体策略；低分：无相关讨论。"
            },
            {
              "sub_criteria": "雅可比检验：符号推导与数值差分一致性",
              "description": "通过数值差分验证解析 Jp：给出误差度量（如最大绝对误差、Frobenius 范数）并说明允许阈值。",
              "score": 35,
              "evaluation_focus": "验证方法",
              "scoring_hint": "高分：提供数值差分结果，误差≤1e-6（或解释阈值）并分析偏差来源；中分：有差分验证但误差较大且无分析；低分：无验证或差分结果不支持解析 Jp。"
            },
            {
              "sub_criteria": "计算效率与复杂度说明（用于实时调用的可行性）",
              "description": "给出算法复杂度估计、每次求 p 与 J 的计算量，并讨论是否满足实时调用或需优化（如循环展开、矩阵复用）。",
              "score": 25,
              "evaluation_focus": "算法工程",
              "scoring_hint": "高分：提供复杂度 O(n) 或具体运行时间基准并提出优化路径；中分：给出定性讨论；低分：无效率分析。"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "实现 f_pos(Θ,params) 并返回 p(Θ)（含单位转换）",
              "description": "提供可调用代码实现 f_pos，含输入校验（单位、长度>0）、对度/弧度的接口支持并返回数值 p(3×1)。",
              "score": 30,
              "evaluation_focus": "代码可靠性",
              "scoring_hint": "高分：代码可运行、含输入校验、单元测试通过并文档化；中分：代码实现但缺少部分校验或文档；低分：代码无法运行或输出错误尺寸。"
            },
            {
              "sub_criteria": "实现 jacobian(Θ,params) 并提供数值差分单元测试",
              "description": "提供 jacobian 函数返回 Jp(3×6)，并包含数值差分对比的自动化单元测试脚本与误差输出。",
              "score": 30,
              "evaluation_focus": "验证/测试",
              "scoring_hint": "高分：函数实现正确且单元测试误差在声明阈值内；中分：实现有但测试未自动化或误差偏大；低分：无 jacobian 实现或测试失败。"
            },
            {
              "sub_criteria": "工程接口与文档（函数签名、参数说明、默认 Θ0）",
              "description": "代码文档应含函数签名、参数含义、默认值、返回值精度及示例调用，方便下游直接调用 f_pos 与 jacobian。",
              "score": 20,
              "evaluation_focus": "工程实践",
              "scoring_hint": "高分：文档齐全、示例可复现并带有注释；中分：文档存在但不完整；低分：无文档或示例不可运行。"
            },
            {
              "sub_criteria": "实现语言选择与第三方库依赖说明",
              "description": "说明实现所用语言（MATLAB/Python）与依赖库（NumPy, SciPy, Robotics Toolbox），并提供环境/版本说明与安装步骤。",
              "score": 20,
              "evaluation_focus": "可复现性",
              "scoring_hint": "高分：明确给出环境、依赖版本与安装脚本；中分：给出语言但依赖说明不全；低分：未说明依赖或无法复现环境。"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "提供数值单元测试与误差量化（雅可比解析 vs 差分）",
              "description": "给出至少一组 Θ0 的 p(Θ0)、Jp(Θ0) 数值输出，并给出解析雅可比与数值差分的具体误差指标（最大绝对误差、范数）。",
              "score": 30,
              "evaluation_focus": "验证解释",
              "scoring_hint": "高分：提供具体误差数值（如 max|Δ|≤1e-6）并解释偏差来源；中分：提供差分结果但无误差阈值；低分：无数值验证或差分误差巨大且未解释。"
            },
            {
              "sub_criteria": "文档中列出 DH 表与实现输出的对照",
              "description": "在结果文档中将 DH 表、变换链与代码输出的中间变量（各节坐标系原点与 z 轴）逐项对照，便于人工核对。",
              "score": 25,
              "evaluation_focus": "可审计性",
              "scoring_hint": "高分：逐项对照并附截图/表格；中分：部分对照；低分：无对照，难以复核。"
            },
            {
              "sub_criteria": "讨论模型适用范围、限制与误差来源（中心线近似、多圈角度）",
              "description": "分析所建模型的适用场景、因中心线近似/忽略截面而产生的几何误差及对后续 IK/碰撞检测的影响。",
              "score": 25,
              "evaluation_focus": "模型批判",
              "scoring_hint": "高分：给出定性与定量限制分析并建议补偿方法；中分：仅定性讨论；低分：未讨论适用范围或误差来源。"
            },
            {
              "sub_criteria": "给出至少一组可复现的数值示例（Θ0）并检查 p 与题图初始位置一致性",
              "description": "在文档或代码中包含 Θ0 的数值示例与得到的 p(Θ0)，并表明该结果与题图的初始指尖位置匹配或给出偏差说明。",
              "score": 20,
              "evaluation_focus": "复现性检验",
              "scoring_hint": "高分：示例可直接运行并数值匹配题图；中分：示例可运行但有小偏差并解释原因；低分：无示例或示例结果不可复现。"
            }
          ]
        }
      }
    },
    "2": {
      "subtask": "子任务2（逆运动学与受限离散指令生成）应独立完成如下工作：目标是从当前关节向量 Θ_curr 出发，在给定末端目标位置或序列 {p_k} 的情况下，生成一条满足每次关节增量 Δθi 属于离散集合 S = {−2.0, −1.9, …, 1.9, 2.0}（单位：度，步长0.1°）且每次绝对值不超过2°、同时满足关节角范围约束的、按时间顺序可执行的角增量指令序列（按行6个值输出）；为此本子任务的输入需包括：当前关节向量 Θ_curr、目标末端位置 p_goal（或一列目标点）、正运动学函数 f(Θ) 与位置雅可比 Jp(Θ)、各关节的上下限、以及量化参数（最大单步角2°、分辨率0.1°）和数值容差（位置终止阈值 ε_pos，建议 0.2–0.5 mm、最大迭代次数 N_max，建议100次）；方法和步骤如下：1) 误差定义与线性近似：在每次迭代计算末端位置误差 e = p_goal − p_curr，并用线性化关系 Δp ≈ Jp(Θ) ΔΘ 作为求解基础；2) 连续解的求解器：优先使用阻尼最小二乘法（Damped Least Squares, DLS）或 Levenberg–Marquardt 形式 ΔΘ_cont = J^T (J J^T + λ^2 I)^{-1} e；λ 可自适应调整（在雅可比条件数变坏或最小奇异值 σ_min < σ_thresh（例如0.01）时增大），并在必要时使用基于 SVD 的奇异值截断以避免数值放大；3) 约束化与二次规划：若需同时考虑关节上下限与次要目标（例如最小化关节变化幅度、远离边界或优先保持与上一解的连续性），将单步更新作为带不等式约束的二次规划求解：最小化 ||J ΔΘ − e||^2 + α||ΔΘ||^2，约束 θ_min ≤ Θ_curr + ΔΘ ≤ θ_max 以及 |ΔΘ_i| ≤ 2°，使用高效小维度 QP 求解器（如 OSQP、quadprog 或内置线性代数方法）；4) 步长分割与量化策略：对计算得到的连续 ΔΘ_cont 如有分量超过±2°，按比例缩放或分段为若干子步使得每子步的连续增量均满足 |Δθi| ≤ 2°；对于每一子步，在发送前对每个分量四舍五入到最近的 0.1°（规则为到最近元素）；为避免量化抖动，保留并累积四舍五入后的残差（carry-over）并在后续步骤中补偿；当四舍五入导致某一子步所有分量为零时，应将该连续子步合并或累积至下一个子步以避免无限循环；5) 迭代与校验循环：每发送一个量化增量向量后，使用正运动学更新 Θ_curr ← Θ_curr + ΔΘ_quantized，重新计算 p_curr 与误差 e，若 ||e|| ≤ ε_pos 或达到 N_max 则终止并输出已发送的指令序列，否则重复求解；为确保数值稳定性，应在每次迭代后检查关节极限并在接近极限时通过QP中的次要目标或约束项驱动解离开边界；6) 奇异性与鲁棒性处理：在遇到收敛缓慢或要求非常大关节调整时，检测雅可比奇异性（条件数或 σ_min 过小），采用增大阻尼、奇异值截断或切换到受限 QP（加入正则项）以获得更稳定的 ΔΘ；7) 误差估计与终止策略：在最终指令序列构造过程中同时估计量化引入的位移上界——量化半步误差约为0.05°（≈8.73×10^−4 rad），可用 ||Δp_q|| ≤ ||J||_2 ||ΔΘ_q||_2 作保守估计，并将 IK 终止阈值 ε_pos 设为量化误差同量级或更大以避免无限迭代；8) 输出与格式化：将每一次实际发送的量化增量（以度为单位）记录为一行6维向量，按执行顺序导出为标准表格/Excel 文件（每组任务一个文件），同时在输出中包含日志信息（每步实际末端位置、残余误差、所用迭代次数及是否触发奇异性/阻尼调整）；9) 实现工具建议：在实现上使用数值线性代数库（如 LAPACK/SciPy）、SVD 例程以及高效小维 QP 求解器（OSQP、quadprog、QPOASES），并严格区分度/弧度单元以避免单位错误；10) 异常处理与接口：对于在给定关节范围内不可达或长时间无法收敛的目标，应返回错误代码和当前最优解，并提供与更高层规划器或碰撞/重规划模块的标准接口以便采取替代策略。该子任务的交付物应包括可重复运行的逆解与量化生成代码、详尽的参数与终止准则说明、量化误差的计算例程以及按行6个数据格式的指令序列生成与导出接口。",
      "criteria": {
        "task_understanding": {
          "core_goal": "在给定正运动学 f(Θ) 与雅可比 Jp(Θ) 的前提下，优化逆运动学并离散量化，生成满足关节上下限与每步Δθ∈S的可执行增量指令序列以逼近目标末端位置。",
          "expected_output": "按时间顺序的角增量指令序列（度，6维每行，量化到0.1°，每分量绝对值≤2°），附带迭代日志（步次、p_curr、||e||、阻尼λ/奇异性标记），以及错误码与最优近似解（不可达时）。",
          "key_inputs_constraints": "输入：Θ_curr（6×1，度或弧度）、p_goal或{p_k}（mm）、关节上下限（度）、正运动学 f(Θ)、位置雅可比 Jp(Θ)、量化集合S={−2.0,…,2.0}°、ε_pos（0.2–0.5 mm）、N_max（~100）。约束：|Δθ_i|≤2°，量化到0.1°，关节角在范围内，单位一致（内部弧度）。必要条件：f与Jp可用且数值稳定；目标在可达工作空间或返回不可达。",
          "modeling_type": "优化+仿真",
          "role_in_pipeline": "作为执行层规划子任务，依赖前序子任务1（正运动学与Jp）；其输出供后续轨迹跟踪/碰撞检测与Excel导出模块使用。前序：f(Θ), Jp(Θ)；后序：路径生成与避碰、文件导出与日志汇总。",
          "assumptions": "采用阻尼最小二乘（DLS/LM）作为主求解器，必要时转QP；度/弧度在接口处转换，内部优化用弧度；雅可比由前序模块提供且可数值/自动微分校验。"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "Δθ离散集合S与2°步长约束识别",
              "description": "准确识别并强调每步关节增量Δθ_i必须属于S={−2.0,…,2.0}°且|Δθ_i|≤2°，并影响算法设计（步长分割/量化）。",
              "score": 30,
              "evaluation_focus": "约束识别",
              "scoring_hint": "高分：清楚列出S与2°上限并贯穿方案；中分：提到2°或量化但未两者兼顾；低分：忽略离散或步长限制。"
            },
            {
              "sub_criteria": "目标误差e与ε_pos定义",
              "description": "明确e=p_goal−p_curr与终止阈值ε_pos（0.2–0.5 mm）并据此设定停止准则与日志指标。",
              "score": 25,
              "evaluation_focus": "指标定义",
              "scoring_hint": "高分：给出数值范围并用于停止；中分：有误差定义无量化阈值；低分：未定义或用角误差替代。"
            },
            {
              "sub_criteria": "关节上下限与单位一致性",
              "description": "识别关节角范围约束与度/弧度转换风险，提出内部弧度、接口支持度的策略。",
              "score": 25,
              "evaluation_focus": "约束与单位",
              "scoring_hint": "高分：明确内部弧度与边界处理；中分：只提醒单位不落地；低分：未提单位或边界。"
            },
            {
              "sub_criteria": "奇异性与数值不适定性",
              "description": "识别雅可比奇异（σ_min或条件数）导致收敛问题，并需要阻尼或SVD截断。",
              "score": 20,
              "evaluation_focus": "数值稳健",
              "scoring_hint": "高分：提出σ_min阈值/条件数策略；中分：口头提奇异无判据；低分：未识别。"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "逆运动学+量化生成的双目标复述",
              "description": "将任务复述为：连续IK求解ΔΘ_cont并经步长分割与0.1°量化生成可执行序列。",
              "score": 35,
              "evaluation_focus": "需求对齐",
              "scoring_hint": "高分：分清连续解与量化两阶段；中分：只提IK或只提量化；低分：泛化为路径规划。"
            },
            {
              "sub_criteria": "迭代与校验循环",
              "description": "复述每步发送后用f(Θ)更新p_curr与e的闭环迭代直到||e||≤ε_pos或N_max。",
              "score": 30,
              "evaluation_focus": "流程把握",
              "scoring_hint": "高分：完整迭代与终止条件；中分：缺一项（如N_max）；低分：一次性计算无迭代。"
            },
            {
              "sub_criteria": "多目标点序列处理",
              "description": "对{p_k}说明逐点串行或分段策略并维护Θ连续性。",
              "score": 20,
              "evaluation_focus": "任务扩展",
              "scoring_hint": "高分：阐明逐点推进与状态传递；中分：只说可以处理多点；低分：未覆盖。"
            },
            {
              "sub_criteria": "不可达与错误返回",
              "description": "复述不可达时返回错误码与当前最优解的要求。",
              "score": 15,
              "evaluation_focus": "异常表达",
              "scoring_hint": "高分：定义判据与返回内容；中分：仅说报错；低分：忽略异常路径。"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "DLS/LM求解器选择与λ自适应假设",
              "description": "假设采用阻尼最小二乘或LM，给出λ调整依据（σ_min阈值或条件数）。",
              "score": 30,
              "evaluation_focus": "算法选择",
              "scoring_hint": "高分：具体λ策略与阈值；中分：提DLS无策略；低分：未说明求解器。"
            },
            {
              "sub_criteria": "量化残差累积（carry-over）假设",
              "description": "提出四舍五入残差保留与在后续子步补偿，避免抖动与零向量陷阱。",
              "score": 30,
              "evaluation_focus": "数值策略",
              "scoring_hint": "高分：明确残差向量与合并零步；中分：仅提四舍五入；低分：无量化策略。"
            },
            {
              "sub_criteria": "关节限近边界的次目标/QP假设",
              "description": "假设在接近边界时通过QP正则或代价项远离边界。",
              "score": 25,
              "evaluation_focus": "约束处理",
              "scoring_hint": "高分：给出具体代价或不等式；中分：口头提QP；低分：忽略边界效应。"
            },
            {
              "sub_criteria": "单位与精度假设（ε_pos与量化误差同量级）",
              "description": "假设ε_pos设置不小于量化引起的位移上界，内部弧度计算。",
              "score": 15,
              "evaluation_focus": "精度设定",
              "scoring_hint": "高分：给出0.2–0.5 mm并用||J||·||ΔΘ_q||估计；中分：仅口头一致性；低分：未设。"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "线性近似Δp≈JpΔΘ与误差模型",
              "description": "正确建立线性化关系并定义e=p_goal−p_curr用于单步更新。",
              "score": 25,
              "evaluation_focus": "数理推导",
              "scoring_hint": "高分：推导并说明适用局部性；中分：直接使用不解释；低分：错误关系。"
            },
            {
              "sub_criteria": "DLS/LM更新公式与SVD截断",
              "description": "构建ΔΘ_cont=J^T(JJ^T+λ^2I)^{-1}e或等价式，必要时基于SVD截断小奇异值。",
              "score": 30,
              "evaluation_focus": "算法细节",
              "scoring_hint": "高分：给出公式与SVD处理；中分：仅给DLS公式；低分：无可用更新。"
            },
            {
              "sub_criteria": "带约束的QP模型",
              "description": "建立min ||JΔΘ−e||^2+α||ΔΘ||^2，约束θ_min≤Θ+ΔΘ≤θ_max与|ΔΘ_i|≤2°。",
              "score": 25,
              "evaluation_focus": "优化建模",
              "scoring_hint": "高分：完整目标与不等式；中分：缺部分约束；低分：未转QP。"
            },
            {
              "sub_criteria": "步长分割与量化策略建模",
              "description": "对超2°分量比例缩放或分段，逐子步量化到0.1°并处理全零步合并。",
              "score": 20,
              "evaluation_focus": "实现可行",
              "scoring_hint": "高分：给出分段与合并规则；中分：仅缩放；低分：忽略。"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "自适应阻尼与奇异性检测",
              "description": "实现基于σ_min或条件数的λ调节与奇异值截断，提升收敛稳定性。",
              "score": 30,
              "evaluation_focus": "稳健求解",
              "scoring_hint": "高分：给阈值与调整曲线；中分：固定λ；低分：无阻尼。"
            },
            {
              "sub_criteria": "QP数值求解与约束满足率",
              "description": "有效调用小规模QP（OSQP/quadprog），保证|Δθ|≤2°与边界约束不被违背。",
              "score": 30,
              "evaluation_focus": "优化实现",
              "scoring_hint": "高分：约束违约率为0且说明求解器；中分：偶发违约；低分：频繁违约或无QP。"
            },
            {
              "sub_criteria": "迭代收敛与终止策略",
              "description": "在N_max内达到||e||≤ε_pos，或返回最优近似与错误码；避免零步循环。",
              "score": 25,
              "evaluation_focus": "收敛控制",
              "scoring_hint": "高分：稳定收敛或正确早停；中分：多次接近阈值但震荡；低分：无终止或死循环。"
            },
            {
              "sub_criteria": "量化误差上界估计与阈值匹配",
              "description": "用||Δp_q||≤||J||_2||ΔΘ_q||_2估计并据此设定ε_pos同量级或更大。",
              "score": 15,
              "evaluation_focus": "误差控制",
              "scoring_hint": "高分：提供估计与示例数值；中分：口头说明；低分：未估计。"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "度/弧度与单位校验",
              "description": "接口支持度输入，内部弧度计算；在关键路径加入单位断言与转换测试。",
              "score": 25,
              "evaluation_focus": "代码可靠性",
              "scoring_hint": "高分：单元测试覆盖单位转换；中分：仅转换无测试；低分：混用单位。"
            },
            {
              "sub_criteria": "IK核心（DLS/SVD）与QP调用实现",
              "description": "正确实现DLS/LM与SVD截断，集成OSQP/quadprog并处理失败回退。",
              "score": 30,
              "evaluation_focus": "算法实现",
              "scoring_hint": "高分：含回退与稳健异常；中分：仅DLS或仅QP；低分：伪代码或不可运行。"
            },
            {
              "sub_criteria": "量化与carry-over逻辑",
              "description": "实现0.1°四舍五入、残差累积、全零步合并与超2°分段。",
              "score": 25,
              "evaluation_focus": "数值工程",
              "scoring_hint": "高分：边界用例通过；中分：偶发零步循环；低分：产生抖动或卡死。"
            },
            {
              "sub_criteria": "日志与错误码/最优解输出",
              "description": "逐步记录p_curr、||e||、λ/奇异性标记，并在不可达时输出错误码与最近Θ。",
              "score": 20,
              "evaluation_focus": "可观测性",
              "scoring_hint": "高分：结构化日志+错误码；中分：仅文本日志；低分：无日志无错误码。"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "收敛性能与步数统计",
              "description": "报告达到ε_pos所需迭代/指令步数，并与N_max对比评价效率。",
              "score": 30,
              "evaluation_focus": "性能评估",
              "scoring_hint": "高分：提供数值与对比；中分：给出步数无解读；低分：未统计。"
            },
            {
              "sub_criteria": "量化误差与终态位置误差评估",
              "description": "比较最终||e||与量化误差上界，说明是否受量化主导并提出改进（如减小步数/调整λ）。",
              "score": 30,
              "evaluation_focus": "误差分析",
              "scoring_hint": "高分：定量对比并解释来源；中分：仅报误差；低分：无分析。"
            },
            {
              "sub_criteria": "约束满足与关节边界行为",
              "description": "统计|Δθ|≤2°、关节上下限是否被触及/逼近及QP作用效果。",
              "score": 25,
              "evaluation_focus": "约束验证",
              "scoring_hint": "高分：零违约并有近边界案例；中分：轻微违约；低分：多次越界。"
            },
            {
              "sub_criteria": "奇异性处理效果",
              "description": "展示在σ_min低时阻尼或截断是否改善收敛（如误差下降曲线对比）。",
              "score": 15,
              "evaluation_focus": "稳健性评估",
              "scoring_hint": "高分：有前后对比或案例；中分：口头声称有效；低分：无证据。"
            }
          ]
        }
      }
    },
    "3": {
      "subtask": "子任务3的目标是独立实现从笛卡尔轨迹或起止位姿到一条满足几何与控制约束的、可直接执行的无碰撞关节增量指令序列的规划器；其范围包括：解析/离散化目标曲线、在配置空间（C-space）中寻找碰撞自由的关节路径、在工作空间/关节空间之间进行一致性转换与逐步细化、在规划过程中嵌入机械臂与障碍物的几何模型与碰撞检测、以及输出满足单步最大角增量和量化分辨率的离散指令并保证每一步的离散或扫掠碰撞检测通过。为实现上述目标，必须按如下具体步骤和方法操作：1) 输入准备——读取机器人几何与运动学（关节数、关节极限、连杆中心线与半径）、初始关节向量、目标曲线或目标点序列、障碍物几何（解析圆台内外表面或三角网格）及控制约束（单步|Δθ|≤2°、量化步长0.1°）；2) 碰撞模型与加速结构——将连杆建模为胶囊（线段＋半径），将障碍物对圆台使用解析表达式，对任意多面体或网格使用三角化表示，建立AABB/八叉树或KD-tree加速最近点与连续碰撞查询，并实现连续碰撞检测（swept-volume）以捕捉量化步间的穿透；3) 曲线采样与初步映射——对给定曲线进行等弧长或自适应采样，采样密度由雅可比灵敏度估计保证每段映射到关节空间后的连续解在最坏情况下可被分割为若干步使每步角增量≤2°；4) 全局可行路径搜索（遇障碍情形）——在C-space使用采样型规划器（如 RRT-Connect 或 PRM，推荐使用 OMPL 实现）寻找从起始配置到目标配置的碰撞自由离散节点序列，每个新节点在生成时通过快速近似碰撞检测验证；5) 局部平滑与优化——对采样得到的离散路径应用轨迹优化器（如 CHOMP、TrajOpt 或受约束的 SQP），在优化目标中同时加入碰撞成本、关节限幅与单步角增量上界作为硬约束或带罚项，以获得平滑且可细分的轨迹；6) 离散化与量化—将优化后连续关节轨迹按控制约束分割为若干步，确保每步 |Δθ_i|≤2°，并对每步角增量四舍五入到0.1°网格，同时对量化引入的残差做累积补偿策略以避免抖动；7) 逐步碰撞验证与细化—对每个量化后的离散步执行精确离散与扫掠碰撞检测（胶囊对解析曲面或网格），若某步检测到碰撞则对该步作二分细化或触发局部重规划/回溯（若细化失败，回退至采样器进行局部重新连通）；8) 鲁棒性策略—在存在窄通道或局部不可行时，启用带目标偏置的采样、桥接采样或增加配置空间冗余度（改变次要目标权重）以提高成功率；9) 输出格式与元数据—最终产出按时间顺序的、每行6个值的关节增量序列（度为单位，已量化），并附带每步末端位置、碰撞最小距离、是否为细化步及优化诊断信息。建议实现工具链：OMPL（采样规划）、FCL/Bullet（碰撞检测与连续碰撞）、SciPy/OSQP（若在轨迹优化中用到QP）、以及常见数值库用于雅可比估计与插值；所有模块应以模块化接口实现以便独立测试（输入：运动学模型+障碍几何+控制约束；输出：量化的关节增量序列与逐步验证日志）。",
      "criteria": {
        "task_understanding": {
          "core_goal": "生成并优化满足几何与控制约束的无碰撞关节增量指令序列（针对关节量化Δθ∈{−2.0…2.0}、步长0.1°），以实现从笛卡尔轨迹或起止位姿到可执行的逐步关节动作的规划与验证",
          "expected_output": "按时间顺序的离散关节增量序列（每行6个值，度为单位；Excel/.xlsx 文件），每步附带末端位置、最小碰撞距离与诊断日志；可复用的代码模块（规划器、碰撞检测、量化器、日志导出）和配置参数文件",
          "key_inputs_constraints": "1) 机器人运动学与雅可比（函数 f(Θ)、Jp(Θ)，数值或代码接口）；2) 初始关节向量 Θ0（6维实数，度或弧度）与各关节上下限（θ_min, θ_max）；3) 障碍物几何（解析圆台与任意网格/三角形表示）；4) 控制约束：单步 |Δθ_i|≤2°、量化步长0.1°、位置终止阈值 ε_pos（建议0.2–0.5 mm）；5) 连杆粗细（胶囊半径）与碰撞模型（连续碰撞检测）",
          "modeling_type": "优化+仿真+生成",
          "role_in_pipeline": "作为执行层之前的运动规划器：依赖子任务1的正运动学/雅可比模块和子任务2的逆运动学/量化策略，输出可直接送入机器人控制器的量化关节增量序列；后序为执行与实时监控/再规划模块。"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "识别控制量化与单步约束（Δθ≤2°，步长0.1°）",
              "description": "明确指出任务关键控制约束：单步角增量上限2°以及量化网格0.1°，并说明这些约束如何影响轨迹细分与误差传播",
              "score": 30,
              "evaluation_focus": "约束识别",
              "scoring_hint": "高分：准确列出Δθ≤2°和0.1°量化、并能定量估计单步量化导致的末端位移上界；中分：列出约束但无量化误差估计；低分：遗漏或错误描述量化/单步上限。"
            },
            {
              "sub_criteria": "识别碰撞检测需求（离散+连续/扫掠检测）",
              "description": "指出需实现离散位置碰撞检测与步间连续（swept-volume）碰撞检测，并明确将连杆建模为胶囊用于检测加速",
              "score": 25,
              "evaluation_focus": "碰撞识别",
              "scoring_hint": "高分：明确离散与连续碰撞检测并提出胶囊/解析模型与加速结构（AABB/八叉树）；中分：只提离散碰撞或仅提胶囊模型；低分：未识别连续碰撞或无具体模型。"
            },
            {
              "sub_criteria": "识别工作空间→配置空间映射与采样挑战（窄通道、可达性）",
              "description": "指出将工作空间曲线映射到C-space可能引起可达性与窄通道问题，需采样式规划（RRT/PRM）与目标偏置采样等策略",
              "score": 25,
              "evaluation_focus": "可达性识别",
              "scoring_hint": "高分：说明窄通道风险并列出RRT-Connect/PRM、桥接/目标偏置采样作为对策；中分：提及采样但无针对窄通道策略；低分：忽视C-space采样难点。"
            },
            {
              "sub_criteria": "识别性能与终止指标（ε_pos、时间、步数、最小安全间隙）",
              "description": "明确任务应报告位置终止阈值ε_pos、规划时间限制、最大步数和最小碰撞安全间隙（例如≥2 mm）作为可验证指标",
              "score": 20,
              "evaluation_focus": "指标识别",
              "scoring_hint": "高分：给出数值阈值（ε_pos 0.2–0.5 mm、最小间隙≥2 mm、可接受时间≤60s等）；中分：列出指标但无数值；低分：未定义可验证指标。"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "复述核心目标：生成无碰撞关节增量序列",
              "description": "用任务关键词复述：生成并优化‘无碰撞’、‘关节增量指令序列’以满足量化（0.1°）和单步上限（2°）",
              "score": 40,
              "evaluation_focus": "目标复述",
              "scoring_hint": "高分：清晰复述并包含‘无碰撞’、‘关节增量’、‘量化0.1°’、‘Δθ≤2°’等关键词；中分：复述部分要点；低分：目标模糊或关键词缺失。"
            },
            {
              "sub_criteria": "复述输出格式与元数据要求（Excel、每步诊断）",
              "description": "明确输出为每步6维增量的Excel文件，并要求附带每步末端位置、最小碰撞距离与是否为细化步等诊断信息",
              "score": 35,
              "evaluation_focus": "输出规格",
              "scoring_hint": "高分：列出Excel格式与每步必备字段（末端位置、最小距离、细化标记）；中分：仅指Excel或仅列部分字段；低分：未指明输出格式或诊断信息。"
            },
            {
              "sub_criteria": "复述依赖模块（f,Jp、IK、碰撞库）",
              "description": "明确指出规划器依赖子任务1的正运动学/雅可比、子任务2的逆解与量化策略及碰撞库（如FCL/Bullet）",
              "score": 25,
              "evaluation_focus": "依赖说明",
              "scoring_hint": "高分：正确列出 f(Θ), Jp(Θ), IK/量化、OMPL/FCL 等依赖；中分：提及部分依赖；低分：漏列关键依赖模块。"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "几何与碰撞建模假设（胶囊近似、静态障碍）",
              "description": "明确将连杆近似为胶囊、障碍物为解析圆台或三角网格，假定障碍与机器人为刚体、环境静态不考虑动力学影响",
              "score": 30,
              "evaluation_focus": "几何假设",
              "scoring_hint": "高分：完整说明胶囊近似、解析/网格表示及静态、刚体假设并讨论误差来源；中分：部分说明假设；低分：未声明或不合理假设。"
            },
            {
              "sub_criteria": "运动学与动力学简化假设（准静态、速度/惯性忽略）",
              "description": "说明忽略动力学惯性与速度限制（准静态规划），只考虑几何碰撞与角增量约束，如需考虑动力学须在假设中注明",
              "score": 25,
              "evaluation_focus": "动力学假设",
              "scoring_hint": "高分：明确准静态假设并指出何时需扩展到动力学约束；中分：声明但无扩展讨论；低分：未声明或与任务不符。"
            },
            {
              "sub_criteria": "采样密度与线性化假设（雅可比灵敏度触发细化）",
              "description": "假定曲线采样可用雅可比范数估计映射敏感度，保证每段在最坏情况下可被分割为满足|Δθ|≤2°的若干步",
              "score": 25,
              "evaluation_focus": "线性化假设",
              "scoring_hint": "高分：给出用||J||或灵敏度估计采样间距并定量计算最大角步数；中分：提出但无定量；低分：未考虑采样与线性化影响。"
            },
            {
              "sub_criteria": "数值容差与终止准则假设（ε_pos、最大迭代/时间）",
              "description": "声明位置终止阈值ε_pos范围（建议0.2–0.5 mm）、最大规划时间或迭代次数及最小允许安全间隙",
              "score": 20,
              "evaluation_focus": "容差设定",
              "scoring_hint": "高分：给出具体ε_pos及时间/迭代上限并说明设置依据；中分：给出默认值但无依据；低分：无明确容差或不现实。"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "采样式全局规划器选择与配置（RRT-Connect/PRM，OMPL）",
              "description": "构建C-space采样规划模块（推荐RRT-Connect或PRM，结合OMPL），并说明采样偏置、步长与连通性策略以解决窄通道",
              "score": 25,
              "evaluation_focus": "采样规划",
              "scoring_hint": "高分：明确选择RRT-Connect或PRM并给出参数（采样率、目标偏置、最大扩展节点数）；中分：提出采样法但无参数；低分：未指定或选型不当。"
            },
            {
              "sub_criteria": "轨迹优化与约束表达（CHOMP/TrajOpt/受限SQP）",
              "description": "建立轨迹优化模型，目标包含碰撞代价、关节限幅、单步|Δθ|上限或作为硬约束，说明优化器与约束松弛策略",
              "score": 25,
              "evaluation_focus": "轨迹优化",
              "scoring_hint": "高分：给出优化目标、约束形式并选用CHOMP/TrajOpt或带约束的SQP；中分：仅概述优化方向；低分：未考虑优化或约束表达错误。"
            },
            {
              "sub_criteria": "碰撞模型与加速结构设计（胶囊、AABB/八叉树、FCL）",
              "description": "构建胶囊连杆与解析/网格障碍的碰撞模型，选用AABB/八叉树或KD-tree加速并推荐FCL/Bullet作精确检测与连续碰撞检测",
              "score": 25,
              "evaluation_focus": "碰撞模型",
              "scoring_hint": "高分：明确胶囊半径、加速结构和使用FCL/Bullet做CCD并描述实现要点；中分：有模型但无加速策略；低分：无明确碰撞建模方案。"
            },
            {
              "sub_criteria": "曲线采样与映射密度策略（雅可比驱动的自适应采样）",
              "description": "提出基于雅可比敏感度估计的等弧长或自适应采样策略，保证映射后可在有限步内满足Δθ约束",
              "score": 25,
              "evaluation_focus": "采样策略",
              "scoring_hint": "高分：给出具体算法（基于||J||估计步长并计算分段数）；中分：描述思路无细节；低分：未考虑采样密度问题。"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "全局路径求解可行性与成功策略（RRT-Connect/PRM 成功率）",
              "description": "评估并实现采样规划求解过程，包括重连策略、局部重规划与窄通道增强采样以提高可达率",
              "score": 30,
              "evaluation_focus": "路径求解",
              "scoring_hint": "高分：成功找到碰撞自由路径且可证明或实验给出成功率（例如>90% 在给定场景）或给出重连策略；中分：能求解多数场景但无成功率说明；低分：频繁失败或无恢复策略。"
            },
            {
              "sub_criteria": "轨迹优化收敛性与约束满足（碰撞、关节限位与Δθ）",
              "description": "在轨迹优化后保证路径满足碰撞约束、关节上下限和每步|Δθ|可被细分为≤2°的离散步序列",
              "score": 25,
              "evaluation_focus": "约束满足",
              "scoring_hint": "高分：优化后路径经离散化与量化仍满足所有约束且无碰撞；中分：需局部细化或微幅回退；低分：优化无法满足硬约束或仍存在碰撞。"
            },
            {
              "sub_criteria": "量化与残差补偿（0.1°网格与carry-over策略）",
              "description": "实现对连续ΔΘ的步段化与0.1°量化，保留并累积四舍五入残差以防止抖动或无限循环",
              "score": 25,
              "evaluation_focus": "量化算法",
              "scoring_hint": "高分：明确carry-over实现并演示可避免量化震荡；中分：实施量化但无残差补偿；低分：量化导致抖动或无限迭代未处理。"
            },
            {
              "sub_criteria": "碰撞细化与回退策略（步细化、局部再连通）",
              "description": "对量化后每步执行连续碰撞检测，若碰撞则二分细化或回退并触发局部重规划，直至满足或报告不可行",
              "score": 20,
              "evaluation_focus": "鲁棒性",
              "scoring_hint": "高分：细化/局部重规划能处理绝大多数冲突并成功恢复；中分：部分情况需人工调整；低分：碰撞后无有效回退。"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "模块化接口与可复用实现（输入:f,Jp,障碍,输出:Excel与日志）",
              "description": "代码应提供清晰接口：接收运动学、障碍几何、初始Θ与约束，返回量化的关节增量Excel与逐步日志；具备配置文件",
              "score": 30,
              "evaluation_focus": "工程化",
              "scoring_hint": "高分：提供文档化API、示例和配置并能直接运行产生answer.xlsx；中分：有实现但接口不够清晰或缺示例；低分：代码不可复现或无接口说明。"
            },
            {
              "sub_criteria": "单元测试与验证用例（含Θ0与典型场景）",
              "description": "包含若干单元测试：正运动学/雅可比验证、碰撞检测单元、采样规划与量化例子（至少用Θ0与题目给定数据）",
              "score": 25,
              "evaluation_focus": "测试覆盖",
              "scoring_hint": "高分：覆盖关键模块与题目示例并能自动验证结果；中分：仅部分模块有测试；低分：无单元测试或无法复现。"
            },
            {
              "sub_criteria": "性能与加速结构实现（AABB/八叉树、并行检测）",
              "description": "实现碰撞加速结构与批量/并行检测以保证规划效率，并衡量运行时（如平均规划时长）",
              "score": 25,
              "evaluation_focus": "性能",
              "scoring_hint": "高分：使用AABB/八叉树/FCL并给出运行时数据（如≤60s），并行化关键检测；中分：有加速但无性能数据；低分：无加速导致不可用性能。"
            },
            {
              "sub_criteria": "鲁棒性与异常处理（边界、奇异、不可达返回）",
              "description": "实现对关节越界、奇异性、不可达目标的检测与友好返回（当前最优解、错误码、建议重规划）",
              "score": 20,
              "evaluation_focus": "鲁棒性",
              "scoring_hint": "高分：完整异常处理并记录错误码与当前解；中分：部分异常处理；低分：异常导致崩溃或未返回有用信息。"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "最终序列验证指标（末端误差≤ε_pos、每步|Δθ|≤2°、量化误差估计）",
              "description": "报告并示证最终序列满足位置终止阈值ε_pos、每步角增量约束与量化引入的末端位移上界估算",
              "score": 30,
              "evaluation_focus": "约束验证",
              "scoring_hint": "高分：给出数值证明（末端误差≤0.5 mm、所有步满足Δθ≤2°）并量化量化误差上界；中分：满足但无量化误差估计；低分：有违反约束或未验证。"
            },
            {
              "sub_criteria": "碰撞安全性分析（最小清晰距离、连续碰撞验证）",
              "description": "给出路径沿序列的最小碰撞间隙统计（例如最小距离mm），并证明所有量化步的连续碰撞检测通过",
              "score": 25,
              "evaluation_focus": "安全性",
              "scoring_hint": "高分：最小间隙≥2 mm且CCD无穿透记录；中分：间隙>0但<2 mm 或少量细化步骤；低分：存在未解决碰撞。"
            },
            {
              "sub_criteria": "效率与复杂度分析（规划时长、步数、优化迭代次数）",
              "description": "报告规划总用时、输出步数、平均每步计算时间及优化迭代统计，评估能否在工程接受范围内运行",
              "score": 25,
              "evaluation_focus": "效率分析",
              "scoring_hint": "高分：完整列出时间/步数并满足工程阈值（例如整体规划≤60s）；中分：有数据但超时或无阈值比较；低分：无性能数据或不可接受的超长时间。"
            },
            {
              "sub_criteria": "敏感性与鲁棒性分析（对连杆半径、量化步长的影响）",
              "description": "分析关键参数（胶囊半径、量化步长、ε_pos）对可行性与步数的影响，并给出设计建议或容差范围",
              "score": 20,
              "evaluation_focus": "敏感性",
              "scoring_hint": "高分：给出参数-结果曲线并提出改进建议；中分：定性讨论影响；低分：未做敏感性分析。"
            }
          ]
        }
      }
    },
    "4": {
      "subtask": "子任务4的目标是负责该机械臂运动与规划系统的工程实现、性能评估、定量验证与部署准备：范围包括把逆运动学与轨迹生成算法、碰撞检测与配置空间规划器、量化与单步角度约束、以及运行时监控与日志整合为一个可测试的软硬件模块，并提供明确的验证准则、性能基线和改进建议；具体任务步骤为——(1) 实现并集成模块化的软件组件：数值运动学与雅可比例程（利用高效矩阵库如Eigen/BLAS或NumPy/SciPy），阻尼最小二乘与小维QP求解器（如OSQP或QPOASES），轨迹优化器（CHOMP/TrajOpt或等价实现），采样规划器（推荐使用OMPL）与连续/离散碰撞检测（使用FCL或Bullet并基于AABB/八叉树加速）；(2) 为碰撞检测与几何操作建立统一的数据接口，要求输入为：机器人几何参数（连杆中心线与半径）、关节极限与初始配置、障碍物几何（解析表面与/或三角网格），以及控制约束（单步|Δθ|≤2°、量化0.1°）；(3) 实现运行时约束与保护：在每次角增量生成前强制幅值上限与量化、在遇到雅可比病态时基于最小奇异值σ_min（阈值建议0.01）自适应增大阻尼并记录事件；(4) 嵌入精细的性能与安全监控逻辑，实时记录并输出每步的关节状态、末端位置残差、σ_min、DLS阻尼系数、最小碰撞距离、所用时间及是否触发回退/重规划；(5) 设计并执行分阶段验证流程：单元测试（正/逆运动学与雅可比的一致性检查）、仿真验证（刚体动力学/碰撞仿真覆盖典型工况）、慢速实机验证（低速追踪以采集实际误差并校准模型参数），每阶段按预定义指标判定通过；(6) 定量性能与验收标准要明确：IK单次求解延迟目标例如≤5 ms（平均），单次碰撞检测延迟目标例如≤2 ms（均摊并支持并行化），闭环位置精度在仿真与实机上应低于ε_pos（建议≤0.2 mm），规划成功率在样本场景中≥95%，轨迹执行过程的最小安全间隙≥连杆半径＋1 mm；(7) 性能优化与工程化建议包括：用并行线程或向量化加速大量碰撞检查、使用层次化包围体减少昂贵最近点查询、在规划器中采用分层策略（粗规划→局部优化→量化+碰撞确认），并对关键路径点缓存IK解以加快重复查询；(8) 日志与报告规范化：输出时间戳的逐步执行日志和汇总性能报告（包含平均/最大时延、误差统计、重规划次数和最小距离分布），并导出最终可执行的量化指令序列和一份回放可视化数据包以便离线复现；(9) 制定回归测试套件与持续集成流程，确保每次算法或参数更改后自动运行覆盖性测试并比较关键性能指标；(10) 明确交付物为：可编译/可运行的软件包与接口说明、完整的测试用例与仿真场景、逐步执行日志样本与性能报告、以及针对未达标项的具体工程改进优先级建议。",
      "criteria": {
        "task_understanding": {
          "core_goal": "集成与评估机械臂运动与规划系统，优化求解与监控以满足实时性与安全性指标并输出可执行离散指令序列与日志报告",
          "expected_output": "可编译/可运行的软件包与接口说明；按行6值的量化关节增量序列文件；时间戳执行日志与汇总性能报告（平均/最大时延、ε_pos残差、σ_min与阻尼、最小碰撞距离、重规划次数）；仿真与实机验证用例与结果；回归测试与CI配置",
          "key_inputs_constraints": "输入：正/逆运动学与雅可比函数、几何参数（连杆中心线与半径）、关节极限、障碍物几何（解析/网格）、控制约束（|Δθ|≤2°、量化0.1°）、阈值参数（ε_pos≤0.2–0.5 mm、σ_min阈值≈0.01、N_max）；约束：实时性（IK≤5 ms、碰撞检测≤2 ms），安全（最小间隙≥连杆半径+1 mm），精度（闭环误差≤ε_pos），规划成功率≥95%",
          "modeling_type": "仿真+优化+评价",
          "role_in_pipeline": "作为系统工程集成与最终验证环节：前序依赖子任务1（正运动学/雅可比）、子任务2（逆运动学与离散指令生成）、子任务3（无碰撞规划与碰撞检测）；后续为部署与实机运行。负责将前序算法组件集成为可测系统并提供性能与安全评估基线",
          "assumptions": "允许使用NumPy/SciPy、OSQP/qpOASES、OMPL与FCL/Bullet；仿真以准静态碰撞为主，动力学仅用于验证跟踪误差；度/弧度统一在接口层转换"
        },
        "evaluation_criteria": {
          "问题识别": [
            {
              "sub_criteria": "实时性与安全性指标识别（IK≤5 ms、碰撞≤2 ms、最小间隙）",
              "description": "是否明确系统需同时满足IK单次求解延迟≤5 ms、单次碰撞检测≤2 ms及最小安全间隙≥连杆半径+1 mm的目标，并将其作为硬指标贯穿设计",
              "score": 30,
              "evaluation_focus": "指标把握",
              "scoring_hint": "高分：三项指标皆被列为约束并量化监控；中分：提到部分指标或无量化阈值；低分：未识别实时/安全关键指标"
            },
            {
              "sub_criteria": "离散指令与量化约束（|Δθ|≤2°、步长0.1°）定位",
              "description": "能否将关节单步幅值上限与量化网格视为控制接口硬约束并贯穿规划与执行链路",
              "score": 25,
              "evaluation_focus": "约束理解",
              "scoring_hint": "高分：在规划、QP与下发均检查并量化；中分：只在输出层量化；低分：忽视或偶发越界"
            },
            {
              "sub_criteria": "σ_min与阻尼自适应的鲁棒性需求",
              "description": "识别通过最小奇异值σ_min（阈值≈0.01）触发DLS阻尼增大与记录事件的必要性",
              "score": 25,
              "evaluation_focus": "鲁棒性",
              "scoring_hint": "高分：定义阈值、记录与回退策略；中分：仅提及阻尼无触发逻辑；低分：未考虑奇异性"
            },
            {
              "sub_criteria": "验证流程三阶段覆盖（单元/仿真/实机）",
              "description": "是否把单元一致性、仿真覆盖典型工况、慢速实机校准作为必需阶段并设通过准则",
              "score": 20,
              "evaluation_focus": "测试规划",
              "scoring_hint": "高分：三阶段与判定阈值齐备；中分：缺一阶段或无阈值；低分：无系统化验证"
            }
          ],
          "问题复述": [
            {
              "sub_criteria": "系统集成范围完整复述（IK/QP/规划/碰撞/量化/监控）",
              "description": "准确复述需集成的组件与数据流：运动学→求解→规划→量化→碰撞→执行→监控→日志",
              "score": 30,
              "evaluation_focus": "系统理解",
              "scoring_hint": "高分：逐模块与接口清晰；中分：模块列举不全；低分：描述零散"
            },
            {
              "sub_criteria": "输入接口统一性与几何数据（胶囊、网格）",
              "description": "复述统一几何/约束接口：连杆中心线与半径、障碍解析/网格、关节极限与阈值",
              "score": 25,
              "evaluation_focus": "接口定义",
              "scoring_hint": "高分：字段完备且单位/坐标明确；中分：缺单位或部分字段；低分：未统一接口"
            },
            {
              "sub_criteria": "性能与验收标准复述（成功率≥95%、ε_pos≤0.2 mm）",
              "description": "清晰陈述规划成功率、闭环精度、时延统计口径（平均/最大）与最小距离分布",
              "score": 25,
              "evaluation_focus": "指标复述",
              "scoring_hint": "高分：数值阈值齐全；中分：部分阈值；低分：无阈值或模糊"
            },
            {
              "sub_criteria": "日志与报告规范（时间戳、σ_min、阻尼、重规划）",
              "description": "复述需要记录并汇总的关键监控字段与导出格式",
              "score": 20,
              "evaluation_focus": "可追溯性",
              "scoring_hint": "高分：字段与格式明确；中分：字段不全；低分：未设计日志"
            }
          ],
          "假设建立": [
            {
              "sub_criteria": "库与工具链假设（NumPy/OSQP/OMPL/FCL或Bullet）",
              "description": "明确依赖库与替代方案，并说明对平台/线程/并行的基本假设",
              "score": 25,
              "evaluation_focus": "工程假设",
              "scoring_hint": "高分：主备库与兼容性说明；中分：仅列主库；低分：无工具链假设"
            },
            {
              "sub_criteria": "度/弧度与单位一致性假设（ε_pos单位mm）",
              "description": "声明接口层度↔弧度转换与长度单位统一，避免单位错误",
              "score": 25,
              "evaluation_focus": "一致性",
              "scoring_hint": "高分：转换位置与校验策略明确；中分：仅口头说明；低分：未提"
            },
            {
              "sub_criteria": "动力学简化与碰撞模型（胶囊+连续检测）",
              "description": "阐明以几何碰撞为主、准静态控制误差建模方式与扫掠体检测假设",
              "score": 25,
              "evaluation_focus": "建模边界",
              "scoring_hint": "高分：连续碰撞与加速结构假设清楚；中分：只离散检测；低分：未定义"
            },
            {
              "sub_criteria": "σ_min阈值与阻尼策略选择依据",
              "description": "给出σ_min≈0.01与阻尼调节范围的经验或文献依据",
              "score": 25,
              "evaluation_focus": "数理依据",
              "scoring_hint": "高分：有阈值与调整规则；中分：仅阈值；低分：无依据"
            }
          ],
          "模型构建": [
            {
              "sub_criteria": "模块化架构设计（IK/QP/规划/碰撞/量化/监控耦合）",
              "description": "是否以清晰API拆分并定义数据结构（关节向量、AABB、日志记录）与调用顺序",
              "score": 30,
              "evaluation_focus": "架构设计",
              "scoring_hint": "高分：时序与接口图或等价描述；中分：接口不完整；低分：耦合混乱"
            },
            {
              "sub_criteria": "约束嵌入（|Δθ|≤2°与0.1°量化在QP/下发）",
              "description": "在QP目标与不等式中建模幅值上限与网格量化并含残差补偿",
              "score": 25,
              "evaluation_focus": "约束建模",
              "scoring_hint": "高分：QP+量化残差策略；中分：仅截断；低分：无建模"
            },
            {
              "sub_criteria": "碰撞检测模型（胶囊-解析/网格，连续检测与BVH）",
              "description": "构建FCL/Bullet数据管线与AABB/八叉树加速，并支持扫掠查询",
              "score": 25,
              "evaluation_focus": "几何建模",
              "scoring_hint": "高分：连续检测+加速结构；中分：仅离散检测；低分：缺失"
            },
            {
              "sub_criteria": "监控与日志指标定义（σ_min、阻尼、最小距离、时延）",
              "description": "设计可观测变量与事件钩子，确保回放与回归可用",
              "score": 20,
              "evaluation_focus": "可观测性",
              "scoring_hint": "高分：指标齐全含时间戳；中分：部分字段；低分：无监控"
            }
          ],
          "模型求解": [
            {
              "sub_criteria": "DLS/LM求解与σ_min自适应阻尼",
              "description": "实现J基于SVD的DLS，σ_min<阈值增大阻尼并记录事件",
              "score": 30,
              "evaluation_focus": "数值稳定",
              "scoring_hint": "高分：SVD+阈值+日志；中分：无SVD或无日志；低分：不稳定或发散"
            },
            {
              "sub_criteria": "小维QP求解（关节限幅与|Δθ|≤2°）",
              "description": "构造并稳定求解带正则的QP，保证可行性与速度",
              "score": 25,
              "evaluation_focus": "优化实现",
              "scoring_hint": "高分：可行性处理与毫秒级；中分：可解但慢；低分：频繁不可行"
            },
            {
              "sub_criteria": "采样规划与连续碰撞验证（OMPL+FCL）",
              "description": "RRT-Connect/PRM生成路径并做扫掠碰撞确认与局部细化/回退",
              "score": 25,
              "evaluation_focus": "规划能力",
              "scoring_hint": "高分：成功率≥95%且无碰撞；中分：偶发失败；低分：频繁碰撞或失败"
            },
            {
              "sub_criteria": "量化与残差累积策略的稳定性",
              "description": "四舍五入到0.1°并累积残差避免抖动与零步死循环",
              "score": 20,
              "evaluation_focus": "离散控制",
              "scoring_hint": "高分：无零步/抖动问题；中分：偶发抖动；低分：经常卡死"
            }
          ],
          "代码实现": [
            {
              "sub_criteria": "性能达标（IK≤5 ms、碰撞≤2 ms，向量化/并行）",
              "description": "采用Eigen/BLAS或NumPy向量化，线程化批量碰撞以满足时延",
              "score": 30,
              "evaluation_focus": "性能工程",
              "scoring_hint": "高分：稳定低于目标且有统计；中分：偶超标；低分：显著超标"
            },
            {
              "sub_criteria": "健壮性与错误处理（越界、不可达、回退/重规划）",
              "description": "完备的输入校验、异常码、超时与回退路径生成",
              "score": 25,
              "evaluation_focus": "可靠性",
              "scoring_hint": "高分：错误覆盖全面；中分：部分覆盖；低分：崩溃或静默失败"
            },
            {
              "sub_criteria": "接口与文档（统一几何/约束API、单位说明）",
              "description": "清晰函数签名、单位与坐标系说明、示例调用与CI脚本",
              "score": 25,
              "evaluation_focus": "可用性",
              "scoring_hint": "高分：文档与示例完善；中分：文档不全；低分：难以复用"
            },
            {
              "sub_criteria": "日志与可视化导出（时间戳、回放包）",
              "description": "逐步日志、汇总报告与可复现回放数据包导出",
              "score": 20,
              "evaluation_focus": "可追溯性",
              "scoring_hint": "高分：一键回放；中分：仅原始日志；低分：无导出"
            }
          ],
          "结果分析": [
            {
              "sub_criteria": "性能报告解读（平均/最大时延、重规划次数）",
              "description": "对统计指标进行对比与瓶颈定位，提出量化改进建议",
              "score": 30,
              "evaluation_focus": "数据解读",
              "scoring_hint": "高分：定位瓶颈并量化收益；中分：定性描述；低分：无分析"
            },
            {
              "sub_criteria": "精度与安全性验证（ε_pos、最小碰撞距离分布）",
              "description": "展示误差CDF/箱线图与最小间隙直方图，验证是否满足阈值",
              "score": 25,
              "evaluation_focus": "统计验证",
              "scoring_hint": "高分：图表+阈值对比通过；中分：图表不全；低分：未验证或不达标无对策"
            },
            {
              "sub_criteria": "鲁棒性事件分析（σ_min触发与阻尼调整日志）",
              "description": "统计奇异性触发频次、位置与影响，评估DLS策略有效性",
              "score": 25,
              "evaluation_focus": "鲁棒性评估",
              "scoring_hint": "高分：有案例与改进阈值；中分：仅计数；低分：未分析"
            },
            {
              "sub_criteria": "回归测试与CI结果比较",
              "description": "展示关键基准随提交的变化与是否触发回归告警",
              "score": 20,
              "evaluation_focus": "质量控制",
              "scoring_hint": "高分：自动基线比较与门禁；中分：手工记录；低分：无回归机制"
            }
          ]
        }
      }
    }
  }
}